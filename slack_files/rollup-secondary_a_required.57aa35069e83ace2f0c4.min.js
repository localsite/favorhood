(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["rollup-secondary_a_required","TS.enterprise","TS.utility"],{"+J8v":function(e,t){(function(){TS.registerModule("ui.react_file_menu",{onStart:function t(){e=l(s)},showFileMenu:function r(n,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=a.model_ob_id,l=a.thread_ts;t=$(n&&n.target);var u=s;u||(u=TS.model.active_channel_id);var d={channelId:u,ts:l,onMenuItemSelected:TS.ui.react_file_menu.closeFileMenu};var c=o();t.closest("#primary_file_button").addClass("active");TS.tips.hideAll();TS.interop.mountNewFileMenu(TS.interop.selfTeamIds.getTeamId(TS.redux.getState()),e,d,c)},closeFileMenu:function r(){if(t){t.closest("#primary_file_button").removeClass("active");t=null}TS.tips.unhideAll();TS.interop.mountNewFileMenu(TS.interop.selfTeamIds.getTeamId(TS.redux.getState()),e,{},{isOpen:false})}});var e;var t;var r=15;var n=46;var i="top-left";var a={x:0,y:-6};var s="reactroot_new_file_menu";var o=function e(){return{targetBounds:t?t.dimensions_rect():{},position:i,allowanceX:n,allowanceY:r,offsetX:a.x,offsetY:a.y,isOpen:true,onClose:TS.ui.react_file_menu.closeFileMenu}};var l=function e(){if(!document.getElementById(s)){var t=document.createElement("div");t.setAttribute("id",s);document.body.appendChild(t)}return document.getElementById(s)}})()},"/q0e":function(e,t,r){var n=r("lSNA");function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}));r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),true).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}(function(){TS.registerModule("redux.messages",{addMessages:function e(t,r,n){var i=_.some(t,function(e){var t=TS.redux.messages.getMessageByTimestamp(e.channel,e.ts);return!t});TS.interop.messages.addMessages(t);if(r){var a=t&&t[0]&&t[0].channel;var s=_.map(t,"ts");TS.interop.messages.markObjectsAsFresh(TS.model.team.id,a,s);var o={};n&&(o={oldest:_.min(s),hasMore:false});TS.redux.dispatch(TS.interop.redux.models.channelHistory.addTimestamps(_.assign({channelId:a,timestamps:s},o)))}return i},addMessage:function t(r,n,i){if(!r||!r.channel||!r.ts)return;var s=TS.redux.messages.getMessageByTimestamp(r.channel,r.ts);var o;TS.boot_data.feature_add_message_perf&&(o=window.performance&&window.performance.now());TS.interop.messages.addMessages([r]);if(TS.boot_data.feature_add_message_perf){var l=window.performance&&window.performance.now();if(l-o>200){e%10===0&&TS.interop.utility.getLogger({getState:TS.redux.getState}).error({duration:l-o,channel:r.channel,user:r.user,bot:r.bot_id,counter:e,channel_num_messages:_.size(TS.redux.getState().messages[r.channel])},"TS.redux.messages.addMessage took over 200ms",{subtype:"addMessage_perf"});e+=1}}var u=r.channel,d=r.ts,c=r.thread_ts;var m={channelId:u,timestamps:[d],fromEvtLog:!!i};if(n){m.oldest=d;m.hasMore=false;m.append=true}TS.interop.messages.markObjectsAsFresh(TS.model.team.id,u,[d]);TS.redux.dispatch(TS.interop.redux.models.channelHistory.addTimestamps(m));TS.interop.messages.isReply(r)&&TS.redux.dispatch(TS.interop.redux.models.channelHistory.addTimestamps(a({},m,{channelId:TS.interop.threads.getThreadKey(u,c)})));return!s},replaceMessage:function e(t,r){if(!t||!t.channel||!t.ts)return;var n=false;TS.redux.messages.addMessage(t,n,r)},removeMessage:function e(t,r){if(!t||!t.channel||!t.ts)return;TS.redux.dispatch(TS.interop.redux.actions.maybeAnimateDeleteMessage({channelId:t.channel,ts:t.ts,threadTs:t.thread_ts,fromEvtLog:r}))},channelHistoryChanged:function e(t){TS.redux.dispatch(TS.interop.redux.models.channelHistory.removeAllTimestamps({channelId:t}))},getMessageByTimestamp:function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!TS.interop.messages.getMessageByTimestamp)return null;return TS.interop.messages.getMessageByTimestamp(t,r,n)},getMessagesInChannel:function e(t,r,n){if(!t)return[];void 0===n&&(n=true);var i=TS.interop.redux.models.channelHistory.getTimestampsByChannelId(TS.redux.getState(),t,r);var a=TS.interop.messages.getMessagesByChannelId(t);var s=i&&i.timestamps||[];var o=_(s).map(function(e){return a[e]}).compact().value();o=TS.interop.messages.computeRollups(o).messages;var l=_(o).reject(TS.interop.rules.messages.isHidden).sortBy("ts");return n?l.reverse().value():l.value()},getRecentMessagesInChannel:function e(t,r){return TS.redux.messages.getMessagesInChannel(t,null,r)},getRecentMessagesInThread:function e(t,r,n){if(!t||!r)return[];var i=TS.interop.redux.models.channelHistory.getTimestampsByChannelId(TS.redux.getState(),TS.interop.rules.threads.getThreadKey(t,r),null);if(!i)return[];var a=_.map(i.timestamps,function(e){return TS.redux.messages.getMessageByTimestamp(t,e)});if(!n)return a;return _.reverse(a)},getLastMessageInChannel:function e(t){if(!t)return null;var r=TS.interop.redux.models.channelHistory.getTimestampsByChannelId(TS.redux.getState(),t);var n=r&&r.timestamps||[];var i=_.last(n);if(!i)return null;return TS.redux.messages.getMessageByTimestamp(t,i)},getExpandablesInChannel:function e(t){var r=TS.redux.messages.getMessagesInChannel(t,null,false);return _(r).map(function(e){var t=e.ts;if(e.file)return TS.interop.messages.getExpandableKey("file",t,{id:e.file});if(e.files)return TS.interop.messages.getExpandableKey("files",t,{fileIds:e.files});if("sh_room_shared"===e.subtype||"sh_room_created"===e.subtype)return TS.interop.messages.getExpandableKey("call",t,{id:e._call_id});if(e.attachments)return _.map(e.attachments,function(e){return TS.interop.messages.getExpandableKey("attachment",t,{id:e.id,imageUrl:e.image_url,audioHtml:e.audio_html,videoHtml:e.video_html,thumbUrl:e.thumb_url})});return null}).flatten().compact().value()},getMessagesByProp:function e(t,r){var n=TS.interop.messages.getMessagesByProps(t,r);return _(n).sortBy("ts").reverse().value()},getMessagesByChannelId:function e(t,r){void 0===r&&(r=true);var n=TS.interop.messages.getMessagesByChannelId(t);return r?_(n).sortBy("ts").reverse().value():_(n).sortBy("ts").value()},recordDeletedMessage:function e(t,r){TS.redux.dispatch(TS.interop.redux.features.deletedMessages.recordMessageDeleted({channelId:t,ts:r}))},wasMessageDeleted:function e(t,r){var n=TS.redux.getState();return TS.interop.redux.features.deletedMessages.wasMessageDeleted(n,{channelId:t,ts:r})}});var e=0})()},"/xdr":function(e,t){(function(){TS.registerModule("redux.prefs",{setUserPrefs:function e(t){TS.interop.prefs.setUserPrefs(t)},setTeamPrefs:function e(t){TS.interop.prefs.setTeamPrefs(t)},setEnterprisePrefs:function e(t){TS.interop.prefs.setEnterprisePrefs({prefs:t})},setUserPref:function e(t,r){if(TS.redux.prefs.getUserPref(t)===r)return;TS.interop.prefs.setUserPref({pref:t,value:r})},setMultipleUserPrefs:function e(t){TS.interop.prefs.setMultipleUserPrefs(t)},setTeamPref:function e(t,r){if(TS.redux.prefs.getTeamPref(t)===r)return;TS.interop.prefs.setTeamPref({pref:t,value:r})},setChannelNotificationOverrideAndCallApi:function e(t,r,n){TS.interop.prefs.setChannelNotificationOverrideAndCallApi({name:t,value:r,channelId:n})},getUserPref:function e(t){return TS.interop.prefs.getUserPref(t)},getTeamPref:function e(t){return TS.interop.prefs.getTeamPref(t)},test:function e(){var t={};return t}})})()},"16zC":function(e,t){(function(){TS.registerModule("tabcomplete",{positionUIRelativeToInput:function e(t,r,n){if(!t||!r)return;var i=$(r).offset();t.style.left=i.left+"px";var a;if(n){var s=i.top+$(r).height()+2;t.style.top=s+"px";a=$(window).height()-s}else{t.style.bottom=$(window).height()-i.top+"px";a=i.top}var o=_.clamp(a-$(t).find(".tab_complete_ui_header").outerHeight()-2,454);$(t).find(".tab_complete_ui_scroller").css("maxHeight",o+"px")},render:function e(t,r,n,i){switch(t){case"members":return TS.tabcomplete.members.render(r,n,i);case"commands":return TS.tabcomplete.commands.render(r,n,i);case"emoji":return TS.tabcomplete.emoji.render(r,n,i);case"channels":return TS.tabcomplete.channels.render(r,n,i);default:TS.warn('TS.tabcomplete: unknown render type "'+t+'"')}},renderMenu:function e(t,r){return TS.templates.tabcomplete_menu({safe_header_html:new Handlebars.SafeString(t),safe_results_html:new Handlebars.SafeString(r)})},onSelectedIndexChange:function e(t){var r=$(".tab_complete_ui_item");r.removeClass("active");r.removeAttr("aria-selected");r.eq(t).addClass("active").attr("aria-selected","true");r.eq(t).scrollintoview({duration:0})},trimTrailingCharacterModifier:function t(r){if(!r)return"";return r.replace(e,"")}});var e=/[`\xb4\u02c6\xa8\u02dc]$/})()},"2h3S":function(e,t){(function(){TS.registerModule("inline_others",{no_scrolling:false,expand_sig:new signals.Signal,collapse_sig:new signals.Signal,onStart:function e(){},shouldExpand:function e(t,r){if(TS.model.expandable_state["vid_"+t+r.src])return true;if(false===TS.model.expandable_state["vid_"+t+r.src])return false;if(r.internal_file_id)return TS.prefs.getPref("expand_internal_inline_imgs");return TS.prefs.getPref("expand_inline_imgs")},expandAllInCurrent:function e(){var t=$(".msg_inline_media_toggler[data-media-type=other]:not(.expanded)");if(!t.length)return;TS.inline_others.no_scrolling=true;t.trigger("click");TS.inline_others.no_scrolling=false},collapseAllInCurrent:function e(){$(".msg_inline_media_toggler[data-media-type=other].expanded").trigger("click")},expand:function e(t,r){TS.model.expandable_state["vid_"+t+r]=true;TS.storage.storeExpandableState(TS.model.expandable_state);var n="#"+TS.utility.makeSafeForDomId(t);var i=$(n);if(!i.length)return;var a=function e(){return $(this).data("real-src")==r};var s=TS.boot_data.feature_attachments_inline?i.find(".inline_attachment").filter(a):null;s&&s.length||(s=i.find(".msg_inline_other_holder").filter(a));s.removeClass("hidden");i.find(".msg_inline_media_toggler[data-media-type=other]:not(.expanded)").filter(a).addClass("expanded");s.css("opacity",0).stop().animate({opacity:1},300);TS.inline_others.no_scrolling||i.find(".msg_inline_other").last().scrollintoview({duration:200,offset:"bottom",px_offset:-10,direction:"y"});TS.inline_others.expand_sig.dispatch(t)},collapse:function e(t,r){TS.model.expandable_state["vid_"+t+r]=false;TS.storage.storeExpandableState(TS.model.expandable_state);var n="#"+TS.utility.makeSafeForDomId(t);var i=$(n);if(!i.length)return;var a=function e(){return $(this).data("real-src")==r};var s=TS.boot_data.feature_attachments_inline?i.find(".inline_attachment").filter(a):null;s&&s.length||(s=i.find(".msg_inline_other_holder").filter(a));s.css("visibility","hidden");i.find(".msg_inline_media_toggler[data-media-type=other].expanded").filter(a).removeClass("expanded");s.find(".msg_inline_other_iframe_div").html("");TS.inline_others.collapse_sig.dispatch(t);setTimeout(function(){s.addClass("hidden");s.css("visibility","visible")},200)},checkForInlineOtherClick:function e(t){if(!t.target)return;var r=$(t.target);var n;var i=r.closest(".message");n=i.attr("id");if(!n)return;var a=r.closest(".msg_inline_media_toggler[data-media-type=other]");if(a.length){t.preventDefault();var s=a.data("real-src");a.hasClass("expanded")?TS.inline_others.collapse(n,s):TS.inline_others.expand(n,s)}},makeInternalInlineOther:function t(r){var n=400;var i=500;if(r.other_html_width>n){r.other_html_height=parseInt(r.other_html_height*(n/r.other_html_width),10);r.other_html_width=n}if(r.other_html_height>i){r.other_html_width=parseInt(r.other_html_width*(i/r.other_html_height),10);r.other_html_height=i}var a;r.google_map_config&&(a=TS.utility.parseJSONOrElse(r.google_map_config,void 0));if(a&&a.center&&"string"!==typeof a.center.lat){a.scrollwheel=false;var s="googmap_"+(e+=1);r.other_html='<div class="google-maps" id="'+s+'" style="width:100%; min-width:'+_.escape(r.other_html_width)+"px; height:"+_.escape(r.other_html_height)+'px;"></div>\t\t\t<script>TS.inline_others.runGoogleMapCode("'+s+"\", '"+JSON.stringify(a)+"')<\/script>";r.safe_other_html=r.other_html}else{if(-1==r.other_html.indexOf("oldwidth")){r.other_html=r.other_html.replace(" width=",' width="'+r.other_html_width+'" oldwidth=');r.other_html=r.other_html.replace(" height=",' height="'+r.other_html_height+'" oldheight=')}r.safe_other_html=r.other_html;r.safe_other_html=TS.utility.swapInRedirUrlForIframe(r.safe_other_html);r.safe_audio_html=TS.utility.setCssFromHeightAndWidthAttrs(r.safe_audio_html)}TS.model.inline_others[r.other_html]={src:_.escape(r.other_html),attachment:r}},runGoogleMapCode:function e(t,r){if(!window.google)return;if(!r)return;var n=JSON.parse(r);var i=new google.maps.Map(document.getElementById(t),n);if(!n.query)return;var a=new google.maps.Geocoder;var s="number"===typeof n.max_results?n.max_results:10;s<0&&(s=Number.MAX_VALUE);var o=function e(){google.maps.event.clearListeners(i,"bounds_changed");var t=i.getBounds();var r=0;var o=function e(t){new google.maps.Marker({map:i,position:t.geometry.location});r+=1};var l=function e(a,l){var u=false;l==google.maps.GeocoderStatus.OK?a.slice(0,s).forEach(function(e){o(e);u=u||!e.partial_match}):TS.warn("Geocoder failed due to: "+l);if(!u&&r<s){var d=new google.maps.places.PlacesService(i);var c=function e(t,n){n==google.maps.places.PlacesServiceStatus.OK?t.slice(0,s-r).map(o):TS.warn("PlacesService failed due to: "+n)};d.nearbySearch({bounds:t,name:n.query},c)}};a.geocode({address:n.query,bounds:t},l)};google.maps.event.addListener(i,"bounds_changed",o)}});var e=0})()},"2hNN":function(e,t,r){var n=r("cDf5");(function(){TS.registerModule("redux.bots",{onStart:function e(){Object.defineProperty(TS.model,"bots",{get:function e(){return TS.redux.bots.getAllBots()},set:function e(){TS.boot_data.feature_tinyspeck&&TS.warn("TS.redux.bots: Set TS.model.bots");return false}})},getBotByMsg:function e(r){var n=t(r);return n?l(n):null},getAllBots:function t(){return _.values(e())},upsertBot:function e(t){if(!t)return;TS.redux.dispatch(TS.interop.redux.models.bots.upsertBot(t))},bulkUpsertBots:function e(t){if(!_.isArray(t))return;TS.redux.dispatch(TS.interop.redux.models.bots.bulkUpsertBots({bots:t}))},logStats:function e(){var t=_(r).keys().union(_.keys(i)).value();var n={};_.forEach(t,function(e){n[e]={gets:r[e]||0,sets:i[e]||0}});TS.console.table(n)}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.models.bots.getAllBots");var t=TS.redux.bindSelectorToStore("TS.interop.redux.models.bots.getBotByMsg");var r={};var i={};var a=function e(){return TS.boot_data&&("dev"===TS.boot_data.version_ts||"local_js"===TS.boot_data.version_ts)};var s=function e(t,a){if("symbol"!==n(a)){if(!_.isNumber(r[a])){r[a]=0;i[a]=0}r[a]+=1}return t[a]};var o=function e(t,a,s){if("symbol"!==n(a)){if(!_.isNumber(i[a])){r[a]=0;i[a]=0}i[a]+=1}t[a]=s;return true};var l=function e(t){if(!window.Proxy||!a())return t;return new window.Proxy(t,{get:function e(t,r){return s(t,r)},set:function e(t,r,n){return o(t,r,n)}})}})()},"3D55":function(e,t){(function(){TS.registerModule("ui.messages",{onStart:function t(){var r=$("body");r.on("click.msg_action","ts-message",function(t){e(t)});r.delegate("ts-message.dirty_hover_container","mouseenter",function(e){TS.ui.messages.updateMessageHoverContainer($(e.currentTarget))})},maybeUpdateMessageHoverContainer:function e(t){if(!t.length)return;t.is(":visible")?TS.ui.messages.updateMessageHoverContainer(t):t.addClass("dirty_hover_container")},updateMessageHoverContainer:function e(t){t.removeClass("dirty_hover_container");var r=t.data("model-ob-id");var n=r?TS.redux.channels.getEntityById(r):TS.shared.legacyGetActiveModelOb();if(!n)return;var i=t.attr("data-ts");var a=TS.utility.msgs.getMsg(i,n.msgs);!a&&n._archive_msgs&&(a=TS.utility.msgs.getMsg(i,n._archive_msgs));if(!a){TS.error(i+" not found in "+r);return}var s=t.find("[data-js=action_hover_container]");var o=t.closest("ts-conversation").length>0;var l=t.closest("#threads_msgs").length>0;var u=o||l;var d=!a.thread_ts||a.thread_ts===a.ts;var c="tombstone"===a.subtype&&n.is_channel&&!n.is_member;var m=false;if(!a.is_ephemeral&&"tombstone"!==a.subtype){var f="message";a.file&&(f="file_comment"===a.subtype?"file_comment":"file");var p;a.file&&(p=_.isString(a.file)?TS.files.getFileById(a.file):a.file);var h={message:a,file:p,file_comment:a.comment}[f];var g="file_comment"===f?p:n;var S=TS.templates.builders.buildStarComponents(f,h,g,true);var T=S.is_starred?"starred ts_icon_star":"ts_icon_star_o";m={text:S.is_starred?S.unstar_str:S.star_str,classes:"star_link star_"+f+" "+("file_comment"===f?"star_comment":"")+" "+T,attributes:S.html_attrs,starred:S.is_starred}}s.html(TS.templates.action_hover_items({msg:a,actions:TS.utility.msgs.getMsgActions(a,n),ts_tip_delay_class:"ts_tip_delay_60",is_in_threads_view:l,is_in_thread:u,is_root_msg:d,hide_actions_menu:c,show_rxn_action:!!s.data("show_rxn_action"),show_reply_action:!!s.data("show_reply_action"),show_comment_action:!!s.data("show_comment_action"),abs_permalink:s.data("abs_permalink"),star:m}));s.toggleClass("narrow_buttons",s.children().length>3)}});var e=function e(r){var n=$(r.target);var i=n.closest("[data-action]");if(i.length){var a=n.closest("ts-message");var s=a.data("model-ob-id");var o=s?TS.redux.channels.getEntityById(s):TS.shared.legacyGetActiveModelOb();var l=a.attr("data-ts");var u=TS.utility.msgs.getMsg(l,o.msgs);var d=i.data("action");var c=false;if(!u){u=TS.utility.msgs.getMsg(l,o._archive_msgs);u&&(c=true)}if(!u){TS.error("WTF no message to click?");return}var _=TS.rxns.getRxnKeyByMsgType(u);switch(d){case"actions_menu":c?TS.menu.startWithMessageActions(r,a.data("ts"),o._archive_msgs,o):TS.menu.startWithMessageActions(r,a.data("ts"),o.msgs,o);t("more_actions_button");break;case"reaction":TS.ui.react_emoji_menu.start({e:r,rxn_key:_});t("add_reaction_button");break;case"pin":TS.pins.startPinMessage(l,o);t("pin_to_this_conversation_button");break;case"unpin":TS.pins.unPinMessage(l,o);t("unpin_from_this_conversation_button");break;case"edit":TS.msg_edit.startEdit(l,o);t("edit_message_button");break;case"delete":TS.msg_edit.startDelete(l,o);t("delete_message_button");break;case"mark_unread":TS.info("_msgActionHandler: setting unread point on "+o.id+", ts = "+l+" (mark_unread)");t("mark_unread_button");break;case"reply":t("reply_to_thread_button");break;case"open_in_channel":if(TS.web){var m=TS.utility.msgs.constructMsgPermalink(o,l);window.location=m}t("open_in_channel_button");break;case"open_conversation":break;case"copy_link":var f=TS.interop.i18n.t("Copied!","messages_action_items")();TS.tips.updateFloater({title:f,classes_to_add:["success"]});TS.clipboard.writeText(i.data("permalink"));t("copy_link_button");break;case"comment":var p=a.attr("data-thread-ts")?"reply_to_thread_button":"start_a_thread_button";t(p);break;case"share_message":TS.ui.share_message_dialog.start(u.ts,o);t("share_message_button");break;case"add_handy_rxn":var h=i.data("name");var g=!TS.rxns.doesRxnsHaveRxnFromUser(TS.rxns.getExistingRxnsByKey(_),h);g&&a.addClass("just_added_handy_rxn_from_actions");TS.rxns.changeRxnsFromUserAction(_,h,g);break;case"share_file":var S=u.file;if(!S)return;TS.ui.share_dialog.start(S.id);break;case"star":TS.stars.checkForStarClick(r,function(e){t(e?"star_message_button":"unstar_message_button")});break;default:TS.error("WTF no action?");break}}};var t=function e(t){var r={action:"click",ui_element:t};TS.interop.clog.track("MSG_ACTION",{contexts:{ui_context:r}})}})()},"3Vm1":function(e,t){(function(){TS.registerModule("user_groups",{updated_sig:new signals.Signal,updated_info_sig:new signals.Signal,changed_is_unknown_sig:new signals.Signal,unknown_resolution_rebuild_sig:new signals.Signal,legacyNeedsToFetchMembership:function e(t){return void 0===t.users||_.size(t.users)!==t.user_count}})})()},"4B0H":function(e,t){(function(){TS.registerModule("redux.notifications",{getCalculatedDesktopNotifySetting:function t(r){return e(r)},getCalculatedMobileNotifySetting:function e(r){return t(r)},getGlobalDesktopNotifySetting:function e(){return n("global_desktop")},getNotificationsChannelPref:function e(t,r){return i(t,r)},canChannelHaveAtChannelMentions:function e(t){return r(t)}});var e=TS.redux.bindSelectorToStore("TS.interop.notifications.getCalculatedDesktopNotifySetting");var t=TS.redux.bindSelectorToStore("TS.interop.notifications.getCalculatedMobileNotifySetting");var r=TS.redux.bindSelectorToStore("TS.interop.messages.canChannelHaveAtChannelMentions");var n=TS.interop.prefs.getNotificationsGlobalPref;var i=TS.interop.prefs.getNotificationsChannelPref})()},"4Cq+":function(e,t){(function(){TS.registerModule("bots",{changed_sig:new signals.Signal,legacyBatchUpsertAndSignal:function e(t){var r=TS.interop.bots.getBotState();TS.redux.bots.bulkUpsertBots(t);var n=TS.interop.bots.getBotState();r!==n&&TS.bots.changed_sig.dispatch()},legacyEnsureBotsInDataArePresent:function e(t){var r=TS.interop.utility.extractAllBotIds(t);return TS.interop.bots.ensureBotsArePresent(r)},legacyFetchAndUpsertBotsWithQuery:function e(t){return TS.interop.Flannel.fetchRawMembersWithQuery(t).then(function(e){e.objects=TS.shared.legacyBatchUpsertObjects(e.objects);return e})}})})()},"4KQo":function(e,t){(function(){TS.registerModule("utility.date",{fake_ts_unique_padder:"x",do24hrTime:function e(){return TS.model.user&&TS.prefs.prefs_loaded&&TS.prefs.getPref("time24")},memberUTCOffset:function t(r){var n=e(r);var i=n/60/60;if(i<0)return"(UTC"+i+")";if(i>0)return"(UTC+"+i+")";return"(UTC)"}});var e=function e(t){var r=-28800;(t&&t.tz_offset&&"undefined"!==typeof t.tz_offset||0===t.tz_offset)&&(r=t.tz_offset);return r}})()},"4oWp":function(e,t){(function(){TS.registerModule("ui.share_dialog",{div:null,showing:false,delegate:void 0,onStart:function e(){TS.files.team_file_changed_sig.add(n);TS.files.team_file_comment_added_sig.add(i);TS.files.team_file_comment_deleted_sig.add(i)},onKeydown:function e(t){if(!TS.ui.share_dialog.showing)return;if(t.which==TS.utility.keymap.enter){if("BODY"===TS.utility.getActiveElementProp("NODENAME")){TS.ui.share_dialog.go();t.preventDefault()}}else t.which==TS.utility.keymap.esc&&"BODY"===TS.utility.getActiveElementProp("NODENAME")&&TS.ui.share_dialog.cancel()},start:function e(n,i,a,s,o,l){if(TS.boot_data.feature_file_threads){TS.redux.dispatch(TS.interop.redux.actions.openShareDialog({fileId:n}));return}r=false;t=n;var u=TS.files.getFileById(n);var d="file";"post"===u.mode?d="file_post":"space"===u.mode?d="file_space":"snippet"===u.mode?d="file_snippet":"docs"===u.mode&&(d="file_arugula");var c=TS.templates.builders.buildFileSharingControls(u,true,null,a);var _=i?"":TS.templates.builders.fileHTML(u,{for_share_dialog:true});var m={type:d,item:u,item_owner:TS.interop.members.getMemberById(u.user),sharing_html:new Handlebars.SafeString(c),file_html:new Handlebars.SafeString(_),show_copy_link:u.permalink&&TS.clipboard.canWriteText()};m.icon_class=TS.utility.getImageIconClass(u,"thumb_80");TS.ui.share_dialog.div||TS.ui.share_dialog.build();var f=TS.templates.share_dialog(m);f=TS.format.replaceHighlightMarkers(f);var p=TS.ui.share_dialog.div;p.html(f);var h=$("#file_comment_textarea");TS.ui.comments.bindInput(h,TS.ui.share_dialog.go);o&&TS.utility.contenteditable.value(h,o);h=null;p.modal("show");p.find(".dialog_cancel").click(TS.ui.share_dialog.cancel);p.find(".dialog_go").click(TS.ui.share_dialog.go);TS.ui.file_share.bindFileShareDropdowns(TS.utility.members.getEntityFromFile(u),{id:s},void 0,l);TS.ui.file_share.bindFileShareShareToggle();TS.ui.file_share.bindFileShareCommentField()},go:function e(){if(r){TS.info("TS.ui.share_dialog stopping because already sharing");return}if(!TS.ui.share_dialog.showing){TS.error("not showing?");return}var n=$("#select_share_channels").lazyFilterSelect("value")[0];var i=_.trim(TS.utility.contenteditable.value($("#file_comment_textarea")));i=TS.utility.contenteditable.legacySynchronouslyReplacePotentialMentions(i,{enableBroadcastKeywords:false});var a=n&&n.model_ob||{};TS.interop.utility.looksLikeMemberId(a.id)&&(a=TS.redux.channels.getImByMemberId(a.id)||a);TS.interop.utility.isModelObjectExternal(a)&&(i="");var s=function e(){TS.shared.legacyGetShareModelObId(u,function(e){var r=false;TS.files.shareFile(t,e,i,r).then(function(){t=null})})};if(n&&n.model_ob&&n.model_ob.create_channel){var o=t;TS.ui.new_channel_modal.start(n.model_ob.name).then(function(e){t=o;u=e.id;s();return null}).catch(function(){TS.ui.share_dialog.start(o,false,false,false,i);return null});TS.ui.share_dialog.cancel();return false}if(!TS.interop.utility.isModelObjectExternal(a)&&TS.ui.file_share.shouldBlockUploadDialogSubmission())return;var l=$("#share_dialog");var u=l.find("#share_model_ob_id").val();u||n&&(u=n.model_ob.id);if(!u){TS.warn("model_ob_id is not set! "+$("#select_share_channels").val());return}TS.ui.share_dialog.delegate&&"function"===typeof TS.ui.share_dialog.delegate.submit?TS.ui.share_dialog.delegate.submit(l,s):s();r=true;TS.ui.share_dialog.div.modal("hide")},cancel:function e(){t=null;TS.ui.share_dialog.div.modal("hide")},end:function t(){e&&e.detachEvents&&e.detachEvents();e=null;TS.model.dialog_is_showing=false;TS.ui.share_dialog.showing=false;TS.ui.share_dialog.div.empty();$(window.document).unbind("keydown",TS.ui.share_dialog.onKeydown)},build:function t(){$("body").append('<div id="share_dialog" tabindex="-1" class="modal hide fade"></div>');TS.ui.share_dialog.div=$("#share_dialog");var r=TS.ui.share_dialog.div;r.on("hidden",function(e){if(e.target!=this)return;TS.ui.share_dialog.end()});r.on("show",function(e){if(e.target!=this)return;TS.model.dialog_is_showing=true;TS.ui.share_dialog.showing=true});r.on("shown",function(t){if(t.target!=this)return;var r=$("#select_share_channels").lazyFilterSelect("value");r.length<1?$("#select_share_channels").lazyFilterSelect("getInstance").$input.focus():TS.utility.contenteditable.focus($("#file_comment_textarea"));$(window.document).bind("keydown",TS.ui.share_dialog.onKeydown);e=TS.ui.share_dialog.div.find("img.lazy").lazyload()})}});var e=null;var t;var r=false;var n=function e(r){if(TS.ui.share_dialog.showing&&t===r.id){var n=!TS.interop.files.isObjectFresh(r.id);if(n){TS.files.getFileById(r.id);return}a(r);s(r)}};var i=function e(r){TS.ui.share_dialog.showing&&t===r.id&&s(r)};var a=function e(t){TS.templates.builders.updateFileShareLabels(t);$("#select_share_at_channel_list").html(TS.templates.builders.makeFileCommentHelpHTML(t))};var s=function e(t){var r=TS.templates.makeFileDomId(t);$("#"+r).replaceWith(TS.templates.builders.fileHTML(t,{for_share_dialog:true}));var n=$("#"+r).find("img.lazy");n.removeClass("lazy").attr("src",n.attr("data-original"))}})()},"5+2p":function(e,t){(function(){TS.registerModule("click",{onStart:function e(){r();t()},addHandler:function t(r,n,i){if(_.isFunction(r)){i=n;n=r;r=null}e.push({selector:r,fn:n,prevent_on_drag:i||false})},addWebHandler:function e(){if(!TS.web)return;return TS.click.addHandler.apply(this,arguments)},test:function n(){return{addAll:t,setupBinding:r,handlers:function t(){return e},resetHandlers:function t(){e=[]},unbind:function e(){$("body").off("click.ts_dot_click");$("body").off("mousedown.ts_dot_click_mousedown")}}}});var e=[];var t=function e(){TS.click.addWebHandler("#msgs_div",function(e){TS.utility.isPostClickEventSafe(e)||e.preventDefault()});TS.click.addHandler(".inline_attachment.clickable, .inline_attachment.clickable + .reply_broadcast_rule",function(e,t){var r=["a",".media_caret",".delete_attachment_link",".msg_inline_video_buttons_div"].join(",");if($(e.target).closest(r).length)return;var n;n=t.is(".reply_broadcast")||t.closest(".reply_broadcast_rule").length?t.closest(".message_body").find('[data-action="open_conversation"]'):t.find(".attachment_from_url_link");n[0]&&n[0].click()},true);TS.click.addHandler(".file_actions",function(e,t){e.preventDefault();TS.menu.file.startWithFileActions(e,t.data("file-id"))});TS.click.addWebHandler("#msgs_div.selecting_messages ts-message",function(e){var t=$(e.target);if(t.attr("href")||t.hasClass("star"))return;var r=t.closest("ts-message");var n=r.find(".msg_select_cb");t.is("input")||n.prop("checked",!n.prop("checked"));TS.msg_edit.batchDeleteSelectionChanged(n,e.shiftKey)});TS.click.addHandler(TS.rxns.checkForRxnClick);TS.click.addHandler(TS.stars.checkForStarClick);TS.click.addHandler(function(e){TS.inline_imgs.checkForInlineImgClick(e)});TS.click.addHandler(function(e){TS.inline_videos.checkForInlineVideoClick(e)});TS.click.addHandler(function(e){TS.inline_audios.checkForInlineAudioClick(e)});TS.click.addHandler(function(e){TS.inline_others.checkForInlineOtherClick(e)});TS.click.addHandler(function(e){TS.inline_attachments.checkForInlineAttachmentClick(e)});TS.click.addHandler(TS.inline_file_previews.checkForInlineFilePreviewClick);TS.click.addHandler(TS.inline_room_previews.checkForInlineRoomPreviewClick);TS.click.addWebHandler(".reply_bar",function(e,t){var r=$(e.target);if(!r.is("a")){var n=t.closest("ts-message");var i=n.attr("data-thread-ts");if(!i)return;var a=n.attr("data-model-ob-id");var s=TS.redux.channels.getEntityById(a);if(!s)return;var o=TS.utility.msgs.constructConversationPermalink(s,i);window.open(o)}})};var r=function t(){var r={};$("body").on("mousedown.ts_dot_click_mousedown",function(e){r.x=e.clientX;r.y=e.clientY});$("body").on("click.ts_dot_click",function(t){if(t.isDefaultPrevented())return;var a=$(t.target);if(a.parents("[data-reactroot]").length||a.parents(".ReactModalPortal").length)return;var s=n(t);var o;var l;for(var u=0;u<e.length;u+=1){o=e[u];l=null;if(o.prevent_on_drag&&(t.clientX!=r.x||t.clientY!=r.y))continue;if(o.selector){l=a.closest(o.selector);if(!l.length)continue;o.fn(t,l,s);t.isDefaultPrevented()&&TS.has_pri[i]&&TS.log(i,"click on "+o.selector)}else o.fn(t,s);if(t.isDefaultPrevented())return}})};var n=function e(t){var r=$(t.target);if(r.closest("#member_stars_list").length)return"starred_items";if(r.closest("#member_mentions").length)return"mentions";if(r.closest("#file_list").length)return"file_list";if(r.closest("#file_preview_scroller").length)return"file_preview";if(r.closest("#member_preview_scroller").length)return"member_preview";if(r.closest("#convo_scroller").length)return"conversation";if(r.closest("#groups_tab").length)return"groups";if(r.closest("#threads_msgs_scroller_div").length)return"threads";if(r.closest("#channel_page_scroller").length){var n=TS.shared.legacyGetActiveModelOb();var i="channel_page";n.is_group&&!n.is_mpim?i="group_page":(n.is_im||n.is_mpim)&&(i="im_page");return i}return null};var i=2003})()},"54vr":function(e,t){(function(){TS.registerModule("enterprise",{updateMenuWithName:function e(t){var r=$(".team_menu.slack_menu");r.find(".slack_menu_header .current_team_name").text(t);r.find(".menu_list .enterprise_logout_url a strong").text(t);$(".enterprise-name").text(t)}})})()},"6btA":function(e,t){(function(){TS.registerModule("utility.msgs",{allowed_embed_attributes:["class","name","id","src","width","oldwidth","height","oldheight","frameborder","title","scrolling","allowtransparency","allowfullscreen","oallowfullscreen","msallowfullscreen","webkitallowfullscreen","mozallowfullscreen","controls","autoplay","loop","muted","poster","preload","webkit-playsinline","type"],ephemeral_msgs_map:{},messageIncludesMember:function e(t,r){if(!t){TS.warn("messageIncludesMember: WTF no member?");return}if(!r){TS.warn("messageIncludesMember: WTF no msg?");return}if(TS.utility.msgs.memberSentMessage(t,r))return true;var n=l(r);var i;for(var a=0,s=n.length;a<s;a+=1){i=n[a];if(0===i.indexOf("<")&&0===i.indexOf("<@")){var o=i.replace(/<|>/g,"");var u=TS.utility.msgs.getMemberIdFromMemberMarkup(o);if(u&&u==t.id)return true}}return false},messageIncludesUserGroup:function e(t,r){if(!t){TS.warn("messageIncludesUserGroup: WTF no user group?");return false}if(!r){TS.warn("messageIncludesUserGroup: WTF no msg?");return false}var n=l(r);var i=_.some(n,function(e){if(e&&u(e)){var r=TS.utility.msgs.getUserGroupIdFromUserGroupMarkup(e);if(r&&r==t.id)return true}return false});return i},extractUserGroupIdsFromMessage:function e(t){if(!t)return[];var r=l(t);var n=_.reduce(r,function(e,t){if(u(t)){var r=TS.utility.msgs.getUserGroupIdFromUserGroupMarkup(t);e.push(r)}return e},[]);return n},memberSentMessage:function e(t,r){if(!t){TS.warn("messageIncludesMember: WTF no member?");return}if(!r){TS.warn("messageIncludesMember: WTF no msg?");return}return!!(r.user&&r.user==t.id)||!!(r.comment&&r.comment.user==t.id)},allUnknownUsersInMessage:function e(t){var r=[];var n=t.text;var i=TS.format.calculateOptions(t,{});var a=TSF.getTokensArray($.trim(n),i.tsf_mode,{jumbomoji:!i.no_jumbomoji,allow_intra_word_formatting:TS.format.shouldAllowIntraWordFormatting()});for(var s=0;s<a.length;s+=1){var o=a[s];if(0===o.indexOf("<")&&0===o.indexOf("<@")){var l=o.replace(/<|>/g,"");var u=TS.utility.msgs.getMemberIdFromMemberMarkup(l);var d=TS.redux.members.getPotentiallyUnknownMemberById(u);d||TS.boot_data.feature_deprecate_get_member_by_name||(d=TS.interop.members.getMemberByName(u));d||r.indexOf(u)<0&&r.push(u)}}return r},appendMsg:function e(t,r){t.unshift(TS.utility.msgs.makeSureMsgObIsValid(r))},setMsgs:function e(t,r){for(var n=0;n<r.length;n+=1)r[n]=TS.utility.msgs.makeSureMsgObIsValid(r[n]);TS.utility.msgs.sortMsgs(r);t.msgs=r;return t.msgs},spliceMsg:function e(t,r){var n=t.indexOf(r);n>-1&&t.splice(n,1)},getNonTempMsgFromUserMatchingText:function e(t,r,n){if(!t&&0!==t)return null;var i;for(var a=0;a<n.length;a+=1){i=n[a];if(i.user!=r)continue;if(TS.interop.rules.messages.isTempMsg(i))continue;if(i.text==t)return i}return null},getMsgByProp:function e(t,r,n){if(!r&&0!==r)return null;var i;for(var a=0;a<n.length;a+=1){i=n[a];if(i[t]==r)return i}return null},sortMsgs:function e(t){function r(e,t){if(e.ts<t.ts)return 1;if(e.ts>t.ts)return-1;return 0}t.sort(r)},isMsgRolledUp:function e(t){if(!t._jl_rolled_up_in)return false;return t._jl_rolled_up_in!==t.ts},getPrevDisplayedMsg:function e(t,r){var n;var i=false;for(var a=0;a<r.length;a+=1){n=r[a];if(i){if(!TS.interop.rules.messages.isHidden(n)&&!TS.utility.msgs.isMsgRolledUp(n))return n}else n.ts==t&&(i=true)}return null},getDisplayedMsgs:function e(t){var r=[];var n;for(var i=0;i<t.length;i+=1){n=t[i];TS.interop.rules.messages.isHidden(n)||TS.utility.msgs.isMsgRolledUp(n)||r.push(n)}return r},getDisplayedMsgAfterTS:function e(t,r){var n;for(var i=r.length-1;i>-1;i-=1){n=r[i];if(n.ts>t&&!TS.interop.rules.messages.isHidden(n)&&!TS.utility.msgs.isMsgRolledUp(n))return n}return null},getDisplayedMsgBeforeTS:function e(t,r){var n;for(var i=0;i<r.length;i+=1){n=r[i];if(n.ts<t&&!TS.interop.rules.messages.isHidden(n)&&!TS.utility.msgs.isMsgRolledUp(n))return n}return null},getUnreadCountableMsgAfterTS:function e(t,r){var n;for(var i=r.length-1;i>-1;i-=1){n=r[i];if(n.ts>t&&TS.interop.messages.canCountAsUnreadForCurrentUser(n,TS.model.user.id))return n}return null},getMarkMsgTSForUnreadPoint:function e(t,r,n){var i;var a;if(n.oldest_msg_ts&&t==n.oldest_msg_ts)i="0000000000.000000";else{a=TS.utility.msgs.getPrevDisplayedMsg(t,r)||TS.utility.msgs.getMsg(t,r);a&&(i=a.ts)}if(!i)return null;while(i&&!TS.utility.msgs.getUnreadCountableMsgAfterTS(i,r)){a=TS.utility.msgs.getPrevDisplayedMsg(i,r);i=a?a.ts:null}if(!i)return null;return i},getMsg:function e(t,r){if(!r)return null;return TS.utility.msgs.getMsgByProp("ts",t,r)},getFileOnMsg:function e(t){if(!t)return;if(TS.interop.messages.shouldRenderFileThread(t)&&t.files&&t.files.length)return t.files[0];return t.file},getFilesOnMsg:function e(t){if(!t)return null;if(!t.file&&!t.files)return null;if(TS.interop.messages.shouldRenderFileThread(t)&&t.files&&t.files.length){var r=_.chain(t.files).map(function(e){if(_.isString(e))return TS.files.getFileById(e);if(e&&_.isString(e.id))return TS.files.getFileById(e.id);return e}).compact().value();return r&&r.length?r:null}var n=t.file;_.isString(t.file)?n=TS.files.getFileById(t.file):t.file&&_.isString(t.file.id)&&(n=TS.files.getFileById(t.file.id));return n?[n]:null},getMsgActions:function e(t,r,n){if(!t)return;r=r||TS.shared.legacyGetActiveModelOb();var i={edit_msg:TS.interop.messages.canEditMessage(TS.model.user.id,t,r,TS.prefs.getTeamPref("msg_edit_window_mins")),delete_msg:true};var a=false;t.user==TS.model.user.id&&(a=true);var s=TS.utility.teams.isMsgFromOtherTeam(t);t.file&&"email"===t.file.mode&&(i.open_original=true);var o=TS.interop.members.getMemberById(t.user);var l=o&&o.is_stranger&&o.deleted;if(TS.prefs.getTeamPref("allow_message_deletion"))if("tombstone"===t.subtype)i.delete_msg=false;else if("retention"===t.subtype)i.delete_msg=false;else if(s&&!l)TS.boot_data.page_needs_enterprise&&(a||TS.model.user.enterprise_user.is_admin&&!r.is_im)?i.delete_msg=true:i.delete_msg=false;else if(r.is_im)a||"USLACKBOT"===t.user||"bot_message"===t.subtype||(i.delete_msg=false);else if(a){if(TS.interop.rules.messages.isAutomatedSubtype(t.subtype)){var u=["pinned_item","sh_room_created","sh_room_shared","reply_broadcast"];TS.model.user.is_admin||_.includes(u,t.subtype)||(i.delete_msg=false)}}else TS.model.user.is_admin||(i.delete_msg=false);else s&&!l?TS.boot_data.page_needs_enterprise&&TS.model.user.enterprise_user.is_admin&&!r.is_im?i.delete_msg=true:i.delete_msg=false:TS.model.user.is_admin?r.is_im&&(a||"USLACKBOT"===t.user||"bot_message"===t.subtype||(i.delete_msg=false)):i.delete_msg=false;var d=n!==TS.interop.constants.MESSAGE_CONTAINERS.THREADS_FLEXPANE&&n!==TS.interop.constants.MESSAGE_CONTAINERS.THREADS_VIEW;"thread_broadcast"===t.subtype&&d&&(i.remove_broadcast=i.delete_msg);if(t.is_ephemeral)i.delete_msg=true;else{"file_comment"===t.subtype?i.add_file_comment_rxn=true:TS.interop.rules.messages.isFile(t)?i.add_file_rxn=true:"tombstone"===t.subtype?i.add_rxn=false:i.add_rxn=true;if(TS.clipboard.canWriteText()){i.copy_link=true;"tombstone"===t.subtype&&(i.copy_link=false)}}var c=!t.thread_ts||t.thread_ts==t.ts;i.jump_to_original=true;i.jump_to_original=c;var m="thread_broadcast"===t.subtype&&d;!i.mark_unread||c||m||(i.mark_unread=false);var f=["bot_message","file_share","file_mention","file_comment","me_message","reply_broadcast","thread_broadcast"];t.is_ephemeral||t.subtype&&-1===f.indexOf(t.subtype)||(i.remind_me=true);(i.jump_to_original||i.copy_link||i.mark_unread||i.remind_me)&&(i.has_private_actions=true);(i.copy_link||i.add_rxn||i.add_file_rxn||i.add_file_comment_rxn||i.pin_msg||i.unpin_msg)&&(i.has_public_actions=true);t.is_ephemeral||TS.interop.rules.messages.isTempMsg(t)||("file_share"===t.subtype||"file_mention"===t.subtype?i.share_file=true:"tombstone"===t.subtype?i.share_message=false:i.share_message=!TS.interop.channels.isImWithDeletedMember(r)&&(!TS.interop.rules.channels.isArchived(r)||r.is_channel));return i},validateMsg:function e(t,r,n){if(!r.ts){TS.error("msg lacks a ts ("+t+")");TS.dir(0,r);return false}if(TS.utility.msgs.getMsg(r.ts,n)){TS.warn("msg "+r.ts+" already exists! ("+t+")");TS.dir(0,r);return false}return true},findMsg:function e(t,r){var n=TS.redux.messages.getMessageByTimestamp(r,t);if(n)return n;var i=TS.redux.channels.getEntityById(r);if(i){n=i.msgs&&TS.utility.msgs.getMsg(t,i.msgs);if(n)return n;n=i._archive_msgs&&TS.utility.msgs.getMsg(t,i._archive_msgs);if(n)return n}var a=TS.mentions.getMentionByMsgId(r,t);if(a)return a.message;return null},legacyMsgChangedWorker:function e(t){var r=TS.redux.channels.getEntityById(t.channel);TS.mentions.replaceMsg(t.channel,t.message);TS.pins&&TS.pins.replaceMsg(t.message,r);(t.message.imgs||TS.utility.msgs.hasImgs(t.message))&&(TS.model.show_inline_img_size_pref_reminder=true)},legacyMsgDeletedWorker:function e(t,r){TS.mentions.legacyRemoveMsg(t.id,r.deleted_ts);TS.pins&&TS.pins.legacyRemoveMsg(r.deleted_ts,t);TS.utility.msgs.legacyDeleteMsg(t,r)},legacyDeleteMsg:function e(t,r){var n=TS.utility.msgs.getMsg(r.deleted_ts,t.msgs);!n&&t._archive_msgs&&(n=TS.utility.msgs.getMsg(r.deleted_ts,t._archive_msgs));if(!n)return;TS.shared.legacyRemoveMsgFromModern(t,n)},replaceMsg:function e(t,r,n,i,a){TS.redux.messages.replaceMessage(TS.interop.messages.preprocessImsg(r,t.id),a);TS.utility.msgs.legacyReplaceMsg(t,r,n,i)},removeEphemeralMsg:function e(t,r){var n=TS.interop.channels.getGroupById(t)||TS.interop.channels.getPublicChannelById(t);if(!n)return;var i=TS.utility.msgs.findMsg(r,n.id);n.is_channel?TS.channels.legacyRemoveMsg(t,i):n.is_mpim?TS.mpims.legacyRemoveMsg(t,i):n.is_group&&TS.groups.legacyRemoveMsg(t,i)},getMemberFromMemberMarkup:function e(t){var r=TS.utility.msgs.getMemberIdFromMemberMarkup(t);var n=TS.redux.members.getPotentiallyUnknownMemberById(r);n||TS.boot_data.feature_deprecate_get_member_by_name||(n=TS.interop.members.getMemberByName(r));return n},getMemberIdFromMemberMarkup:function e(t){var r=t.substr(1);r&&(r=r.split("|")[0]);return r},getUserGroupIdFromUserGroupMarkup:function e(t){var r=new RegExp(TS.interop.userGroups.USER_GROUP_MSG_REGEX);var n=r.exec(t);if(n&&_.isArray(n)){var i=n[1];return i}return null},makeSureMsgObIsValid:function e(t){return t},old_api_url_prefix:"api::",new_api_url_prefix:"slack-action://",doNewApiUrl:function e(){alert(TS.interop.i18n.t("This link will not work in the archives.","msgs")())},countAllUnreads:function t(r){if(e)return;(TS.boot_data.feature_tinyspeck||TS.model&&TS.model.user&&"W461MFL8H"===TS.model.user.id)&&TS.telemeter.mark("count_all_unreads_start");var n=TS.boot_data.feature_faster_count_all_unreads;var i="count_all_unreads";var a="count_all_unreads_loop";if(n){i="count_all_unreads_treatment";a="count_all_unreads_loop_treatment"}n&&!TS.model.channels_with_unreads&&(TS.model.channels_with_unreads=[]);if(n&&r){var s=parseInt(r.unread_cnt,10)||0;var o=parseInt(r.unread_highlight_cnt,10)||0;d(r.id,s,o);c(r.id,s,o)}TS.model.all_unread_highlights_cnt=0;TS.model.all_unread_cnt=0;TS.model.all_unread_cnt_to_exclude=0;TS.model.all_unread_highlights_cnt_to_exclude=0;var l=TS.redux.getState();var u;if(n&&r){u=TS.model.channels_with_unreads.map(function(e){return TS.interop.channels.getChannelById(e)});TS.interop.console.debug("[UNREAD-COUNTS]","Looping over the "+_.size(TS.model.channels_with_unreads)+" channels in TS.model.channels_with_unreads \u2728")}else{u=TS.interop.channels.getAllChannels();TS.interop.console.debug("[UNREAD-COUNTS]","Looping over all "+_.size(u)+" of the users channels \ud83d\ude2d")}(TS.boot_data.feature_tinyspeck||TS.model&&TS.model.user&&"W461MFL8H"===TS.model.user.id)&&TS.telemeter.mark("count_all_unreads_loop_start");_.each(u,function(e){if(!TS.interop.rules.unreads.shouldCountUnreadsInModel(l,e))return;if(TS.interop.rules.channels.shouldSuppressOrgChannel(l,e))return;var t=parseInt(e.unread_cnt,10)||0;var i=parseInt(e.unread_highlight_cnt,10)||0;var a=TS.interop.rules.unreads.useUnreadCountAsMentionCount(l,e)?t:i;if(n&&!r){d(e.id,t,i);c(e.id,t,i)}TS.model.all_unread_cnt+=t;TS.model.all_unread_highlights_cnt+=a});if(TS.boot_data.feature_tinyspeck||TS.model&&TS.model.user&&"W461MFL8H"===TS.model.user.id){var m=TS.telemeter.measureAndClear("count_all_unreads_loop_start",a);TS.interop.console.info("UNREAD-COUNTS","Looping over the channels in countAllUnreads took "+m+"ms")}_.each(TS.model.threads_mention_counts,function(e,t){var r=parseInt(e,10)||0;TS.model.all_unread_highlights_cnt+=r;TS.utility.msgs.maybeExcludeUnreads(TS.redux.channels.getEntityById(t),0,r)});TS.model.threads_has_unreads&&(TS.model.all_unread_cnt+=1);if(TS.boot_data.feature_tinyspeck||TS.model&&TS.model.user&&"W461MFL8H"===TS.model.user.id){var f=TS.telemeter.measureAndClear("count_all_unreads_start",i);TS.interop.console.info("UNREAD-COUNTS","countAllUnreads took "+f+"ms")}},legacyGetChannelsWithUnreads:function e(){return TS.model.channels_with_unreads||[]},legacyGetAllUnreadCnt:function e(){return TS.model.all_unread_cnt||0},legacyIsChannelsWithUnreadsReady:function e(){return i},legacySetChannelsWithUnreadsReady:function e(){i=true},maybeExcludeUnreads:function e(t,r,n){if(!t)return;if(!r&&!n)return;if(!TS.interop.rules.channels.isOrgShared(t))return;if(TS.interop.rules.channels.shouldSuppressOrgChannel(TS.redux.getState(),t)){TS.model.is_our_app&&TS.has_pri[s]&&TS.log(s,"Excluding unread of "+r+" and highlight of "+n+" for shared channel "+t.id+" because this is NOT the relevant team.");TS.model.all_unread_cnt_to_exclude+=r;TS.model.all_unread_highlights_cnt_to_exclude+=n}else TS.has_pri[s]&&TS.model.is_our_app&&TS.log(s,"Using unread of "+r+" and highlight of "+n+" for shared channel "+t.id+" because this IS the relevant team.")},doesMsgHaveRxnFromUser:function e(t,r){return TS.rxns.doesRxnsHaveRxnFromUser(TS.rxns.getExistingRxnsByKey(t._rxn_key),r)},doesMsgHaveRxn:function e(t,r){return TS.rxns.doesRxnsHaveRxn(TS.rxns.getExistingRxnsByKey(t._rxn_key),r)},recordEmojiInHash:function e(t,r){if(!t)return false;if(!r)return false;var n=true;var i=TS.utility.findAllTeamEmojiInStr(t,n);if(!i.length)return false;var a=false;var s;for(var o=0;o<i.length;o+=1){s=TS.emoji.isValidName(i[o]);if(!s){TS.error(i[o]+" invalid");continue}parseInt(r[s],10)||(r[s]=0);r[s]+=1;a=true}return a},startBatchUnreadCalc:function t(){if("0"==TS.qs_args.unread_batch)return;e=true},finishBatchUnreadCalc:function t(){e=false;TS.utility.msgs.countAllUnreads()},maybeSetOldestMsgsTsAfterMsgAdded:function e(t){if(t.oldest_msg_ts)return;if(t.latest)return;TS.utility.msgs.setOldestMsgsTs(t)},setOldestMsgsTs:function e(t){var r=TS.utility.msgs.getOldestValidTs(t);if(r){TS.pri&&TS.log(58,"setOldestMsgsTs ("+t.id+'): setting oldest_msg_ts from "'+t.oldest_msg_ts+'" -> '+r);t.oldest_msg_ts=r;TS.storage.storeOldestTs(t.id,t.oldest_msg_ts);t._latest_via_users_counts&&(t._latest_via_users_counts=void 0)}},resetOldestMsgsTs:function e(t){TS.pri&&TS.log(58,"resetOldestMsgsTs ("+t.id+'): setting oldest_msg_ts from "'+t.oldest_msg_ts+'" -> null');t.oldest_msg_ts=null;TS.storage.storeOldestTs(t.id,null)},getOlderMsgsStatus:function e(t){var r=t.msgs;var n=t.oldest_msg_ts;var i=false;var a="ERROR";var s=false;var o=0;var l;t.msgs.length&&(l=TS.interop.rules.channels.getLatestMsgTs(t)||null);n&&TS.utility.msgs.getMsg(n,r)&&(i=true);if(l)if(i||t.is_limited){s=false;o=3;a="We have the oldest msg: "+n+". is_limited:"+t.is_limited}else{s=true;o=4;a=n?"There are older messages than these. oldest_msg_ts: "+n:"There are older messages than these. oldest_msg_ts: unknown"}else if(r.length){s=false;o=1;a="There are NOT older messages than these."}else{s=false;o=2;a="THIS IS A BRAND NEW CHANNEL SAY SOMETHING"}return{text:a,more:s,code:o,is_limited:t.is_limited}},getMostRecentValidTs:function e(t){if(!t)return null;var r;var n=t.msgs||[];for(var i=0;i<n.length;i+=1){r=n[i];if(!TS.interop.rules.messages.isTempMsg(r)){TS.pri&&i>0&&TS.log(58,"getMostRecentValidTs ("+t.id+"): "+r.ts+" at msgs["+i+"] of "+n.length);return r.ts}}var a=TS.interop.rules.channels.getLatestMsgTs(t)||null;TS.pri&&TS.log(58,"getMostRecentValidTs ("+t.id+"): did not find most recent valid ts. getLatestMsgTs() returned "+a);return a},getOldestValidTs:function e(t){var r;if(!t||!t.msgs)return null;var n=t.msgs.length-1;for(var i=n;i>-1;i-=1){r=t.msgs[i];if(!TS.interop.rules.messages.isTempMsg(r)){TS.pri&&i!==n&&TS.log(58,"getOldestValidTs("+t.id+"): "+r.ts+" at msgs["+i+"] of "+n);return r.ts}}TS.pri&&TS.warn("getOldestValidTs("+t.id+"): none found. msgs.length = "+n);return null},getHistoryFetchJobKey:function e(t,r){var n=t;r&&(n+="_"+r);return n},processImsg:function e(t,r){return TS.interop.messages.preprocessImsg(t,r)},maybeFetchUserDataFromLS:function e(t){if(!t){TS.warn("maybeFetchUserDataFromLS: WTF no model_ob?");return}if(n[t.id])return;if(!t.last_msg_input){t.last_msg_input=TS.storage.fetchLastMsgInput(t.id);t.has_draft=!!t.last_msg_input;t.last_msg_input&&TS.has_pri[o]&&TS.log(o,'Got last_msg_input for "'+t.id+'": length = '+(t.last_msg_input.length||"unknown"))}n[t.id]=true},_handleLegacyAttachment:function e(t,r){if(!t){TS.warn("attachment is null!");return}if(t.slack_file_id&&!t._slack_file_is_deleted){var n=TS.files.getFileById(t.slack_file_id);n?t._slack_file=n:t._slack_file&&(t._slack_file=TS.files.upsertFile(t._slack_file,"handleLegacyAttachment").file)}if(t.mrkdwn_in&&_.isArray(t.mrkdwn_in)&&t.mrkdwn_in.length){t.mrkdwn_in_hash={};for(var i=0;i<t.mrkdwn_in.length;i+=1)t.mrkdwn_in_hash[t.mrkdwn_in[i]]=true}t.mrkdwn_in_hash||(t.mrkdwn_in_hash={});delete t.mrkdwn_in;t.hex_swatches=!!t.hex_swatches;(t.audio_html||t.audio_url)&&TS.inline_audios.makeInternalInlineAudio(t.audio_html||t.audio_url,t);if(t.other_html)TS.inline_others.makeInternalInlineOther(t);else if(t.video_html){var a=t.video_html_width&&parseInt(t.video_html_width,10)>parseInt(t.thumb_width,10)?t.video_html_width:t.thumb_width;var s=t.video_html_height&&parseInt(t.video_html_height,10)>parseInt(t.thumb_height,10)?t.video_html_height:t.thumb_height;TS.inline_videos.makeInternalInlineVideo(t.from_url||t.thumb_url,{title:t.title,html:TS.utility.msgs.filterHTMLForEmbeds(t.video_html),thumbnail:{url:t.thumb_url,width:a,height:s,link_url:t.from_url||t.title_url}})}else t.image_url&&TS.inline_imgs.makeInternalInlineImg(t.from_url||t.image_url,{src:t.image_url,width:t.image_width,height:t.image_height,link_url:t.from_url||t.title_url||t.image_url,bytes:t.image_bytes,rotation:t.rotation,content_type:t.content_type});TS.inline_attachments.massageAttachment(t,r);return t},processAttachments:function e(t){if(!t)return;var r;for(var n=0;n<t.length;n+=1){r=t[n];TS.utility.msgs._handleLegacyAttachment(r,n)}},constructMsgPermalink:function e(t,r,n){if(!t)return"";var i;i=_.isString(t)?t:t.id;return TS.interop.rules.messages.constructMsgPermalink(i,r,n)},constructAbsoluteMsgPermalink:function e(t,r,n){var i=TS.boot_data.team_url.slice(0,-1)+TS.utility.msgs.constructMsgPermalink(t,r,n);return i},constructConversationPermalink:function e(t,r){var n;n=_.isString(t)?t:t.id;return"/conversation/"+n+"/p"+r.replace(".","")},shouldMarkUnreadsOnMessageFetch:function e(t){if("1"==TS.qs_args.no_unread_marking_on_msgs_fetch)return false;var r;if(t){r=TS.shared.legacyGetActiveModelOb();if(!r||r.id!==t.id)return false}TS.pri&&r&&TS.log(58,"shouldMarkUnreadsOnMessageFetch: returning TRUE for active model_ob of "+r.id);return true},updateFileMsgs:function e(t,r){var n=t.msgs;var i=!(n&&n.length);n=i?t._archive_msgs:n;if(!n||!n.length)return;var a;var s=function e(t){if(!t)return false;if(!t.attachments)return false;if(!t.attachments.length)return false;if(TS.inline_attachments.getAttachmentBySlackFileId(t.attachments,r.id))return true;return false};for(var o=n.length-1;o>-1;o-=1){a=n[o];if(r.is_deleted||"file_share"!==a.subtype&&"file_mention"!==a.subtype&&"file_comment"!==a.subtype||!a.file||a.file.id!=r.id){if(!s(a))continue}else;a.file=_.assign({},r);if(r.is_tombstoned)t.id==TS.model.active_im_id?TS.ims.message_changed_sig.dispatch(t,a):t.id==TS.model.active_channel_id?TS.channels.message_changed_sig.dispatch(t,a):t.id==TS.model.active_group_id?TS.groups.message_changed_sig.dispatch(t,a):t.id==TS.model.active_mpim_id&&TS.mpims.message_changed_sig.dispatch(t,a);else if("hosted"===r.mode||"external"===r.mode||"snippet"===r.mode){if(!r.comments.length&&r.is_tombstoned)continue;t.id==TS.model.active_im_id?TS.ims.message_changed_sig.dispatch(t,a):t.id==TS.model.active_channel_id?TS.channels.message_changed_sig.dispatch(t,a):t.id==TS.model.active_group_id?TS.groups.message_changed_sig.dispatch(t,a):t.id==TS.model.active_mpim_id&&TS.mpims.message_changed_sig.dispatch(t,a)}}},updateCommentReferences:function e(t){if(!t)return;var r=TS.interop.channels.getAllChannels();_.forEach(r,function(e){_.forEach(e.msgs,function(e){if(!e.file||e.file.id!==t.id)return;if(!e.comment)return;var r=_.find(t.comments,{id:e.comment.id});r&&(e.comment=r)})})},getEphemeralMsgsByCidAndType:function e(t,r){var n;var i=[];var a=TS.redux.channels.getEntityById(t);if(!a)return i;i=TS.redux.messages.getMessagesByProp(t,{_ephemeral_type:r});_.forOwn(TS.utility.msgs.ephemeral_msgs_map,function(e,s){if(e.ephemeral_type==r&&e.c_id==t){n=TS.utility.msgs.getMsg(s,a.msgs);if(!n)return;i.push(n)}});return i},removeAllEphemeralMsgsByType:function e(t,r,n){if(!n){var i=TS.redux.messages.getMessagesByProp(r,{_ephemeral_type:t});_.forEach(i,function(e){var t=TS.redux.channels.getEntityById(e.channel);if(!t)return;var r=TS.shared.legacyGetControllerForModelOb(t);r.legacyRemoveMsg(t.id,e)});return}var a;var s;_.forOwn(TS.utility.msgs.ephemeral_msgs_map,function(e,i){if(e.ephemeral_type==t){if(r&&r!=e.c_id)return;if(n&&n!=e.thread_ts)return;a=TS.redux.channels.getEntityById(e.c_id);if(!a)return;s=TS.utility.msgs.getMsg(i,a.msgs);if(!s)return;a.is_im?TS.ims.legacyRemoveMsg(a.id,s):a.is_mpim?TS.mpims.legacyRemoveMsg(a.id,s):a.is_channel?TS.channels.legacyRemoveMsg(a.id,s):a.is_group&&TS.groups.legacyRemoveMsg(a.id,s);delete TS.utility.msgs.ephemeral_msgs_map[i]}})},hasImgs:function e(t){if(!t)return false;if(t.img_vids)_.forOwn(t.img_vids,function(e){if("img"===e.img_vid_type)return true});else if(t.attachments)for(var r=0;r<t.attachments.length;r+=1)if(t.attachments[r].image_url)return true;return false},ingestMessagesFromBootData:function e(t){if(!TS.boot_data.msgs)return;var r=TS.boot_data.msgs[t.id]||[];var n=TS.interop.messages.preprocessImsgs(r.filter(function(e){return!!e.ts}),t.id);TS.utility.msgs.setMsgs(t,n)},handleSearchHighlights:function e(t){return TS.format.replaceHighlightMarkers(t,'<span class="match">',"</span>")},handleFailedMsgSend:function e(t,r,n){var i=TS.utility.msgs.findMsg(t,r.id);if(i){var a;var s;if(n&&i.thread_ts){a=TS.utility.msgs.findMsg(i.thread_ts,r.id);s=i._was_reply_broadcast}r.is_mpim?TS.mpims.legacyRemoveMsg(r.id,i):r.is_channel?TS.channels.legacyRemoveMsg(r.id,i):r.is_group?TS.groups.legacyRemoveMsg(r.id,i):TS.ims.legacyRemoveMsg(r.id,i);n&&TS.shared.legacySendMsg(r.id,TS.format.unFormatMsg(i.text,i),a,s);delete TS.model.unsent_msgs[i.ts];delete TS.model.display_unsent_msgs[i.ts]}else TS.error("no msg?: "+t)},msgMightBeRolledUp:function e(t){return t.subtype&&-1!=TS.model.join_leave_subtypes.indexOf(t.subtype)},msgRollUpWorker:function e(t,r,n,i){delete r._jl_rollup_hash;delete r._jl_rolled_up_in;if(!TS.utility.msgs.msgMightBeRolledUp(r))return;i.push(r);if(0!==t&&TS.utility.msgs.msgMightBeRolledUp(n[t-1]))return"continue";i[0]._jl_rollup_hash={msg_ids:[],users:{}};var a=i[0]._jl_rollup_hash;var s;for(var o=0;o<i.length;o+=1){s=i[o];a.users[s.user]=a.users[s.user]||{};var l=a.users[s.user];a.msg_ids.push(s.ts);s._jl_rolled_up_in=i[0].ts;if("channel_join"===s.subtype||"group_join"===s.subtype){l.inviter=s.inviter;l.joined=true;l.is_in=true}else if("channel_leave"===s.subtype||"group_leave"===s.subtype){l.left=true;l.is_in=false}}return"swap"},shouldHaveBotLabel:function e(t,r){var n=t.subtype&&("bot_message"===t.subtype||"thread_broadcast"===t.subtype&&t.bot_id)&&"USLACKBOT"!==t.user;var i=r&&r.is_bot&&!TS.interop.rules.members.isSlackbot(r);return n||i},filterHTMLForEmbeds:function e(n){if(!n)return n;var i;var a=new DOMParser;var s=a.parseFromString(n,"text/html")||a.parseFromString(n,"text/xml");var o="";var l;s&&(l=$(s.body));if(!l)return n;if(l){i=l.find(r);i.length&&(o=TS.utility.sanitizeHTML(i.first()[0].outerHTML,t,TS.utility.msgs.allowed_embed_attributes))}a=null;s=null;l=null;i=null;return o},areMsgsSameDay:function e(t,r){var n=TS.interop.datetime.toDateObject(t.ts);var i=TS.interop.datetime.toDateObject(r.ts);return TS.interop.datetime.isSameDay(n,i)},maybeSetPrevLastRead:function e(t,r){if(!t)return;var n=TS.utility.msgs.getMostRecentValidTs(t);r!=n?TS.utility.msgs.setPrevLastRead(t,r):TS.utility.msgs.setPrevLastRead(t,t.last_read)},setPrevLastRead:function e(t,r){if(!t)return;if(t._prev_last_read||!t.unread_cnt||TS.notifs.isCorGMuted(t.id)){var n=TS.utility.msgs.getMostRecentValidTs(t);var i=TS.utility.msgs.getMsg(n,t.msgs);i&&"pinned_item"===i.subtype&&(t._prev_last_read=r)}else t._prev_last_read=r},maybeClearPrevLastRead:function e(t){t=t||TS.shared.legacyGetActiveModelOb();t&&t._prev_last_read&&(t._prev_last_read=void 0)},msgHasReplies:function e(t){if(!t)return false;return t.ts===t.thread_ts&&!!t.reply_count},startUpdatingRelativeTimestamps:function e(t){a.start(t)},stopUpdatingRelativeTimestamps:function e(t){a.stop(t)},extractMsgDisplayContext:function e(t){var r=t.closest("#unread_msgs_div");if(r.is("#unread_msgs_div"))return"all_unreads";return null},extractLinkType:function e(t,r,n){if(r.data("member-id")||t.data("member-id"))return"user";if(r.data("channel-id")||t.data("channel-id"))return"channel";if(r.data("file-id")||t.data("file-id"))return"file";if(n&&n.match(/\.slack\.com\/archives\//))return"message";var i=n&&!TS.interop.url.getHostName(n).match(/\.slack\.com/);if(i)return"external";return"internal"},extractLinkItemId:function e(t,r,n){if("user"===n)return r.data("member-id")||t.data("member-id");if("channel"===n)return r.data("channel-id")||t.data("channel-id");if("file"===n)return r.data("file-id")||t.data("file-id");return null},extractLinkAction:function e(t,r){if(r.hasClass("file_preview_action")){if(r.hasClass("file_ssb_download_link"))return"file_ssb_download_link";if(r.hasClass("file_new_window_link"))return"file_new_window_link";if(r.hasClass("file_comment_link"))return"file_comment_link";return"file_preview_action"}if(t.hasClass("file_viewer_external_link"))return"file_viewer_external_link";if(t.hasClass("file_viewer_link"))return"file_viewer_link";if(r.hasClass("file_preview_link"))return"file_preview_link";if(r.hasClass("file_header"))return"file_header";if(r.parent()&&r.parent().hasClass("rest_text_expander"))return"rest_text_expander";return null},extractLinkAttachmentField:function e(t){var r=t.parent();if(t.hasClass("btn_attachment_link"))return"attachment_link_button";if(r.hasClass("attachment_source_icon"))return"attachment_source_icon";if(r.hasClass("attachment_source_name"))return"attachment_source_name";if(r.hasClass("attachment_author_name"))return"attachment_author_name";if(r.hasClass("attachment_title"))return"attachment_title";return null},isRawLink:function e(t,r){if(!t||!r)return false;if(!t.is("a"))return false;var n=r.replace(/(^\w+:|^)\/\//,"");return t.text()===r||t.text()===n},legacyReplaceMsg:function e(t,r,n,i){var a=TS.utility.msgs.getMsg(r.ts,t.msgs);!a&&t._archive_msgs&&(a=TS.utility.msgs.getMsg(r.ts,t._archive_msgs));if(!a){n||TS.error("unknown msg:"+r.ts+" in "+t.id);return}r._rxn_key=a._rxn_key;r.pinned_to||(r.pinned_to=a.pinned_to);"is_starred"in r||(r.is_starred=a.is_starred);var s=null;if(r.comment&&r.file){var o=TS.files.getFileById(r.file.id);if(o){TS.files.editCommentOnFile(r.comment,o);s=TS.files.getFileCommentById(o,r.comment.id)}}r=TS.interop.messages.preprocessImsg(r,t.id);s&&(r.comment=s);var l=_.union(Object.keys(r),Object.keys(a)).filter(function(e){return r[e]!=a[e]});if(!l.length&&!i){TS.info("Not signalling message change because it doesn't look like anything has changed for "+r.ts+" in "+t.id);return}_.each(_.keys(a),function(e){delete a[e]});_.forOwn(r,function(e,t){a[t]=e});t.is_im?TS.ims.message_changed_sig.dispatch(t,a,l):t.is_group&&t.is_mpim?TS.mpims.message_changed_sig.dispatch(t,a,l):t.is_group&&!t.is_mpim?TS.groups.message_changed_sig.dispatch(t,a,l):t.is_channel&&TS.channels.message_changed_sig.dispatch(t,a,l)},isEKMAccessDeniedMessage:function e(t){return t&&"ekm_access_denied"===t.subtype},test:function e(){var t={looksLikeUserGroupMarkup:u,tokenizeMessage:l};return t}});var e=false;var t=["video","iframe","source"];var r=t.join(",");var n={};var i=false;var a=function(){var e=null;var t=[];function r(r){if(_.includes(t,r))return;t.push(r);null===e&&(e=setInterval(i,6e4))}function n(r){_.pull(t,r);if(!t.length){clearInterval(e);e=null}}function i(){_.forEach(t,function(e){$(e).find(".relative_ts").each(function(){var e=$(this).attr("data-ts");var t=$(this).data("really-short");var r=TS.interop.datetime.toTimeAgo(e,{compact:t});r!==$(this).text()&&$(this).text(r)})})}return{start:r,stop:n}}();var s=67;var o=667;var l=function e(t){var r=t.text;var n=TS.format.calculateOptions(t);var i=TSF.getTokensArray($.trim(r),n.tsf_mode,{jumbomoji:!n.no_jumbomoji,allow_intra_word_formatting:TS.format.shouldAllowIntraWordFormatting()});return i};var u=function e(t){return 0===t.indexOf("<")&&0===t.indexOf("<!subteam")};var d=function e(t,r,n){if(!t)return;if(!_.includes(TS.model.channels_with_unreads,t)&&(0!==r||0!==n)){TS.model.channels_with_unreads.push(t);TS.interop.console.debug("[UNREAD-COUNTS]","Adding "+t+" to TS.model.channels_with_unreads because it is unread")}};var c=function e(t,r,n){if(!t)return;if(_.includes(TS.model.channels_with_unreads,t)&&0===r&&0===n){TS.interop.console.debug("[UNREAD-COUNTS]","Removing "+t+" from TS.model.channels_with_unreads because it is no longer unread");_.pull(TS.model.channels_with_unreads,t)}}})()},"6usU":function(e,t){(function(){TS.registerModule("redux.socket",{connectedSig:new signals.Signal,disconnectedSig:new signals.Signal,provisionallyConnectedSig:new signals.Signal,socketErrorMessageReceivedSig:new signals.Signal,socketMessageReceivedSig:new signals.Signal,troubleConnectingSig:new signals.Signal,waitingForRateLimitSig:new signals.Signal,hasNeverConnected:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.hasNeverConnected"),wasPreviouslyConnected:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.wasPreviouslyConnected"),isAsleep:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.isAsleep"),isConnected:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.isConnected"),isConnecting:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.isConnecting"),isProvisionallyConnected:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.isProvisionallyConnected"),isWaitingForConnectivity:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.isWaitingForConnectivity"),isWaitingForRateLimit:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.isWaitingForRateLimit"),promiseToHaveOpenWebSocket:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.promiseToHaveOpenWebSocket")})})()},"7EQy":function(e,t){(function(){TS.registerModule("team",{team_profile_changed_sig:new signals.Signal,team_email_domain_changed_sig:new signals.Signal,team_domain_changed_sig:new signals.Signal,team_name_changed_sig:new signals.Signal,onStart:function e(){TS.interop.Flannel.useSocket()&&TS.redux.socket.connectedSig.add(r,TS.team);TS.team.team_name_changed_sig.add(n)},ensureTeamProfileFields:function e(){if(t)return t;t=TS.interop.api.call("team.profile.get").then(function(e){TS.redux.teams.upsertTeam(_.assign({id:TS.boot_data.team_id},{profile:e.data.profile}))});return t},getTeamProfileFieldById:function e(t){TS.model.team.profile.fields.length||TS.warn("Ensure profile fields exist before calling getTeamProfileFieldById");for(var r=0;r<TS.model.team.profile.fields.length;r+=1)if(TS.model.team.profile.fields[r].id===t)return TS.model.team.profile.fields[r];return null},getVisibleTeamProfileFields:function e(){TS.model.team.profile.fields.length||TS.warn("Ensure profile fields exist before calling getVisibleTeamProfileFields");return TS.model.team.profile.fields.filter(function(e){return!e.is_hidden})},getHiddenTeamProfileFields:function e(){TS.model.team.profile.fields.length||TS.warn("Ensure profile fields exist before calling getHiddenTeamProfileFields");return TS.model.team.profile.fields.filter(function(e){return e.is_hidden})},getTeamCustomStatusPresets:function e(){return _.map(TS.prefs.getTeamPref("custom_status_presets"),function(e){return{text:e[1],canonical:e[2]||null,emoji:e[0]}})},sortTeamProfileFieldsByOrdering:function e(t){if(t&&t.length)return _.clone(t).sort(function(e,t){return e.ordering-t.ordering});TS.warn("Ensure profile fields exist before calling sortTeamProfileFieldsByOrdering")},getVisibleTeamProfileFieldsForMember:function e(t,r){if(!(t&&t.profile))return[];TS.model.team.profile.fields.length||TS.warn("Ensure profile fields exist before calling getVisibleTeamProfileFieldsForMember");return TS.model.team.profile.fields.filter(function(e){return(r||_.get(t.profile,["fields",e.id,"value"]))&&!e.is_hidden}).map(function(e){var r=_.get(t.profile,["fields",e.id,"value"]);var n=_.get(t.profile,["fields",e.id,"alt"]);var i=r&&"date"===e.type?TS.interop.datetime.convertISOtoUTCReadableDate(r):n;return $.extend(true,{value:r,alt:i},e)})},isEntireTeamLoaded:function t(){return e}});var e=false;var t;var r=function e(){t=null};var n=function e(){$("#team_name").text(TS.model.team.name);document.title=document.title.replace(TS.model.last_team_name,TS.model.team.name);TS.model.last_team_name=TS.model.team.name}})()},"8FFK":function(e,t,r){var n=r("cDf5");(function(){TS.registerModule("prefs",{all_notifications_prefs_changed_sig:new signals.Signal,highlight_words_changed_sig:new signals.Signal,seen_welcome_2_changed_sig:new signals.Signal,emoji_mode_changed_sig:new signals.Signal,obey_inline_img_limit_changed_sig:new signals.Signal,messages_theme_changed_sig:new signals.Signal,expand_inline_imgs_changed_sig:new signals.Signal,expand_internal_inline_imgs_changed_sig:new signals.Signal,expand_non_media_attachments_changed_sig:new signals.Signal,webapp_spellcheck_changed_sig:new signals.Signal,color_names_in_list_changed_sig:new signals.Signal,search_only_my_channels_changed_sig:new signals.Signal,search_exclude_channels_changed_sig:new signals.Signal,search_exclude_bots_changed_sig:new signals.Signal,search_only_current_team_changed_sig:new signals.Signal,box_enabled_changed_sig:new signals.Signal,dropbox_enabled_changed_sig:new signals.Signal,read_changed_sig:new signals.Signal,push_changed_sig:new signals.Signal,time24_changed_sig:new signals.Signal,sidebar_behavior_changed_sig:new signals.Signal,dtop_notif_changed_sig:new signals.Signal,muted_channels_changed_sig:new signals.Signal,mac_ssb_bullet_changed_sig:new signals.Signal,team_hide_referers_changed_sig:new signals.Signal,sidebar_theme_changed_sig:new signals.Signal,no_invites_widget_in_sidebar_changed_sig:new signals.Signal,k_key_omnibox_auto_hide_count_changed_sig:new signals.Signal,display_real_names_override_changed_sig:new signals.Signal,team_display_real_names_changed_sig:new signals.Signal,team_perms_pref_changed_sig:new signals.Signal,privacy_policy_seen_changed_sig:new signals.Signal,two_factor_update_seen_changed_sig:new signals.Signal,compliance_export_start_changed_sig:new signals.Signal,team_disallow_public_file_urls_changed_sig:new signals.Signal,mentions_exclude_at_channels_changed_sig:new signals.Signal,mentions_exclude_at_user_groups_changed_sig:new signals.Signal,team_auth_mode_changed_sig:new signals.Signal,team_sso_auth_restrictions_changed_sig:new signals.Signal,preferred_skin_tone_changed_sig:new signals.Signal,separate_private_channels_changed_sig:new signals.Signal,separate_shared_channels_changed_sig:new signals.Signal,whats_new_read_changed_sig:new signals.Signal,team_dnd_enabled_changed_sig:new signals.Signal,team_dnd_start_hour_changed_sig:new signals.Signal,team_dnd_end_hour_changed_sig:new signals.Signal,team_invites_only_admins_changed_sig:new signals.Signal,tz_changed_sig:new signals.Signal,keyboard_changed_sig:new signals.Signal,msg_input_send_btn_changed_sig:new signals.Signal,msg_input_send_btn_auto_set_changed_sig:new signals.Signal,team_allow_calls_changed_sig:new signals.Signal,team_calling_app_name_changed_sig:new signals.Signal,team_calling_app_id_changed_sig:new signals.Signal,frecency_jumper_changed_sig:new signals.Signal,jumbomoji_changed_sig:new signals.Signal,hide_hex_swatch_changed_sig:new signals.Signal,channel_sort_changed_sig:new signals.Signal,show_memory_instrument_changed_sig:new signals.Signal,enable_unread_view_changed_sig:new signals.Signal,enable_react_emoji_picker_changed_sig:new signals.Signal,team_disable_file_editing_changed_sig:new signals.Signal,team_disable_file_deleting_changed_sig:new signals.Signal,team_display_email_addresses_changed_sig:new signals.Signal,all_unreads_sort_order_changed_sig:new signals.Signal,email_alerts_changed_sig:new signals.Signal,team_uses_customized_custom_status_presets_changed_sig:new signals.Signal,team_loud_channel_mentions_limit_changed_sig:new signals.Signal,locale_changed_sig:new signals.Signal,enable_shared_channels_changed_sig:new signals.Signal,a11y_animations_changed_sig:new signals.Signal,prefs_loaded:false,setPrefs:function e(t){var r=TS.prefs.getPref("muted_channels");TS.redux.prefs.setUserPrefs(t);TS.prefs.prefs_loaded=true;TS.prefs.mergeEmojiUse(TS.prefs.getPref("emoji_use"));TS.prefs.mergeFrecencyJumper(TS.ui.frecency.isEnterprise()?TS.prefs.getPref("frecency_ent_jumper"):TS.prefs.getPref("frecency_jumper"));TS.prefs.setUserColors(TS.prefs.getPref("user_colors"));TS.prefs.setLoudChannels(TS.prefs.getPref("loud_channels"));TS.prefs.setSuppressedChannels(TS.prefs.getPref("at_channel_suppressed_channels"));TS.prefs.setPushSuppressedChannels(TS.prefs.getPref("push_at_channel_suppressed_channels"));TS.prefs.setNeverChannels(TS.prefs.getPref("never_channels"));TS.prefs.setMutedChannels(TS.prefs.getPref("muted_channels"),r);TS.prefs.setLoudChannelsSet(TS.prefs.getPref("loud_channels_set"));TS.prefs.setPushLoudChannels(TS.prefs.getPref("push_loud_channels"));TS.prefs.setPushMentionChannels(TS.prefs.getPref("push_mention_channels"));TS.prefs.setPushLoudChannelsSet(TS.prefs.getPref("push_loud_channels_set"));TS.prefs.setSearchExcludeChannels(TS.prefs.getPref("search_exclude_channels"));TS.prefs.setChannelSort(TS.prefs.getPref("channel_sort"));TS.prefs.setSidebarThemeCustomValues(TS.utility.parseJSONOrElse(TS.prefs.getPref("sidebar_theme_custom_values"),void 0));TS.emoji.setEmojiMode();TS.prefs.setTheme();TS.prefs.setPrefLocal("emoji_autocomplete_big",false)},setChannelSort:function e(t){TS.model.channel_sort=t},setHighlightWords:function e(t){TS.prefs.setPrefLocal("highlight_words",t)},setSuppressedChannels:function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.skipSettingLocalPref,i=void 0!==n&&n;i||TS.prefs.setPrefLocal("at_channel_suppressed_channels",t);TS.model.at_channel_suppressed_channels=[];t&&"string"===typeof t&&(TS.model.at_channel_suppressed_channels=TS.model.at_channel_suppressed_channels.concat(t.split(",")))},setPushSuppressedChannels:function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.skipSettingLocalPref,i=void 0!==n&&n;i||TS.prefs.setPrefLocal("push_at_channel_suppressed_channels",t);TS.model.push_at_channel_suppressed_channels=[];t&&"string"===typeof t&&(TS.model.push_at_channel_suppressed_channels=TS.model.push_at_channel_suppressed_channels.concat(t.split(",")))},setLoudChannels:function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.skipSettingLocalPref,i=void 0!==n&&n;i||TS.prefs.setPrefLocal("loud_channels",t);TS.model.loud_channels=[];t&&"string"===typeof t&&(TS.model.loud_channels=TS.model.loud_channels.concat(t.split(",")))},setNeverChannels:function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.skipSettingLocalPref,i=void 0!==n&&n;i||TS.prefs.setPrefLocal("never_channels",t);TS.model.never_channels=[];t&&"string"===typeof t&&(TS.model.never_channels=TS.model.never_channels.concat(t.split(",")))},setMutedChannels:function t(r,n){var i;n||(n=TS.prefs.getPref("muted_channels"));if(n===r&&e)return;i=TS.prefs.getPref("muted_channels")&&"string"===typeof TS.prefs.getPref("muted_channels")?TS.prefs.getPref("muted_channels").split(","):[];TS.prefs.setPrefLocal("muted_channels",r);e=true;var a;var s;var o=[];var l=[];if(r&&"string"===typeof r){o=o.concat(r.split(","));l=_.difference(i,o)}var u=false;for(a=0;a<o.length;a+=1){s=TS.redux.channels.getEntityById(o[a],u);if(!s)continue;if(!s.unread_cnt)continue;s._show_in_list_even_though_no_unreads=true}TS.model.channels.forEach(function(e){if(TS.notifs.isCorGMuted(e.id))return;e._show_in_list_even_though_no_unreads=false});TS.model.groups.forEach(function(e){if(TS.notifs.isCorGMuted(e.id))return;e._show_in_list_even_though_no_unreads=false});TS.redux.channels.updateMutedChannels(o);return l},legacyOnMutedChannelsPrefChanged:function e(){TS.prefs.muted_channels_changed_sig.dispatch()},setLoudChannelsSet:function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.skipSettingLocalPref,i=void 0!==n&&n;i||TS.prefs.setPrefLocal("loud_channels_set",t);TS.model.loud_channels_set=[];t&&"string"===typeof t&&(TS.model.loud_channels_set=TS.model.loud_channels_set.concat(t.split(",")))},setPushLoudChannels:function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.skipSettingLocalPref,i=void 0!==n&&n;i||TS.prefs.setPrefLocal("push_loud_channels",t);TS.model.push_loud_channels=[];t&&"string"===typeof t&&(TS.model.push_loud_channels=TS.model.push_loud_channels.concat(t.split(",")))},setPushMentionChannels:function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.skipSettingLocalPref,i=void 0!==n&&n;i||TS.prefs.setPrefLocal("push_mention_channels",t);TS.model.push_mention_channels=[];t&&"string"===typeof t&&(TS.model.push_mention_channels=TS.model.push_mention_channels.concat(t.split(",")))},setPushLoudChannelsSet:function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.skipSettingLocalPref,i=void 0!==n&&n;i||TS.prefs.setPrefLocal("push_loud_channels_set",t);TS.model.push_loud_channels_set=[];t&&"string"===typeof t&&(TS.model.push_loud_channels_set=TS.model.push_loud_channels_set.concat(t.split(",")))},setSearchExcludeChannels:function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.skipSettingLocalPref,i=void 0!==n&&n;i||TS.prefs.setPrefLocal("search_exclude_channels",t);TS.model.search_exclude_channels=[];t&&"string"===typeof t&&(TS.model.search_exclude_channels=TS.model.search_exclude_channels.concat(t.split(",")))},mergeFrecencyJumper:function e(t){t&&"object"===n(t)||(t=TS.utility.parseJSONOrElse(t||null)||{});TS.model.frecency_jumper=t;return true},mergeEmojiUse:function e(t){TS.model.emoji_names&&TS.model.emoji_names.length||TS.emoji.makeMenuLists();if(!t||"object"!==n(t)){t=TS.utility.parseJSONOrElse(t||null)||{};t=_.pickBy(t,function(e,t){return _.includes(TS.model.emoji_names,t)})}var r=false;for(var i in t)if(!TS.model.emoji_use.hasOwnProperty(i)||t[i]>TS.model.emoji_use[i]){TS.model.emoji_use[i]=t[i];r=true}if(!r){TS.has_pri[777]&&TS.log(777,"mergeEmojiUse TS.model.emoji_use unchanged");return false}TS.has_pri[777]&&TS.dir(777,TS.model.emoji_use,"mergeEmojiUse TS.model.emoji_use set to:");return true},setUserColors:function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.skipSettingLocalPref,i=void 0!==n&&n;i||TS.prefs.setPrefLocal("user_colors",t);var a=t?JSON.parse(t):{};TS.model.user_colors=a||{}},setTheme:function e(){"default"===TS.prefs.getPref("messages_theme")&&TS.prefs.setPrefLocal("messages_theme","light_with_avatars");TS.prefs.setPrefLocal("theme","light");TS.prefs.setPrefLocal("avatars",true);if("dense"===TS.prefs.getPref("messages_theme")){TS.prefs.setPrefLocal("theme","dense");TS.prefs.setPrefLocal("avatars",false)}else if("light"===TS.prefs.getPref("messages_theme")){TS.prefs.setPrefLocal("theme","light");TS.prefs.setPrefLocal("avatars",false)}else if("light_with_avatars"===TS.prefs.getPref("messages_theme")){TS.prefs.setPrefLocal("theme","light");TS.prefs.setPrefLocal("avatars",true)}},legacyOnTeamPrefChanged:function e(t){if("msg_edit_window_mins"===t.name)TS.prefs.setTeamPrefLocal("msg_edit_window_mins",t.value);else if("allow_message_deletion"===t.name)TS.prefs.setTeamPrefLocal("allow_message_deletion",!!t.value);else if("hide_referers"===t.name){TS.prefs.setTeamPrefLocal("hide_referers",!!t.value);TS.prefs.team_hide_referers_changed_sig.dispatch()}else if("display_real_names"===t.name){TS.prefs.setTeamPrefLocal("display_real_names",!!t.value);TS.prefs.team_display_real_names_changed_sig.dispatch()}else if("display_email_addresses"===t.name){TS.prefs.setTeamPrefLocal("display_email_addresses",!!t.value);TS.prefs.team_display_email_addresses_changed_sig.dispatch()}else if(0===t.name.indexOf("who_can_")){if(TS.prefs.getTeamPref(t.name)!=t.value){TS.prefs.setTeamPrefLocal(t.name,t.value);TS.prefs.team_perms_pref_changed_sig.dispatch(t.name)}}else if("compliance_export_start"===t.name){if(TS.prefs.getTeamPref("compliance_export_start")!=t.value){TS.prefs.setTeamPrefLocal("compliance_export_start",t.value);TS.prefs.compliance_export_start_changed_sig.dispatch()}}else if("disallow_public_file_urls"===t.name){TS.prefs.setTeamPrefLocal("disallow_public_file_urls",!!t.value);TS.prefs.team_disallow_public_file_urls_changed_sig.dispatch()}else if("auth_mode"===t.name){TS.prefs.setTeamPrefLocal("auth_mode",t.value);TS.prefs.team_auth_mode_changed_sig.dispatch()}else if("sso_auth_restrictions"===t.name){TS.prefs.setTeamPrefLocal("sso_auth_restrictions",t.value);TS.prefs.team_sso_auth_restrictions_changed_sig.dispatch()}else if("dnd_enabled"===t.name){TS.prefs.setTeamPrefLocal("dnd_enabled",t.value);TS.prefs.team_dnd_enabled_changed_sig.dispatch()}else if("dnd_start_hour"===t.name){TS.prefs.setTeamPrefLocal("dnd_start_hour",t.value);TS.prefs.team_dnd_start_hour_changed_sig.dispatch()}else if("dnd_end_hour"===t.name){TS.prefs.setTeamPrefLocal("dnd_end_hour",t.value);TS.prefs.team_dnd_end_hour_changed_sig.dispatch()}else if("invites_only_admins"===t.name){TS.prefs.setTeamPrefLocal("invites_only_admins",t.value);TS.prefs.team_invites_only_admins_changed_sig.dispatch()}else if("allow_calls"===t.name){TS.prefs.setTeamPrefLocal("allow_calls",t.value);TS.prefs.team_allow_calls_changed_sig.dispatch()}else if("calling_app_id"===t.name){TS.prefs.setTeamPrefLocal("calling_app_id",t.value);TS.prefs.team_calling_app_id_changed_sig.dispatch()}else if("calling_app_name"===t.name){TS.prefs.setTeamPrefLocal("calling_app_name",t.value);TS.prefs.team_calling_app_name_changed_sig.dispatch()}else if("disable_file_editing"===t.name){TS.prefs.setTeamPrefLocal("disable_file_editing",t.value);TS.prefs.team_disable_file_editing_changed_sig.dispatch()}else if("disable_file_deleting"===t.name){TS.prefs.setTeamPrefLocal("disable_file_deleting",t.value);TS.prefs.team_disable_file_deleting_changed_sig.dispatch()}else if("uses_customized_custom_status_presets"===t.name){TS.prefs.setTeamPrefLocal(t.name,t.value);TS.prefs.team_uses_customized_custom_status_presets_changed_sig.dispatch()}else if("loud_channel_mentions_limit"===t.name){TS.prefs.setTeamPrefLocal(t.name,t.value);TS.prefs.team_loud_channel_mentions_limit_changed_sig.dispatch()}else if("enable_shared_channels"===t.name){TS.prefs.setTeamPrefLocal(t.name,t.value);TS.prefs.enable_shared_channels_changed_sig.dispatch()}else if("dropbox_legacy_picker"===t.name){TS.prefs.setTeamPrefLocal(t.name,t.value);TS.prefs.dropbox_enabled_changed_sig.dispatch()}else TS.prefs.setTeamPrefLocal(t.name,t.value)},onTeamPrefChanged:function e(t){var r=t.name;"hide_referers"===r?TS.prefs.team_hide_referers_changed_sig.dispatch():"display_real_names"===r?TS.prefs.team_display_real_names_changed_sig.dispatch():"display_email_addresses"===r?TS.prefs.team_display_email_addresses_changed_sig.dispatch():0===r.indexOf("who_can_")?TS.prefs.team_perms_pref_changed_sig.dispatch(r):"compliance_export_start"===r?TS.prefs.compliance_export_start_changed_sig.dispatch():"disallow_public_file_urls"===r?TS.prefs.team_disallow_public_file_urls_changed_sig.dispatch():"auth_mode"===r?TS.prefs.team_auth_mode_changed_sig.dispatch():"sso_auth_restrictions"===r?TS.prefs.team_sso_auth_restrictions_changed_sig.dispatch():"dnd_enabled"===r?TS.prefs.team_dnd_enabled_changed_sig.dispatch():"dnd_start_hour"===r?TS.prefs.team_dnd_start_hour_changed_sig.dispatch():"dnd_end_hour"===r?TS.prefs.team_dnd_end_hour_changed_sig.dispatch():"invites_only_admins"===r?TS.prefs.team_invites_only_admins_changed_sig.dispatch():"allow_calls"===r?TS.prefs.team_allow_calls_changed_sig.dispatch():"calling_app_id"===r?TS.prefs.team_calling_app_id_changed_sig.dispatch():"calling_app_name"===r?TS.prefs.team_calling_app_name_changed_sig.dispatch():"disable_file_editing"===r?TS.prefs.team_disable_file_editing_changed_sig.dispatch():"disable_file_deleting"===r?TS.prefs.team_disable_file_deleting_changed_sig.dispatch():"uses_customized_custom_status_presets"===r?TS.prefs.team_uses_customized_custom_status_presets_changed_sig.dispatch():"loud_channel_mentions_limit"===r?TS.prefs.team_loud_channel_mentions_limit_changed_sig.dispatch():"enable_shared_channels"===r&&TS.prefs.enable_shared_channels_changed_sig.dispatch()},getPref:function e(t){return TS.redux.prefs.getUserPref(t)},setPrefLocal:function e(t,r){TS.redux.prefs.setUserPref(t,r)},getTeamPref:function e(t){return TS.redux.prefs.getTeamPref(t)},setTeamPrefLocal:function e(t,r){TS.redux.prefs.setTeamPref(t,r)},legacyOnPrefChanged:function e(t){switch(t.name){case"all_notifications_prefs":TS.prefs.setPrefLocal("all_notifications_prefs",t.value);TS.prefs.all_notifications_prefs_changed_sig.dispatch(t.value);break;case"locale":TS.prefs.setPrefLocal("locale",t.value);TS.prefs.locale_changed_sig.dispatch(t.value);break;case"flannel_server_pool":TS.prefs.setPrefLocal("flannel_server_pool",t.value);break;case"color_names_in_list":TS.prefs.setPrefLocal("color_names_in_list",!!t.value);TS.prefs.color_names_in_list_changed_sig.dispatch();break;case"display_real_names_override":TS.prefs.setPrefLocal("display_real_names_override",t.value);TS.prefs.display_real_names_override_changed_sig.dispatch();break;case"growls_enabled":TS.prefs.setPrefLocal("growls_enabled",!!t.value);TS.prefs.dtop_notif_changed_sig.dispatch();break;case"sidebar_theme":if(TS.prefs.getPref("sidebar_theme")!==t.value){TS.prefs.setPrefLocal("sidebar_theme",t.value);TS.prefs.sidebar_theme_changed_sig.dispatch()}break;case"sidebar_theme_custom_values":if(TS.prefs.getPref("sidebar_theme_custom_values")!==t.value){TS.prefs.setSidebarThemeCustomValues(JSON.parse(t.value));TS.prefs.sidebar_theme_changed_sig.dispatch()}break;case"expand_inline_imgs":TS.prefs.setPrefLocal("expand_inline_imgs",!!t.value);TS.prefs.expand_inline_imgs_changed_sig.dispatch();break;case"webapp_spellcheck":TS.prefs.setPrefLocal("webapp_spellcheck",!!t.value);TS.prefs.webapp_spellcheck_changed_sig.dispatch();break;case"expand_internal_inline_imgs":TS.prefs.setPrefLocal("expand_internal_inline_imgs",!!t.value);TS.prefs.expand_internal_inline_imgs_changed_sig.dispatch();break;case"expand_non_media_attachments":TS.prefs.setPrefLocal("expand_non_media_attachments",!!t.value);TS.prefs.expand_non_media_attachments_changed_sig.dispatch();break;case"messages_theme":TS.prefs.setPrefLocal("messages_theme",t.value);TS.prefs.setTheme();TS.prefs.messages_theme_changed_sig.dispatch();break;case"highlight_words":TS.prefs.setHighlightWords(t.value);TS.prefs.highlight_words_changed_sig.dispatch();break;case"at_channel_suppressed_channels":TS.prefs.setSuppressedChannels(t.value);TS.prefs.dtop_notif_changed_sig.dispatch();break;case"push_at_channel_suppressed_channels":TS.prefs.setPushSuppressedChannels(t.value);TS.prefs.push_changed_sig.dispatch();break;case"loud_channels":TS.prefs.setLoudChannels(t.value);break;case"never_channels":TS.prefs.setNeverChannels(t.value);break;case"muted_channels":TS.boot_data.feature_tinyspeck&&TS.interop.console.info("PREFS","muted_channels updated: "+t.value);TS.prefs.setMutedChannels(t.value);TS.prefs.muted_channels_changed_sig.dispatch();break;case"loud_channels_set":TS.prefs.setLoudChannelsSet(t.value);TS.prefs.dtop_notif_changed_sig.dispatch();break;case"push_loud_channels":TS.prefs.setPushLoudChannels(t.value);break;case"push_mention_channels":TS.prefs.setPushMentionChannels(t.value);break;case"push_loud_channels_set":TS.prefs.setPushLoudChannelsSet(t.value);TS.prefs.push_changed_sig.dispatch();break;case"emoji_use":TS.prefs.mergeEmojiUse(t.value)&&TS.emoji.maybeRemakeMenuListsIfFrequentsChanged();break;case"user_colors":_.each(_.keys(TS.model.user_colors),function(e){var t=TS.interop.members.getMemberById(e);t&&TS.members.setMemberUserColor(t,t.color)});TS.prefs.setUserColors(t.value);_.forOwn(TS.model.user_colors,function(e,t){var r=TS.interop.members.getMemberById(t);r&&TS.members.setMemberUserColor(r,e)});break;case"graphic_emoticons":TS.rxns.clearHandyRxnsDisplayDataCache();TS.prefs.setPrefLocal("graphic_emoticons",t.value);TS.emoji.setEmojiMode();TS.prefs.emoji_mode_changed_sig.dispatch();break;case"ss_emojis":TS.prefs.setPrefLocal("ss_emojis",t.value);TS.emoji.setEmojiMode();TS.prefs.emoji_mode_changed_sig.dispatch();TS.emoji.makeMenuLists();break;case"emoji_mode":TS.rxns.clearHandyRxnsDisplayDataCache();var r=t.value;"as_text"!==t.value&&(r=TS.interop.rules.emoji.getEmojiMode({forceDisplay:true}));TS.emoji.setEmojiMode(r);TS.prefs.setPrefLocal("emoji_mode",t.value);TS.prefs.emoji_mode_changed_sig.dispatch();TS.emoji.makeMenuLists();break;case"obey_inline_img_limit":TS.prefs.setPrefLocal("obey_inline_img_limit",t.value);TS.prefs.obey_inline_img_limit_changed_sig.dispatch();break;case"search_only_my_channels":case"search_only_current_team":case"search_exclude_bots":break;case"search_exclude_channels":TS.prefs.setSearchExcludeChannels(t.value);TS.prefs.search_exclude_channels_changed_sig.dispatch();break;case"has_uploaded":TS.prefs.setPrefLocal("has_uploaded",!!t.value);break;case"has_invited":TS.prefs.setPrefLocal("has_invited",!!t.value);break;case"has_created_channel":TS.prefs.setPrefLocal("has_created_channel",!!t.value);break;case"no_joined_overlays":TS.prefs.setPrefLocal("no_joined_overlays",!!t.value);break;case"no_created_overlays":TS.prefs.setPrefLocal("no_created_overlays",!!t.value);break;case"seen_welcome_2":TS.prefs.setPrefLocal("seen_welcome_2",!!t.value);TS.prefs.seen_welcome_2_changed_sig.dispatch();break;case"box_enabled":TS.prefs.setPrefLocal("box_enabled",!!t.value);TS.prefs.box_enabled_changed_sig.dispatch();break;case"dropbox_enabled":TS.prefs.setPrefLocal("dropbox_enabled",!!t.value);TS.prefs.dropbox_enabled_changed_sig.dispatch();break;case"mark_msgs_read_immediately":if(TS.prefs.getPref("mark_msgs_read_immediately")!==!!t.value){TS.prefs.setPrefLocal("mark_msgs_read_immediately",!!t.value);TS.prefs.read_changed_sig.dispatch()}break;case"start_scroll_at_oldest":if(TS.prefs.getPref("start_scroll_at_oldest")!==!!t.value){TS.prefs.setPrefLocal("start_scroll_at_oldest",!!t.value);TS.prefs.read_changed_sig.dispatch()}break;case"mac_ssb_bullet":if(TS.prefs.getPref("mac_ssb_bullet")!==!!t.value){TS.prefs.setPrefLocal("mac_ssb_bullet",!!t.value);TS.prefs.mac_ssb_bullet_changed_sig.dispatch()}break;case"all_channels_loud":if(TS.prefs.getPref("all_channels_loud")!==!!t.value){TS.prefs.setPrefLocal("all_channels_loud",!!t.value);TS.prefs.dtop_notif_changed_sig.dispatch()}break;case"push_everything":if(TS.prefs.getPref("push_everything")!==!!t.value){TS.prefs.setPrefLocal("push_everything",!!t.value);TS.prefs.push_changed_sig.dispatch()}break;case"push_mention_alert":if(TS.prefs.getPref("push_mention_alert")!==!!t.value){TS.prefs.setPrefLocal("push_mention_alert",!!t.value);TS.prefs.push_changed_sig.dispatch()}break;case"push_dm_alert":if(TS.prefs.getPref("push_dm_alert")!==!!t.value){TS.prefs.setPrefLocal("push_dm_alert",!!t.value);TS.prefs.push_changed_sig.dispatch()}break;case"time24":if(TS.prefs.getPref("time24")!==!!t.value){TS.prefs.setPrefLocal("time24",!!t.value);TS.prefs.time24_changed_sig.dispatch()}break;case"sidebar_behavior":if(TS.prefs.getPref("sidebar_behavior")!=t.value){TS.prefs.setPrefLocal("sidebar_behavior",t.value);TS.prefs.sidebar_behavior_changed_sig.dispatch()}break;case"two_factor_update_seen":if(TS.model.two_factor_update_seen!=t.value){TS.mode.prefs.two_factor_update_seen=t.value;TS.prefs.two_factor_update_seen_changed_sig.dispatch()}break;case"privacy_policy_seen":if(TS.prefs.getPref("privacy_policy_seen")!=t.value){TS.prefs.setPrefLocal("privacy_policy_seen",t.value);TS.prefs.privacy_policy_seen_changed_sig.dispatch()}break;case"last_seen_at_channel_warning":TS.prefs.getPref("last_seen_at_channel_warning")!=t.value&&TS.prefs.setPrefLocal("last_seen_at_channel_warning",t.value);break;case"mentions_exclude_at_channels":if(TS.prefs.getPref("mentions_exclude_at_channels")!=t.value){TS.prefs.setPrefLocal("mentions_exclude_at_channels",t.value);TS.prefs.mentions_exclude_at_channels_changed_sig.dispatch()}break;case"mentions_exclude_at_user_groups":if(TS.prefs.getPref("mentions_exclude_at_user_groups")!=t.value){TS.prefs.setPrefLocal("mentions_exclude_at_user_groups",t.value);TS.prefs.mentions_exclude_at_user_groups_changed_sig.dispatch()}break;case"no_invites_widget_in_sidebar":if(TS.prefs.getPref("no_invites_widget_in_sidebar")!=t.value){TS.prefs.setPrefLocal("no_invites_widget_in_sidebar",t.value);TS.prefs.no_invites_widget_in_sidebar_changed_sig.dispatch()}break;case"k_key_omnibox_auto_hide_count":if(TS.prefs.getPref("k_key_omnibox_auto_hide_count")!=t.value){TS.prefs.setPrefLocal("k_key_omnibox_auto_hide_count",t.value);TS.prefs.k_key_omnibox_auto_hide_count_changed_sig.dispatch()}break;case"show_sidebar_quickswitcher_button":TS.prefs.getPref("show_sidebar_quickswitcher_button")!=t.value&&TS.prefs.setPrefLocal("show_sidebar_quickswitcher_button",t.value);break;case"preferred_skin_tone":if(TS.prefs.getPref("preferred_skin_tone")!=t.value){TS.rxns.clearHandyRxnsDisplayDataCache();TS.prefs.setPrefLocal("preferred_skin_tone",t.value);TS.prefs.preferred_skin_tone_changed_sig.dispatch()}break;case"separate_private_channels":if(TS.prefs.getPref("separate_private_channels")!=t.value){TS.prefs.setPrefLocal("separate_private_channels",t.value);TS.prefs.separate_private_channels_changed_sig.dispatch()}break;case"separate_shared_channels":if(TS.prefs.getPref("separate_shared_channels")!=t.value){TS.prefs.setPrefLocal("separate_shared_channels",t.value);TS.prefs.separate_shared_channels_changed_sig.dispatch()}break;case"whats_new_read":if(TS.prefs.getPref("whats_new_read")!=t.value){TS.prefs.setPrefLocal("whats_new_read",t.value);TS.prefs.whats_new_read_changed_sig.dispatch()}break;case"tz":if(TS.prefs.getPref("tz")!=t.value){TS.prefs.setPrefLocal("tz",t.value);TS.prefs.tz_changed_sig.dispatch()}break;case"keyboard":if(TS.prefs.getPref("keyboard")!=t.value){TS.prefs.setPrefLocal("keyboard",t.value);TS.prefs.keyboard_changed_sig.dispatch()}break;case"msg_input_send_btn":if(TS.prefs.getPref("msg_input_send_btn")!=t.value){TS.prefs.setPrefLocal("msg_input_send_btn",t.value);TS.prefs.msg_input_send_btn_changed_sig.dispatch()}break;case"msg_input_send_btn_auto_set":if(TS.prefs.getPref("msg_input_send_btn_auto_set")!=t.value){TS.prefs.setPrefLocal("msg_input_send_btn_auto_set",t.value);TS.prefs.msg_input_send_btn_auto_set_changed_sig.dispatch()}break;case"frecency_jumper":if(TS.ui.frecency.isEnterprise())break;TS.prefs.conditionallyClogFrecencyDueToSizeChange("PREF_USER_TEAM_FRECENCY_SHRINKAGE",JSON.stringify(TS.model.frecency_jumper),t.value);TS.prefs.mergeFrecencyJumper(t.value)&&TS.prefs.frecency_jumper_changed_sig.dispatch();break;case"frecency_ent_jumper":TS.prefs.conditionallyClogFrecencyDueToSizeChange("PREF_USER_ORG_FRECENCY_SHRINKAGE",JSON.stringify(TS.model.frecency_jumper),t.value);TS.log(666,"Received a pref_change event for frecency_ent_jumper.");TS.prefs.mergeFrecencyJumper(t.value)&&TS.prefs.frecency_jumper_changed_sig.dispatch();break;case"jumbomoji":if(TS.prefs.getPref("jumbomoji")!=t.value){TS.prefs.setPrefLocal("jumbomoji",t.value);TS.prefs.jumbomoji_changed_sig.dispatch()}break;case"hide_hex_swatch":if(TS.prefs.getPref("hide_hex_swatch")!=t.value){TS.prefs.setPrefLocal("hide_hex_swatch",t.value);TS.prefs.hide_hex_swatch_changed_sig.dispatch()}break;case"a11y_animations":if(TS.prefs.getPref("a11y_animations")!==t.value){TS.prefs.setPrefLocal("a11y_animations",t.value);TS.prefs.a11y_animations_changed_sig.dispatch()}break;case"show_memory_instrument":if(TS.prefs.getPref("show_memory_instrument")!==t.value){TS.prefs.setPrefLocal("show_memory_instrument",t.value);TS.prefs.show_memory_instrument_changed_sig.dispatch()}break;case"channel_sort":if(TS.prefs.getPref("channel_sort")!==t.value){TS.prefs.setPrefLocal("channel_sort",t.value);TS.prefs.setChannelSort(TS.prefs.getPref("channel_sort"));TS.prefs.channel_sort_changed_sig.dispatch()}break;case"enable_unread_view":if(TS.prefs.getPref("enable_unread_view")!==t.value){TS.prefs.setPrefLocal("enable_unread_view",t.value);TS.prefs.enable_unread_view_changed_sig.dispatch()}break;case"enable_react_emoji_picker":if(TS.prefs.getPref("enable_react_emoji_picker")!==t.value){TS.prefs.setPrefLocal("enable_react_emoji_picker",t.value);TS.prefs.enable_react_emoji_picker_changed_sig.dispatch()}break;case"client_logs_pri":TS.prefs.setPrefLocal(t.name,t.value);TS.console.setAppropriatePri();break;case"email_alerts":TS.prefs.setPrefLocal(t.name,t.value);TS.prefs.email_alerts_changed_sig.dispatch();break;default:TS.prefs.setPrefLocal(t.name,t.value)}},onPrefChanged:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.name,n=t.value;switch(r){case"all_notifications_prefs":TS.prefs.all_notifications_prefs_changed_sig.dispatch(n);break;case"locale":TS.prefs.locale_changed_sig.dispatch(n);break;case"color_names_in_list":TS.prefs.color_names_in_list_changed_sig.dispatch();break;case"display_real_names_override":TS.prefs.display_real_names_override_changed_sig.dispatch();break;case"growls_enabled":TS.prefs.dtop_notif_changed_sig.dispatch();break;case"sidebar_theme":TS.prefs.sidebar_theme_changed_sig.dispatch();break;case"sidebar_theme_custom_values":TS.prefs.setSidebarThemeCustomValues(JSON.parse(n));TS.prefs.sidebar_theme_changed_sig.dispatch();break;case"expand_inline_imgs":TS.prefs.expand_inline_imgs_changed_sig.dispatch();break;case"webapp_spellcheck":TS.prefs.webapp_spellcheck_changed_sig.dispatch();break;case"expand_internal_inline_imgs":TS.prefs.expand_internal_inline_imgs_changed_sig.dispatch();break;case"expand_non_media_attachments":TS.prefs.expand_non_media_attachments_changed_sig.dispatch();break;case"messages_theme":TS.prefs.setTheme();TS.prefs.messages_theme_changed_sig.dispatch();break;case"highlight_words":TS.prefs.highlight_words_changed_sig.dispatch();break;case"at_channel_suppressed_channels":TS.prefs.setSuppressedChannels(n,{skipSettingLocalPref:true});TS.prefs.dtop_notif_changed_sig.dispatch();break;case"push_at_channel_suppressed_channels":TS.prefs.setPushSuppressedChannels(n,{skipSettingLocalPref:true});TS.prefs.push_changed_sig.dispatch();break;case"loud_channels":TS.prefs.setLoudChannels(n,{skipSettingLocalPref:true});break;case"never_channels":TS.prefs.setNeverChannels(n,{skipSettingLocalPref:true});break;case"muted_channels":TS.prefs.setMutedChannels(n);TS.prefs.muted_channels_changed_sig.dispatch();break;case"loud_channels_set":TS.prefs.setLoudChannelsSet(n,{skipSettingLocalPref:true});TS.prefs.dtop_notif_changed_sig.dispatch();break;case"push_loud_channels":TS.prefs.setPushLoudChannels(n,{skipSettingLocalPref:true});break;case"push_mention_channels":TS.prefs.setPushMentionChannels(n,{skipSettingLocalPref:true});break;case"push_loud_channels_set":TS.prefs.setPushLoudChannelsSet(n,{skipSettingLocalPref:true});TS.prefs.push_changed_sig.dispatch();break;case"emoji_use":TS.prefs.mergeEmojiUse(n)&&TS.emoji.maybeRemakeMenuListsIfFrequentsChanged();break;case"user_colors":_.each(_.keys(TS.model.user_colors),function(e){var t=TS.interop.members.getMemberById(e);t&&TS.members.setMemberUserColor(t,t.color)});TS.prefs.setUserColors(n,{skipSettingLocalPref:true});_.forOwn(TS.model.user_colors,function(e,t){var r=TS.interop.members.getMemberById(t);r&&TS.members.setMemberUserColor(r,e)});break;case"graphic_emoticons":TS.rxns.clearHandyRxnsDisplayDataCache();TS.prefs.setPrefLocal("graphic_emoticons",n);TS.emoji.setEmojiMode();TS.prefs.emoji_mode_changed_sig.dispatch();break;case"ss_emojis":TS.emoji.setEmojiMode();TS.prefs.emoji_mode_changed_sig.dispatch();TS.emoji.makeMenuLists();break;case"emoji_mode":TS.rxns.clearHandyRxnsDisplayDataCache();var i=n;"as_text"!==n&&(i=TS.interop.rules.emoji.getEmojiMode({forceDisplay:true}));TS.emoji.setEmojiMode(i);TS.prefs.setPrefLocal("emoji_mode",n);TS.prefs.emoji_mode_changed_sig.dispatch();TS.emoji.makeMenuLists();break;case"obey_inline_img_limit":TS.prefs.obey_inline_img_limit_changed_sig.dispatch();break;case"search_only_my_channels":TS.prefs.search_only_my_channels_changed_sig.dispatch();break;case"search_only_current_team":TS.prefs.search_only_current_team_changed_sig.dispatch();break;case"search_exclude_channels":TS.prefs.setSearchExcludeChannels(n,{skipSettingLocalPref:true});TS.prefs.search_exclude_channels_changed_sig.dispatch();break;case"search_exclude_bots":TS.prefs.search_exclude_bots_changed_sig.dispatch();break;case"seen_welcome_2":TS.prefs.seen_welcome_2_changed_sig.dispatch();break;case"box_enabled":TS.prefs.box_enabled_changed_sig.dispatch();break;case"dropbox_enabled":TS.prefs.dropbox_enabled_changed_sig.dispatch();break;case"mark_msgs_read_immediately":TS.prefs.read_changed_sig.dispatch();break;case"start_scroll_at_oldest":TS.prefs.read_changed_sig.dispatch();break;case"mac_ssb_bullet":TS.prefs.mac_ssb_bullet_changed_sig.dispatch();break;case"all_channels_loud":TS.prefs.dtop_notif_changed_sig.dispatch();break;case"push_everything":TS.prefs.push_changed_sig.dispatch();break;case"push_mention_alert":TS.prefs.push_changed_sig.dispatch();break;case"push_dm_alert":TS.prefs.push_changed_sig.dispatch();break;case"time24":TS.prefs.time24_changed_sig.dispatch();break;case"sidebar_behavior":TS.prefs.sidebar_behavior_changed_sig.dispatch();break;case"two_factor_update_seen":TS.prefs.two_factor_update_seen_changed_sig.dispatch();break;case"privacy_policy_seen":TS.prefs.privacy_policy_seen_changed_sig.dispatch();break;case"mentions_exclude_at_channels":TS.prefs.mentions_exclude_at_channels_changed_sig.dispatch();break;case"mentions_exclude_at_user_groups":TS.prefs.mentions_exclude_at_user_groups_changed_sig.dispatch();break;case"no_invites_widget_in_sidebar":TS.prefs.no_invites_widget_in_sidebar_changed_sig.dispatch();break;case"k_key_omnibox_auto_hide_count":TS.prefs.k_key_omnibox_auto_hide_count_changed_sig.dispatch();break;case"preferred_skin_tone":TS.rxns.clearHandyRxnsDisplayDataCache();TS.prefs.setPrefLocal("preferred_skin_tone",n);TS.prefs.preferred_skin_tone_changed_sig.dispatch();break;case"separate_private_channels":TS.prefs.separate_private_channels_changed_sig.dispatch();break;case"separate_shared_channels":TS.prefs.separate_shared_channels_changed_sig.dispatch();break;case"whats_new_read":TS.prefs.whats_new_read_changed_sig.dispatch();break;case"tz":TS.prefs.tz_changed_sig.dispatch();break;case"keyboard":TS.prefs.keyboard_changed_sig.dispatch();break;case"msg_input_send_btn":TS.prefs.msg_input_send_btn_changed_sig.dispatch();break;case"msg_input_send_btn_auto_set":TS.prefs.msg_input_send_btn_auto_set_changed_sig.dispatch();break;case"frecency_jumper":if(TS.ui.frecency.isEnterprise())break;TS.prefs.conditionallyClogFrecencyDueToSizeChange("PREF_USER_TEAM_FRECENCY_SHRINKAGE",JSON.stringify(TS.model.frecency_jumper),n);TS.prefs.mergeFrecencyJumper(n)&&TS.prefs.frecency_jumper_changed_sig.dispatch();break;case"frecency_ent_jumper":TS.prefs.conditionallyClogFrecencyDueToSizeChange("PREF_USER_ORG_FRECENCY_SHRINKAGE",JSON.stringify(TS.model.frecency_jumper),n);TS.log(666,"Received a pref_change event for frecency_ent_jumper.");TS.prefs.mergeFrecencyJumper(n)&&TS.prefs.frecency_jumper_changed_sig.dispatch();break;case"jumbomoji":TS.prefs.jumbomoji_changed_sig.dispatch();break;case"hide_hex_swatch":TS.prefs.hide_hex_swatch_changed_sig.dispatch();break;case"a11y_animations":TS.prefs.a11y_animations_changed_sig.dispatch();break;case"show_memory_instrument":TS.prefs.show_memory_instrument_changed_sig.dispatch();break;case"channel_sort":TS.prefs.setChannelSort(TS.prefs.getPref("channel_sort"));TS.prefs.channel_sort_changed_sig.dispatch();break;case"enable_unread_view":TS.prefs.enable_unread_view_changed_sig.dispatch();break;case"enable_react_emoji_picker":TS.prefs.enable_react_emoji_picker_changed_sig.dispatch();break;case"client_logs_pri":TS.console.setAppropriatePri();break;case"email_alerts":TS.prefs.email_alerts_changed_sig.dispatch();break;default:break}},hex_regex:new RegExp(/^#?([0-9a-f]{6})$/i),conditionallyClogFrecencyDueToSizeChange:function e(t,r,n){n.length/r.length<.1&&TS.interop.clog.track(t,{updated_user_client_prefs:{existing_frecency:r,new_frecency:n}})},setSidebarThemeCustomValues:function e(t){var r=false;t&&"object"===n(t)&&void 0===t.length&&_.forOwn(t,function(e,n){r=false;if(!e)return false;if(!e.substr)return false;t[n]=e.substr(0,7);if(!e.match(TS.prefs.hex_regex))return false;r=true});if(r)TS.prefs.setPrefLocal("sidebar_theme_custom_values",JSON.stringify(t));else{TS.prefs.setPrefLocal("sidebar_theme","default");TS.prefs.setPrefLocal("sidebar_theme_custom_values",JSON.stringify(TS.sidebar_themes.default_themes.default_theme))}},setMultiPrefsByAPI:function e(t,r){var n="";_.forOwn(t,function(e,t){n+="&"+encodeURIComponent(t)+"="+encodeURIComponent(e)});if(!n){TS.error(" no prefs to set?");return}var i={prefs:n};return TS.prefs.setPrefByAPI(i,r)},setPrefByAPI:function e(t,r){return TS.interop.api.callExpedited("users.prefs.set",t).then(function(e){var t=true;var n=e.data,i=e.args;if(n&&n.prefs&&i){var a=i.name&&[i.name]||_.keys(TS.interop.url.queryStringParse(i.prefs));_.forEach(a,function(e){return TS.prefs.legacyOnPrefChanged({name:e,value:n.prefs[e]})})}if(r)return r(t,n,i)}).catch(function(e){var t=e.args;var r;t.hasOwnProperty("name")?r="pref name: "+t.name:t.prefs&&(r="(multiple prefs)");TS.interop.utility.getLogger({getState:TS.redux.getState}).error(r,"TS.prefs.setPrefByAPI call got a not ok rsp",{subtype:"API response error"});setTimeout(function(){t.prefs?TS.error("multi preferences setting failed."):TS.error('"'+t.name+'" preference setting failed.')},0)})},setTeamPrefByAPI:function e(t,r,n){return TS.interop.api.callExpedited("team.prefs.set",{prefs:JSON.stringify(t)}).then(function(e){var r=e.data;if(TS.web){n=n||[];var i=Object.keys(t).concat(n);i.forEach(function(e){r.prefs.hasOwnProperty(e)&&(t.hasOwnProperty(e)||TS.prefs.getTeamPref(e)!==r.prefs[e])&&TS.prefs.legacyOnTeamPrefChanged({name:e,value:r.prefs[e]})})}return Promise.resolve(r.prefs)}).catch(function(e){var t=e.data;r&&r(t);return Promise.reject(t)})},removeTeamFromEnterpriseExcludeTeamPref:function e(t){if(!TS.boot_data.page_needs_enterprise)return;var r=TS.prefs.getPref("enterprise_excluded_app_teams");if(!r)return;var n=r?r.split(","):[];_.pull(n,t);TS.prefs.setPrefByAPI({name:"enterprise_excluded_app_teams",value:n.join(",")})}});var e=false})()},"9mk2":function(e,t){(function(){TS.registerModule("help",{issues_sorted_sig:new signals.Signal,issues:[],more_url:null,fake_api_rsps:false,max_title_chars:100,getIssueById:function e(t){var r;for(var n=0;n<TS.help.issues.length;n+=1){r=TS.help.issues[n];if(r.id==t)return r}return null},onListIssues:function e(t,r){if(TS.help.fake_api_rsps){TS.help.more_url="/help";TS.help.issues=[{id:"T00001",title:"issue 1",ts:"1111111111",short_text:"blah blah blah blah blah",state:"resolved"},{id:"T00002",title:"issue 2",ts:"1141111111",short_text:"I think this is ok",state:"open"},{id:"T00003",title:"issue 3",ts:"1121111111",short_text:"but I am not so sure abotu this",state:"unread"},{id:"T00004",title:"issue 4",ts:"1161111111",short_text:"what about that?",state:"open"},{id:"T00005",title:"issue 5",ts:"1151111111",short_text:"fuck it all to hell",state:"open"},{id:"T00006",title:"issue 6",ts:"1171111111",short_text:"MORE BATTRY PLZ",state:"read"},{id:"T00007",title:"issue 7",ts:"1191111111",short_text:"halp",state:"unread"},{id:"T00008",title:"issue 8",ts:"191111111",short_text:"halp",state:"unread"},{id:"T00009",title:"issue 9",ts:"181111111",short_text:"halp",state:"unread"},{id:"T000010",title:"issue 10",ts:"171111111",short_text:"halp halp halp halp halp halp halp halp halp halp ...",state:"unread"}]}else t&&(TS.help.issues=r.issues);TS.help.sortIssues();TS.help.updateIcon()},sortIssues:function e(){var t={unread:4,open:3,read:2,resolved:1};var r;for(var n=0;n<TS.help.issues.length;n+=1){r=TS.help.issues[n];r._sorter=parseFloat((t[r.state]||5)+"."+r.ts)}TS.help.issues.sort(function e(t,r){if(t._sorter<r._sorter)return 1;if(t._sorter>r._sorter)return-1;return 0});TS.help.issues_sorted_sig.dispatch()},updateIcon:function e(){var t="normal";var r=0;var n;for(var i=0;i<TS.help.issues.length;i+=1){n=TS.help.issues[i];if("unread"===n.state){t="unread";r+=1}}$("#flex_menu_toggle").removeClass("normal open unread").addClass(t);$("#help_toggle").removeClass("normal open unread").addClass(t);$("#help_icon_circle_count, .help_icon_circle_count").addClass("hidden");r>9&&(r="9+");r&&$("#help_icon_circle_count, .help_icon_circle_count").removeClass("hidden").text(r)},createIssue:function e(t,r){var n=t.title;var i=t.text;if(!n)return;i=i||"";var a={title:n,text:i};t.tags&&(a.tags=t.tags);var s=function e(t,a){if(!t&&TS.help.fake_api_rsps){var s={id:Date.now(),title:n,ts:Date.now()/1e3,short_text:i.substr(0,50),state:"open"};setTimeout(function(){TS.redux.dispatch(TS.interop.redux.features.socket.socketMessageReceived({type:"issue_created",issue:s}))},2e3)}r&&r(t,TS.help.makeErrStr(a))};TS.interop.api.call("help.issues.create",a).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;s(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;s(i,t,r,n);return{data:t,args:r,request_id:n}})},markIssueRead:function e(t,r){var n=TS.help.getIssueById(t);if(!n){r&&r(false,"unknown issue");return}if("unread"!==n.state){r&&r(true);return}var i=function e(t,i){if(!t&&TS.help.fake_api_rsps){var a=_.cloneDeep(n);a.state="read";setTimeout(function(){TS.redux.dispatch(TS.interop.redux.features.socket.socketMessageReceived({type:"issue_change",issue:a}))},2e3)}r&&r(t,TS.help.makeErrStr(i))};TS.interop.api.call("help.issues.markRead",{id:t}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var a=true;i(a,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var a=false;i(a,t,r,n);return{data:t,args:r,request_id:n}})},markIssueResolved:function e(t,r){var n=TS.help.getIssueById(t);if(!n){r&&r(false,"unknown issue");return}var i=function e(t,i){if(TS.help.fake_api_rsps||!t&&i&&"ticket_closed"===i.error){t=true;var a=_.cloneDeep(n);a.state="resolved";setTimeout(function(){TS.redux.dispatch(TS.interop.redux.features.socket.socketMessageReceived({type:"issue_change",issue:a}))},1e3)}r&&r(t,TS.help.makeErrStr(i))};TS.interop.api.call("help.issues.markResolved",{id:t}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var a=true;i(a,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var a=false;i(a,t,r,n);return{data:t,args:r,request_id:n}})},onIssueChange:function e(t){var r=TS.help.getIssueById(t.id);r?TS.help.updateIssue(t,r):TS.help.issues.push(t);TS.help.sortIssues();TS.help.updateIcon()},updateIssue:function e(t,r){_.forOwn(t,function(e,t){r[t]=e});r.comments&&r.comments.sort(function e(t,r){if(t.ts<r.ts)return 1;if(t.ts>r.ts)return-1;return 0})},makeErrStr:function e(t){if(!t)return"missing data";if(t.ok)return null;if(t.error&&t.info&&TS.boot_data.feature_tinyspeck)try{return'api error: "'+t.error+'"<br><br><div class="admin-section" style="word-wrap: break-word; word-break: break-word;">api rsp: '+JSON.stringify(t).replace(/,/g,", ")+"</div>"}catch(e){}if(t.error)return'api error: "'+t.error+'"'}})})()},Bnag:function(e,t){function r(){throw new TypeError("Invalid attempt to spread non-iterable instance")}e.exports=r},Chwb:function(e,t){(function(){TS.registerModule("menu.member",{member:null,member_item_click_sig:new signals.Signal,onStart:function e(){},startWithEditMemberProfilePhotoActions:function e(t,r){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();var n=true===TS.model.user.profile.is_custom_image;var i=$(t.target);var a=i.is(".btn");var s={show_delete:n&&!a,is_iOS:TS.model.is_iOS};TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_edit_member_profile_photo_action_items(s));TS.menu.$menu_items.on("click.menu","li",r);TS.menu.start(t,null,{menu_class:"member_menu"});a?TS.menu.positionAt(i,0,i.outerHeight()+5):TS.menu.positionAt(i.closest('[data-action="edit_member_profile_photo_menu"]'),36,156);TS.menu.keepInBounds()},startWithEnterpriseMemberHeader:function t(r){var n=15;if(TS.menu.isRedundantClick(r))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var i={enterprise_name:$("[data-enterprise-name]").val(),signout_url:TS.boot_data.signout_url};TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_enterprise_member_header(i));TS.menu.$menu_items.on("click.menu","li",e);TS.kb_nav.setSubmitItemHandler(e);TS.menu.start(r,null,{menu_class:"member_menu"});var a=$("[data-header-menu-toggle]");var s=-TS.menu.$menu.outerWidth()+a.outerWidth();var o=a.outerHeight()+n;TS.menu.positionAt(a,s,o);r.preventDefault()},end:function e(){TS.menu.member.member=null;TS.menu.end();TS.menu.clean()}});var e=function e(t){var r=$(this).attr("id");if("sign_out"===r)return;if("view_account"===r)return;t.preventDefault();TS.warn("not sure what to do with clicked element id:"+r)}})()},Cs7e:function(e,t){(function(){TS.registerModule("menu",{$menu:null,$submenu:null,$submenu_origin:null,$submenu_parent:null,$menu_header:null,$menu_items:null,$menu_list_container:null,$menu_list:null,$menu_footer:null,menu_lazy_load:null,user_group:null,end_tim:0,$target_element:null,$secondary_target_element:null,members_html_cache:null,large_list_trigger:1500,large_dom_trigger:500,watching_members_model:false,menu_items_hidden:true,has_submenu:false,menu_closed_sig:new signals.Signal,local_discount_offer_loaded_sig:new signals.Signal,onStart:function e(){},buildIfNeeded:_.once(function(){TS.menu.$menu=$(TS.templates.menu());var e=TS.menu.$menu;if("mobile"!==TS.boot_data.app&&"0"!=TS.qs_args.new_scroll){e.appendTo($("body"));if(!TS.environment.supports_custom_scrollbar){var t="1"==TS.qs_args.debug_scroll;e.find("#menu_items_scroller").monkeyScroll({debug:t})}e.detach()}TS.menu.$menu_header=e.find("#menu_header");TS.menu.$menu_body=e.find(".menu_body");TS.menu.$menu_list_container=e.find("#menu_list_container");TS.menu.$menu_list=e.find("#menu_list");TS.menu.$menu_items=e.find("#menu_items");TS.menu.$menu_footer=e.find("#menu_footer")}),handleTopicKeydown:function e(t){var r=TS.utility.keymap;if(t.which==r.enter&&!t.shiftKey&&!t.altKey){var n=$(t.target);var i=TS.shared.legacyGetActiveModelOb();var a=$.trim(n.val());if(i.topic.value===a){TS.menu.end();return}TS.interop.channels.submitChannelTopic(i.id,a).catch(TS.channels.legacyAlertSetTopicError);TS.menu.end()}},startWithList:function e(t,r,n){if(!r||!r.length)return;if(TS.menu.isRedundantClick(t))return;n=n||{};TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(r.html());TS.menu.$menu.addClass(n.menu_class);(n.close_on_click||n.onClick)&&TS.menu.$menu_items.on("click.menu","li",function(e){"function"===typeof n.onClick&&n.onClick(e);n.close_on_click&&TS.menu.end()});TS.menu.start(t,void 0,n);if(n.attach_to_target_at_full_width)TS.menu.$menu.css({width:"100%",top:"calc(100% + 3px)",left:"0"});else{var i=s(n.align_right);TS.menu.positionAt(TS.menu.$target_element,i.left,i.top)}},startWithMessageActions:function e(t,r,n,i){if(!TS.interop.connectivity.isOnline()){TS.sounds.play("beep");return}if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();i=i||TS.shared.legacyGetActiveModelOb();var a=TS.redux.messages.getMessageByTimestamp(i.id,r);var s=$(t.target);var o=TS.interop.constants.MESSAGE_CONTAINERS.MESSAGE_PANE;s.closest("ts-conversation").length>0?o=TS.interop.constants.MESSAGE_CONTAINERS.THREADS_FLEXPANE:s.closest("#threads_msgs").length>0?o=TS.interop.constants.MESSAGE_CONTAINERS.THREADS_VIEW:s.closest("#unread_msgs_div").length>0&&(o=TS.interop.constants.MESSAGE_CONTAINERS.UNREAD_VIEW);TS.ui.react_message_menu.showMessageMenu(t,{channel:i,message:a,message_container_type:o})},onMessageActionClick:function e(t){t.preventDefault();var r=$(this);var n=r.attr("id");var i=r.data("msg-ts");var a=r.data("model-ob-id");var s=r.data("rxn-key");var o=a?TS.redux.channels.getEntityById(a):TS.shared.legacyGetActiveModelOb();if("edit_link"===n){var l=r.data("edit-state");TS.msg_edit.startEdit(i,o,l);c("edit_message_button")}else if("delete_link"===n){TS.msg_edit.startDelete(i,o);c("delete_message_button")}else if("open_in_channel"===n)c("open_in_channel_button");else if("toggle-subscription-status"===n){var u=r.data("subscribed");r.addClass("disabled");c(u?"unfollow_message_button":"follow_message_button")}else if("pin_link"===n){TS.pins.startPinMessage(i,o);c("pin_to_this_conversation_button")}else if("unpin_link"===n){TS.pins.unPinMessage(i,o);c("unpin_from_this_conversation_button")}else if("rxn_link"===n){TS.ui.react_emoji_menu.start({e:t,rxn_key:s});c("add_reaction_button")}else if("copy_link"===n){TS.clipboard.writeText($(this).data("permalink"));var d=TS.menu.$secondary_target_element;var _={message_timestamp:i,channel_id:a,channel_type:a[0]||"",member_id:d.data("member-id"),app_id:d.data("app-id"),bot_id:d.data("bot-id")};TS.interop.clog.track("MSG_LINK_COPY",_);c("copy_link_button")}else if("open_original_link"===n);else if("share_message_link"===n){TS.ui.share_message_dialog.start(i,o);c("share_message_button")}else if("remove_broadcast_link"===n){TS.msg_edit.startRemoveBroadcast(i,o);c("remove_from_conversation_button")}else if("remind_me"===n)return;TS.menu.end()},onMessageRemindClick:function e(t,r,n,i){var a=$(i.target).data("msg-action");if("remind"===a){var s={time:$(i.target).data("remind-length"),message_channel:t.id,message_ts:r.ts};"thread_broadcast"!==r.subtype||n||(s.respond_in_channel=true);var o=function e(){};TS.interop.api.call("reminders.addFromMessage",s).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;o(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;o(i,t,r,n);return{data:t,args:r,request_id:n}});c("remind_me_button")}TS.menu.end()},startWithCommentActions:function e(t,r,n){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var i=TS.files.getFileById(r);if(!i)return;var a=TS.files.getFileCommentById(i,n);if(!a)return;var s=TS.shared.legacyGetActiveModelOb();var o=TS.files.getFileCommentActions(a,i);TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_comment_action_items({model_ob:s,file:i,comment:a,actions:o}));var l=$(t.target);TS.menu.$menu_items.on("click.menu","li",function(e){var t=l.closest(".comment_actions");TS.menu.onCommentActionClick(e,t)});TS.menu.start(t);var u=0;var d=-(TS.menu.$menu.width()+10);var c=TS.menu.$menu.find("#edit_file_comment");0===c.length&&(c=TS.menu.$menu.find("#rxn_file_comment"));if(c.length>0){var _=TS.menu.$menu.offset().top;var m=c.offset().top;u=-(m-_+c.height()/2-5)}TS.menu.positionAt(l,d,u);TS.menu.keepInBounds()},onCommentActionClick:function e(t,r){t.preventDefault();var n=$(t.target).closest("[id]");var i=n.attr("id");var a=n.data("rxn-key");var s=TS.shared.legacyGetActiveModelOb();if("edit_file_comment"===i)TS.ui.comments.startEdit(n.data("file-id"),n.data("comment-id"),r);else if("delete_file_comment"===i)TS.ui.comments.startDelete(n.data("file-id"),n.data("comment-id"));else if("rxn_file_comment"===i)TS.ui.react_emoji_menu.start({e:t,rxn_key:a});else if("pin_comment"===i&&s)TS.pins.startPinFileComment(n.data("comment-id"),n.data("file-id"),s);else{if("unpin_comment"!==i||!s){TS.warn("not sure what to do with clicked element id:"+i);return}TS.pins.unPinFileComment(n.data("comment-id"),n.data("file-id"),s)}TS.menu.end()},startWithTeamAndUser:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.startWithTeamAndUserRebuild(t);if(TS.boot_data.page_needs_enterprise){TS.menu.listenForRebuildWorthiness(t);o(t)}},did_start_slack_menu_signal_listeners:false,listenForRebuildWorthiness:function e(){TS.menu.did_start_slack_menu_signal_listeners=true},stopListeningForRebuildWorthiness:function e(){TS.menu.did_start_slack_menu_signal_listeners=false},startWithTeamAndUserRebuild:function r(i){TS.menu.clean();TS.menu.submenu_template_args={};t=!!TS.prefs.getTeamPref("all_users_can_purchase");var a=TS.model&&TS.model.team&&TS.boot_data.feature_tinyspeck;var s=TS.environment.is_dev;var o=a||s;var l=TS.boot_data.qa_messages_count||TS.model.team.messages_count;var c=!!TS.interop.selfTeamIds.getEnterpriseId(TS.redux.getState());var m=TS.interop.desktop.isAppStoreBuild();var f=TS.model.team.plan&&_.includes(["std","plus","enterprise"],TS.model.team.plan)||!TS.model.team.plan;var p=c||!m;var h=TS.menu.showAdminLink();var g=TS.interop.rules.invites.canUserSeeInviteModal(TS.redux.getState());var S=TS.model.team.plan&&(TS.model.user.is_owner||TS.prefs.getPref("purchaser"));var T=TS.interop.rules.members.isEnterpriseAdmin(TS.model.user)||TS.interop.rules.members.isEnterpriseOwner(TS.model.user);var v=!m&&!TS.model.team.plan;var b=TS.model.user.is_admin||!TS.prefs.getTeamPref("stats_only_admins")&&!TS.model.user.is_restricted;var y=!TS.model.team.plan&&b&&!c&&l>=200;var w=TS.model.user.is_admin||!TS.model.user.is_restricted&&(!TS.prefs.getTeamPref("emoji_only_admins")||!TS.prefs.getTeamPref("slackbot_responses_only_admins")||!TS.prefs.getTeamPref("loading_only_admins"));var k=TS.interop.members.isAppmin()&&c;var x=TS.interop.rules.user.canManageParticipationInSharedChannelsOpenBeta(true);var C=TS.interop.rules.teams.isPaidTeam(TS.model.team);var M=!TS.interop.rules.teams.isSharedChannelsEnabled(TS.redux.getState(),TS.model.team);var I=TS.boot_data.page_needs_enterprise&&!TS.model.user.is_restricted;var E=C&&x&&!M;var A=!C&&x&&!TS.interop.desktop.isAppStoreBuild();var P={user:TS.model.user,team:TS.model.team,team_name:TS.interop.rules.teams.getTeamDisplayName(TS.model.team),logout_url:TS.boot_data.logout_url,signin_url:TS.boot_data.signin_url,help_url:TS.boot_data.help_url,show_version_info:o,current_team_is_in_enterprise:false,current_team_gets_logout_url:true,is_in_plan_awareness_experiment:f,show_plan_info:p,show_admin_link:h,show_invite_link:g,show_limit_meters:y,show_apps_link:k,show_customize_link:w,show_statistics_link:b,show_billing_link:S,show_paid_plans_link:v,show_shared_channels:I,show_shared_channels_open_beta_controls:E,show_shared_channels_open_beta_free_team_controls:A,user_is_enterprise_owner_admin:T,anyone_can_buy:t,is_our_app:TS.model.is_our_app,messages_count:l,messages_count_str:TS.utility.number.formatNumberWithAbbreviation(l,{precision:2,decimal_places:1,lowercase:true}),hidden_messages_count_str:TS.utility.number.formatNumberWithAbbreviation(l-1e4,{decimal_places:1,lowercase:true}),local_discount_offer:n,org_name:TS.redux.teams.getSelfEnterpriseOrgName(),team_url:TS.utility.enterprise.buildTeamUrl(TS.model.team.domain)};if(f&&p){var O;var F;switch(TS.model.team.plan){case"std":O=TS.interop.i18n.t("Standard","menu")();F="/pricing/standard";break;case"plus":O=TS.interop.i18n.t("Plus","menu")();F="/pricing/plus";break;case"enterprise":O=TS.interop.i18n.t("Enterprise","menu")();F="/pricing/enterprise-grid";break;default:F="/pricing";break}n&&(F="/pricing");P.current_team_plan=O;P.current_team_plan_a_tag="<a class='inline_menu_link see_upgrade_options_link' href='"+F+"?ui_step=61&ui_element=5' target='_blank' tabindex='1'>"}var H=Object.keys(TS.boot_data.other_accounts).length;H&&(P.other_accounts=TS.boot_data.other_accounts);TS.model.team.enterprise_id&&(P.current_team_is_in_enterprise=true);var j=false;var D=_.merge({},TS.boot_data.other_accounts);var L={};TS.boot_data.page_needs_enterprise&&_.get(TS.model.user,"enterprise_user.teams.length")>1&&(D[TS.model.team.id]=TS.model.team);_.each(D,function(t){if(t.enterprise_id){if(!P.other_enterprise_accounts){j=true;P.other_enterprise_accounts=_(D).filter("enterprise_id").groupBy("enterprise_id").map(function(t){var r={};r.enterprise_id=t[0].enterprise_id;r.enterprise_name=t[0].enterprise_name;TS.model.user.enterprise_user&&r.enterprise_id===TS.model.user.enterprise_user.enterprise_id?r.enterprise_teams=_(_.get(TS.model.user,"enterprise_user.teams",[])).without(TS.model.team.id).map(function(e){return TS.teams.getTeamById(e)}).compact().slice(0,e).map(function(e){return{team_id:e.id,team_url:TS.utility.enterprise.buildTeamUrl(e.domain),team_name:TS.interop.rules.teams.getTeamDisplayName(e)}}).sortBy("team_name").value():r.enterprise_teams=t.slice(0,e);r.is_currently_logged_into=false;if(r.enterprise_id===TS.model.team.enterprise_id){r.is_enterprise_currently_logged_into=true;r.needs_enterprise_teams_dialog=_.get(TS.model.user,"enterprise_user.teams.length")>e;P.current_team_is_in_enterprise&&(P.current_team_gets_logout_url=false);P.enterprise_logout_url=TS.boot_data.enterprise_logout_url;P.enterprise_domain=TS.boot_data.enterprise_url+"/manage"}else{r.needs_other_enterprise_logout=true;r.logout_url=TS.enterprise.workspaces.createLogoutURL(r.enterprise_id,TS.boot_data.logout_url)}return r}).value();TS.model.user.enterprise_user&&(P.other_enterprise_accounts=P.other_enterprise_accounts.sort(function(e,t){if(e.enterprise_id===TS.model.user.enterprise_user.enterprise_id)return-1;if(t.enterprise_id===TS.model.user.enterprise_user.enterprise_id)return 1;return 0}))}}else{t.logout_url=TS.enterprise.workspaces.createLogoutURL(t.team_id,TS.boot_data.logout_url);L[t.team_id]=t}});j&&(Object.keys(L).length?P.other_accounts=L:Object.keys(P.other_enterprise_accounts).length&&delete P.other_accounts);if(P.current_team_is_in_enterprise){P.current_team_gets_logout_url=false;P.enterprise_logout_url=TS.boot_data.enterprise_logout_url;P.enterprise_domain=TS.boot_data.enterprise_url+"/manage"}if(TS.boot_data.page_needs_enterprise){(j||P.current_team_is_in_enterprise)&&(P.other_enterprise_accounts&&Object.keys(P.other_enterprise_accounts).length||P.other_accounts&&Object.keys(P.other_accounts).length)&&(P.show_switch_teams_submenu=true);P.can_show_leave_workspace=TS.permissions.enterprise.canUserLeaveTeam(TS.model.user,TS.model.team)}TS.menu.$menu.addClass("team_menu slack_menu");TS.menu.$menu.attr("data-qa","team_menu");TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_body.html(TS.templates.menu_slack_menu(P));TS.menu.$menu_items.addClass("hidden");var R=TS.menu.$menu_body;R.off("click.menu mouseenter.section_header");R.on("click.menu","li",TS.menu.onTeamAndUserItemClick);R.on("click.menu",".member_preview_link",function(e){e.preventDefault()});R.on("mouseenter.section_header","> div.section_header",TS.kb_nav.clearHighlightedItem);TS.kb_nav.setSubmitItemHandler(TS.menu.onTeamAndUserItemClick);if(TS.boot_data.page_needs_enterprise){TS.menu.submenu_template_args.administration={};TS.menu.submenu_template_args.switch_teams=P}var N=55;TS.model.is_electron&&TS.model.is_mac&&TS.interop.desktop.isMainWindowFrameless()&&(N+=7);TS.menu.start(i,void 0,{needs_to_remain_open:function e(){return TS.ui.react_emoji_menu.is_showing}});TS.menu.positionAt($("#team_menu"),10,N);R.on("highlighted","li:not(.divider)",TS.menu.onTeamAndUserItemMouseenter);y&&u(l);h&&d("#administration",{ui_element:"admin_link"});g&&d("#team_invitations",{ui_element:"invite_link"});if(y){var B=["UPGRDEXP_LIMIT_METER"];v?B.push("GROWTH_PRICING"):B.push("UPGRADEXP_TEAM_ANALYTICS");d("#limit_meter",{event_ids:B,ui_element:"limit_meter",clog_args:{limit_meter_messages_count:l}})}k&&d("#team_services",{ui_element:"apps_link"});w&&d("#team_customize",{ui_element:"customize_link"});b&&d("#team_statistics",{event_ids:["UPGRADEXP_TEAM_ANALYTICS"],ui_element:"analytics_link"});S&&d("#team_billing",{event_ids:["GROWTH_PRICING"],ui_element:"billing_link"});v&&d("#team_pricing",{event_ids:["GROWTH_PRICING"],ui_element:"pricing_link"});E&&d("#shared_channels_open_beta",{event_ids:[TS.interop.clogTypes.EventId.GROWTH_INTRO_SHARED_CHANNEL],clog_args:{contexts:{ui_context:{step:TS.interop.clogTypes.UiStep.TEAM_MENU,step_variant:"paid",ui_properties:{element_type:TS.interop.clogTypes.ElementType.LINK,element_name:"shared_channels_beta_cta"}}}}});A&&d("#shared_channels_open_beta_free_team",{event_ids:[TS.interop.clogTypes.EventId.GROWTH_INTRO_SHARED_CHANNEL],clog_args:{contexts:{ui_context:{step:TS.interop.clogTypes.UiStep.TEAM_MENU,step_variant:"free",ui_properties:{element_type:TS.interop.clogTypes.ElementType.LINK,element_name:"shared_channels_beta_new_cta"}}}}})},onTeamAndUserItemMouseenter:function e(t){if((!$(this).hasClass("has_submenu")||"member_current_status_item"===$(this).attr("id"))&&TS.menu._current_status_input&&TS.menu._current_status_input.isEdited())return;TS.menu.$submenu&&TS.menu.$submenu_parent&&TS.menu.$submenu_parent.submenu("destroy");if($(t.currentTarget).hasClass("has_submenu")){var r=$(this).attr("id")||$(this).data("action");var n=TS.menu.$menu_body;var i={};TS.menu.submenu_template_args[r]&&(i=TS.menu.submenu_template_args[r]);switch(r){case"administration":if(TS.model.user.enterprise_user&&(TS.model.user.enterprise_user.is_admin||TS.model.user.enterprise_user.is_owner)){i.show_org_settings=true;i.enterprise_domain=TS.boot_data.enterprise_url+"/manage"}else{var a=TS.interop.desktop.isAppStoreBuild();var s=(TS.model.user.is_owner||TS.prefs.getPref("purchaser"))&&!a;TS.interop.members.isAppmin()?i.show_apps_link=true:s&&(i.show_billing_link=s);TS.prefs.getPref("seen_administration_menu")||TS.prefs.setPrefByAPI({name:"seen_administration_menu",value:true})}i.is_admin=TS.menu.isAdminOrOwner();i.can_create_shared_channel=TS.interop.rules.user.canUserApproveExternalSharedChannels()||TS.interop.rules.user.canUserViewExternalSharedChannelRelationships();TS.menu.$submenu_parent=n.find("#administration");TS.menu.$submenu_parent.submenu({items_html:TS.templates.administration_items(i),onclick:TS.menu.onTeamAndUserItemSubmenuClick});break;case"switch_teams":TS.menu.$submenu_parent=n.find("#switch_teams");TS.menu.$submenu_parent.submenu({items_html:TS.templates.switch_teams_items(i),onclick:TS.menu.onTeamAndUserItemSubmenuClick});break;case"team_invitations":t.preventDefault();TS.interop.mountInviteModal(TS.boot_data.team_id,{source:"team_menu"});TS.interop.clog.track(this.getAttribute("data-clog-event"),this.getAttribute("data-clog-params"));break;default:}}},onTeamAndUserItemSubmenuClick:function e(t){var r=$(t.target).closest("li");var n=r.attr("id")||r.data("action");switch(n){case"team_settings":TS.interop.clog.trackClickWithContext({event:"ADMIN_TEAM_MENU_ADMINISTRATION_SUBMENU_CLICK",element:"TEAM_MENU_ADMINISTRATION_TEAM_SETTINGS_BTN"});break;case"team_services":TS.interop.clog.trackClickWithContext({event:"ADMIN_TEAM_MENU_ADMINISTRATION_SUBMENU_CLICK",element:"TEAM_MENU_ADMINISTRATION_TEAM_SERVICES_BTN"});break;case"org_settings":TS.interop.clog.trackClickWithContext({event:"ADMIN_TEAM_MENU_ADMINISTRATION_SUBMENU_CLICK",element:"TEAM_MENU_ADMINISTRATION_ORG_SETTINGS_BTN"});break;case"switch_team":case"logout":case"enterprise_logout":break;case"enterprise_teams_dialog":t.preventDefault();TS.ui.enterprise_teams_dialog.show(TS.model.user);break;case"manage_shared_channels":t.preventDefault();TS.interop.mountManageSharedChannelsModal(TS.boot_data.team_id,{referringUiElement:"TEAM_MENU_ADMINISTRATION_MANAGE_SHARED_CHANNELS_BTN"});break;case"manage_team":TS.interop.clog.trackClickWithContext({event:"ADMIN_TEAM_MENU_ADMINISTRATION_SUBMENU_CLICK",element:"TEAM_MENU_ADMINISTRATION_MANAGE_TEAM_BTN"});break;default:t&&t.target&&"_blank"===t.target.getAttribute("target")||t.preventDefault();return}TS.menu.$submenu&&TS.menu.$submenu_parent&&TS.menu.$submenu_parent.submenu("destroy");TS.menu.end()},onTeamAndUserItemClick:function e(t){clearTimeout(TS.menu.end_time);var r=$(this);if(r.is("[disabled]")||r.hasClass("disabled")){t.preventDefault();return}var n=r.attr("id");!n&&r.hasClass("switch_team")&&(n="switch_team");switch(n){case"leave_workspace":t.preventDefault();TS.ui.leave_team_dialog.start(TS.model.team.id);break;case"workspaces":t.preventDefault();TS.ui.workspaces.start();break;case"shared_channels_open_beta":case"shared_channels_open_beta_free_team":t.preventDefault();break;case"version_info":t.preventDefault();TS.ui.showVersionInfo();break;case"member_account_item":t.preventDefault();break;case"team_settings":case"manage_team":case"team_billing":case"team_services":case"team_customize":case"team_statistics":case"limit_meter":case"team_apps":TS.telemeter.count("team_menu_download_apps");break;case"team_invitations":t.preventDefault();TS.interop.mountInviteModal(TS.boot_data.team_id,{source:"team_menu"});TS.interop.clog.track(this.getAttribute("data-clog-event"),this.getAttribute("data-clog-params"));break;case"member_prefs_item":t.preventDefault();TS.redux.dispatch(TS.interop.redux.actions.openPrefsModal());break;case"team_help":t.preventDefault();break;case"add_team":case"enterprise_login":if(TS.interop.desktop.isDesktop){TS.interop.desktop.signInTeam();t.preventDefault()}break;case"member_presence":t.preventDefault();TS.redux.presence.toggleUserPresence();TS.menu.end_time=setTimeout(TS.menu.end,1e3);return;case"logout":t.preventDefault();if(TS.interop.desktop.isDesktop&&TS.interop.desktop.canSignOut()){TS.interop.desktop.legacySignOutTeam(TS.model.team.id);break}TS.utility.loadUrlInWindowIfOnline(TS.boot_data.logout_url);break;case"enterprise_logout":if(TS.interop.environment.isWindows()&&TS.interop.environment.isElectronAndAtLeastVersion("3.0.0")){t.preventDefault();var i=new URL(TS.boot_data.enterprise_logout_url);i.search="";window.location=i}break;case"switch_team":var a=$(this).data("user-id");if(TS.interop.desktop.isDesktop){TS.interop.desktop.displayTeam(a);t.preventDefault()}else{var s=$(this).find("a").attr("href");s&&-1==s.indexOf("?")&&$(this).find("a").attr("href",[s,TS.getQsArgsForUrl()].join("?"))}break;case"member_current_status_item":$(".team_name_caret").focus();TS.redux.dispatch(TS.interop.redux.actions.openCustomStatusDialog());break;case"member_current_status_clear_item":var o={status_text:"",status_emoji:"",status_text_canonical:"",status_expiration:0};TS.interop.members.updateCurrentMemberProfile({profile:o});break;case"team_pricing":if(!$(t.target).hasClass("see_upgrade_options_link")){t.preventDefault();return}break;default:t.preventDefault();return}TS.menu.end()},startWithFlexMenu:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();var r;r=TS.boot_data.page_needs_enterprise?TS.interop.i18n.t("Organization Directory","menu")():TS.interop.i18n.t("Workspace Directory","menu")();TS.menu.$menu_items.html(TS.templates.menu_flexpane_items({special_flex_panes:TS.boot_data.special_flex_panes,show_downloads:TS.model.supports_downloads,is_enterprise:TS.boot_data.page_needs_enterprise,show_user_groups:""!==TS.model.team.plan&&!TS.model.user.is_restricted,directory_title:r,show_user_calendar:TS.boot_data.feature_calendar_simple_agenda_view}));TS.menu.$menu_items.on("click.menu","li",TS.menu.onFlexMenuItemClick);TS.menu.start(t);TS.menu.$menu.addClass("flex_menu");TS.menu.$menu.attr("data-qa","flex_menu");var n=$("#flex_menu_toggle");var i=-(TS.menu.$menu.width()-n.width());var a=6+n.height();TS.menu.positionAt(n,i,a);TS.help.updateIcon();$("#flex_menu_toggle").addClass("menu_open");$("#flex_menu_callout").bind("click",function(){TS.menu.end()})},onFlexMenuItemClick:function e(t){var r=$(this).data("tab-id");var n="";if(r)n=r;else if($(this).data("filetype"));else{var i=$(this).attr("id");n=i;"help"===i&&t.preventDefault()}TS.interop.clog.track("FLEX_MENU_ITEM_CLICK",{flex_name:n});TS.menu.end()},startWithUserGroupMenu:function e(t,r){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.user_group=TS.interop.userGroups.getUserGroupById(r);TS.menu.$menu.addClass("no_min_width");var n=TS.permissions.members.canCreateAndDeleteUserGroups()&&!TS.menu.user_group.date_delete;var i=TS.permissions.members.canCreateAndDeleteUserGroups()&&TS.menu.user_group.date_delete;TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.user_group_items({show_user_groups_edit:TS.permissions.members.canEditUserGroups(),show_user_groups_disable:n,show_user_groups_enable:i}));TS.menu.$menu_items.on("click.menu","li",TS.menu.onUserGroupMenuItemClick);TS.menu.start(t);TS.menu.positionAt($("#user_group_menu_toggle"),-(TS.menu.$menu.width()-$("#user_group_menu_toggle").width()),37)},onUserGroupMenuItemClick:function e(){var t=$(this).data("action");"edit_info"===t?TS.ui.admin_user_groups.editInfo(TS.menu.user_group):"edit_members"===t?TS.ui.admin_user_groups.editMembers(TS.menu.user_group):"disable"===t?TS.ui.admin_user_groups.disable(TS.menu.user_group):"enable"===t?TS.ui.admin_user_groups.enable(TS.menu.user_group):"delete"===t&&TS.ui.admin_user_groups.remove(TS.menu.user_group);TS.menu.end()},startWithSearchFilter:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();var r={search_exclude_bots:TS.prefs.getPref("search_exclude_bots"),search_only_my_channels:TS.prefs.getPref("search_only_my_channels"),search_only_current_team:TS.prefs.getPref("search_only_current_team"),result_type:"files"===TS.search.filter?"files":"messages",is_enterprise:TS.boot_data.page_needs_enterprise};TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu.addClass("search_filter_menu");TS.menu.$menu_items.html(TS.templates.menu_search_filter_items(r));TS.menu.start(t);a();var n=$("#search_filter_menu_label");TS.menu.positionAt(n,-8,n.height()+10);$("#search_only_my_channels_cb").bind("change",function(){TS.prefs.setPrefByAPI({name:"search_only_my_channels",value:!$(this).prop("checked")})});$("#search_exclude_bots_cb").bind("change",function(){TS.prefs.setPrefByAPI({name:"search_exclude_bots",value:!$(this).prop("checked")})});$("#search_only_current_team_cb").bind("change",function(){TS.prefs.setPrefByAPI({name:"search_only_current_team",value:!$(this).prop("checked")})});TS.menu.search_filter_is_showing=true;$("#search_filter_menu_label").addClass("active")},startWithMentionsFilter:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();var r={exclude_at_channels:TS.prefs.getPref("mentions_exclude_at_channels"),exclude_at_user_groups:TS.prefs.getPref("mentions_exclude_at_user_groups"),show_user_group_filter:true};TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu.addClass("search_filter_menu");TS.menu.$menu_items.html(TS.templates.menu_mentions_filter_items(r));TS.menu.start(t);a();var n=$("#mentions_filter_menu_label");TS.menu.positionAt(n,-8,n.height()+10);$("#exclude_at_channels_cb").bind("change",function(){TS.prefs.setPrefByAPI({name:"mentions_exclude_at_channels",value:!$(this).prop("checked")})});$("#exclude_at_user_groups_cb").bind("change",function(){TS.prefs.setPrefByAPI({name:"mentions_exclude_at_user_groups",value:!$(this).prop("checked")})});$("#mentions_filter_menu_label").addClass("active")},startWithEditTeamProfileListActions:function e(t,r,n){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();var i=$(t.target);var a=TS.team.getTeamProfileFieldById(i.data("id"));var s={id:a.id,hidden:!!(a&&a.is_hidden),is_scim:n.is_scim};TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.admin_menu_edit_team_profile_list_action_items(s));TS.menu.$menu_items.on("click.menu","li",r);TS.menu.start(t);TS.menu.positionAt(i.find('[data-action="edit_team_profile_list_menu"]'),-(TS.menu.$menu.width()+6),0);TS.menu.keepInBounds()},startWithSearchableMemberListFilter:function e(t,r,n){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var i={everyone_count:0,admins_count:0,guests_count:0,enterprise_filter_options:TS.boot_data.page_needs_enterprise,bots_count:0};TS.boot_data.page_needs_enterprise&&_.merge(i,{is_enterprise:true,org_name:TS.model.team.enterprise_name,team_name:TS.interop.rules.teams.getTeamDisplayName(TS.model.team),everyone_count:0,org_members_count:0,org_admins_count:0,org_guests_count:0,org_bots_count:0});_.each(r,function(e,t){i[t+"_count"]=e});i.everyone_count=r.people;var a=[];_.each(r.external_teams,function(e,t){a.push({id:t,name:TS.teams.getTeamNameById(t)})});a.length>0&&_.merge(i,{ext_teams:a.sort(TS.interop.i18n.mappedSorter("name"))});TS.menu.$menu.width($(t.target).outerWidth());TS.menu.$menu.addClass("searchable_member_list_filter_menu");TS.menu.$menu_items.html(TS.templates.searchable_member_list_filter_items(i));TS.menu.$menu_items.on("click.menu","li",function(e){TS.menu.end();n(e)});TS.menu.start(t);TS.menu.positionAt($(".searchable_member_list_filter"),16,56)},startWithSoundsMenu:function e(t,r){if(TS.menu.isRedundantClick(t))return;if(TS.menu.menu_is_showing)return;TS.menu.buildIfNeeded();var n=TS.boot_data.notification_sounds;n=_.reject(n,{value:"none"});var i={notification_sounds:n};TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_sound_items(i));TS.menu.start(t);TS.menu.$menu_items.on("click.menu",'[data-action="set_sound"]',function(e){var t=$(this).data("sound");if(!t)return;e.preventDefault();r(t);TS.menu.end()}).on("click.menu",'[data-action="play_sound"]',function(e){var t=$(this).data("sound");if(!t)return;e.preventDefault();TS.sounds.play(t,{ignore_mute:true})});TS.menu.keepInBounds()},startWithGeneric:function e(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(TS.menu.isRedundantClick(t))return;if(TS.menu.menu_is_showing)return;TS.menu.buildIfNeeded();var a="";_.each(r,function(e){a+=TS.templates.menu_generic_item({label:e.label,value:e.value})});TS.menu.clean();TS.menu.$menu_header.empty();i.header_text?TS.menu.$menu_header.html(TS.templates.menu_generic_header({header_text:i.header_text})):TS.menu.$menu_header.addClass("hidden");TS.menu.$menu_items.html(a);var s={};s.menu_class=i.menu_class;TS.menu.start(t,void 0,s);TS.menu.$menu_items.on("click.menu","a[data-value]",function(){t.preventDefault();n($(this).data("value"));TS.menu.end()});TS.menu.keepInBounds()},positionAt:function e(t,r,n){r=r||0;n=n||0;var i=t.offset();var a=i.left+r;var s=i.top+n;TS.menu.$menu.css({top:s,left:a})},isRedundantClick:function e(t){if(t&&TS.menu.last_e&&(t.target==TS.menu.last_e.target||t.currentTarget==TS.menu.last_e.currentTarget))return true;return false},isLarge:function e(){return TS.menu&&TS.menu.$menu&&TS.menu.$menu.find("li").length>TS.menu.large_dom_trigger},start:function e(t,n,a){a=a||{};TS.menu.last_e=t;if(!i){var s=$(t.target).offset();var o=s.left+$(t.target).width()+10;var l=s.top;if(n){o=t.pageX+10;l=t.pageY+10}}_.isFunction(a.needs_to_remain_open)&&(TS.menu.needs_to_remain_open=a.needs_to_remain_open);$(".tooltip").hide();TS.tips.hideAll();$(t.currentTarget).addClass("active");TS.menu.$target_element=$(t.currentTarget);TS.model.menu_is_showing=true;var u=TS.menu.$menu;a.onClose&&u.one("closed",a.onClose);a.menu_class&&u.addClass(a.menu_class);var d=TS.menu.isLarge();i||u.css({top:l,left:o});var c=u.find("#menu_items_scroller");c.scrollTop(0);a.attach_to_target_at_full_width?TS.menu.$target_element.after(u):u.appendTo($("body"));a.keep_menu_open_if_target_clicked_again&&TS.menu.$menu.addClass("keep_menu_open_if_target_clicked_again");if(d||i)u.css("opacity",1);else{u.css("opacity",0);u.stop().transition({opacity:1},200)}u.find(".menu_close").on("click",TS.menu.end);a.ignore_bounds||TS.menu.keepInBounds();TS.ui.utility.updateClosestMonkeyScroller(c,true);TS.menu.menu_lazy_load&&TS.menu.menu_lazy_load.detachEvents&&TS.menu.menu_lazy_load.detachEvents();TS.menu.menu_lazy_load=TS.menu.$menu_items.find(".lazy").lazyload({container:$("#menu_items_scroller"),all_images_same_size:true,throttle:250});a.ignore_bounds||$(window).bind("resize",TS.menu.keepInBounds);$(window.document).bind("keydown",TS.menu.onKeyDown);$("html").bind("mousedown touchstart",TS.menu.onMouseDown);var m=u.find(".menu_list");var f=m.length?m:u.find("#menu_items");TS.menu.has_submenu?TS.kb_nav.start(f,"li:not(.divider)",u,{onLeftKeyDownIfSubmenuExists:TS.menu.onLeftKeyDownIfSubmenuExists,onRightKeyDownIfSubmenuExists:TS.menu.onRightKeyDownIfSubmenuExists}):TS.kb_nav.start(f,"li:not(.divider)");var p=m.length?m.first().find("a, button").first():null;TS.ui&&TS.ui.a11y&&TS.ui.a11y.focusAndAddTabindex(p);i=false;r=a.on_esc},clean:function e(){TS.menu.$menu_footer.empty();TS.menu.$menu_header.removeClass("hidden");TS.menu.$menu.removeClass("no_min_width no_max_width profile_preview flex_menu search_filter_menu popover_menu no_icons team_menu member_menu file_menu all_unreads_sort_order_menu searchable_member_list_filter_menu selectable member_file_filter_menu app_card keep_menu_open_if_target_clicked_again member_file_filter_menu").css("max-height","");TS.menu.$menu.removeAttr("data-qa");TS.menu.$menu.find("#menu_items_scroller").css("max-height","");TS.menu.$menu.find(".arrow, .arrow_shadow").remove();TS.menu.$menu_items.off("mouseenter.section_header");TS.menu.$menu.removeClass("narrow_menu");TS.menu.$menu_body.off("mouseenter.section_header");TS.menu.needs_to_remain_open=void 0;TS.menu.$menu.removeClass("date_picker");if(TS.boot_data.page_needs_enterprise){TS.menu.$menu_list_container.html('<div id="menu_list" role="menu"></div>').removeClass("populated");TS.menu.$menu_list=TS.menu.$menu.find("#menu_list");TS.menu.$menu.off("keydown","#file_member_filter .member_filter")}TS.menu.$menu.removeAttr("data-model-ob-id");TS.menu.$menu.removeAttr("data-thread-ts");if(TS.SearchableMemberList&&TS.SearchableMemberList.get("member_file_filter_menu")){TS.menu.$menu.find(".searchable_member_list").remove();TS.SearchableMemberList.get("member_file_filter_menu").destroy()}if(TS.menu.$menu.find(".member_item")){TS.menu.$menu.find(".member_item").remove();TS.menu.$menu.find(".list_items").css("height",0)}r=null},end:function e(){if(_.isFunction(TS.menu.needs_to_remain_open)&&TS.menu.needs_to_remain_open())return;TS.menu.$submenu&&TS.menu.$submenu_parent&&TS.menu.$submenu_parent.submenu("destroy");TS.menu.$menu.width("");TS.model.menu_is_showing=false;TS.menu.menu_items_hidden=true;TS.menu.has_submenu=false;TS.menu.$submenu_parent=null;TS.menu.submenu_template_args={};TS.menu.did_start_slack_menu_signal_listeners&&TS.menu.stopListeningForRebuildWorthiness();var t=TS.menu.$menu;var r=function e(){if(TS.model.menu_is_showing)return;setTimeout(function(){TS.model.menu_is_showing||(TS.menu.last_e=null)},50);t.detach();TS.menu.$menu_header.empty();TS.menu.$menu_footer.empty();TS.menu.$menu_items.empty();TS.menu.$menu_items.removeClass("hidden");TS.menu.$menu_body.empty();TS.menu.clean()};TS.menu.isLarge()||i?r():t.stop().transition({opacity:0},200,r);t.trigger("closed");if(TS.menu.$target_element){TS.menu.$target_element.removeClass("active");TS.menu.$target_element=null}if(TS.menu.$secondary_target_element){TS.menu.$secondary_target_element.removeClass("active");TS.menu.$secondary_target_element=null}TS.menu.user_group=null;TS.menu.$menu_header.unbind("click.menu");TS.menu.$menu_items.off("click.menu");TS.menu.$menu_body.off("click.menu");$(window).unbind("resize",TS.menu.keepInBounds);$(window.document).unbind("keydown",TS.menu.onKeyDown);$("html").unbind("mousedown touchstart",TS.menu.onMouseDown);TS.members.view.team_filter_changed_sig.remove(TS.kb_nav.clearHighlightedItem);$(".file_list_item.active").removeClass("active");TS.tips.unhideAll();TS.menu.search_filter_is_showing=false;$("#search_filter_menu_label").removeClass("active");$("#mentions_filter_menu_label").removeClass("active");$("#flex_menu_toggle").removeClass("menu_open");$("#channel_actions_toggle").removeClass("active");$("#menu_member_dm_input").length&&TS.utility.contenteditable.unload($("#menu_member_dm_input"));t.removeClass("narrow_menu");setTimeout(function(){TS.menu.file.file_list_menu_up=false;$(".inline_file_preview_container.file_menu_open, .file_container.file_menu_open").removeClass("file_menu_open")},100);if(TS.menu.menu_lazy_load&&TS.menu.menu_lazy_load.detachEvents){TS.menu.menu_lazy_load.detachEvents();TS.menu.menu_lazy_load=null}TS.kb_nav.end();TS.menu.menu_closed_sig.dispatch()},onKeyDown:function e(t){var n=TS.utility.keymap;var i=t.which;var a=t.metaKey||t.ctrlKey||t.altKey;if(i==n.esc){if(TS.utility.contenteditable.hasFocus($("#menu_member_dm_input")))return;t.stopPropagation();t.preventDefault();TS.menu.end();r&&r()}else if(!a&&!TS.utility.isArrowKey(i)&&i!=n.tab&&i!=n.enter&&i!=n.shift){TS.kb_nav.clearHighlightedItem();TS.utility.contenteditable.focus($("#menu_member_dm_input"))}},onLeftKeyDownIfSubmenuExists:function e(){var t=false;if(TS.menu.$submenu&&TS.menu.$submenu.hasClass("kb_active")){TS.menu.$submenu.removeClass("kb_active");TS.kb_nav.end();TS.kb_nav.highlightItemWithKey(TS.menu.$submenu_origin);var r=TS.menu.$menu.find(".menu_list");var n=r.length?r:TS.menu.$menu.find("#menu_items");TS.kb_nav.start(n,"li:not(.divider)",TS.menu.$menu,{onLeftKeyDownIfSubmenuExists:TS.menu.onLeftKeyDownIfSubmenuExists,onRightKeyDownIfSubmenuExists:TS.menu.onRightKeyDownIfSubmenuExists});-1===["member_current_status_item","switch_teams"].indexOf(TS.menu.$submenu_origin.attr("id"))&&TS.menu.$submenu_origin.submenu("destroy");t=true}return t},onRightKeyDownIfSubmenuExists:function e(){var t=false;if(TS.menu.$submenu){if(TS.menu.$submenu.hasClass("kb_active")){TS.menu.$submenu.removeClass("kb_active");TS.menu.end()}else{TS.menu.$submenu.addClass("kb_active");TS.kb_nav.end();TS.kb_nav.highlightItemWithKey(TS.menu.$submenu.find("li:not(.divider)").first());TS.kb_nav.start(TS.menu.$submenu.find("ul"),"li:not(.divider)",TS.menu.$submenu,{onLeftKeyDownIfSubmenuExists:TS.menu.onLeftKeyDownIfSubmenuExists,onRightKeyDownIfSubmenuExists:TS.menu.onRightKeyDownIfSubmenuExists})}t=true}return t},onMouseDown:function e(t){var r=$(t.target);if(TS.menu.$menu&&TS.menu.$menu.hasClass("keep_menu_open_if_target_clicked_again")&&r.is(TS.menu.$target_element))return;(0===r.closest("#menu, .submenu, .trap_menu_clicks").length||r.hasClass("popover_mask"))&&TS.menu.end()},keepInBounds:function e(){window.requestAnimationFrame?TS.utility.rAF(TS.menu.keepInBoundsThrottled):TS.menu.keepInBoundsThrottled()},keepInBoundsThrottled:function e(){var t=TS.menu.$menu;var r=10;var n=t.dimensions_rect();var i={top:0+r,right:$(window).width()-r,bottom:$(window).height()-(r+14),left:0+r};if(TS.utility.doesRectContainRect(i,n))return;n.left<i.left?t.css("left",i.left):n.right>i.right&&t.css("left",Math.max(i.left,i.right-n.width));n.top<i.top?t.css("top",i.top):n.bottom>i.bottom&&t.css("top",Math.max(i.top,i.bottom-n.height+$(window).scrollTop()))},addSubmenu:function e(t,r,n,i){var a=TS.menu.$menu_items.find(t);a.on("highlighted",function(){a.submenu({items_html:r,onclick:n,help:i})}).on("unhighlighted",function(){TS.menu.$submenu&&!TS.menu.$submenu.hasClass("kb_active")&&a.submenu("destroy")})},showAdminLink:function e(){var t=TS.interop.rules.members,r=t.canManageExternalSharedChannels,n=t.isAdmin,i=t.isOwner,a=t.isEnterpriseAdmin,s=t.isEnterpriseOwner;var o=TS.model.user;var l=r(TS.redux.getState(),{blockAllForNoOne:false});var u=n(o);var d=i(o);var c=a(o)||s(o);return l||u||d||c},isAdminOrOwner:function e(){return TS.interop.rules.members.isAdmin(TS.model.user)||TS.interop.rules.members.isOwner(TS.model.user)||TS.interop.rules.members.isEnterpriseAdmin(TS.model.user)||TS.interop.rules.members.isEnterpriseOwner(TS.model.user)},onPricingPlansModalOpen:function e(t,r){t.preventDefault();TS.interop.mountPricingPlansModal(TS.boot_data.team_id,{source:r})}});var e=3;var t;var n;var i=false;var a=function e(){var t=TS.menu.$menu;t.addClass("popover_menu");t.prepend('<span class="arrow"></span><span class="arrow_shadow"></span>')};var s=function e(t){var r=3;var n=TS.menu.$target_element.outerHeight()+r;var i=0;t&&(i=TS.menu.$target_element.outerWidth()-TS.menu.$menu.outerWidth());return{left:i,top:n}};var o=function t(r){var n=_.without(_.get(TS.model.user,"enterprise_user.teams",[]),TS.model.team.id);if(!n.length)return;var i=false;var a=_.partition(n,function(e){return TS.teams.getTeamById(e,i)});var s=a[0];var o=a[1];var u=o.slice(0,Math.max(0,e-s.length));if(!u.length)return;var d="TS.menu._maybeEnsureTeamsAndRebuild";TS.teams.ensureTeamsArePresent(u,d).then(function(){if(!TS.model.menu_is_showing||!TS.menu.did_start_slack_menu_signal_listeners)return;l(r)})};var l=function e(t){var r=$(".menu.submenu").data("origin-id");i=true;TS.menu.startWithTeamAndUserRebuild(t);i=false;r&&$("#"+r).trigger("highlighted")};var u=function e(t){var r=1e4;var n=$("#limit_meter");var i=$("#limit_meter_circle_progress");var a;var s="rgba(0, 0, 0, .1)";var o;var l={r:69,g:186,b:133};var u={r:255,g:197,b:101};var d={r:243,g:61,b:95};if(t<=r){a=t/r;s="rgba(0, 0, 0, .1)";var c=_.mergeWith(l,u,function(e,t){return Math.floor(e*(1-a)+t*a)});o="rgb("+c.r+", "+c.g+", "+c.b+")"}else{a=Math.atan((t-r)/2500-3)/Math.PI+.5;s="rgb("+u.r+", "+u.g+" , "+u.b+")";o="rgb("+d.r+", "+d.g+", "+d.b+")"}i.circleProgress({value:a,size:50,animation:{duration:20},thickness:4,fill:{color:o},emptyFill:s,startAngle:.425*-Math.PI});n.on("click",function(){TS.interop.clog.track("UPGRDEXP_LIMIT_METER",{limit_meter_messages_count:t,contexts:{ui_context:{action:"click",step:"slack_menu"}}})})};var d=function e(t,r){var n="slack_menu";var i={contexts:{ui_context:{action:"impression",step:n,ui_element:r.ui_element}}};var a={contexts:{ui_context:{action:"click",step:n,ui_element:r.ui_element}}};var s=r.clog_args||{};var o=_.defaultsDeep({},s,i);var l=_.defaultsDeep({},s,a);var u=["SIDEBAR_TEAM_MENU"];r.event_ids&&(u=u.concat(r.event_ids));_.each(u,function(e){TS.interop.clog.track(e,o);TS.interop.clog.trackClick(t,e,l)})};$.widget("TS.submenu",{_create:function e(){this.element.data("has-submenu",true);var t=TS.interop.i18n.t("submenu","menu_source")();var r='<div class="menu submenu'+(this.options.help?" submenu_help":"")+'" data-origin-id="'+this.element.attr("id")+'" data-model-ob-id="'+this.element.data("modelObId")+'"><ul aria-hidden="true" aria-label="'+t+'">'+this.options.items_html+"</ul></div>";var n=-13;var i=11;var a=TS.menu.$menu.offset().left+TS.menu.$menu.width()+n;var s=this.element.offset().top-i;this.$submenu=$(r);this.$submenu.appendTo("body");TS.menu.$submenu=this.$submenu;TS.menu.$submenu_origin=this.element;if(a+this.$submenu.width()>window.innerWidth){var o=TS.menu.$menu.offset().left-n;var l=window.innerWidth-a;o>l&&(a=TS.menu.$menu.offset().left-this.$submenu.width()-n)}if(s+this.$submenu.height()>window.innerHeight){var u=s;var d=Math.abs(window.innerHeight-(s+this.$submenu.height()));s=u>d?window.innerHeight-this.$submenu.height()-i:i}this.$submenu.css({position:"absolute",left:a+"px",top:s+"px"});var c=this.options.onclick;c&&this.$submenu.on("click",function(e){c.call(this,e)})},_destroy:function e(){TS.menu.$submenu=null;TS.menu.$submenu_origin=null;this.options.ondestroy&&this.options.ondestroy();this.$submenu.remove()}});var c=function e(t){var r={action:"click",step:"more_actions_menu",ui_element:t};TS.interop.clog.track("MSG_ACTION",{contexts:{ui_context:r}})}})();var r},D7d6:function(e,t,r){var n=r("lSNA");function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}));r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),true).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}(function(){TS.registerModule("utility.attachments",{hasContent:function t(r,n){if(!r)return false;_.isArray(n)||(n=[].concat(n));var i=_.difference(e,n);return _.some(i,function(e){return!_.isEmpty(r[e])})},getMediaSource:function e(t){if(!t)return;var r=TS.utility.attachments.getMediaType(t);switch(r){case"video":return t.thumb_url;case"audio":return t.audio_html||t.audio_url;case"other":return t.other_html;case"image":return t.image_url;default:break}return t.from_url},getMediaType:function e(t){if(!t)return;if(t.video_html)return"video";if(t.audio_html||t.audio_url)return"audio";if(t.other_html)return"other";if(t.image_url)return"image"},getDecoratedAttachment:function e(t,a){var d=_.cloneDeep(t);d=r(d);d._source=n(d);i(d)?d=s(d,a):"twitter"===d.service_name?d=o(d):"salesforce"===d.service_name&&(d=l(d));if(d.is_app_unfurl&&d.bot_id){var c=TS.interop.bots.getBotById(d.bot_id);if(c){d._attribution=c.name;d._attribution_link="/services/"+d.bot_id}}if(d._source.icon){var m=u(d._source.icon);d._source.icon=m.src;d._source.icon_srcset=m.srcset}if(d.footer_icon){var f=u(d.footer_icon);d.footer_icon=f.src;d.footer_icon_srcset=f.srcset}return d},getSlackMessageFooterText:function e(t,r,n){if(!i(t))return"";var a=t.channel_name;var s=t.channel_id;!s&&t.from_url&&(s=TS.utility.getChannelNameFromUrl(t.from_url));var o=TS.redux.channels.getEntityById(s)||TS.redux.channels.getPublicChannelByName(a);!a&&o&&(a=_.escape(o.name));var l=r.source_team_id&&TS.teams.getTeamNameById(r.source_team_id);var u='<a class="channel_link_unfurl_footer" data-channel-id='+s+" data-channel-name="+a+' target="_blank" href='+t.from_url+">#"+a+"</a>";if(a){if("Direct Message"===a||o&&(o.is_im||o.is_mpim))return TS.interop.i18n.t("Direct message","attachments")();if(t.is_reply_unfurl){if(n)return TS.interop.i18n.t("From a thread in {channel_link}","attachments")({channel_link:TS.interop.i18n.safeString(u)});return TS.interop.i18n.t("From a thread in #{channel_name}","attachments")({channel_name:TS.interop.i18n.safeString(a)})}if(t.is_thread_root_unfurl){if(n)return TS.interop.i18n.t("Thread in {channel_link}","attachments")({channel_link:TS.interop.i18n.safeString(u)});return TS.interop.i18n.t("Thread in #{channel_name}","attachments")({channel_name:TS.interop.i18n.safeString(a)})}if(n)return TS.interop.i18n.t("Posted in {channel_link}","attachments")({channel_link:TS.interop.i18n.safeString(u)});return TS.interop.i18n.t("Posted in #{channel_name}","attachments")({channel_name:TS.interop.i18n.safeString(a)})}if(l)return TS.interop.i18n.t("From {team_name}","attachments")({team_name:l});return TS.interop.i18n.t("From another workspace","attachments")()},getSlackMessageFooterPermalinkText:function e(t){if(!i(t)||false===t._unfurl_type_message)return"";var r=t.channel_name;var n=t.channel_id;!n&&t.from_url&&(n=TS.utility.getChannelNameFromUrl(t.from_url));var a=TS.redux.channels.getEntityById(n)||TS.redux.channels.getPublicChannelByName(r);if(r){if("Direct Message"===r||a&&(a.is_im||a.is_mpim))return TS.interop.i18n.t("View conversation","attachments")();if(t.is_reply_unfurl)return TS.interop.i18n.t("View reply","attachments")()}return TS.interop.i18n.t("View message","attachments")()},getMediaCaretLocation:function e(r){var n=_.find(t,function(e){return _.some(r[e])});return n||"end"},isAutomatedSlackUnfurl:function e(t){return!!t&&i(t)&&TS.interop.rules.messages.isAutomatedSubtype(t.msg_subtype)},formatMessageAttachmentPart:function e(t,r,n,i,a,s){if(r){n&&TS.interop.rules.messages.isAutomatedSubtype(r.subtype)&&(n=false);if(n&&!_.isEmpty(r.attachments)){var o=r.attachments.some(TS.utility.attachments.isAutomatedSlackUnfurl);o&&(n=false)}}true===s&&(t=_.escape(t));var l=TS.format.formatWithOptions(t,r,{no_highlights:true!==n,no_specials:true!==i,enable_slack_action_links:true===a});l=TS.utility.msgs.handleSearchHighlights(l);return l},findAttachment:function e(t){if(!t)return;var r=TS.utility.msgs.findMsg(t.message_ts,t.channel_id);if(!r)return;return _.find(r.attachments,{id:t.attachment_id})},unfurlPlaceholders:function e(t){t.find(".unfurl-placeholder:not(.unfurled)").each(function(e,t){var r=$(t);r.addClass("unfurled");var n=_.uniqueId("pending_unfurl_");r.attr("id",n);try{var i=r.attr("href");TS.interop.api.call("chat.unfurlLink",{url:i}).then(function(e){if(!(e&&e.data&&e.data.attachments&&e.data.attachments[i]))throw new Error("No unfurl data");var t=e.data.attachments[i];var r=$("#"+n);if(!r.length)return;if(false===TS.prefs.getPref("a11y_animations")&&"gif"===t.file_type)return;var a=TS.inline_attachments.renderStandaloneAttachment(t);var s=r.closest(".unfurl-container");r.replaceWith(a);s.wrap('<div class="unfurl"></div>');s.removeClass("unfurl-render-pending")}).catch(function(){$("#"+n).addClass("hidden")})}catch(e){r.addClass("hidden")}})},test:function e(){var e={};Object.defineProperty(e,"_isSlackMessageUnfurl",{get:function e(){return i},set:function e(t){i=t}});return e}});var e=["title","text","pretext","video_html","audio_html","audio_url","other_html","from_url","fields","actions","image_url","thumb_url","author_name","service_name","footer","footer_icon","ts"];var t=["ts","footer","fields","text","title","_source"];var r=function e(t){if(t.author_id&&!t.author_name){var r=TS.redux.members.getPotentiallyUnknownMemberById(t.author_id);if(!r||r.is_non_existent){t.author_name=TS.interop.i18n.t("Private user info","member_token")();t.author_icon=cdn_url+"/80588/img/unknown_avatar.png"}else if(r.is_unknown);else{t.author_name=TS.interop.members.getPrefCompliantMemberName(r);t.author_link="/team/"+r.id;r.profile&&(t.author_icon=r.profile.image_24)}}return t};var n=function e(t){var r={};r.icon=t.service_icon||t.author_icon;r.name=t.service_name||t.author_name;r.link=t.service_url||t.author_link;r.author_name=t.author_name==r.name?t.author_subname:t.author_name;r.author_link=t.author_link;return r};var i=function e(t){if(t.is_msg_unfurl)return true;if(t.from_url&&/slack\.com\/archives\/.+\/p.+/.test(t.from_url)){t.is_msg_unfurl=true;return true}};var s=function e(t,r){if(t.author_link){var n=TS.utility.getMemberIdFromURL(t.author_link);var i=TS.interop.utility.getBotIdFromUrl(t.author_link);n&&(t._slack_author_id=n);i&&(t._slack_bot_id=i)}r&&"pinned_item"===r.subtype&&(t.from_url=TS.utility.msgs.constructAbsoluteMsgPermalink(TS.shared.legacyGetActiveModelOb(),t.ts));t._is_automated_unfurl=TS.utility.attachments.isAutomatedSlackUnfurl(t);t.color=null;_.set(t,"mrkdwn_in_hash.text",true);TS.interop.members.shouldDisplayRealNames()?t._source.name=t.author_name||t.author_subname:t._source.name=t.author_subname||t.author_name;t._source.author_name=null;t._source.author_link=null;t._unfurl_type_message=true;t._show_permalink=true;if(t.from_url){var a=TS.interop.permalink.getPermalinkIdentifier(t.from_url);if(a&&TS.interop.utility.looksLikeChannelId(a)){var s=TS.interop.channels.getChannelById;var o=s(a);var l=TS.interop.permalink.parsePermalink(t.from_url),u=l.team;var d=TS.interop.teams.getTeamByDomain(u);var c=TS.interop.channels.isMemberOfChannel(o);var m=TS.interop.rules.teams.isTeamExternal(TS.redux.getState(),d);var f=TS.interop.rules.user.canJoinChannel(a);if(!c&&m&&!f){t._unfurl_type_message=false;t._show_permalink=false}}}if(!t.footer){var p=TS.utility.attachments.getSlackMessageFooterText(t,r);p&&(t.footer=p)}return t};var o=function e(t){t._source.name=t.author_name;t._source.link="https://twitter.com/"+t.author_subname;t._source.author_name=t.author_subname;t._source.author_link=t._source.link;t._unfurl_type_message=true;t.footer||(t.footer=TS.interop.i18n.t("Twitter","attachments")());t.footer_icon||(t.footer_icon=cdn_url+"/80588/img/services/twitter_pixel_snapped_32.png");return t};var l=function e(t){t._source.name=t.author_name;t._source.author_name=t.author_subname;t._unfurl_type_message=true;t._always_expand=true;return t};var u=function e(t){if(!t)return;if(0===t.indexOf("/img/"))return t;var r={width:16,height:16};"ico"===t.split(".").pop()&&(r.convert_ico=true);var n=TS.utility.getImgProxyURLWithOptions(t,r);var i=TS.utility.getImgProxyURLWithOptions(t,a({},r,{width:2*r.width,height:2*r.height}));return{src:n,srcset:n+" 1x, "+i+" 2x"}}})()},EXLS:function(e,t,r){var n=r("cDf5");(function(){TS.registerModule("redux.user_groups",{onStart:function e(){Object.defineProperty(TS.model,"user_groups",{get:function e(){return TS.redux.user_groups.getAllUserGroups()},set:function e(){TS.error("TS.redux.user_groups: trying to set TS.model.user_groups???");return false}})},getUserGroupById:function e(t){var r=TS.interop.userGroups.getUserGroupById(t);if(!r||TS.interop.rules.user_groups.isUnknownOrNonExistent(r)||r.id!==t)return null;return l(r)},getAllUserGroups:function r(){var n=TS.interop.userGroups.getAllUserGroups();if(n===e)return t;t=_.values(n).sort(TS.interop.i18n.mappedSorter("_name_lc"));e=n;return t},addUserGroup:function e(t){if(!t)return;TS.interop.userGroups.upsertUserGroups([t])},logStats:function e(){var t=_(r).keys().union(_.keys(i)).value();var n={};_.forEach(t,function(e){n[e]={gets:r[e]||0,sets:i[e]||0}});TS.console.table(n)}});var e;var t;var r={};var i={};var a=function e(){return TS.boot_data&&("dev"===TS.boot_data.version_ts||"local_js"===TS.boot_data.version_ts)};var s=function e(t,a){if("symbol"!==n(a)){if(!_.isNumber(r[a])){r[a]=0;i[a]=0}r[a]+=1}return t[a]};var o=function e(t,a,s){if("symbol"!==n(a)){if(!_.isNumber(i[a])){r[a]=0;i[a]=0}i[a]+=1}t[a]=s;return true};var l=function e(t){if(!window.Proxy||!a())return t;return new window.Proxy(t,{get:function e(t,r){return s(t,r)},set:function e(t,r,n){return o(t,r,n)}})}})()},EbDI:function(e,t){function r(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}e.exports=r},EcSN:function(e,t){(function(){TS.registerModule("ui.fs_modal",{is_showing:false,transition_duration:250,start:function s(l){if(TS.ui.fs_modal.is_showing)return k(l);f=_.defaults({},l,p);TS.ui.fs_modal.is_showing=true;TS.tips.hideAll();h();f.modal_class&&e.addClass(f.modal_class);f.modal_bg_class&&t.addClass(f.modal_bg_class);f.modal_contents_container_class&&e.find(".contents_container").addClass(f.modal_contents_container_class);n=e.find(".contents");i=e.find("#fs_modal_sidebar");a=e.find("#fs_modal_header");o=e.find("#fs_modal_footer_content");var u;if(f.body_template_html){u=f.body_template_html;f.body&&TS.warn("Both body and body_template_html were passed in settings to TS.ui.fs_modal.start(). Using body_template.")}else u=TS.templates.fs_modal_generic_contents({settings:f,fs_modal_header:_.includes(f.modal_class,"fs_modal_header"),fs_modal_footer:_.includes(f.modal_class,"fs_modal_footer")});n.html(u);f.header_html&&a.replaceWith(f.header_html);f.footer_html&&o.html(f.footer_html);f.sidebar_html&&i.html(f.sidebar_html);f.modal_gallery&&C();l.title&&e.attr("aria-label",l.title);!l.title&&a&&e.attr("aria-labelledby","fs_modal_header");TS.boot_data.feature_accessible_fs_dialogs&&$("#client-ui").attr("aria-hidden",true);e.on("click",".dialog_go",g);e.on("click",".dialog_secondary_go",S);e.on("click",".dialog_cancel",b);$(window.document).off(".fs_modal");$(window.document).on("keydown.fs_modal",T);$(window.document).on("focusin.fs_modal",v);r.on("click",function(){f.esc_for_ok?g():b()});$("html").addClass("fs_modal_active");setTimeout(function(){t&&t.addClass("active");e&&e.addClass("active")},0);e.find("input").length?e.find("input").first().focus():document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur();f.onShow&&f.onShow();if(f.onShowComplete||TS.model.is_our_app&&TS.interop.desktop.legacyAreDragRegionsRequired()){var d=false;var m=x();c=setTimeout(function(){d=true;M();f.onShowComplete&&f.onShowComplete();e.off(m+".fs_modal_show_complete")},600);e.one(m+".fs_modal_show_complete",function(){if(!d){M();clearTimeout(c);f.onShowComplete&&f.onShowComplete()}})}},close:function e(t){b(t)},bindBackButton:function e(t){$("#fs_modal_back_btn").off("click.fs_modal").on("click.fs_modal",t)},unbindBackButton:function e(){$("#fs_modal_back_btn").off("click.fs_modal")},showBackButton:function e(){$("#fs_modal_back_btn").removeClass("hidden")},hideBackButton:function e(){$("#fs_modal_back_btn").addClass("hidden")},activate:function r(){e.addClass("active");t.addClass("active")},deactivate:function r(){e.removeClass("active");t.removeClass("active")},setHeaderTitle:function t(r){if(!a.length)return;var n=TS.templates.fs_modal_header({title:r});a.replaceWith(n);a=e.find("#fs_modal_header")},showFooter:function t(){if(!s.length)return;e.addClass("fs_modal_footer");s.removeClass("hidden")},hideFooter:function t(){if(!s.length)return;e.removeClass("fs_modal_footer");s.addClass("hidden")},isShowing:function e(){return TS.ui.fs_modal.is_showing}});var e;var t;var r;var n;var i;var a;var s;var o;var l=0;var u=false;var d;var c;var m=".modal,[role=dialog]:not(.modal),[role=alertdialog]:not(.modal)";var f=null;var p={title:"",body:"",body_template_html:null,show_go_button:true,show_secondary_go_button:false,show_cancel_button:true,go_button_text:TS.interop.i18n.t("OK","fs_modal")(),go_button_class:"",secondary_go_button_text:TS.interop.i18n.t("OK 2","fs_modal")(),secondary_go_button_class:"",cancel_button_text:TS.interop.i18n.t("Cancel","fs_modal")(),disable_default_controls:false,disable_esc:false,onGo:null,onSecondaryGo:null,onCancel:null,onEnd:null,esc_for_ok:false,onShow:null,enter_always_gos:false,fullscreen:false,modal_class:null,modal_bg_class:null,modal_contents_container_class:null,modal_gallery:null,sidebar_html:null,header_html:null,footer_html:null,full_height_contents:false};var h=function l(){t=null;e=null;a=null;s=null;o=null;r=null;n=null;i=null;var u={settings:f,fs_modal_header:_.includes(f.modal_class,"fs_modal_header"),fs_modal_footer:_.includes(f.modal_class,"fs_modal_footer"),fs_modal_sidebar:_.includes(f.modal_class,"fs_modal_sidebar"),disable_default_controls:f.disable_default_controls};var d=TS.templates.fs_modal(u);$("body").append(d);t=$("#fs_modal_bg");e=$("#fs_modal");a=$("#fs_modal_header");s=$("#fs_modal_footer");r=$("#fs_modal_close_btn")};var g=function e(){if(!TS.ui.fs_modal.is_showing){TS.error("not showing?");return}f.onGo?false!==f.onGo()&&b():b()};var S=function e(){if(!TS.ui.fs_modal.is_showing){TS.error("not showing?");return}f.onSecondaryGo?false!==f.onSecondaryGo()&&b():b()};var T=function e(t){if(t.which!=TS.utility.keymap.enter||"BODY"!==TS.utility.getActiveElementProp("NODENAME")&&!f.enter_always_gos){if(t.which==TS.utility.keymap.esc){if(f.disable_esc)return;if(f.esc_for_ok)g();else{b();f.clog_name&&TS.interop.clog.track(f.clog_name+"_ACTION",{source:f.clog_source,action:"close_modal",trigger:"esc_key"})}}}else if(f.show_go_button){g();t.preventDefault()}};var v=function t(r){if(!TS.boot_data.feature_accessible_fs_dialogs)return;if(!TS.boot_data.feature_trap_kb_within_fs_modals)return;var n=$(m).filter(function(){return"none"!==$(this).css("display")}).toArray();var i=_.sortBy(n,function(e){return parseInt($(e).css("z-index"),10)}).pop();if(!e.is(i))return;var a=r.target;e.is(a)||e.has(a).length||e.focus()};var b=function r(n){if(A(n)){e&&e.removeClass("active");t&&t.removeClass("active");setTimeout(function(){$("html").removeClass("fs_modal_active")},TS.ui.fs_modal.transition_duration);f.onCancel&&f.onCancel();w()}};var y=function r(){e.removeAttr("aria-label");e.removeAttr("aria-labelledby");e.remove();t.remove();TS.ui.fs_modal.is_showing=false;I()};var w=function t(){setTimeout(function(){y();TS.boot_data.feature_accessible_fs_dialogs&&$("#client-ui").removeAttr("aria-hidden")},TS.ui.fs_modal.transition_duration);$(window.document).off("keydown.fs_modal");$(window.document).off("focusin.fs_modal");clearTimeout(c);e.off(x()+".fs_modal_show_complete");f.onEnd&&f.onEnd();TS.tips.unhideAll()};var k=function r(n){e.removeClass("active");f.onCancel&&f.onCancel();var i=t.attr("id",null).addClass("fs_modal_bg");return new Promise(function(t){setTimeout(function(){e.remove();TS.ui.fs_modal.is_showing=false;t(TS.ui.fs_modal.start(n));setTimeout(i.remove.bind(i),TS.ui.fs_modal.transition_duration)},TS.ui.fs_modal.transition_duration)})};var x=function t(){var r={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",transition:"transitionend"};for(var n in r)if(void 0!==e[0].style[n])return r[n]};var C=function t(){var r=e.find("[data-modal-items]");l=f.modal_gallery.index;TS.ui.fs_modal.hideFooter();l?e.find('[data-modal-gallery-index="'+l+'"]').removeClass("hidden"):e.find("[data-modal-gallery-index]").first().removeClass("hidden");e.on("click","[data-modal-gallery-direction]",function(){var e=$(this).data("modal-gallery-direction");l+=e;r.find("[data-modal-gallery-index]").addClass("hidden");r.find('[data-modal-gallery-index="'+l+'"]').removeClass("hidden");E()});E()};var M=function e(){if(!TS.model.is_our_app||!TS.interop.desktop.legacyAreDragRegionsRequired())return;if(_.get(window,"desktop.app.updateDragRegion")){window.desktop.app.updateDragRegion([]);return}TS.interop.desktop.legacyUpdateNoDragRegion([]);var t=$("#fs_modal").find("header").find("button, a").toArray();if(!u){TSSSB.nodrag.updateElements(t);u=true}d=_.debounce(function(){TS.interop.utility.requestIdleCallback(function(){return TSSSB.nodrag.updateElements(t)},{timeout:200})},400);$(window).off("resize.setupNoDragFSM").on("resize.setupNoDragFSM",d)};var I=function e(){if(!TS.model.is_our_app||!TS.interop.desktop.legacyAreDragRegionsRequired())return;u=false;$(window).off("resize.setupNoDragFSM");TS.interop.desktop.legacyUpdateNoDragRegion([]);TS.search.autocomplete.calculateNoDragRegions()};var E=function t(){var r=e.find('[data-modal-gallery-direction="-1"]');var n=e.find('[data-modal-gallery-direction="1"]');var i=e.find("[data-modal-slideshow-count]");var a=e.find("[data-modal-slideshow-total]");var s=f.modal_gallery.total_items;0===l?r.prop("disabled",true):r.prop("disabled",false);l===s?n.prop("disabled",true):n.prop("disabled",false);i.html(l+1);a.html(s+1)};var A=function e(t){if(t)return true;if(TS.ui.lazy_filter_select.is_list_open)return false;if(TS.ui.react_emoji_menu.is_showing)return false;if(TS.model.menu_is_showing)return false;if(TS.model.dialog_is_showing)return false;if(TS.utility.isTabCompleteShowing())return false;return true}})()},"F/UT":function(e,t){(function(){TS.registerModule("mpims",{switched_sig:new signals.Signal,joined_sig:new signals.Signal,member_joined_sig:new signals.Signal,message_received_sig:new signals.Signal,message_removed_sig:new signals.Signal,message_changed_sig:new signals.Signal,marked_sig:new signals.Signal,unread_changed_sig:new signals.Signal,unread_highlight_changed_sig:new signals.Signal,msg_not_sent_sig:new signals.Signal,onStart:function e(){TS.prefs.display_real_names_override_changed_sig.add(r);TS.prefs.team_display_real_names_changed_sig.add(r);TS.members.changed_profile_sig.add(t)},legacyAddMsg:function e(t,r){var n=false;var i=TS.interop.channels.getMpimById(t,n);if(!i){TS.error('unknown mpim "'+t+'"');return}if(!TS.redux.messages.addMessage(r,true))return;if(TS.interop.messages.isReply(r)&&!TS.shared.legacyAddMsg(i,r))return;TS.mpims.message_received_sig.dispatch(i,r);if(!i.is_open&&TS.interop.messages.canCountAsUnreadForCurrentUser(r,TS.model.user.id))if(1==i.members.length){var a={return_im:true,reason:"TS.mpims.legacyAddMsg"};a.channel=i.id;TS.interop.api.call("conversations.open",a).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;TS.ims.legacyOnOpened&&TS.ims.legacyOnOpened(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;TS.ims.legacyOnOpened&&TS.ims.legacyOnOpened(i,t,r,n);return{data:t,args:r,request_id:n}})}else if(i.members.length>1){var s=i.members.join(",");TS.interop.api.call("conversations.open",{users:s})}},legacyRemoveMsg:function e(t,r){var n=false;var i=TS.interop.channels.getMpimById(t,n);if(!i){TS.error('unknown mpim "'+t+'"');return}TS.redux.messages.removeMessage(r);if(TS.interop.messages.isReply(r)){i._archive_msgs&&TS.utility.msgs.spliceMsg(i._archive_msgs,r);var a=i.msgs;TS.utility.msgs.spliceMsg(a,r)}TS.mpims.message_removed_sig.dispatch(i,r)},legacyOnSendMsg:function e(t,r){var n=false;var i=TS.interop.channels.getMpimById(r.SENT_MSG.channel,n);if(!i){TS.error("unknown mpim? "+r.SENT_MSG.channel);return}TS.shared.legacyOnSendMsg(t,r,i,TS.mpims)},legacyDisplayMpim:function e(t){var r=_.defaults({},t,{from_history:false,replace_history_state:false});var n=r.id;if(!n){TS.error("no mpim id supplied");return}var i=r.and_send_txt;var a=r.replace_history_state;var o=r.last_active_primary_view;TS.telemeter.mark("start_channel_change_"+n);TS.redux.dispatch(TS.interop.redux.models.channelsMeta.prqMetrics.updateChannelLastFocus({lastFocus:TS.interop.redux.models.window.getWindowLastFocusEvent(TS.redux.getState()),objId:n}));var l=false;var u=TS.interop.channels.getEntityById(n,l);if(!TS.interop.rules.channels.isMpim(u)){TS.error('mpim "'+n+'" unknown');return}TS.utility.msgs.maybeClearPrevLastRead();TS.utility.msgs.maybeClearPrevLastRead(u);var d=o||TS.model.active_mpim_id;if(n==d&&!a){TS.warn('mpim "'+n+'" already displayed');i&&TS.shared.legacySendMsg(n,$.trim(i));return}TS.has_pri[s]&&TS.log(s,"legacyDisplayChannel (mpim): "+n);if(u.is_open){i&&TS.shared.legacySendMsg(n,$.trim(i));return}TS.redux.dispatch(TS.interop.redux.features.pendingOpenChannel.addPendingOpenChannel({channelId:u.id,msgText:i}));var c={channel:n};TS.interop.api.call("conversations.open",c)},legacyMarkMostRecentReadMsg:function e(t,r){if(!t){TS.error("mpim unknown");return}TS.interop.channels.markMostRecentMsgRead({channelId:t.id,reason:r})},markReadMsg:function e(t,r,n){TS.redux.dispatch(TS.interop.actions.markLastRead({id:t,ts:r,reason:n}))},legacyGetMembersInDisplayOrder:function e(t){if(!t)return;var r=TS.model&&TS.model.user?TS.model.user.id:TS.boot_data.user_id;return _.chain(t.members).without(r).map(function(e){return TS.redux.members.getPotentiallyUnknownMemberById(e)}).compact().value()},legacyGetDisplayName:function e(t,r,n,s,o){var l=_.isInteger(s);if(t._display_name&&!r&&!n&&!l&&!o)return t._display_name;if(t._display_name_truncated&&!r&&!n&&!o&&l)return t._display_name_truncated;if(o)return a(t);return i(t,r)},legacyHasUnknownMember:function e(t){var r=TS.mpims.legacyGetMembersInDisplayOrder(t);if(!r)return true;return _.some(r,"is_unknown")},getMemberCount:function e(t){if(!(t&&t.members))return null;return Math.min(Math.max((t.members.length||1)-1,2),9)},makeNameForMpim:function t(r){return e(r)},checkMpimMatch:function e(t,r,n){if(!t)return;var i=true;var a=true;var s=TS.mpims.legacyGetMembersInDisplayOrder(t);for(var o=0;o<r.length;o+=1){var l=false;for(var u=0;u<s.length;u+=1)(TS.utility.members.checkMemberMatch(s[u],r[o],i)||n&&TS.utility.members.checkMemberMatch(s[u],n[o],i))&&(l=true);l||(a=false)}return a}});var e=function e(t){var r=TS.mpims.legacyGetMembersInDisplayOrder(t);if(r.length<2)return t._internal_name;return"@"+_(r).compact().map(function(e){if(TS.interop.members.isExternal(e))return e.name+"_"+e.team_id;return e.name}).value().join(",")};var t=function e(t){TS.model.mpims.forEach(function(e){-1!==e.members.indexOf(t.id)&&n(e)})};var r=function e(){TS.model.mpims.forEach(n)};var n=function e(t){t._display_name=void 0};var i=function e(t,r){var n=TS.mpims.legacyGetMembersInDisplayOrder(t);var i=_.find(n,"is_unknown");if(i){if(r)return TS.templates.unknown_member({id:i.id});return""}var a=_(n).map(function(e){var t=TS.interop.members.getPrefCompliantMemberName(e);if(r){var n="";var i=TS.interop.members.getMemberCurrentStatus(TS.redux.getState(),e.id);(i.emoji||i.text)&&(n=" "+TS.templates.current_status({tip_direction:"bottom",member:e,classes:"ts_tip_float ts_tip_hidden"}));t=_.escape($.trim(t));t='<li class="mpdm_member '+TS.templates.makeMemberDomId(e)+" "+TS.templates.makeMemberPresenceStateClass(e)+'" data-member-id="'+e.id+'">'+t+n+"</li>"}return t}).compact().value();var s=r?a.join(" "):a.join(", ");r||(t._display_name=s);return s};var a=function e(t){var r=TS.mpims.legacyGetMembersInDisplayOrder(t);var n=r.map(function(e){return TS.interop.members.getPrefCompliantMemberName(e)});var i=TS.interop.i18n.listify(n,{strong:true}).join("");return i};var s=999})()},Foai:function(e,t,r){var n=r("cDf5");var i=r("lSNA");function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}));r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),true).forEach(function(t){i(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}(function(){TS.registerModule("files",{team_file_added_sig:new signals.Signal,team_file_deleted_sig:new signals.Signal,team_file_deleted_success_sig:new signals.Signal,team_file_changed_sig:new signals.Signal,team_file_shared_sig:new signals.Signal,team_file_comment_added_sig:new signals.Signal,team_file_comment_edited_sig:new signals.Signal,team_file_comment_deleted_sig:new signals.Signal,file_uploaded_sig:new signals.Signal,file_uploading_sig:new signals.Signal,file_progress_sig:new signals.Signal,file_canceled_sig:new signals.Signal,file_queue_emptied_sig:new signals.Signal,channel_files_fetched_sig:new signals.Signal,user_changed_public_url_sig:new signals.Signal,uploadQ:[],uploading:false,polling_count:0,polling_file_id:null,polling_ticket:null,polling_tim:null,polling_handler:null,waiting_for_refresh:{},supported_audio_type_re:/^(m4a|mp3|wav)$/,supported_video_type_re:/^(mp4|mov|webm)$/,onStart:function e(){TS.prefs.team_disable_file_editing_changed_sig.add(TS.files.getFileActions,TS.files.upsertAndSignal);TS.files.file_uploaded_sig.add(a)},isFilePrivate:function e(t){return!t.is_public&&!t.is_external&&!t.is_shared},isFileAuthorExternal:function e(t){if(!_.isObject(t))return false;var r=TS.interop.members.getMemberById(t.user);if(!_.isObject(r))return false;return TS.interop.members.isExternal(r)},isFileUntitled:function e(t){return"-"===t.name},createPublicURL:function e(t,r){if(TS.prefs.getTeamPref("disallow_public_file_urls"))return;var n=function e(n,i,a){if(n){TS.files.upsertAndSignal({id:t.id,public_url_shared:true},"createPublicURL");TS.files.user_changed_public_url_sig.dispatch(i.file)}else if(i.error&&"not_allowed"===i.error){TS.prefs.setTeamPrefLocal("disallow_public_file_urls",true);TS.generic_dialog.alert(TS.interop.i18n.t("An administator has disabled public file URL creation. You will not be able to create a public URL for this space.","files")())}r&&"function"===typeof r&&r(n,i,a)};return TS.interop.api.callExpedited("files.sharedPublicURL",{file:t.id}).then(function(e){var t=e.data,r=e.args,i=e.request_id;var a=true;n(a,t,r,i);return{data:t,args:r,request_id:i}}).catch(function(e){var t=e.data,r=e.args,i=e.request_id;var a=false;n(a,t,r,i);return{data:t,args:r,request_id:i}})},createSpace:function e(t){var r={};TS.boot_data.page_needs_enterprise&&(r.team=TS.model.team.id);var n=function e(r,n){if(r){var i=TS.files.upsertAndSignal(n.file,"createSpace").file;TS.web&&TS.ssb.upsertFileInSSBParentWin(i);t(i)}else{TS.generic_dialog.alert('<p class="no_bottom_margin">'+TS.interop.i18n.t("Oops! Something went wrong. Please try again.","files")()+"</p>");t(null)}};return TS.interop.api.callExpedited("files.createSpace",r).then(function(e){var t=e.data,r=e.args,i=e.request_id;var a=true;n(a,t,r,i);return{data:t,args:r,request_id:i}}).catch(function(e){var t=e.data,r=e.args,i=e.request_id;var a=false;n(a,t,r,i);return{data:t,args:r,request_id:i}})},createAndOpenNewSpace:function e(t,r){var n=TS.model.active_cid?"?origin_channel="+TS.model.active_cid:"";TS.boot_data.page_needs_enterprise&&(n.length?n+="&origin_team="+TS.model.team.id:n="?origin_team="+TS.model.team.id);if(r||!TS.model.is_our_app){var i="/files/create/post"+n;TS.utility.openInNewTab(i,"_blank");"function"===typeof t&&t();return Promise.resolve()}return TS.files.createSpace(function(e){if(e){var r=e.permalink+n;TS.ssb.openNewFileWindow(e,r,n)||TS.utility.openInNewTab(r,e.id)}"function"===typeof t&&t()})},createDocs:function e(t){var r={};TS.boot_data.page_needs_enterprise&&(r.team=TS.model.team.id);var n=function e(r,n){if(r){var i=TS.files.upsertAndSignal(n.file).file;TS.web&&TS.ssb.upsertFileInSSBParentWin(i);t(i)}else{TS.generic_dialog.alert('<p class="no_bottom_margin">'+TS.interop.i18n.t("Oops! Something went wrong. Please try again.","files")()+"</p>");t(null)}};return TS.interop.api.callExpedited("files.docs.create",r).then(function(e){var t=e.data,r=e.args,i=e.request_id;var a=true;n(a,t,r,i);return{data:t,args:r,request_id:i}}).catch(function(e){var t=e.data,r=e.args,i=e.request_id;var a=false;n(a,t,r,i);return{data:t,args:r,request_id:i}})},createAndOpenNewDocs:function e(t,r){var n=TS.model.active_cid?"?origin_channel="+TS.model.active_cid:"";TS.boot_data.page_needs_enterprise&&(n.length?n+="&origin_team="+TS.model.team.id:n="?origin_team="+TS.model.team.id);if(r||!TS.model.is_our_app){var i=TS.interop.environment.subdomain;var a=i?"https://app."+i+(i?".":"")+"slack.com/docs/"+TS.model.team.id+n:"https://app.slack.com/docs/"+TS.model.team.id+n;TS.utility.openInNewTab(a,"_blank");"function"===typeof t&&t();return Promise.resolve()}return TS.files.createDocs(function(e){if(e){var r=e.permalink+n;TS.ssb.openNewFileWindow(e,r,n)||TS.utility.openInNewTab(r,e.id)}"function"===typeof t&&t()})},promptForFileUnshare:function e(t,r){var n=TS.redux.channels.getEntityById(r);if(!n||n.is_im||n.is_mpim)return;var i=TS.interop.i18n.t("<p>Are you sure you want to un-share this file from the <strong>{channel_name}</strong> {is_private, select, true {private} other {}} channel?</p>\t\t\t<p>Un-sharing the file will not remove existing share and comment messages, but it will keep any future comments from appearing in the channel.</p>","files")({is_private:n.is_private||n.is_group,channel_name:n.is_channel&&!n.is_private?"#"+n.name:n.name});TS.generic_dialog.start({title:TS.interop.i18n.t("Un-share file","files")(),body:i,show_cancel_button:true,show_go_button:true,go_button_text:TS.interop.i18n.t("Yes, unshare this file","files")(),cancel_button_text:TS.interop.i18n.t("Cancel","files")(),onGo:function e(){TS.files.unshareFile(t,r)}})},shareFile:function e(t,r,n,i,a){var s={file:t,channel:r,comment:TS.format.cleanMsg(n)};s.resharing_aware=true;i&&(s.share_quietly=true);var o=function e(t,r,n){TS.files.onFileShare(t,r,n);a&&a(t,r,n)};return TS.interop.api.call("files.share",s).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;o(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;o(i,t,r,n);return{data:t,args:r,request_id:n}})},onFileShare:function e(t,r,n){if(!t)return;TS.files.fetchFileInfo(n.file,function(e,t){TS.web&&TS.files.upsertAndSignal(t,"onFileShare")})},unshareFile:function e(t,r,n){var i=function e(r,i,a){TS.files.onFileUnShare(r,i,a);n&&n(t,TS.files.getFileById(t))};TS.interop.api.call("files.unshare",{file:t,channel:r}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var a=true;i(a,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var a=false;i(a,t,r,n);return{data:t,args:r,request_id:n}})},fetchFileInfo:function e(t,r,n){var i=TS.redux.dispatch(TS.interop.files.fetchAndUpsertFileById({fileId:t,reason:n}));if(r)return i.tap(function(e){return r(t,e)}).catch(function(){return r(t,null)});return i},onFileUnShare:function e(t,r,n){if(!t)return;TS.files.fetchFileInfo(n.file,function(e,t){TS.web&&TS.files.upsertAndSignal(t,"onFileUnShare")})},fetchTeamFiles:function e(r,n){var i=function e(t,r,i){if(t&&r.files){var a;for(var s=0;s<r.files.length;s+=1){a=r.files[s];TS.files.upsertFile(a,"fetchTeamFiles")}}n&&n(t,r,i)};TS.interop.api.call("files.list",{types:r,count:t}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var a=true;i(a,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var a=false;i(a,t,r,n);return{data:t,args:r,request_id:n}})},fetchMemberFiles:function e(r,n,i){var a=function e(t,r,n){if(t&&r.files){var a;for(var s=0;s<r.files.length;s+=1){a=r.files[s];TS.files.upsertFile(a,"fetchMemberFiles")}}i&&i(t,r,n)};TS.interop.api.call("files.list",{user:r,types:n,count:t}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;a(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;a(i,t,r,n);return{data:t,args:r,request_id:n}})},fetchChannelFiles:function e(t,r,n,i,a){a=a||{};var o=i&&i.length?i.join(","):"";if(r){var l=function e(t,n,i){t&&TS.files.onChannelFetch(t,n,i);r(t,n,i)};a=s({channel:t,types:o,count:n},a);TS.interop.api.call("files.list",a).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;l(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;l(i,t,r,n);return{data:t,args:r,request_id:n}})}else{a=s({channel:t,types:o},a);TS.interop.api.call("files.list",a).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;TS.files.onChannelFetch&&TS.files.onChannelFetch(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;TS.files.onChannelFetch&&TS.files.onChannelFetch(i,t,r,n);return{data:t,args:r,request_id:n}})}},onChannelFetch:function e(t,r,n){if(!t)return;if(r.files){var i;for(var a=0;a<r.files.length;a+=1){i=r.files[a];TS.files.upsertFile(i,"onChannelFetch")}}TS.files.channel_files_fetched_sig.dispatch(n.channel,r.files)},addComment:function e(t,r,n,i){var a={file:t,comment:r,channel:n||"",override_ft:true};var s=function e(t,r,n){TS.files.onFileComment(t,r,n);i&&i(t,r,n)};TS.interop.api.callExpedited("files.comments.add",a).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;s(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;s(i,t,r,n);return{data:t,args:r,request_id:n}})},onFileComment:function e(t,r,n){if(!t)return;var i=TS.files.getFileById(n.file);if(!i){TS.error("no file? "+n.file);return}TS.files.addCommentToFile(r.comment,i)},getFileById:function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return TS.redux.files.getFileById(t,r)},getFileByDownloadUrlPrivate:function e(t){return TS.files.getFileByProp("url_private_download",t)},getFileByProp:function e(t,r){return TS.redux.files.getFileByProp(t,r)},getFileActions:function e(t){if(!t)return;var r={};var n=false;t.user==TS.model.user.id&&(n=true);t.is_public?r.share=true:n?r.share=true:r.share_private_file=true;r.comment=true;t.public_url_shared||"external"===t.mode||TS.model.user.is_restricted||TS.prefs.getTeamPref("disallow_public_file_urls")||(t.is_public?r.create_public_link=true:n&&(r.create_public_link=true));!t.public_url_shared||TS.model.user.is_restricted||!TS.model.user.is_admin&&!n||TS.prefs.getTeamPref("disallow_public_file_urls")||(r.revoke_public_link=true);"hosted"!==t.mode&&"snippet"!==t.mode||(r.download=true);(t.mimetype&&0===t.mimetype.indexOf("image/")||"pdf"===t.filetype||"external"===t.mode||"snippet"===t.mode||"email"===t.mode)&&(r.open_original=true);TS.web&&("post"!==t.mode&&"snippet"!==t.mode&&"space"!==t.mode&&"email"!==t.mode&&"docs"!==t.mode||(r.print=true));"space"!==t.mode||"USLACKBOT"===t.user&&"Getting_Started_with_Posts"===t.name||(r.learn_more=true);"space"!==t.mode&&"docs"!==t.mode||(r.new_window=true);"space"===t.mode&&"locked"!==t.state&&(r.edit=true);if(n){"snippet"!==t.mode&&"post"!==t.mode&&"space"!==t.mode&&"docs"!==t.mode||(r.edit=true);"hosted"!==t.mode&&"email"!==t.mode||(r.edit_title=true);r.delete_file=true}if(TS.model.user.is_admin){var i=TS.interop.members.isExternalById(t.user);r.delete_file=!i}TS.clipboard.canWriteText()&&(r.copy_file_link=true);"external"===t.mode&&(n||TS.model.user.is_admin)&&(r.refresh=true);window.Dropbox&&Dropbox.isBrowserSupported()&&TS.prefs.getPref("dropbox_enabled")&&"hosted"===t.mode&&(r.save_to_dropbox=true);r.rxn_file=true;if(TS.prefs.getTeamPref("disable_file_editing")){r.edit=false;r.edit_title=false}TS.prefs.getTeamPref("disable_file_deleting")&&(r.delete_file=false);if(t.is_tombstoned){r.edit=false;r.edit_title=false;r.delete_file=false}return r},getFileCommentActions:function e(t){if(!t)return{};var r={can_edit:!TS.boot_data.feature_file_threads,can_delete:true};t.user!=TS.model.user.id?r.can_edit=false:TS.prefs.getTeamPref("msg_edit_window_mins")>-1&&(Date.now()-TS.interop.datetime.toDateObject(t.timestamp))/6e4>TS.prefs.getTeamPref("msg_edit_window_mins")&&(r.can_edit=false);TS.prefs.getTeamPref("allow_message_deletion")?t.user!=TS.model.user.id&&(TS.model.user.is_admin||(r.can_delete=false)):TS.model.user.is_admin||(r.can_delete=false);r.rxn_file_comment=!TS.boot_data.feature_file_threads;return r},getThumbSrcForFile:function e(t,r){try{t=i(t)}catch(e){return false}var n=s({suppressAnimations:!TS.prefs.getPref("a11y_animations")},r);return TS.interop.files.getThumbSrcForFile(t,n)},fileIsImage:function e(t){try{t=i(t)}catch(e){return false}return TS.interop.files.fileIsImage(t)},fileHasRichPreview:function e(t){try{t=i(t)}catch(e){return false}var r=t.mimetype&&-1!==t.mimetype.indexOf("image/");return t.has_rich_preview&&!r},fileIsPDF:function e(t){try{t=i(t)}catch(e){return false}return"pdf"===t.filetype||t.converted_pdf},getHiddenFileTemplateArgs:function e(t){var r=TS.interop.messages.getClogUIStepFromContext(t);return{is_hidden_by_storage_limit:true,pricing_link_a_tag:'<a href="/pricing?ui_step='+r+'&ui_element=5" data-clog-click="true" data-clog-event="GROWTH_PRICING" data-clog-ui-action="click" data-clog-ui-step='+r+' data-clog-ui-element="pricing_link" data-clog-ui-component="file_storage_limit_banner" target="_blank">'}},getFileTemplateArguments:function e(t,r,n){var i={};i.current_user_id=TS.model.user.id;i.file_partial="generic";/(snippet|post|email|docs)/.test(t.mode)&&(i.file_partial=t.mode);/(space)/.test(t.mode)&&(i.file_partial="post");TS.interop.files.shouldShowFile(t)&&(i.file_show_meta_text=true);if(TS.interop.files.isTombstone(t)){i.file_partial="tombstone";i.file_tombstone=true}if(TS.interop.files.isHiddenByStorageLimit(t)){i.file_partial="hidden_by_limit";_.assign(i,TS.files.getHiddenFileTemplateArgs(n))}if(TS.files.fileIsImage(t)){i.file_partial="image";i.image_src=TS.files.getThumbSrcForFile(t,{maxSize:r});i.image_width=360===r?t.thumb_360_w:t.thumb_480_w||t.thumb_360_w;i.image_height=360===r?t.thumb_360_h:t.thumb_480_h||t.thumb_360_h;i.preserve_aspect_ratio=i.image_width>0&&i.image_height>0;i.preview_actions_class="";(i.image_width<170||i.image_height<50)&&(i.preview_actions_class+=" overflow_preview_actions");i.image_width<170&&(i.preview_actions_class+=" overflow_preview_actions_width")}/(post|space|email|docs|generic)/.test(i.file_partial)&&(i.title_hider=true);"snippet"===t.mode&&(i.title_hider="Untitled"===t.title);i.filesize=t.size>2e4&&!/(gdoc|gpres|gsheet|gdraw)/.test(t.filetype);/(space|post)/.test(t.filetype)||(i.meta_filetype=new Handlebars.SafeString(TS.templates.builders.makeFiletypeHTML(t)));TS.templates.builders.makeExternalFiletypeHTML(t)===i.meta_filetype&&(i.meta_filetype=false);if(TS.interop.files.fileIsHostedSupportedMedia(t)){if(TS.interop.files.fileIsSupportedVideo(t)){i.file_is_video=true;var a={width:t.width,height:t.height,source:t.url_private,size:t.size};if(t.video){i.transcoding_status=t.video.status;if(t.video.outputs)for(var s=t.video.outputs.length-1;s>=0;s-=1){var o=t.video.outputs[s];if(!o.source)continue;(!a.width||o.width>a.width)&&(a=o)}}i.video_height=TS.model.native_video_embed_height;t.thumb_video&&(i.poster=t.thumb_video);i.best_source=a.source}if(TS.interop.files.fileIsSupportedAudio(t)){i.file_is_audio=true;i.audio_preload="metadata";t.size<=TS.model.native_media_preload_limit_bytes&&(i.audio_preload="auto")}}return i},getFileDetailsMetaTemplateArguments:function e(t){var r=TS.files.getFileActions(t);var n="post"===t.mode;var i="space"===t.mode||"post"===t.mode;var a="snippet"===t.mode;var s="docs"===t.mode;var o={file:t,user:TS.model.user,download:"hosted"===t.mode,edit_link:n?t.edit_link:t.permalink,edit:(i||a)&&t.user===TS.model.user.id,is_post:n,is_post_or_space:i,is_snippet:a,is_docs:s,show_open_public_link:!TS.prefs.getTeamPref("disallow_public_file_urls"),show_revoke_public_link:!TS.prefs.getTeamPref("disallow_public_file_urls")&&r.revoke_public_link};if("email"===t.mode){o.to_more_count=t.to.length-1;o.cc_more_count=t.cc.length-1}t&&t.id&&("snippet"!==t.mode&&"post"!==t.mode&&"space"!==t.mode||t.content||t.content_html||t.content_highlight_html||TS.files.fetchFileInfo(t.id));return o},createFileCommentsGroup:function e(t){var r={};function n(e,t,n){var i=TS.redux.channels.getEntityById(t);var a=i&&TS.interop.rules.channels.getDisplayNameForChannel(i);var s=e.share_info&&e.share_info[t];var o=s&&s.timestamp;var l=TS.interop.members.getMemberById(s&&s.user_id);var u=l&&TS.interop.members.getPrefCompliantMemberName(l);r[t]={name:a,first_share:{name:u,timestamp:o},comments:n?[n]:[]}}for(var i=t.comments.length-1;i>=0;i-=1){var a=t.comments[i];a.channel&&(r[a.channel]?r[a.channel].comments.unshift(a):n(t,a.channel,a))}_.each([t.channels,t.groups,t.ims,t.mpims],function(e){if(e)for(var i=e.length-1;i>=0;i-=1){var a=e[i];r[a]||n(t,a)}});t._comments_grouped=r},resetFileCommentsGroup:function e(t){t._comments_grouped=null},sortFiles:function e(t){function r(e,t){if(e.timestamp<t.timestamp)return 1;if(e.timestamp>t.timestamp)return-1;return 0}t.sort(r)},getFileCommentById:function e(t,r){var n;for(var i=0;i<t.comments.length;i+=1){n=t.comments[i];if(n.id==r)return n}return null},addCommentToFile:function e(t,r){var n=TS.files.getFileCommentById(r,t.id);if(n)return n;t._rxn_key=TS.rxns.getRxnKey("file_comment",t.id);TS.rxns.upsertRxnsFromDataAndUpdateUI(t._rxn_key,t.reactions);delete t.reactions;r.comments.push(t);TS.files.sortCommentsOnFile(r);TS.files.team_file_comment_added_sig.dispatch(r,t);return t},editCommentOnFile:function e(t,r){var n;var i=false;var a=false;for(var s=0;s<r.comments.length;s+=1){n=r.comments[s];if(n.id==t.id){i=true;r.comments[s]=t;n.is_starred&&(t.is_starred=true);n._rxn_key&&(t._rxn_key=n._rxn_key);n.pinned_to&&!t.pinned_to&&(t.pinned_to=n.pinned_to);if(r.initial_comment&&n.id==r.initial_comment.id){r.initial_comment=t;a=true}break}}if(!i)return false;TS.files.sortCommentsOnFile(r);TS.files.team_file_comment_edited_sig.dispatch(r,t);a&&TS.files.team_file_changed_sig.dispatch(r);return true},deleteCommentOnFile:function e(t,r){var n;var i=[];var a;for(var s=0;s<r.comments.length;s+=1){n=r.comments[s];if(n.id==t){a=n;r.initial_comment&&n.id==r.initial_comment.id&&(r.initial_comment=null);continue}i.push(n)}if(i.length==r.comments.length)return;r.comments=i;TS.files.sortCommentsOnFile(r);TS.files.team_file_comment_deleted_sig.dispatch(r,t,a);TS.files.team_file_changed_sig.dispatch(r)},sortCommentsOnFile:function e(t){function r(e,t){if(e.timestamp>t.timestamp)return 1;if(e.timestamp<t.timestamp)return-1;return 0}t.comments.sort(r)},upsertFile:function e(t,i){i=i||"no reason";var a="NOOP";var s=[];if(Object.keys(t).length<2){TS.error("upserting a bad file object! it has less than 2 properties",t,"with reason: "+i);return{status:a,file:t,what_changed:s}}if(t&&_.isString(t)&&TS.interop.utility.looksLikeFileId(t)){TS.interop.files.markObjectsAsFresh([t]);t=TS.files.getFileById(t)}else TS.interop.files.markObjectsAsFresh([t.id]);var o=TS.files.getFileById(t.id);var l;var u;var d;t=TS.interop.files.processFileForUpserting(t);if(o){t._rxn_key=TS.rxns.getRxnKey("file",t.id);u=TS.rxns.getExistingRxnsByKey(t._rxn_key);u&&!t.reactions?TS.error("file:"+t.id+" ("+i+") has reactions in local model, but we are upserting an object that does NOT have reactions, which seems suspicious"):TS.rxns.upsertRxnsFromDataAndUpdateUI(t._rxn_key,t.reactions);delete t.reactions;if(t.comments)for(d=0;d<t.comments.length;d+=1){l=t.comments[d];l._rxn_key=TS.rxns.getRxnKey("file_comment",l.id);u=TS.rxns.getExistingRxnsByKey(l._rxn_key);u&&!l.reactions?TS.warn("comment:"+t.id+" ("+i+") has reactions in local model, but we are upserting an object that does NOT have reactions, which seems suspicious"):TS.rxns.upsertRxnsFromDataAndUpdateUI(l._rxn_key,l.reactions);delete l.reactions}if(t.initial_comment){t.initial_comment._rxn_key=TS.rxns.getRxnKey("file_comment",t.initial_comment.id);u=TS.rxns.getExistingRxnsByKey(t.initial_comment._rxn_key);u&&!t.initial_comment.reactions?TS.warn("initial_comment:"+t.id+" ("+i+") has reactions in local model, but we are upserting an object that does NOT have reactions, which seems suspicious"):TS.rxns.upsertRxnsFromDataAndUpdateUI(t.initial_comment._rxn_key,t.initial_comment.reactions);delete t.initial_comment.reactions}for(var c in t)if("channels"===c||"ims"===c||"groups"===c||"pinned_to"===c||"to"===c||"from"===c||"cc"===c||"attachments"===c){var m=false;var f=_.isArray(t[c])?t[c]:[];var p=_.isArray(o[c])?o[c]:[];"to"===c||"from"===c||"cc"===c||"attachments"===c?p.length!=f.length&&(m=true):p.join("")!=f.join("")&&(m=true);if(m){a="CHANGED";s.push(c)}}else if("preview"===c){if(o[c]!==t[c]){a="CHANGED";s=s.concat([c,"content","content_html","content_highlight_html"])}}else if("comments"===c){if(t[c]&&!TS.utility.areSimpleObjectsEqual(t[c],o[c],"file:"+t.id+" "+t.name)){a="CHANGED";s.push(c)}}else if("content"===c){if(t[c]&&o[c]!=t[c]){a="CHANGED";s.push(c)}}else if("editor"===c||"state"===c){if(t[c]!=o[c]){s.push(c);a="CHANGED"}}else if("initial_comment"===c);else if("reactions"===c);else if("channel_map"!==c&&"group_map"!==c&&"im_map"!==c&&"teams"!==c&&"teams_shared_with"!==c&&"users"!==c||TS.utility.isScalar(t[c])){if("video"===c){if(t[c]&&!TS.utility.areSimpleObjectsEqual(t[c],o[c],"file:"+t.id+" "+t.name)){a="CHANGED";s.push(c)}}else if("shares"===c)TS.boot_data.feature_file_threads&&(TS.utility.areSimpleObjectsEqual(o[c],t[c])||(a="CHANGED"));else if("pinned_info"===c){if(!TS.utility.areSimpleObjectsEqual(o[c],t[c])){a="CHANGED";s.push(c)}}else if(o[c]!=t[c])if(t[c]&&!TS.utility.isScalar(t[c]))TS.warn(c+" is not scalar! it needs to be handled by upsertFile specifically to test if it has changed! "+n(t[c]));else if("boolean"!==typeof t[c]||!t[c]!=!o[c]){s.push(c+" ["+o[c]+"] -> ["+t[c]+"]");a="CHANGED"}}else;o=t}else if(t&&_.isObject(t)){a="ADDED";t._rxn_key=TS.rxns.getRxnKey("file",t.id);TS.rxns.upsertRxnsFromDataAndUpdateUI(t._rxn_key,t.reactions);delete t.reactions;if(t.comments){for(d=0;d<t.comments.length;d+=1){l=t.comments[d];l._rxn_key=TS.rxns.getRxnKey("file_comment",l.id);TS.rxns.upsertRxnsFromDataAndUpdateUI(l._rxn_key,l.reactions);delete l.reactions}if(t.initial_comment){t.initial_comment._rxn_key=TS.rxns.getRxnKey("file_comment",t.initial_comment.id);TS.rxns.upsertRxnsFromDataAndUpdateUI(t.initial_comment._rxn_key,t.initial_comment.reactions);delete t.initial_comment.reactions}}var h=TS.redux.members.getPotentiallyUnknownMemberById(t.user);if(h){h.files.push(t);TS.files.sortFiles(h.files)}else TS.error("hmmm, file "+t.id+" does not have a known user "+t.user);r(t);o=t}if("CHANGED"===a){r(t);_.includes(s,"comments")&&TS.utility.msgs.updateCommentReferences(o)}"NOOP"!==a&&TS.redux.dispatch(TS.interop.redux.models.files.addFile(o));return{status:a,file:o,what_changed:s}},upsertAndSignal:function e(t,r){var n=TS.files.upsertFile(t,r);"CHANGED"===n.status?TS.files.team_file_changed_sig.dispatch(n.file):"ADDED"===n.status&&TS.files.team_file_added_sig.dispatch(n.file);return n},removeFile:function e(t){TS.log(4,'removing file "'+t+'"');var r=TS.files.getFileById(t);r&&(r.is_deleted=true);if(r){TS.redux.dispatch(TS.interop.redux.models.files.tombstoneFiles({fileIds:[t]}));r=TS.files.getFileById(t)}r&&TS.files.team_file_deleted_sig.dispatch(r)},upload:function e(t){var r=TS.interop.files.isPendingFile(t.file)||TS.interop.files.isExternalPendingFile(t.file);if(r){o(t);return}TS.files.uploading?TS.files.uploadQ.push(t):TS.files.actuallyUpload(t)},actuallyUpload:function t(r){TS.files.uploading=true;r.retry_num=r.retry_num||0;TS.boot_data.feature_legacy_file_upload_analytics&&(r.start_time=new Date);var n=new FormData;var i;var a=!!r.file;r.title&&(r.title=TS.emoji.maybeGetCanonicalEmojiString(r.title));if(r.text){i=r.title||r.filetype;TS.files.file_uploading_sig.dispatch(i,r.retry_num>0,a);n.append("content",r.text);r.filetype&&n.append("filetype",r.filetype);r.filename&&TS.warn("ignoring filename because it makes no sense for text files")}else{i=r.title||r.filename||r.file&&r.file.name||"blob";TS.files.file_uploading_sig.dispatch(i,r.retry_num>0,a);"string"===typeof r.file?n.append("content64",r.file):n.append("file",r.file);r.filename&&n.append("filename",r.filename);r.filetype&&TS.warn("ignoring filetype we send a filename which can intuit it")}n.append("token",TS.model.api_token);if(r.channels&&r.channels.length){var o="";"string"===typeof r.channels?o=r.channels:r.channels.join&&(o=r.channels.join(","));n.append("channels",o)}n.append("title",r.title);r.initial_comment&&n.append("initial_comment",TS.format.cleanMsg(r.initial_comment));var l="files.uploadAsync";if(r.link){r.is_dropbox&&(l="files.uploadExternal");r.is_box&&(l="files.uploadExternal");n.append("link",r.link)}TS.boot_data.feature_legacy_file_upload_analytics&&(r.is_external="files.uploadExternal"===l);if(TS.boot_data.feature_file_threads){r.thread_ts&&n.append("thread_ts",r.thread_ts);r.broadcast&&n.append("broadcast",r.broadcast)}var u;u="files.uploadAsync"===l?TS.model.async_api_url+l:TS.model.api_url+l;var d=r;var c=false;e=$.ajax({url:u,data:n,dataType:"json",cache:false,contentType:false,processData:false,type:"POST",xhr:function e(){var e=jQuery.ajaxSettings.xhr();e.upload&&e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=parseInt(100*e.loaded/e.total,10);TS.files.file_progress_sig.dispatch(t)}else TS.info("Upload length not computable")},false);return e},error:function e(t,n,a){c=true;TS.info("Error: Failed to upload file.");TS.info("textStatus:"+n+" errorThrown:"+a);TS.info("data:"+t);if("abort"===n){TS.files.file_canceled_sig.dispatch(i);TS.files.uploadOver(false);return}if(0===r.retry_num){r.retry_num+=1;TS.files.actuallyUpload(r)}else TS.generic_dialog.start({title:TS.interop.i18n.t("Upload failed","files")(),body:TS.interop.i18n.t("Hmm, it looks like your file failed to upload. Want to try again?","files")(),go_button_text:TS.interop.i18n.t("Yes, try again","files")(),cancel_button_text:TS.interop.i18n.t("No, cancel","files")(),onGo:function e(){r.retry_num+=1;TS.files.actuallyUpload(r)},onCancel:function e(){TS.files.uploadOver(false);TS.boot_data.feature_legacy_file_upload_analytics&&TS.files.clogCompleteUpload(s({ok:false,error:"Error during request. Status: "+status+", error: "+a},r))}})},complete:function e(t){if(c)return;t=jQuery.parseJSON(t.responseText);if(t&&t.ok&&t.file){if("files.uploadAsync"===l){var n=function e(t,r,n){if(!TS.files.polling_file_id)return;if(t)if("complete"===r.status){var i=TS.files.upsertAndSignal(r.file,"actuallyUploadAsync");TS.files.uploadProcessingOver(true,i.file.id,d)}else if("failed"===r.status){var a="";r.debug&&TS.boot_data.feature_tinyspeck&&(a="<br><br>TS only Debugging:<br><br>"+r.debug);TS.generic_dialog.start({title:TS.interop.i18n.t("Upload failed","files")(),body:TS.interop.i18n.t("Hmm, it looks like your file failed to upload. Want to try again?","files")()+a,go_button_text:TS.interop.i18n.t("Yes, try again","files")(),cancel_button_text:TS.interop.i18n.t("No, cancel","files")(),onGo:function e(){n.retry_num+=1;TS.files.actuallyUpload(n)},onCancel:function e(){TS.files.uploadProcessingOver(false,TS.files.polling_file_id)}})}else TS.files.pollForUploadProcessing();else{TS.generic_dialog.start({title:TS.interop.i18n.t("Upload failed","files")(),body:TS.interop.i18n.t("Hmm, it looks like your file failed to upload.","files")(),show_cancel_button:true});TS.files.uploadProcessingOver(false,TS.files.polling_file_id)}};TS.files.startPollingForUploadProcessing(t.file,t.ticket,n)}else{var i=TS.files.upsertAndSignal(t.file,"actuallyUpload");TS.files.uploadOver(t.ok,i.file.id,d)}TS.boot_data.feature_legacy_file_upload_analytics&&TS.files.clogCompleteUpload(s({ok:true},r))}else{TS.info("Error: Failed to upload file.");TS.info(t);var a=function e(){if(!TS.boot_data.feature_legacy_file_upload_analytics)return;var n=t&&t.error;TS.files.clogCompleteUpload(s({ok:false,error:n},r))};if(t)if(0===r.retry_num){r.retry_num+=1;TS.files.actuallyUpload(r)}else"folders_not_supported"===t.error?TS.generic_dialog.start({title:TS.interop.i18n.t("Folders not supported","files")(),body:TS.interop.i18n.t("<p>Sorry, <strong>{folder_name}</strong> is a folder, and folder uploads are not supported by Slack.</p>\t\t\t\t\t\t\t\t\t<p>Try uploading a .zip version of the file instead.</p>","files")({folder_name:_.escape(r.filename)}),show_cancel_button:false,esc_for_ok:true,onGo:function e(){TS.generic_dialog.end();TS.files.uploadOver(false);a()}}):"request_timeout"===t.error?TS.generic_dialog.start({title:TS.interop.i18n.t("File upload timed out","files")(),body:TS.interop.i18n.t('<p>It looks like you\u2019re on a slow or inconsistent internet connection. You may want to try your file upload again later. Or, try again now and it might work if you cross your fingers!</p>\t\t\t\t\t\t\t\t\t<p>If you\u2019re still having problems, you can:</p>\t\t\t\t\t\t\t\t\t<ul><li><a href="/help/test" target="{new_win_name}" class="bold">Run our Self-Help Tests</a></li>\t\t\t\t\t\t\t\t\t<li><a href="/help/requests/new" target="{new_win_name}" class="bold">Contact our support team</li></ul>',"files")({new_win_name:TS.templates.builders.newWindowName()}),show_cancel_button:false,esc_for_ok:true,onGo:function e(){TS.generic_dialog.end();TS.files.uploadOver(false);a()}}):"file_uploads_disabled"===t.error?TS.generic_dialog.start({title:TS.interop.i18n.t("Upload failed","files")(),body:TS.interop.i18n.t("At the request of your administrator, file uploads have been disabled on this workspace.","files")(),show_cancel_button:false,onGo:function e(){TS.files.uploadOver(false);a()}}):"file_uploads_except_images_disabled"===t.error?TS.generic_dialog.start({title:TS.interop.i18n.t("Upload failed","files")(),body:TS.interop.i18n.t("At the request of your administrator, only images can be uploaded to this workspace.","files")(),show_cancel_button:false,onGo:function e(){TS.files.uploadOver(false);a()}}):TS.generic_dialog.start({title:TS.interop.i18n.t("Upload failed","files")(),body:TS.interop.i18n.t("Hmm, it looks like your file failed to upload. Want to try again?","files")(),go_button_text:TS.interop.i18n.t("Yes, try again","files")(),cancel_button_text:TS.interop.i18n.t("No, cancel","files")(),onGo:function e(){r.retry_num+=1;TS.files.actuallyUpload(r)},onCancel:function e(){TS.files.uploadOver(false);a()}});else{alert("Upload failed.");TS.files.uploadOver(false)}}}})},startPollingForUploadProcessing:function e(t,r,n){TS.files.polling_count=0;TS.files.polling_file_id=t;TS.files.polling_ticket=r;TS.files.polling_handler=n;TS.files.pollForUploadProcessing()},pollForUploadProcessing:function e(){TS.files.polling_count+=1;TS.files.polling_tim=setTimeout(function(){if(!TS.files.polling_ticket)return;var e=function e(t,r,n){if(!TS.files.polling_ticket)return;TS.files.polling_handler(t,r,n)};TS.interop.api.callExpedited("files.uploadStatus",{ticket:TS.files.polling_ticket}).then(function(t){var r=t.data,n=t.args,i=t.request_id;var a=true;e(a,r,n,i);return{data:r,args:n,request_id:i}}).catch(function(t){var r=t.data,n=t.args,i=t.request_id;var a=false;e(a,r,n,i);return{data:r,args:n,request_id:i}})},1e3*TS.files.polling_count)},uploadProcessingOver:function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(TS.files.polling_file_id!=r)return;TS.info("TS.files.uploadProcessingOver polling_file_id:"+TS.files.polling_file_id+" polling_ticket:"+TS.files.polling_ticket+" polling_count:"+TS.files.polling_count);TS.files.polling_count=0;TS.files.polling_file_id=null;TS.files.polling_ticket=null;TS.files.polling_handler=null;clearTimeout(TS.files.polling_tim);TS.files.uploadOver(t,r,n)},uploadOver:function t(r,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};TS.files.file_uploaded_sig.dispatch(r,n,i);TS.files.uploading=false;e=null;TS.files.uploadQ.length?TS.files.actuallyUpload.call(null,TS.files.uploadQ.shift()):TS.files.file_queue_emptied_sig.dispatch()},cancelCurrentUpload:function t(){e&&e.abort()},deleteFile:function e(t){if(TS.boot_data.feature_modern_delete_file)return TS.interop.files.deleteFile({fileId:t,reason:"legacy_delete_file"});TS.interop.api.call("files.delete",{file:t}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;TS.files.onFileDelete&&TS.files.onFileDelete(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;TS.files.onFileDelete&&TS.files.onFileDelete(i,t,r,n);return{data:t,args:r,request_id:n}})},onFileDelete:function e(t){!t},endEditFileTitle:function e(){$("#file_edit_title_container").addClass("hidden");$("#file_title_container").removeClass("hidden")},saveEditFileTitle:function e(t){var r=TS.files.getFileById(t);if(!r)return;var n=$("#file_edit_title_input").val();if(!$.trim(n)){TS.sounds.play("beep");return}var i=r.title;if(i==n){TS.files.endEditFileTitle();return}var a=function e(r){if(!r){TS.files.upsertAndSignal({id:t,title:i},"saveEditFileTitle");TS.generic_dialog.alert(TS.interop.i18n.t("Something\u2019s gone wrong, and your change didn\u2019t save. If you see this message more than once, you may want to try restarting Slack.","files")(),TS.interop.i18n.t("Oh, crumbs!","files")(),TS.interop.i18n.t("Got it","files")())}};TS.interop.api.callExpedited("files.edit",{file:t,title:TS.emoji.maybeGetCanonicalEmojiString(n)}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;a(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;a(i,t,r,n);return{data:t,args:r,request_id:n}});n=_.escape(n);TS.files.upsertAndSignal({id:t,title:n},"saveEditFileTitleOptimistic");TS.files.endEditFileTitle()},editFileTitle:function e(t){var r=TS.files.getFileById(t);if(!r)return;var n=r.title;n=n?TS.format.unFormatMsg(n):r.name;$("#file_title_container").addClass("hidden");$("#file_edit_title_container").removeClass("hidden");$("#file_edit_title_input").val(n);$("#file_edit_title_input").select()},openBoxChooser:function e(t,r,n){TS.utility.box.unregister(TS.utility.box.SUCCESS_EVENT_TYPE,TS.files.onBoxChooser);TS.boot_data.feature_file_threads?TS.utility.box.success(function(e){TS.files.onBoxChooser(e,t,r,n)}):TS.utility.box.success(TS.files.onBoxChooser);TS.utility.box.launchPopup()},onBoxChooser:function e(t,r,n,i){var a=new Array(t.length);for(var s=0;s<t.length;s+=1){var o=t[s];a[s]={name:o.name,link:o.url,is_box:true}}TS.boot_data.feature_file_threads?TS.redux.dispatch(TS.interop.redux.actions.openFileUploadDialog({files:a,initialChannelId:r||TS.model.active_cid,threadTs:n,metadata:i})):TS.ui.upload_dialog.startWithCommentFromChatInput(a)},openDropboxChooser:function e(t,r,n){var i="preview";var a=TS.files.onDropboxChooser;TS.boot_data.feature_file_threads&&(a=function e(i){TS.files.onDropboxChooser(i,t,r,n)});Dropbox.choose({success:a,linkType:i,multiselect:true})},onDropboxChooser:function e(t,r,n,i){var a=[];for(var s=0;s<t.length;s+=1){var o=t[s];a.push({name:o.name,size:o.bytes,link:o.link,icon:o.icon,is_dropbox:true})}TS.boot_data.feature_file_threads?TS.redux.dispatch(TS.interop.redux.actions.openFileUploadDialog({files:a,initialChannelId:r||TS.model.active_cid,threadTs:n,metadata:i})):TS.ui.upload_dialog.startWithCommentFromChatInput(a)},makeFileNameFromFile:function e(t){return t.name||TS.interop.i18n.t("Pasted image at {date}","files")({date:TS.interop.datetime.toFilenameFriendlyDate(Date.now()/1e3)})+".png"},makeFileTitleFromFile:function e(t){return t.name||TS.interop.i18n.t("Pasted image at {date}","files")({date:TS.interop.datetime.toDate(Date.now()/1e3)})},justUploadTheseFileNow:function e(t,r,n){var i;for(var a=0;a<t.length;a+=1){i=t[a];if(i.size>TS.model.upload_file_size_limit_bytes)continue;TS.boot_data.feature_file_threads?TS.files.upload({file:i,filename:TS.files.makeFileNameFromFile(i),title:TS.files.makeFileTitleFromFile(i),channels:[r||TS.shared.legacyGetActiveModelOb().id],initial_comment:"",thread_ts:n}):TS.files.upload({file:i,filename:TS.files.makeFileNameFromFile(i),title:TS.files.makeFileTitleFromFile(i),channels:[TS.shared.legacyGetActiveModelOb().id],initial_comment:""})}},refreshFile:function e(t){TS.files.startRefreshingFile(t);TS.interop.api.call("files.refresh",{file:t}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;TS.files.onFileRefresh&&TS.files.onFileRefresh(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;TS.files.onFileRefresh&&TS.files.onFileRefresh(i,t,r,n);return{data:t,args:r,request_id:n}})},onFileRefresh:function e(t,r,n){var i=n.file;var a=TS.menu.$menu.find("#refresh_file").find(".item_label");if(t)a.text(TS.interop.i18n.t("File refreshed!","files")()).end();else if(!t){TS.files.doneRefreshingFile(i,'<span class="moscow_red">'+TS.interop.i18n.t("Refresh failed.","files")()+"</span>",5e3);a.text(TS.interop.i18n.t("Refresh failed","files")()).end()}t&&!r.will_refresh&&TS.files.doneRefreshingFile(i,'<span class="moscow_red">'+TS.interop.i18n.t("File refreshed < 1 minute ago.","files")()+"</span>",5e3);if(TS.web&&t){a.text(TS.interop.i18n.t("Reloading...","files")());TS.reload(false,"TS.files.onFileRefresh")}if(!t&&"file_deleted"===r.error){var s=TS.files.getFileById(i);s&&TS.files.removeFile(s.id)}},fileWasMaybeRefreshed:function e(t){if(!t)return;if(!TS.files.waiting_for_refresh[t.id])return;TS.files.doneRefreshingFile(t.id,'<span class="kelly_green">'+TS.interop.i18n.t("File refreshed!","files")()+"</span>",6e4)},startRefreshingFile:function e(t){TS.files.waiting_for_refresh[t]=true;$('.file_refresh[data-file-id="'+t+'"]').addClass("hidden");$('.file_refresh_status[data-file-id="'+t+'"]').removeClass("hidden")},doneRefreshingFile:function e(t,r,n){delete TS.files.waiting_for_refresh[t];$('.file_refresh_status[data-file-id="'+t+'"]').html(r);setTimeout(function(){$('.file_refresh[data-file-id="'+t+'"]').removeClass("hidden");$('.file_refresh_status[data-file-id="'+t+'"]').text(TS.interop.i18n.t("Refreshing file...","files")()).addClass("hidden")},n)},reShareConfirmation:function e(t,r){var n=t.map(function(e){return TS.interop.members.getPrefCompliantMemberNameById(e.user,true)});n=_.uniq(n);var i=TS.shared.legacyGetActiveModelOb();var a=TS.interop.rules.channels.isExternallySharedChannel(i);var s;var o;var l=TS.interop.rules.channels.getConnectedTeamIds(TS.redux.getState(),i);if(a&&(i.is_im||i.is_mpim||i.is_private)){s=TS.interop.i18n.t("Share private {file_count, plural, =1 {file} other {files}}?","files")({file_count:t.length});o=TS.interop.i18n.t("<p><strong>{user_names}</strong> {file_owners_count, plural, =1 {originally shared} other {originally shared}} {file_count, plural, =1 {this file} other {these files}} with you privately. If you share {file_count, plural, =1 {it} other {them}} here, {file_count, plural, =1 {the file} other {they}} could be shared with anyone from <strong>{workspace_name}</strong>.</p>","files")({user_names:TS.interop.i18n.safeString(TS.interop.i18n.listify(n).join("")),workspace_name:TS.interop.i18n.safeString(i.is_im?_.escape(TS.teams.getTeamNameByMemberId(i.user)):TS.interop.i18n.listify(_.map(l,TS.teams.getTeamNameById)).join("")),file_owners_count:n.length,file_count:t.length,file_title:1===t.length?TS.format.formatNoSpecials(t[0].title||"Untitled"):""})}else if(a&&i.is_channel){s=TS.interop.i18n.t("Share private {file_count, plural, =1 {file} other {files}}?","files")({file_count:t.length});o=TS.interop.i18n.t("<p><strong>{user_names}</strong> {file_owners_count, plural, =1 {originally shared} other {originally shared}} {file_count, plural, =1 {this file} other {these files}} with you privately. If you share {file_count, plural, =1 {it} other {them}} here, {file_count, plural, =1 {the file} other {they}} will be viewable by anyone from <strong>{workspace_names}</strong>.</p>","files")({user_names:TS.interop.i18n.safeString(TS.interop.i18n.listify(n).join("")),workspace_names:TS.interop.i18n.safeString(TS.interop.i18n.listify(_.map(l,TS.teams.getTeamNameById)).join("")),file_owners_count:n.length,file_count:t.length,file_title:1===t.length?TS.format.formatNoSpecials(t[0].title||"Untitled"):""})}else if(i.is_im){s=TS.interop.i18n.t("Share private {file_count, plural, =1 {file} other {files}} and {file_count, plural, =1 {its} other {their}} comments?","files")({file_count:t.length});o=TS.interop.i18n.t("<p><strong>{user_names}</strong> {file_owners_count, plural, =1 {originally shared} other {originally shared}} {file_count, plural, =1 {this file} other {these files}} with you privately. If you share {file_count, plural, =1 {it} other {them}} here, both the {file_count, plural, =1 {file} other {files}} and {file_count, plural, =1 {its} other {their}} comments will be viewable by <strong>{recipient_name}</strong>.</p>","files")({user_names:TS.interop.i18n.safeString(TS.interop.i18n.listify(n).join("")),recipient_name:TS.interop.i18n.safeString(TS.templates.builders.makeModelObNameForDisplay(i)),file_owners_count:n.length,file_count:t.length,file_title:1===t.length?TS.format.formatNoSpecials(t[0].title||"Untitled"):""})}else if(i.is_mpim){s=TS.interop.i18n.t("Share private {file_count, plural, =1 {file} other {files}} and {file_count, plural, =1 {its} other {their}} comments?","files")({file_count:t.length});o=TS.interop.i18n.t("<p><strong>{user_names}</strong> {file_owners_count, plural, =1 {originally shared} other {originally shared}} {file_count, plural, =1 {this file} other {these files}} with you privately. If you share {file_count, plural, =1 {it} other {them}} here, both the {file_count, plural, =1 {file} other {files}} and {file_count, plural, =1 {its} other {their}} comments will be viewable by everyone in this conversation.</p>","files")({user_names:TS.interop.i18n.safeString(TS.interop.i18n.listify(n).join("")),file_owners_count:n.length,file_count:t.length,file_title:1===t.length?TS.format.formatNoSpecials(t[0].title||"Untitled"):""})}else{s=TS.interop.i18n.t("Share private {file_count, plural, =1 {file} other {files}} and {file_count, plural, =1 {its} other {their}} comments?","files")({file_count:t.length});o=TS.interop.i18n.t("<p><strong>{user_names}</strong> {file_owners_count, plural, =1 {originally shared} other {originally shared}} {file_count, plural, =1 {this file} other {these files}} with you privately. If you share {file_count, plural, =1 {it} other {them}} here, both the {file_count, plural, =1 {file} other {files}} and {file_count, plural, =1 {its} other {their}} comments will be viewable by anyone in <strong>{channel_name}</strong>.</p>","files")({user_names:TS.interop.i18n.safeString(TS.interop.i18n.listify(n).join("")),channel_name:TS.interop.i18n.safeString(TS.templates.builders.makeModelObNameForDisplay(i)),file_owners_count:n.length,file_count:t.length,file_title:1===t.length?TS.format.formatNoSpecials(t[0].title||"Untitled"):""})}TS.generic_dialog.start({title:s,body:o,show_cancel_button:true,show_go_button:true,go_button_text:TS.interop.i18n.t("Share {file_count, plural, =1 {file} other {files}}","files")({file_count:t.length}),cancel_button_text:TS.interop.i18n.t("Cancel","files")(),onGo:r})},updateFileListItem:function e(t,r,n){var i=r.find('.file_list_item[data-file-id="'+t.id+'"]');if(i.length){i.replaceWith(TS.templates.builders.fileHTML(t,{viewContext:n}));TS.files.fileIsImage(t)&&r.find(".lazy").lazyload()}},containerHasFileListItem:function e(t,r){return!!r.find('.file_list_item[data-file-id="'+t.id+'"]').length},nonImageCanUseFSFV:function e(t){if(!t)return false;return TS.model.pdf_viewer_enabled&&"hosted"===t.mode&&TS.files.fileIsPDF(t)&&t.size<=5e7},maybePruneChannels:function e(t){if(!t)return;if(t.channels&&t.channel_map){var r=_(t.channel_map).map(function(e){return TS.interop.rules.channels.isOrgShared(e)||e.team===TS.model.team.id?e.id:void 0}).compact().value();t.channels=_.intersection(t.channels,r)}},getMessageListener:function e(t){return function(e){if(e.origin!==window.location.origin)return;if(e.data.method!==t.method)return;if(e.data.ok)t.resolve(e.data);else{var r=new Error(t.method+" not ok");r.data=e.data;t.reject(r)}}},clogCompleteUpload:function e(t){var r=t.ok,n=t.is_external,i=t.start_time,a=t.initial_comment,s=t.retry_num,o=t.error,l=t.metadata;var u=TS.interop.clogTypes.EventId;var d=TS.interop.clogTypes.FileUploadType;var c=r?u.FILE_COMPLETE_UPLOAD_SUCCESS:u.FILE_COMPLETE_UPLOAD_FAILURE;var _=n?d.EXTERNAL:d.ASYNC;var m=o?"Failed to upload file: "+o+".":void 0;var f=l&&l.fileUploadAction;var p=l&&l.fileUploadSrc;TS.interop.clog.track(c,{duration:new Date-i,type:_,has_upload_message:!!a,file_count:1,retry_count:s,file_upload_error_message:m,file_upload_action:f,file_upload_src:p})},test:function e(){return{_handleFileUploaded:a}}});var e=null;var t=20;var r=function e(t){if(!TS.files.fileIsImage(t))return;var r={width:t.thumb_360_w,height:t.thumb_360_h,link_url:t.url_private,internal_file_id:t.id};"gif"===t.filetype&&(t.deanimate_gif?TS.inline_imgs.makeInternalInlineImg(t.deanimate_gif,r):t.thumb_160&&TS.inline_imgs.makeInternalInlineImg(t.thumb_160,r));if(t.thumb_480_gif||t.thumb_360_gif){t.thumb_480_gif&&TS.inline_imgs.makeInternalInlineImg(t.thumb_480_gif,r);t.thumb_360_gif&&TS.inline_imgs.makeInternalInlineImg(t.thumb_360_gif,r)}else{t.thumb_720&&TS.inline_imgs.makeInternalInlineImg(t.thumb_720,r);t.thumb_480&&TS.inline_imgs.makeInternalInlineImg(t.thumb_480,r);t.thumb_360&&TS.inline_imgs.makeInternalInlineImg(t.thumb_360,r);t.thumb_pdf&&TS.inline_imgs.makeInternalInlineImg(t.thumb_pdf,r)}};var i=function e(t){var r=_.isString(t)?TS.files.getFileById(t):t;if(!_.isObject(r))throw new Error("Expected file or file ID.");return r};var a=function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t)return;var i=TS.files.getFileById(r);if(!i)return;if(TS.boot_data.feature_file_threads&&n.thread_ts){var a=n.channels;var s=n.thread_ts;TS.redux.dispatch(TS.interop.actions.requestOfflineHistory({channelId:a,threadTs:s}));n.broadcast&&TS.redux.dispatch(TS.interop.actions.requestOfflineHistory({channelId:a}))}else{var o=TS.interop.files.getFileShareLocations(i);o.forEach(function(e){return TS.redux.dispatch(TS.interop.actions.requestOfflineHistory({channelId:e}))})}};var o=function e(t){if(!t||!t.file)return;var r=t.file;var n=TS.interop.uploadQueue.getInstance();var i={channelId:_.first(t.channels),clientMsgId:TS.interop.utility.uuidv4(),link:t.link,introMessage:t.initial_comment,threadTs:t.thread_ts,broadcast:t.broadcast,isBox:t.is_box,isDropbox:t.is_dropbox};TS.redux.dispatch(TS.interop.actions.filterFilesForUpload({selectedFiles:[r]})).then(function(e){if(!e||!e.length)return;n.uploadFiles({files:e,shareData:i})})}})()},G4VQ:function(e,t){(function(){var e=10;var t=10;var r=100;var n=100;var i=33;var a=100;TS.registerComponent("SearchableEnterpriseTeamList",{_constructor:function e(t){this.id=t.id;this.triggered_by_user_action=t.triggered_by_user_action;this.$_container=t.$container;this.$_long_list_view;this.$_search_bar;this.$_search_input;this.$_clear_icon;this._team_searcher={};this._have_all_teams=false;this._model_ob_id=t.model_ob_id;this._omit_my_team=!!t.omit_my_team;this._current_query="";this._approx_item_height=30;this._long_list_view_height=0;this._long_list_view_items_height=0;this._long_list_view_initial_height=null;this._fetch_page_p=null;this._resize_sig_handler=null;this.team_clicked_sig=new signals.Signal},destroy:function e(){this.$_container.off();this.$_long_list_view&&this.$_long_list_view.off();this.$_search_input&&this.$_search_input.off();this.$_clear_icon&&this.$_clear_icon.off();this.$_long_list_view&&this.$_long_list_view.length&&$.data(this.$_long_list_view.get(0),"TS-longListView")&&this.$_long_list_view.longListView("destroy");this.$_search_bar&&this.$_search_bar.remove()},showInitial:function e(){var t=this;this.$_long_list_view=this.$_container.find(".p-searchable_enterprise_team_list__scroller");this._showLoadingState();this._fetchPage().then(function(){t._hideLoadingState()}).then(function(){t._setupLongListView();t._maybeSetupSearchBar();return null})},maybeRerenderLongListView:function e(){this.$_long_list_view&&_.get(this._team_searcher,"items")&&this.$_long_list_view.longListView("setItems",this._team_searcher.items,true,true)},_fetchPage:function e(){if(this._fetch_page_p)return this._fetch_page_p;var t=this;this._setupSearcher();this._fetch_page_p=TS.teams.promiseToSearchTeams(this._team_searcher).then(function(){t._fetch_page_p=null;t._have_all_teams=t._team_searcher.num_remaining<=0});return this._fetch_page_p},_setupSearcher:function e(){this._team_searcher.max_api_results=this._current_query?r:t;var n=TS.interop.utility.looksLikeMemberId(this._model_ob_id)?TS.interop.members.getMemberById(this._model_ob_id):TS.redux.channels.getEntityById(this._model_ob_id);this._team_searcher.included_ids=TS.interop.utility.looksLikeMemberId(_.get(n,"id"))?_.get(n,"enterprise_user.teams",[]):TS.interop.rules.channels.getInternalTeamIds(TS.redux.getState(),n);_.get(TS.model.user,"is_restricted")&&(this._team_searcher.included_ids=_.intersection(_.get(TS.model.user,"enterprise_user.teams"),this._team_searcher.included_ids));this._omit_my_team&&(this._team_searcher.omitted_ids=[TS.model.team.id]);this._current_query&&(this._team_searcher.query=this._current_query)},_fetchProcessAndDisplayPage:function e(){var t=this;return this._fetchPage().then(function(){t._maybeHideNoResultsState();_.get(t._team_searcher,"items.length")?t.$_long_list_view.longListView("setItems",t._team_searcher.items,true,true):t._showNoResultsState();return null}).then(function(){TS.utility.rAF(function(){t._long_list_view_height=t.$_long_list_view.height();t._long_list_view_items_height=t.$_long_list_view.find(".list_items").height();t._recursivelyFillLongListViewToHeight()});return null})},_maybeSetupSearchBar:function t(){var r=this;if(this.$_search_bar)return;var n=TS.interop.utility.looksLikeMemberId(this._model_ob_id)?TS.interop.members.getMemberById(this._model_ob_id):TS.redux.channels.getEntityById(this._model_ob_id);var i;i=TS.interop.utility.looksLikeMemberId(_.get(n,"id"))?_.get(n,"enterprise_user.teams.length"):_.get(n,"is_global_shared")?Infinity:TS.interop.rules.channels.getInternalTeamIds(TS.redux.getState(),n).length;if(i>=e){r.$_long_list_view.before(TS.templates.teams_search_bar());r.$_search_bar=r.$_container.find(".p-searchable_enterprise_team_list__search_bar");r.$_search_input=r.$_search_bar.find(".p-searchable_enterprise_team_list__input");r._setupSearchInput()}},_setupSearchInput:function e(){var t=this;this.$_search_bar.find(".p-searchable_enterprise_team_list__search.loading").replaceWith(TS.templates.teams_search_bar_input());this.$_search_input=this.$_search_bar.find(".p-searchable_enterprise_team_list__input");this.$_clear_icon=this.$_container.find(".icon_close");this.$_search_input.bind("keyup.searchable_enterprise_team_list",this._handleSearchKeyUp.bind(this));this.$_clear_icon.bind("click",function(){t._reset();Promise.resolve().then(function(){t.$_search_input.focus();return null})});this.triggered_by_user_action&&this.$_search_input.focus()},_setupLongListView:function e(){var t=this;var r=TS.interop.utility.looksLikeMemberId(this._model_ob_id);this.$_long_list_view.longListView({items:this._team_searcher.items||[],approx_item_height:this._approx_item_height,approx_divider_height:this._approx_divider_height,calcItemHeight:function e(t){return t.outerHeight()},makeElement:function e(){return $(TS.templates.teams_list_item())},renderItem:function e(n,i){var a=TS.model.team.id!==i.id;var s=r&&a;n.html(TS.templates.teams_team_row({team:i,linked:!!s&&t._buildTeamLink(i),target:s?t._buildTeamLinkTarget(i):""}));TS.utility.makeSureAllLinksHaveTargets(n)}});this.$_long_list_view.on("click","[data-long-list-item]",function(e){t.team_clicked_sig.dispatch(e,TS.teams.getTeamById($(e.target).closest(".p-enterprise_team_item").find("[data-team-id]").data("teamId")))});this._resize_sig_handler=_.throttle(function(){t._long_list_view_height=t.$_long_list_view.height();t._long_list_view_items_height=t.$_long_list_view.find(".list_items").height();t._long_list_view_initial_height||(t._long_list_view_initial_height=t._long_list_view_height)},i);this.$_long_list_view.on("scroll",_.debounce(function(e){if(t._current_query)return;var r=t._long_list_view_items_height-($(e.target).scrollTop()+t._long_list_view_height);r<n&&t._fetchProcessAndDisplayPage()},a));TS.utility.rAF(function(){t._recursivelyFillLongListViewToHeight()})},_recursivelyFillLongListViewToHeight:function e(){var t=this;if(this._current_query)return;this._long_list_view_items_height<=this._long_list_view_height&&!this._have_all_teams&&this._fetchProcessAndDisplayPage().then(function(){t._long_list_view_items_height=t.$_long_list_view.find(".list_items").height()})},_reset:function e(){this._team_searcher={};this._current_query="";this.$_search_input.val("");this.$_clear_icon.addClass("hidden");this._have_all_teams=false;this._maybeHideNoResultsState();this.$_long_list_view.longListView("setItems",[],true,true);this.$_long_list_view.scrollTop(0);this.$_long_list_view.height(this._long_list_view_initial_height);this._fetchProcessAndDisplayPage()},_showLoadingState:function e(){this.$_long_list_view.before(TS.templates.infinite_spinner({color:"white",size:"medium"}))},_hideLoadingState:function e(){this.$_container.find(".infinite_spinner").remove()},_showNoResultsState:function e(){var t=this.$_container.find(".no_results");t.length>0&&t.remove();var r=this;var n={query:this._current_query};var i=TS.templates.teams_searchable_no_results(n);this.$_long_list_view.hide().before(i);this.$_container.on("click",".clear_enterprise_team_filter",function(){r._reset()})},_maybeHideNoResultsState:function e(){var t=this.$_container.find(".no_results");if(0==t.length)return;var r=this.$_container.find(".other_matches");r&&r.remove();t.remove();this.$_long_list_view.show()},_handleSearchKeyUp:function e(t){var r=$(t.target).val();if(r.trim()!==this._current_query){if(this._fetch_page_p){this._fetch_page_p.cancel();this._fetch_page_p=null}this._team_searcher={};this._have_all_teams=false;this._current_query=r.trim();this._fetchProcessAndDisplayPage();this.$_long_list_view.scrollTop(0);this.$_clear_icon.toggleClass("hidden",!this._current_query)}},_buildTeamLink:function e(t){return TS.utility.enterprise.buildTeamUrl(t.domain)+"home"},_buildTeamLinkTarget:function e(t){return TS.utility.enterprise.buildTeamUrl(t.domain)},test:function n(){var i={};Object.defineProperty(i,"MINIMUM_TEAMS_FOR_SEARCH",{get:function t(){return e},set:function t(r){e=r}});Object.defineProperty(i,"FETCH_PAGE_SIZE",{get:function e(){return t},set:function e(r){t=r}});Object.defineProperty(i,"FETCH_PAGE_SIZE_SEARCH",{get:function e(){return r},set:function e(t){r=t}});return i}})})()},GNek:function(e,t){(function(){TS.registerModule("redux.reactions",{getReactionsForKey:function e(t){return TS.interop.redux.models.reactions.getReactionsForKey(TS.redux.getState(),t)},getReactionsForKeyAndName:function e(t,r){return TS.interop.redux.models.reactions.getReactionsForKeyAndName(TS.redux.getState(),t,r)},changeReactionFromUserAction:function e(t,r,n){return TS.redux.dispatch(TS.interop.redux.actions.changeReactionFromUserAction({key:t,name:r,adding:n}))},addOrRemoveReaction:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.adding,n=t.key,i=t.name,a=t.userId,s=t.url,o=t.fromUserAction;var l=TS.redux.reactions.getReactionsForKey(n);var u=r?TS.interop.redux.models.reactions.addReaction({key:n,name:i,userId:a,url:s,fromUserAction:o}):TS.interop.redux.models.reactions.removeReaction({key:n,name:i,userId:a,url:s,fromUserAction:o});var d=TS.redux.dispatch(u);var c="NOOP";var m=TS.redux.reactions.getReactionsForKey(n);d&&(m&&_.isEmpty(l)?c="ADDED":_.isEqual(l,m)||(c="CHANGED"));return{status:c,what_changed:[],rxns:m}},upsertReactions:function e(t,r,n){var i=TS.redux.reactions.getReactionsForKey(t);var a=TS.redux.dispatch(TS.interop.redux.models.reactions.upsertReactions({key:t,reactions:r,fromUserAction:n}));var s="NOOP";a&&(r&&_.isEmpty(i)?s="ADDED":_.isEqual(i,r)||(s="CHANGED"));return{status:s,what_changed:[],rxns:r}}})})()},GhNQ:function(e,t){(function(){TS.registerModule("attachment_actions",{action_triggered_sig:new signals.Signal,action_completed_sig:new signals.Signal,onStart:function e(){TS.attachment_actions.action_triggered_sig.add(t);TS.attachment_actions.action_completed_sig.add(r)},getActionContext:function e(t){var r=a(t);var n=TS.utility.msgs.findMsg(r.message_ts,r.channel_id);if(!n)return;var i=_.find(n.attachments,{id:r.attachment_id});if(!i)return;var s=_.find(i.actions,{id:r.action_id});if(!s)return;return{action:s,attachment:i,channel_id:r.channel_id,message:n}},handleActionEventAndGetContext:function e(t){var r=t.data("url");if(r){var n=r.match(/<(.*?)\|/);var i=n?n[1]:r;if(!i)return;if(0===i.indexOf(TS.utility.msgs.new_api_url_prefix))TS.utility.msgs.doNewApiUrl(i);else{var a=TS.model.isSSB()&&parseFloat(TS.model.desktop_app_version.major+"."+TS.model.desktop_app_version.minor)>=2.6;var s=TS.interop.url.parseUrl(r);TS.interop.url.isValidSlackHostName(s.hostname)&&"/oauth/authorize"===s.pathname&&a?TS.utility.openAuthenticatedInBrowser(s.pathname+s.search):TS.utility.openInNewTab(r,"_blank",{dontEncodeHash:true})}return}var o=TS.attachment_actions.getActionContext(t);return o},confirmAction:function e(t,r,n){var i="danger"===t.style?"btn_danger":"btn_primary";var a=_.defaults(t.confirm,{dismiss_text:TS.interop.i18n.t("Cancel","attachment_actions")(),ok_text:TS.interop.i18n.t("OK","attachment_actions")(),text:"",title:""});a.text?a.text=TS.emoji.graphicReplace(a.text):a.title||(a.text=TS.interop.i18n.t("Are you sure?","attachment_actions")());a.title&&(a.title=TS.emoji.graphicReplace(a.title));TS.generic_dialog.start({title:a.title,body:a.text,show_go_button:true,show_cancel_button:true,go_button_text:a.ok_text,go_button_class:i,cancel_button_text:a.dismiss_text,onGo:r,onCancel:n})},render:function e(t,r,n){if(!t||!r)return;var a=i(t,r);if(!a.length)return;if(!n||a.find(".attachment_actions_interactions").hasClass("attachment_pending")){var s=TS.templates.attachment_actions({attachment:t,message_ts:r});a.html(s);TS.attachment_actions.select.decorateNewElements(a)}},test:function t(){var r={};Object.defineProperty(r,"_getActionContextDataFromDOM",{get:function e(){return a},set:function e(t){a=t}});Object.defineProperty(r,"_getPendingAttachment",{get:function t(){return e},set:function t(r){e=r}});return r}});function e(e,t){if(!e||!t||!t.length)return;var r=_.map(t,"id");var n=_.cloneDeep(e);n.actions.forEach(function(e){e._disabled=true;e._loading=_.includes(r,e.id)});n._pending=true;return n}function t(t){if(!t||!t.message||!t.attachment||!t.action||!t.channel_id){TS.warn("_onActionTriggered: missing message, attachment, action, or channel_id");return}var r=e(t.attachment,[t.action]);r&&TS.attachment_actions.render(r,t.message.ts);var n=_.clone(t.action);delete n.options;var i={actions:[n],attachment_id:t.attachment.id,callback_id:t.attachment.callback_id,channel_id:t.channel_id,is_ephemeral:t.message.is_ephemeral,message_ts:t.message.ts};var a=_.get(t.message,"bot_profile.team_id",false);a&&(i.team_id=a);var s={payload:JSON.stringify(i),client_token:TS.interop.client_action_token.generateAndEnqueue()};t.message.bot_id&&(s.service_id=t.message.bot_id);t.message.user&&(s.bot_user_id=t.message.user);TS.interop.api.call("chat.attachmentAction",s).then(function(e){TS.attachment_actions.action_completed_sig.dispatch({attachment:t.attachment,message_ts:t.message.ts,channel_id:t.channel_id,is_expecting_ms_update:!!(_.get(e,"data.replaced")||_.get(e,"data.deleted"))})}).catch(function(e){TS.error(e);TS.attachment_actions.action_completed_sig.dispatch({attachment:t.attachment,message_ts:t.message.ts,channel_id:t.channel_id,err:e})})}function r(e){if(!e)return;e.attachment&&e.message_ts&&e.channel_id&&!e.is_expecting_ms_update&&n(e)}function n(e){TS.utility.rAF(function(){var t=TS.utility.attachments.findAttachment({attachment_id:e.attachment.id,message_ts:e.message_ts,channel_id:e.channel_id});t&&TS.attachment_actions.render(t,e.message_ts,true)})}function i(e,t){var r=TS.templates.makeMsgDomId(t);var n="#"+r+", #"+r+"_conversation";return $(n).find("[data-attachment-id="+e.id+"] .attachment_actions")}function a(e){var t=e.parents("[data-attachment-id]");var r=t.parents("ts-message");var n={action_id:String(e.data("action-id")||""),attachment_id:String(t.data("attachment-id")||""),channel_id:String(r.data("model-ob-id")||""),message_ts:String(r.data("ts")||"")};Object.keys(n).forEach(function(e){if(!n[e])throw new Error('Attachment is missing "'+e+'"')});return n}})()},GhXE:function(e,t,r){var n=r("cDf5");(function(){var e="STORAGE";TS.registerModule("storage",{version:"0.85",msgs_version:window.boot_data&&boot_data.cache_version||"unknown_version",cache_ts_version:window.boot_data&&boot_data.cache_ts_version||"unknown_version",do_compression:!TS.model.is_our_app&&"undefined"!==typeof window.Worker&&(!window.bowser||!bowser.phantom&&!bowser.msie),test:function e(){return{getLocalStorage:$,setLocalStorage:L,getKeys:y,set:j}},onStart:function t(){TS.storage.onStart=function(){};if(!TS.storage.do_compression){TS.interop.console.info(e,"Special case: force-enabling LS compression for this session.");TS.storage.do_compression=true}TS.storage.version+=TS.storage.do_compression?"-compressed-LZString":"";var r=s||!D||function(){if(!TS.storage.storageAvailable()){k();if(!TS.storage.storageAvailable()){TS.interop.console.info(e,"TS.storage.storageAvailable() = false in onStart after flushing all our keys, so disabling");return true}}return false}();if(TS.has_pri[U]){TS.log(U,"TS.storage.onStart should_disable:"+r);TS.log(U,"TS.storage.do_compression:"+TS.storage.do_compression+" (_ls.getItem('is_compressed') === 'yes'):"+(D&&"yes"===D.getItem("is_compressed")))}TS.ui.window_unloaded_sig.add(C);TS.ui.window_focus_changed_sig.add(M);TS.storage.setDisabled(r);j("rxn_records",null);var n=TS.storage.fetchExpandableState();TS.redux.dispatch(TS.interop.redux.features.expandables.bulkSetExpanded(n))},setDisabled:function e(t){if(s==t)return;if(t||!D){s=true;D&&k()}else{s=false;w()}TS.log(U,"_disabled:"+s)},storageAvailable:function e(){if(!D)return false;try{var t="test_to_see_if_we_can_write_to_local_storage";D.setItem(t,"foo");D.removeItem(t);return true}catch(e){return false}},storageSize:function t(r){var i=0;if(!D)return i;var a=y();var s=0;var o;var l;for(var u=0;u<a.length;u+=1){s+=1;o=a[u];l=D.getItem(o);if(l||""===l){i+=l.length;r&&TS.info(o+"="+(2*l.length/1024).toFixed(2)+"KB (total="+(i/1024).toFixed(2)+"KB)")}else TS.interop.console.info(e,o+" not measurable value, typeof:"+n(l))}r&&TS.info("total for "+s+" items is "+(i/1024).toFixed(2)+"KB");return i},completelyEmptyAllStorageAndReset:function e(){TS.info("completelyEmptyAllStorageAndReset running");x();TS.storage.storeLastEventTS("",true,true);var t=TS.storage.fetchLastEventTS(true);TS.info("completelyEmptyAllStorageAndReset fetched_b4_flush:"+t);if(t){TS.info("completelyEmptyAllStorageAndReset _getKeys:"+y().join(", "));TS.info("completelyEmptyAllStorageAndReset Object.keys(_buffer):"+Object.keys(l).join(", "))}O(true,"completelyEmptyAllStorageAndReset");var r=TS.storage.fetchLastEventTS(true);TS.info("completelyEmptyAllStorageAndReset fetched_after_flush:"+r);if(r){TS.info("completelyEmptyAllStorageAndReset _getKeys:"+y().join(", "));TS.info("completelyEmptyAllStorageAndReset Object.keys(_buffer):"+Object.keys(l).join(", "))}},flush:function e(t){TS.has_pri[U]&&TS.log(U,"TS.storage.flush()");k();t&&TS.storage.clearBufferAndCache()},clearBufferAndCache:function e(){TS.has_pri[U]&&TS.log(U,"TS.storage.clearBufferAndCache()");l={};u={};TS.compresion&&TS.compression.terminate()},fetchStorageVersion:function e(){return F("storage_version")},storeStorageVersion:function e(t){j("storage_version",t,true)},fetchCacheTSStorageVersion:function e(){return F("storage_cache_ts_version")},storeCacheTSStorageVersion:function e(t){j("storage_cache_ts_version",t,true)},_makeMsgInputId:function e(t){return"msg_input_"+t},fetchLastMsgInput:function e(t){var r=F(TS.storage._makeMsgInputId(t),null);if("\u4000"===r){TS.interop.utility.getLogger({getState:TS.redux.getState}).error({storage_version:TS.storage.fetchStorageVersion(),ts_storage_version:TS.storage.version,is_our_app:TS.model.is_our_app,typeof_window_worker:n(window.Worker),has_bowser:!!window.bowser},"decompress_general_compressed_fail");return""}return r},storeLastMsgInput:function e(t,r){j(TS.storage._makeMsgInputId(t),r)},legacyGetAllDraftChannelIds:function e(){var t=y().map(function(e){var t=e.match(/msg_input_(C|G|D)[A-Z0-9]{8,}$/);return t?e.split("_")[3]:void 0}).filter(function(e){return e&&!!TS.storage.fetchLastMsgInput(e)});return t||[]},_makeCommentInputId:function e(t){return"comment_input_"+t},fetchLastCommentInput:function e(t){return F(TS.storage._makeCommentInputId(t),null)},storeLastCommentInput:function e(t,r){j(TS.storage._makeCommentInputId(t),r)},fetchOldestTs:function e(t){return F(a(t),null)},storeOldestTs:function e(t,r){j(a(t),r)},fetchActiveHistory:function e(){return F("active_history",[])||[]},storeActiveHistory:function e(t){j("active_history",t,true)},fetchLastEventTS:function e(t){return F("last_event_ts","",t)||""},storeLastEventTS:function e(t,r,n){j("last_event_ts",t,r,n)},fetchUIState:function e(){var t=F("ui_state",{})||{};_.isString(t)&&(t={});return t},storeUIState:function e(t){j("ui_state",t)},fetchExpandableState:function e(){var t=F("expandable_state",{});return t&&"object"===n(t)?t:{}},storeExpandableState:function e(t){j("expandable_state",t)},fetchClientWindows:function e(){return F("client_windows",{})||{}},storeClientWindows:function e(t){j("client_windows",t)},fetchInputHistory:function e(){var t=F("input_history",[])||[];"string"===typeof t&&(t=[t]);var r=300;t.length>r&&(t.length=r);return t},storeInputHistory:function e(t){j("input_history",t)},fetchCustomEmoji:function e(){return F("custom_emoji",null)||null},storeCustomEmoji:function e(t){j("custom_emoji",t)},fetchStaticTranslations:function e(){return F("static_translations",null)||null},storeStaticTranslations:function e(t){j("static_translations",t)},fetchApps:function e(){return F("apps",null)||null},storeApps:function e(t){j("apps",t)},fetchAppsSearchResults:function e(){return F("apps_search",null)||null},storeAppsSearchResults:function e(t){j("apps_search",t)},fetchCmds:function e(){return F("cmds",null)||null},storeCmds:function e(t){j("cmds",t)},fetchChannelPageState:function e(){return F("channel_page_state",{})||{}},storeChannelPageState:function e(t){j("channel_page_state",t)},fetchInvitesState:function e(){return F("invites_state",[])||[]},storeInvitesState:function e(t){j("invites_state",t)},fetchReplyInput:function e(t,r){var n=F("reply_inputs")||[];var i=_.find(n,{model_ob_id:t,thread_ts:r});return i?i.text:""},storeReplyInput:function e(t,r,n){var i=10;var a=F("reply_inputs")||[];a=_.reject(a,{model_ob_id:t,thread_ts:r});a.length>i&&a.shift();a.push({model_ob_id:t,thread_ts:r,text:n});j("reply_inputs",a)},fetchFilterState:function e(){return F("team_filter_state","")||""},storeFilterState:function e(t){j("team_filter_state",t)},fetchCallsState:function e(){return F("calls_state",{})||{}},storeCallsState:function e(t){j("calls_state",t)},fetchFrecency:function e(t){return F("frecency_"+t)},storeFrecency:function e(t,r){j("frecency_"+t,r)},clearFrecency:function e(t){j("frecency_"+t,"")},fetchEnterpriseState:function e(){return F("enterprise_state",{})||{}},storeEnterpriseState:function e(t){j("enterprise_state",t)},fetchLastEKMChangeTimestamp:function e(){return F("last_ekm_change_ts","0")||"0"},storeLastEKMChangeTimestamp:function e(t){j("last_ekm_change_ts",t)}});var t=window.boot_data.user_id+"_";var r="channel_msgs_";var i="oldest_msg_ts_";var a=function e(t){return i+t};var s;var o=false;var l={};var u={};var d=1e3;var c=false;var m=1e3;var f=false;var p=1e3;var h=false;var g=false;var S=null;var T=3e5;var v=1e4;var b=1e3;var y=function e(){var t=[];if(!D)return t;var r=D.length;if(!r)return t;for(var n=0;n<r;n+=1)t.push(D.key(n));return t};var w=function r(){var n;if(!s){var i=TS.storage.fetchStorageVersion()||"";var a=-1!=i.indexOf("-compressed")||"yes"===D.getItem("is_compressed");if(TS.storage.do_compression&&!a){TS.interop.console.info(e,"migrating to compressed format");n=y();n.forEach(function(e){var r=e.replace(t,"");var n=H(e,D.getItem(e));var i="converting: "+e+" -> "+r+" val.length: "+(void 0===n||null===n?-1:String(n).length);j(r,null);j(r,n);F(r)==n?TS.has_pri[U]&&TS.log(U,i+" SUCCESS _get(name) has a value:"+!!F(r)+", and it it the same as val"):TS.error(i+" FAILURE _get(name) !== val")});TS.interop.console.info(e,"migration to compressed format complete, "+n.length+" migrated");TS.storage.storeStorageVersion(TS.storage.version)}else TS.has_pri[U]&&TS.log(U,"no migration needed");D.setItem("is_compressed",TS.storage.do_compression?"yes":"no")}var o=TS.storage.fetchCacheTSStorageVersion();TS.has_pri[U]&&TS.log(U,"storage_cache_ts_version:"+o);var l=TS.storage.fetchStorageVersion()||"";if(TS.has_pri[U]){TS.log(U,"TS.storage.version:"+TS.storage.version);TS.log(U,"storage_version:"+l);TS.log(U,"TS.storage last_unload_flushing: "+F("last_unload_flushing"));TS.log(U,"TS.storage.storageAvailable(): "+TS.storage.storageAvailable())}n=y();TS.has_pri[U]&&TS.dir(U,n,"_getKeys()");if(TS.storage.storageAvailable()){if(l!=TS.storage.version){TS.log(U,"storage_version:"+l+" does not match TS.storage.version:"+TS.storage.version+" so flushing all our keys: "+n.join(", "));k()}else if(!TS.storage.fetchLastEventTS()){TS.log(U,"TS.storage.fetchLastEventTS() is empty so flushing channel data");x()}}else{TS.log(U,"TS.storage.storageAvailable() = false so flushing all our keys");k()}TS.storage.storeStorageVersion(TS.storage.version);TS.redux.socket.connectedSig.addOnce(I)};var k=function e(){y().forEach(function(e){0===e.indexOf(t)&&D.removeItem(e)})};var x=function e(){var n=y();TS.has_pri[U]&&TS.log(U,n,"_getKeys()");var a;for(var s=0;s<n.length;s+=1){a=n[s];if(0!==a.indexOf(t))continue;if(-1==a.indexOf(r)&&-1==a.indexOf(i))continue;D.removeItem(a);delete l[a]}for(a in l){if(0!==a.indexOf(t))continue;if(-1==a.indexOf(r)&&-1==a.indexOf(i))continue;delete l[a]}u={};n=y();TS.dir(488,n,"_getKeys()")};var C=function e(){o=true;j("last_unload_flushing",(new Date).toString(),true);O(true,"_windowUnloaded");TS.compression.terminate()};var M=function e(){O(true,"_windowBlurred")};var I=function e(){if(S){window.clearInterval(S);S=null}S=window.setInterval(E,T)};var E=function e(){if(!TS.model)return;var t=Object.keys(l).length;if(!t)return;var r=false;var n="";if(!TS.model.ui.is_window_focused){n="window blurred!";r=true}var i=Date.now()-TS.model.client.last_user_active_timestamp;if(!r&&i>=v){n="window focused, but user has been idle long enough "+i+" >= "+v;r=true}TS.has_pri[U]&&TS.log(U,"_maybeFlushBuffer ok_to_flush_all:"+r);if(r){O(true,"maybeFlushBuffer ("+t+") "+n);return}var a=i>b;TS.has_pri[U]&&TS.log(U,"_maybeFlushBuffer ok_to_flush_some:"+a);n="window focused, but user has been idle long enough "+i+" >= "+b;a&&O(false,"maybeFlushBuffer ("+t+") "+n)};var A=function e(t){return"string"!==typeof t&&"number"!==typeof t&&t?JSON.stringify(t):t};var P=function e(t){if("undefined"===t)return null;if("null"===t)return null;return t};var O=function e(t,r){if(s)return;var n=new Date;var i=Date.now();var a;var o=0;var d;var c=TS.model&&TS.model.team&&TS.model.team.domain&&TS.boot_data.feature_tinyspeck;var _;var m;var f;var S;var T;for(d in l){if(l[d].being_flushed)continue;S=A(l[d].val);if(void 0===S||null===S){D.removeItem(d);delete l[d];delete u[d]}else try{R(d,S)}catch(e){TS.error(0,e);k();delete l[d];delete u[d];continue}o+=1;a=Date.now()-i;c&&TS.has_pri[U]&&TS.log(U,"_flushBuffer _ls.setItem "+d+": "+a+"ms "+(l[d]&&l[d].val&&l[d].val.toString?l[d].val.toString().substr(0,100):"NULL?"));if(!t){_=new Date-n;if(!h&&_>p){h=true;f=new Date;try{m=TS.storage.storageSize()}catch(e){}f=new Date-f;T="Took "+_+"ms for "+o+" item (!all case) (threshold is "+p+" ms). Key: "+d+". Buffer length: "+(l[d]&&l[d].val&&l[d].val.toString()?l[d].val.toString().length:"unknown (not a string)")+". localStorage size: "+(m||"unknown")+". Time to read LS size: "+f;TS.info("_flushBuffer exceeded slow write threshold: "+T)}}l[d]&&(l[d].being_flushed=true);if(!t){TS.has_pri[U]&&TS.log(U,"_flushBuffer: Wrote one item. why: "+r);return}u={}}if(o&&!g){_=new Date-n;if(_>p){g=true;try{m=TS.storage.storageSize()}catch(e){}T="Took "+_+"ms for "+o+" items (threshold is "+p+" ms). localStorage size: "+m+". App open for "+((Date.now()-TS.boot_data.start_ms)/1e3/60).toFixed(2)+" min. why: "+r;TS.info("_flushBuffer exceeded slow write threshold (all case): "+T)}}TS.has_pri[U]&&(0===o?TS.log(U,"_flushBuffer: Nothing to save."):TS.log(U,"_flushBuffer: Saved "+o+(1===o?" item":" items")+" why: "+r))};var F=function e(r,n,i){var a=t+r;i&&TS.info("_get name:"+r+" k:"+a+" disabled:"+s+' _buffer["'+a+'"].val:'+(l[a]&&l[a].val));if(s)return l[a]&&l[a].val||n;if(a in l)return l[a]&&l[a].val||n;if(u.hasOwnProperty(a))return u[a];var o=H(a,B(a,D.getItem(a)),n,i);u[a]=o;return o};var H=function e(t,r,i,a){var s=new Date;var o=P(r);a&&TS.info("_get _correctBadValsFromStorage(_ls.getItem(k)) k:"+t+" typeof result:"+n(o)+" /^[{[]/.test(result):"+/^[{[]/.test(o));var l;o&&"string"===typeof o&&/^[{[]/.test(o)&&(o=TS.utility.parseJSONOrElse(o)||o);o=o||(void 0!==i?i:null);s=new Date-s;if(!c&&s>d){c=true;try{l=TS.storage.storageSize()}catch(e){}var u="_get took longer than threshold: Took "+s+"ms to read "+t+" (theshold is "+d+"ms), length = "+(o&&!isNaN(o.length)?o.length:"unknown")+". Storage size: "+l;TS.info(u)}return o};var j=function r(n,i,a,o){var d=false;var c=new Date;var _;var p=t+n;l[p]={val:i,being_flushed:false};u[p]=l[p].val;o&&TS.info("_set immediate:"+a+" name:"+n+" k:"+p+" disabled:"+s+" do_compression:"+TS.storage.do_compression+' _buffer["'+p+'"].val:'+l[p].val);if(a){if(!s){var h=A(i);if(void 0===h||null===h){D.removeItem(p);delete l[p]}else try{R(p,h,a)}catch(e){TS.interop.console.warn("_set _ls.setItem failed, flushing. TS.storage.storageSize():"+TS.storage.storageSize(false));d=true}}o&&TS.info("_set failed:"+d);if(!d){o&&TS.info('_set _buffer["'+p+'"]:'+(l[p]&&JSON.stringify(l[p])));c=new Date-c;if(c>m){TS.interop.console.info(e,"_set immediately "+n+": "+c+"ms "+(i&&i.toString?i.toString().substr(0,100):"NULL?"));if(!f){f=true;try{_=TS.storage.storageSize()}catch(e){}var g="_set exceeded slow set threshold (immediate): Took "+c+"ms to write "+p+" (theshold is "+m+"ms), length = "+(i&&!isNaN(i.length)?i.length:"unknown")+". Storage length: "+_;TS.info(g)}}else TS.has_pri[U]&&TS.log(U,"_set GOOD immediately: "+a+" "+n+": "+c+"ms",i)}}};var D=window.localStorage;var $=function e(){return D};var L=function e(t){D=t};var R=function e(t,r,n){r=String(r);if(TS.storage.do_compression){TS.compression.compress(t,r,n||o,N);return}N({k:t,str:r})};var N=function t(r){D.setItem(r.k,r.str);var i=function t(i){var a=D.getItem(r.k);if(a===r.str){i>1&&TS.interop.console.info(e,r.k+" now saved, try #"+i);delete l[r.k];delete u[r.k];return}if(i>1&&(!l[r.k]||l[r.k].val!=r.str)){TS.error("buffer changed for "+r.k+" so we don't care anymore, a new value is being set for it, try #"+i);return}TS.error("WTF not saved, try #"+i+" "+r.k+" "+(r.str||"").length+" typeof ob.str:"+n(r.str)+" from_ls:"+n(a));D.setItem(r.k,r.str);setTimeout(t,1e3,i+1)};i(1)};var B=function e(t,r){if(!TS.storage.do_compression){if("\u4000"===r){TS.interop.utility.getLogger({getState:TS.redux.getState}).error({storage_version:TS.storage.fetchStorageVersion(),ts_storage_version:TS.storage.version,is_our_app:TS.model.is_our_app,typeof_window_worker:n(window.Worker),has_bowser:!!window.bowser},"decompress_empty_string_fail");return""}return r}var i=Date.now();r&&(r=LZString.decompress(r));var a=Date.now()-i;r&&TS.has_pri[U]&&TS.log(U,t+" took "+a+"ms to _decompress str.length: "+r.length);if("\u4000"===r){TS.interop.utility.getLogger({getState:TS.redux.getState}).error({storage_version:TS.storage.fetchStorageVersion(),ts_storage_version:TS.storage.version,is_our_app:TS.model.is_our_app,typeof_window_worker:n(window.Worker),has_bowser:!!window.bowser},"decompress_double_compressed_fail");return""}return r};var U=488})()},HUaD:function(e,t){(function(){TS.registerModule("enterprise.workspaces",{onStart:function e(){},joinTeam:function e(r){var n=TS.teams.getTeamById(r);if(!n)return TS.generic_dialog.alert(TS.interop.i18n.t("Invalid workspace","enterprise_dashboard")(),TS.interop.i18n.t("Oops! Something went wrong.","enterprise_dashboard")());if(!n.is_open&&!n.is_assigned)return TS.generic_dialog.alert(TS.interop.i18n.t("This workspace is not available to join.","enterprise_dashboard")(),TS.interop.i18n.t("Oops! Something went wrong.","enterprise_dashboard")());var i={team:n.id};"client"===TS.boot_data.app&&(i.enterprise_token=TS.model.enterprise_api_token);var a=function e(r,n,i){var a=TS.teams.getTeamById(i.team);var s=new Handlebars.SafeString(emoji.replace_colons(":sparkles:")+TS.interop.i18n.t(" You\u2019ve successfully joined <strong>{team_name}</strong>","enterprise_dashboard")({team_name:TS.interop.i18n.safeString(_.escape(TS.interop.rules.teams.getTeamDisplayName(a)))}));if(r){TS.redux.teams.upsertTeam(_.merge({},TS.teams.getTeamById(i.team),{joined_date:n.joined_date}));t("success",s);return true}if("user_already_team_member"===n.error){t("success",s);return true}if("team_is_not_open"===n.error){t("error",TS.interop.i18n.t("This workspace is not open to join.","enterprise_dashboard")());return false}t("error",TS.interop.i18n.t('Joining workspace failed with error "{error}"',"enterprise_dashboard")({error:n.error}));return false};return TS.interop.api.call("enterprise.teams.join",i).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;a(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;a(i,t,r,n);return{data:t,args:r,request_id:n}})},requestToJoinTeam:function e(r,n){var i={team:r};n&&(i=_.merge({},i,n));"client"===TS.boot_data.app&&(i.enterprise_token=TS.model.enterprise_api_token);var a=function e(r,n,i){var a=TS.teams.getTeamById(i.team);var s=new Handlebars.SafeString(TS.interop.i18n.t("Request to join <strong>{team_name}</strong> sent!","enterprise_dashboard")({team_name:TS.interop.i18n.safeString(_.escape(TS.interop.rules.teams.getTeamDisplayName(a)))}));if(r){TS.redux.teams.upsertTeam(_.merge({},TS.teams.getTeamById(i.team),{has_join_request:true}));t("success",s);return true}t("error",TS.interop.i18n.t("Your request couldn\u2019t be sent. Try again later, or contact the Workspace Admin for help.","enterprise_dashboard")({error:n.error}));return false};return TS.interop.api.call("enterprise.teams.joinrequests.create",i).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;a(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;a(i,t,r,n);return{data:t,args:r,request_id:n}})},createLogoutURL:function e(t,r){var n=document.createElement("a");n.href=r;var i=n.protocol+"//"+n.host+"/signout/"+t+n.search+n.hash;n=null;return i},recordTeamLeave:function t(r,n,i){i||(i="");var a={anchor_page:n,entity_key:"leave_workspace",target_team_id:r,tracking_code:i};var s={action:"click",action_status:1};TS.interop.clog.track(e,_.assign({},a,{contexts:{ui_context:s}}))},recordTeamLeaveConfirm:function t(r,n,i){i||(i="");var a={anchor_page:n,entity_key:"leave_workspace_confirm",target_team_id:r,tracking_code:i};var s={action:"click",action_status:1};TS.interop.clog.track(e,_.assign({},a,{contexts:{ui_context:s}}))},showRequestDialog:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.displayModernToast,n=void 0===r?_.noop:r;var i="#generic_dialog";var a=".dialog_go";var s="enterprise.teams.creationrequests.create";var o="#input_ws_team_name";var l="#textarea_ws_team_message";var u;var d;function c(){var e=$(i);var t=e.find(a);if(u&&d){t.removeAttr("disabled");return true}t.attr("disabled",true);return false}TS.generic_dialog.start({title:TS.interop.i18n.t("Request creation of a new workspace","enterprise_workspaces")(),body:TS.templates.ws_request_dialog(),show_cancel_button:true,show_go_button:true,go_button_text:TS.interop.i18n.t("Send Request","enterprise_workspaces")(),onGo:function e(){var t=$(i);var r=$(o);var u=_.escape(r.val());var d=$(l);var c=d.val();var m=t.find(a);m.addClass("ladda-button");m.attr("data-style","expand-right");var f=Ladda.create(m[0]);f.start();var p={name:_.unescape(u),reason:c};"client"===TS.boot_data.app&&(p.enterprise_token=TS.model.enterprise_api_token);TS.interop.api.callExpedited(s,p).then(function(){n({type:"success",teamName:u});TS.generic_dialog.end();TS.generic_dialog.cancel()}).catch(function(e){if(!e||!e.data){TS.error("WTF: error, but no response or data on "+s+"?",e);return}var t=e.data;n({type:"error",errorType:t.error,teamName:u});TS.error(s+" failed with error: "+(t.error||"undefined"));f.stop()});return false}});$(o).on("keyup change",function(){u=TS.ui.validation.validate($(o));c()});$(l).on("keyup change",function(){d=TS.ui.validation.validate($(l));c()});$(o).focus();$(i).find(a).attr("disabled",true)}});var e="ENTERPRISE_DISCOVER_WORKSPACES";var t=function e(t,r){TS.ui.toast.show({type:t,message:r})}})()},HfRC:function(e,t){(function(){TS.registerModule("rxns",{rxn_records_changed_sig:new signals.Signal,member_rxns_fetched_sig:new signals.Signal,member_rxns_being_fetched_sig:new signals.Signal,need_alerts:{},upsertRxnsFromDataAndUpdateUI:function e(t,r){var n=l(t,r);"NOOP"!==n.status&&s(t);return n},getRxnKey:function e(t,r,n){"message"!==t||n||TS.error("getRxnKey: no c_id provided for message rxn_key");"message"!==t&&n&&TS.error("getRxnKey: c_id provided for but this is not a message rxn_key");return t+"-"+r+"-"+(n||"")},getRxnKeyByMsgType:function e(t){var r;if("file_upload"===t.subtype||"file_share"===t.subtype||"file_mention"===t.subtype||"file_reaction"===t.subtype){if(t.file){var n=t.file;_.isString(n)&&(n=TS.files.getFileById(n));r=n&&n._rxn_key}}else"file_comment"===t.subtype?t.comment&&(r=t.comment._rxn_key):r=t._rxn_key;return r},getRxnKeyFromData:function e(t){var r;if("message"===t.type)r=t.ts||t.message.ts;else if("file"===t.type)r=t.file.id||t.file;else{if("file_comment"!==t.type)throw new Error("item.type not handled");r=t.file_comment||t.comment.id}return TS.rxns.getRxnKey(t.type,r,t.channel)},getExistingRxnsByKey:function e(t){var r=TS.redux.reactions.getReactionsForKey(t);return r&&r.length?r:null},getRxnRecordByKey:function e(t){if(n[t])return n[t];for(var i=r.length-1;i>-1;i-=1)if(r[i].rxn_key===t){n[t]=r[i];return n[t]}return null},getNextRxnRecordThatNeedsAlert:function e(){var t;for(var n=r.length-1;n>-1;n-=1){if(!TS.rxns.need_alerts[r[n].rxn_key])break;t=r[n]}return t},getRxnsFromData:function e(t){if("message"===t.type)return t.message&&t.message.reactions;if("file"===t.type)return t.file&&t.file.reactions;if("file_comment"===t.type)return t.comment&&t.comment.reactions;return null},doesRxnsHaveRxnFromMember:function e(t,r,n){var i=TS.emoji.nameToCanonicalName(r);if(!t)return false;var a=TS.rxns.getRxnFromRxns(t,r)||TS.rxns.getRxnFromRxns(t,i);if(!a)return false;if(!a.count)return false;if(!a.users)return false;return-1!==a.users.indexOf(n)},doesRxnsHaveRxnFromUser:function e(t,r){return TS.rxns.doesRxnsHaveRxnFromMember(t,r,TS.model.user.id)},doesRxnsHaveRxn:function e(t,r){if(!t)return false;return!!TS.rxns.getRxnFromRxns(t,r)},doesRxnsHaveSkinlessRxn:function e(t,r){if(!t)return false;var n=[r.replace(/(::skin-tone-[2-6])/,"")];TS.emoji.spliceSkinToneVariationsIntoAnArrayOfEmojiNames(n);for(var i=0;i<n.length;i+=1)if(TS.rxns.getRxnFromRxns(t,n[i]))return true;return false},countAllRxns:function e(t){if(!t)return 0;var r=0;t.forEach(function(e){r+=e.count||0});return r},countAllEmoji:function e(t){if(!t)return 0;return t.length},countAllUsersRxns:function e(t,r){if(!t)return 0;var n=0;t.forEach(function(e){e.users.indexOf(r)>-1&&(n+=1)});return n},getAllUniqueRxners:function e(t,r){if(!t)return[];var n=[];t.forEach(function(e){if(!e)return;if(!e.count)return;if(!e.users)return;e.users.forEach(function(e){if(r==e)return;if(-1!=n.indexOf(e))return;n.push(e)})});return n},getRxnFromRxns:function e(t,r){if(!t)return null;return t.filter(function(e){return e.name==r})[0]||null},changeRxnsFromUserAction:function e(t,r,n){return TS.redux.reactions.changeReactionFromUserAction(t,r,n).catch(function(e){[p,f].indexOf(e.message)>-1?m(e.message):e.message===h&&TS.warn("Attempted to add/remove invalid emoji and the API complained: "+r)})},checkForRxnClick:function e(t){if(!t||!t.target)return;var r=$(t.target);var n=r.closest(".rxn");if(!n.length)return;var i=String(n.data("emoji"));var a=r.closest(".rxn_panel");var s=a.data("rxn-key");var o=n.hasClass("is_handy");var l;if(n.hasClass("menu_rxn"))TS.ui.react_emoji_menu.start({e:t,rxn_key:s});else{l=!n.hasClass("user_reacted");if(!l&&t.shiftKey)g(s);else{var u=o&&TS.emoji.isNameSkinToneModifiable(i)?":"+TS.emoji.getChosenSkinToneModifier():"";TS.rxns.changeRxnsFromUserAction(s,i+u,l)}}},getRxnRecords:function e(){return r},getRxnKeyParts:function e(t){var r=t.split("-");return{type:r[0],id:r[1],c_id:r[2]}},test:function e(){return{updateUI:a,addOrRemoveRxnFromRxns:o,upsertRxnsFromData:l,incrementPendingCnt:u,decrementPendingCnt:d,fetchAndUpdateRxns:c,displayTooManyError:m,TOO_MANY_REACTIONS:f,TOO_MANY_EMOJI:p}},clearHandyRxnsDisplayDataCache:function e(){t=void 0},getMemberRxnsFromMessage:function e(t,r){if(!t||!r)return;var n=TS.rxns.getRxnKeyByMsgType(t);if(!n)return;var i=TS.rxns.getExistingRxnsByKey(n);if(!i)return;var a=i.filter(function(e){return _.includes(e.users,r)});return a},getHandyRxnsDisplayDataByRxnKey:function r(){if(!t){t={items:{}};var n=e;n.forEach(function(e){var r=TS.emoji.isNameSkinToneModifiable(e)?TS.emoji.getChosenSkinToneModifier():"";var n=":"+e+":"+r;t.items[e]={html:new Handlebars.SafeString(TS.emoji.graphicReplace(n,{no_skin_tone_squares:true})),name:n,names:n}})}return t},legacyUpdateUI:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.key,n=t.name,i=t.userId,o=t.type,l=t.shouldThrottle;l?s(r,o):a(r,n,i,o)}});var e=["slightly_smiling_face","+1","heavy_check_mark","heart","eyes"];var t;var r=[];var n={};var i={};var a=function e(t,r,n,i){TS.templates.builders.updateRxnPanels(t,r,n);"file"===i&&TS.log("(Temporary) Rebuilding mentions due to file reaction.")};var s=function e(t,r){a(t,void 0,void 0,r)};var o=function e(t,r,n,i,a){var s=TS.rxns.getRxnFromRxns(r,n);if(t)s?TS.utility.ensureInArray(s.users,i)&&(s.count+=1):r.push({users:[i],count:1,name:n,url:a});else if(s){var o=s.users.indexOf(i)>=0;if(o){_.pull(s.users,i);s.count-=1;(s.count<1||0===s.users.length)&&_.pull(r,s);r.length||(r=null)}}return r};var l=function e(t,r){var n=false;return TS.redux.reactions.upsertReactions(t,r,n)};var u=function e(t){if(!t)return;i[t]=i[t]||0;i[t]+=1;TS.has_pri[S]&&TS.log(S,"_incrementPendingCnt "+t+": "+i[t])};var d=function e(t){if(!i[t]){TS.has_pri[S]&&TS.log(S,"_decrementPendingCnt "+t+": "+i[t]);return}i[t]-=1;0===i[t]&&delete i[t];TS.has_pri[S]&&TS.log(S,"_decrementPendingCnt "+t+": "+i[t])};var c=function e(t){u(t);TS.redux.dispatch(TS.interop.reactions.fetchReactions({reactionKey:t})).then(function(e){d(t);var r=TS.rxns.getRxnsFromData(e);var n=l(t,r);TS.has_pri[S]&&TS.dir(S,n,"_fetchAndUpdateRxns upsert status:"+n.status);if("NOOP"===n.status)return;a(t)}).catch(function(){d(t);TS.error("_fetchAndUpdateRxns got an err")})};var m=function e(t){var r=TS.interop.i18n.t("You\u2019ve reached the reaction limit","rxns")();var n=[TS.interop.i18n.t("For reasons of performance and productivity and brevity being the soul of wit, you can add up to 23 emoji to a message, but no more.","rxns")(),TS.interop.i18n.t("Well done! You\u2019ve added the maximum amount of emoji one person can add to one message. For reasons of performance, productivity and sharpened creative thinking, we cap the number of individual reacji to 23.","rxns")(),TS.interop.i18n.t("Emotions! We all have them \u2014 but on Slack, you\u2019re limited to 23 reactions per message.","rxns")()];var i=[TS.interop.i18n.t("The human heart is a powerful thing; its capacity to feel is limitless! A message\u2019s capacity is 50.","rxns")(),TS.interop.i18n.t("Alas! Slack only allows each message a grand total of 50 emoji reactions.","rxns")(),TS.interop.i18n.t("A single message can\u2019t have more than 50 unique reactions. When we asked the engineers why they said, \u201cwe have to set limits somewhere,\u201d and then we tried to frown but this error popped up. So that\u2019s where we\u2019re at.","rxns")()];if(t==f){var a=_.sample(n);TS.generic_dialog.alert('<p class="no_bottom_margin">'+a+"</p>",r)}else if(t==p){var s=_.sample(i);TS.generic_dialog.alert('<p class="no_bottom_margin">'+s+"</p>",r)}};var f="too_many_reactions";var p="too_many_emoji";var h="invalid_name";var g=function e(t){var r=TS.rxns.getExistingRxnsByKey(t);if(!r)return;r.forEach(function(e){if(!TS.rxns.doesRxnsHaveRxnFromUser(r,e.name))return;TS.rxns.changeRxnsFromUserAction(t,e.name,false)})};var S="888"})()},HtJm:function(e,t,r){(function(){TS.registerModule("templates.builders.msgs",{buildHTML:function r(n,i){i&&TS.dir(0,n);try{var a=n.msg;var s=n.model_ob;var o=n.prev_msg;var l=!!n.highlight;var u=!!n.no_attachments;var d=!!n.standalone;var c=!!(d||n.hide_actions);var m=!!n.full_date;TS.prefs.getPref("fuller_timestamps")&&!m&&(m=a.ts&&!TS.interop.datetime.isSameDay(TS.interop.datetime.toDateObject(a.ts),new Date));var f=!!n.relative_ts;var p=n.jump_link?new Handlebars.SafeString(n.jump_link):"";var h=!!n.starred_items_list;var g=n.starred_items_actions;var S=n.container_id?"#"+n.container_id:"";var T=!!n.enable_slack_action_links;var v=!!(n&&n.highlight_as_new);var b="";var y=TS.utility.members.getEntityFromMessage(a);var w=true;var k=a.ts&&TS.interop.datetime.toDateObject(a.ts);var x=false;var C=false;var M=!!a.is_pending;var I=a.user;var E;var A=a.is_ephemeral;var P=TS.templates.makeMsgDomId(a.ts);var O=TS.utility.msgs.getMsgActions(a,s);var F=TS.utility.msgs.isEKMAccessDeniedMessage(a);var H=!!a.blocks&&!TS.interop.rules.messages.isRichTextMessage(a);if(!a.blocks&&a.attachments)for(var j=0,D=a.attachments;j<D.length;j++)if(D[j].blocks){H=true;break}I||(I=TS.templates.builders.getBotIdentifier(a));var L=TS.utility.msgs.shouldHaveBotLabel(a,y);var R;var N;var B;var U;P=n.msg_dom_id||P;var q=!!n.is_in_conversation;var G=!!n.is_threads_view;var W=TS.interop.constants.MESSAGE_CONTAINERS.UNREAD_VIEW;h?W=TS.interop.constants.MESSAGE_CONTAINERS.STARS_FLEXPANE:G?W=TS.interop.constants.MESSAGE_CONTAINERS.THREADS_VIEW:n.for_mention_display?W=TS.interop.constants.MESSAGE_CONTAINERS.ACTIVITY_FLEXPANE:n.highlight_items_list&&(W=TS.interop.constants.MESSAGE_CONTAINERS.HIGHLIGHTS_FLEXPANE);false;if(L){var z=TS.interop.bots.getBotInfoByMsg(a);if(z){R=_.get(z,"appId");N=_.get(z,"botId");B=_.get(z,"teamId")?z.teamId:_.get(a,"source_team_id")}U=true}if(o){E="file_comment"===o.subtype&&o.comment?o.comment.user:o.user;E||(E=TS.templates.builders.getBotIdentifier(o))}if(!a.no_display&&!d)if(o){var K=o.ts&&TS.interop.datetime.toDateObject(o.ts);a.subtype&&"file_comment"===a.subtype&&a.comment&&(I=a.comment.user);var V=TS.interop.rules.messages.isAutomatedSubtype(a.subtype);if(V||"thread_broadcast"===a.subtype)w=true;else if(E==I&&!V)if(!a.subtype&&o.subtype&&"file_comment"===o.subtype)w=true;else{if(!o.subtype||TS.templates.builders.getBotIdentifier(o)){var Y=o.thread_ts||o.ts;var J=a.thread_ts==Y;var Q=!a.thread_ts&&!o.thread_ts;(J||Q)&&(w=false)}!TS.interop.rules.messages.isTempMsg(a)||"bot_message"!==a.type&&"USLACKBOT"!==a.user||(w=true)}if(!M&&k&&K&&!TS.interop.datetime.isSameDay(k,K)&&!q){x=true;var X=$(S+" div.day_divider");if(X.length>0){var Z;var ee=$(X[X.length-1]);if(ee.length){Z="";try{Z=TS.templates.messages_day_divider({ts:ee.data("ts")})}catch(e){e.message||(e.message="");e.message+=" $last_divider.data('ts'):"+ee.data("ts");TS.info("Problem with TS.templates.messages_day_divider 2.1: "+JSON.stringify(e))}ee.replaceWith(Z)}if(X.length>1){var te=$(X[X.length-2]);if(te.length){Z="";try{Z=TS.templates.messages_day_divider({ts:te.data("ts")})}catch(e){e.message||(e.message="");e.message+=" $second_last_divider.data('ts'):"+te.data("ts");TS.info("Problem with TS.templates.messages_day_divider 3.1: "+JSON.stringify(e))}te.replaceWith(Z)}}}}!M&&TS.interop.datetime.distanceInMinutes(k,K)>TS.model.msg_activity_interval&&(C=true)}else q||(C=true);C&&(w=true);"message"!==a.type&&(w=true);("me_message"===a.subtype||o&&"me_message"===o.subtype)&&(w=true);var re=true;d&&(re=false);var ne=false;var ie=TS.rxns.getExistingRxnsByKey(a._rxn_key);ie&&(ne=true);n.for_mention_rxn_display&&(w=false);c=!!(c||M);if(F){c=true;d=false}var ae={msg:a,model_ob:s,member:y,actions:O,show_user:w,unprocessed:M,highlight:l,do_inline_imgs:re,msg_dom_id:P,standalone:d,hide_actions:c,full_date:m,relative_ts:f,jump_link:p,show_resend_controls:a.ts in TS.model.display_unsent_msgs,starred_items_list:h,starred_items_actions:g,no_attachments:u,is_ephemeral:A,enable_slack_action_links:T,is_bot:L,bot_id:N,app_id:R,team_id:B,is_app_data_enabled:U,highlight_as_new:v,show_star:false,has_rxns:ne,for_mention_display:n.for_mention_display,for_mention_rxn_display:n.for_mention_rxn_display,for_search_display:n.for_search_display,for_top_results_search_display:n.for_top_results_search_display,ts_tip_delay_class:"ts_tip_delay_600",is_root_msg:n.is_root_msg,is_in_conversation:q,is_threads_view:G,file_title_only:"file_reaction"===a.subtype,is_slackbot_response:"slackbot_response"===a.subtype,is_ekm_denied_message:F,is_ekm_error:a.isEKMError,show_block_kit_error:H,hide_msg_text:!!a.blocks&&!TS.interop.rules.messages.isRichTextMessage(a)};var se=TS.utility.msgs.getFilesOnMsg(a);var oe=_.first(se);(O.add_rxn||O.add_file_rxn||O.add_file_comment_rxn)&&(ae.show_rxn_action=true);ae.star_components=TS.templates.builders.buildStarComponents("message",a,s);var le=true;d&&(le=false);TS.interop.rules.messages.isFile(a)&&(le=false);ae.selectable=le;q&&(ae.msg_dom_id=TS.templates.makeMsgDomIdInConversation(a.ts));if(TS.interop.messages.isReply(a))ae.show_reply_action=false;else{ae.show_reply_action=false;!ae.show_reply_action&&TS.interop.rules.messages.isFile(a)&&oe&&(ae.show_comment_action=true)}var ue=a.ts==a.thread_ts;!ue||!a.reply_count||q||d||n.for_search_display||n.for_top_results_search_display||n.is_threads_view||(ae.show_reply_bar=true);ae.is_tombstone="tombstone"===a.subtype;ae.is_new_reply=!!n.is_new_reply;if(TS.interop.messages.isReply(a)&&"thread_broadcast"===a.subtype&&!q&&!d&&!n.is_threads_view){ae.is_broadcast=true;ae.show_reply_action=true}if(ae.is_broadcast&&a.root){ae.root_repliers_summary=new Handlebars.SafeString(TS.templates.builders.buildBroadcastRepliersSummaryHTML(a.root));if("tombstone"!==a.root.subtype){var de=a.root.text;var ce=_.first(a.root.attachments);if(_.get(ce,"is_msg_unfurl")){var _e=ce.from_url&&a.root.text==="<"+ce.from_url+">";de&&!_e||(de=ce.text)}if(de){var me=TS.format.formatBroadcastExcerpt(de,a.root);me.length>150&&(me=TS.utility.truncateHTML(me,150));ae.root_excerpt=new Handlebars.SafeString(me)}}}ae.show_broadcast_indicator=TS.boot_data.feature_broadcast_indicator&&"thread_broadcast"===a.subtype&&(q||G);var fe;fe="file_share"===a.subtype||"file_mention"===a.subtype||TS.boot_data.feature_file_threads&&!a.subtype&&oe?oe:"file_comment"===a.subtype?a.comment:a;fe&&fe.pinned_to&&fe.pinned_to.length>0?ae.is_pinned=_.some(fe.pinned_to,function(e){return e===s.id}):ae.is_pinned=false;ae.is_pinned?ae.pin_html=TS.templates.builders.buildPinInfoHtml(a):ae.pin_html="";!a.subtype&&(n.for_search_display||n.for_top_results_search_display)&&oe&&(a.comment?ae.star_components=TS.templates.builders.buildStarComponents("file_comment",a.comment,oe):ae.star_components=TS.templates.builders.buildStarComponents("file",oe,null));if(!TS.interop.rules.messages.isTempMsg(a)&&!a.is_ephemeral||H){ae.permalink=TS.utility.msgs.constructMsgPermalink(s,a.ts,a.thread_ts);ae.abs_permalink=TS.utility.msgs.constructAbsoluteMsgPermalink(s,a.ts,a.thread_ts)}if((n.for_top_results_search_display||n.for_search_display)&&TS.boot_data.page_needs_enterprise){ae.abs_permalink=a.permalink;ae.archive_link=a.permalink;ae.permalink=a.permalink}if("file_share"===a.subtype||"file_mention"===a.subtype||"file_reaction"===a.subtype||TS.interop.messages.shouldRenderFileThread(a)&&oe){oe&&$.extend(ae,e({file:oe,msg:a,starred_items_list:h,model_ob:s,viewContext:W}));var pe=TS.templates.builders.msgs.buildFileShareMetaText(a);ae.file_share_html=new Handlebars.SafeString(pe)}else if("file_comment"===a.subtype){o&&!o.no_display&&o.file&&oe&&oe.id==o.file.id&&(x||(ae.is_file_convo_continuation=true));ae.show_comment_quote_icon=true;if(o&&!o.no_display&&o.file&&oe&&oe.id==o.file.id){(TS.boot_data.feature_file_threads&&!a.subtype||"file_share"===o.subtype)&&o.upload&&o.file.initial_comment&&(x||(ae.show_comment_quote_icon=false));"file_comment"===o.subtype&&(x||(ae.show_comment_quote_icon=false))}ae.file=oe;ae.icon_class=TS.utility.getImageIconClass(oe,"thumb_40");ae.comment=a.comment;ae.member=TS.utility.members.getEntityFromMessage(a);oe&&oe.user!=a.comment.user&&(ae.uploader=TS.utility.members.getEntityFromFile(oe));h||(ae.star_components=TS.templates.builders.buildStarComponents("file_comment",a.comment,oe))}ae.render_file_thread=TS.interop.messages.shouldRenderFileThread(a);ae.files=se&&se.map(function(t){return e({file:t,msg:a,starred_items_list:h,model_ob:s,viewContext:W})});var he=t(a,ae);ae.msg_classes=he.join(" ");ae.addDirectionAttr=parseInt(a.ts,10)>1541628e3;b+=TS.templates.message(ae);b=TS.format.replaceHighlightMarkers(b);return b}catch(e){var ge="";if(a){ge="msg.ts:"+a.ts;delete n.model_ob;try{n.msg=_.cloneDeep(a);n.msg.text="REDACTED";n.msg.attachments&&(n.msg.attachments="REDACTED");n.prev_msg&&(n.prev_msg=n.prev_msg.ts);n.msg.channel&&n.msg.channel.id&&(n.msg.channel=n.msg.channel.id);ge+=" "+JSON.stringify(n,null,"  ")}catch(e){}}e.message||(e.message="");e.message+=" "+ge;TS.warn("Problem in TS.templates.builders.msgs.buildHTML with args: "+JSON.stringify(e.message));e.stack&&TS.info(e.stack);if(TS.boot_data.feature_tinyspeck)return TS.templates.message_failed({subtype:a&&a.subtype?a.subtype:"",msg_ts:a?a.ts:"",model_ob_id:s?s.id:""});return""}},buildFileShareMetaText:function e(t,i){if(!t)return"";var a=TS.utility.msgs.getFileOnMsg(t);if(!a)return"";var s=(TS.boot_data.feature_file_threads&&!t.subtype||"file_share"===t.subtype)&&t.upload;var o=a.user!=t.user&&!s;var l=!r(t);var u=TS.interop.files.getFileMetaTemplate(a);var d;if(o&&l)if(("file_share"===t.subtype||TS.boot_data.feature_file_threads&&!t.subtype)&&t.upload)if(a.initial_comment)d=n.test(a.mode)?u.addedCommentedPossessive:u.uploadedCommentedPossessive;else{if(!n.test(a.mode))return u.uploadedPossessive;d=u.addedPossessive}else d="file_mention"===t.subtype?u.mentionedPossessive:u.sharedPossessive;else d=("file_share"===t.subtype||TS.boot_data.feature_file_threads&&!t.subtype)&&t.upload?a.initial_comment?n.test(a.mode)?u.addedCommented:u.uploadedCommented:n.test(a.mode)?u.added:u.uploaded:"file_mention"===t.subtype?u.mentioned:u.shared;var c=TS.utility.members.getEntityFromFile(a);var _;if(i){var m=TS.interop.members.getPrefCompliantMemberName(c);_=TS.interop.i18n.fullPossessiveString(m)}else{var f=TS.templates.builders.makeMemberPreviewLink(c,false);var p=TS.interop.i18n.possessive(TS.interop.members.getPrefCompliantMemberName(c));var h="client"===TS.boot_data.app?'target="'+a.permalink+'" ':"";var g='<a href="'+a.permalink+'" '+h+'data-file-id="'+a.id+'">';var S=TS.interop.i18n.t("{uploader_name}{uploader_name_affix}","message")({uploader_name:TS.interop.i18n.safeString(f),uploader_name_affix:p});_="</a> "+S+g}return d({uploader_name_possessive_html:TS.interop.i18n.safeString(_),file_pretty_name:t&&a&&a.pretty_type?a.pretty_type:""})}});function e(e){var t=e.file,r=e.msg,n=e.starred_items_list,i=e.model_ob,a=e.viewContext;var s={};s.file=t;s.edit=TS.files.getFileActions(t).edit;s.download=!("snippet"===t.mode||"post"===t.mode||"space"===t.mode||t.is_external);s.new_window=!s.edit&&!s.download;s.abs_permalink=t.permalink;n||(s.star_components=TS.templates.builders.buildStarComponents("file",t,null));$.extend(s,TS.files.getFileTemplateArguments(t,360,a));s.is_message=true;s.lightbox=true;if(("file_share"===r.subtype||TS.boot_data.feature_file_threads)&&r.upload){"email"===t.mode&&(s.is_added=true);s.icon_class=TS.utility.getImageIconClass(t,"thumb_80")}else t.user!=r.user&&(s.uploader=TS.utility.members.getEntityFromFile(t));!TS.interop.messages.shouldRenderFileThread(r)&&"file_share"===r.subtype&&r.upload&&t.initial_comment&&(s.show_initial_comment=true);TS.files.isFileAuthorExternal(t)&&(s.show_comment_action=false);TS.interop.messages.shouldRenderFileThread(r)&&(s.can_remove_file=TS.interop.rules.messages.canRemoveFileFromMessage(TS.redux.getState(),{channel:i,message:r,file:t}));return s}function t(e,t){var r=["message"];e.subtype&&("channel_join"===e.subtype||"group_join"===e.subtype||"app_conversation_join"===e.subtype||"app_conversation_created"===e.subtype?r.push("joined","automated"):"channel_leave"===e.subtype||"group_leave"===e.subtype||"app_conversation_leave"===e.subtype?r.push("left","automated"):"channel_topic"===e.subtype||"group_topic"===e.subtype?r.push("topic","automated"):"channel_name"===e.subtype||"group_name"===e.subtype?r.push("rename","automated"):"channel_purpose"===e.subtype||"group_purpose"===e.subtype?r.push("purpose","automated"):"channel_archive"===e.subtype||"group_archive"===e.subtype?r.push("archived","automated"):"channel_unarchive"===e.subtype||"group_unarchive"===e.subtype?r.push("unarchived","automated"):"bot_message"===e.subtype||"thread_broadcast"===e.subtype&&e.bot_id?r.push("bot_message"):"sh_room_shared"===e.subtype?r.push("sh_shared","automated"):"sh_room_created"===e.subtype?r.push("sh_created","automated"):"bot_add"===e.subtype||"bot_remove"===e.subtype||"bot_enable"===e.subtype||"bot_disable"===e.subtype?r.push("bot_change","automated"):"reminder_add"!==e.subtype&&"reminder_delete"!==e.subtype||r.push("reminder_change","automated"));e.alert_type&&"shared_channel_join"===e.alert_type&&r.push("highlight_yellow_bg");TS.boot_data.feature_fix_files&&r.push("feature_fix_files");e.no_display&&r.push("hidden");t.for_search_display&&r.push("for_search_display");t.for_top_results_search_display&&r.push("for_top_results_search_display");t.starred_items_list&&r.push("for_star_display");t.for_mention_display&&r.push("for_mention_display");t.for_mention_rxn_display&&r.push("for_mention_rxn_display");t.is_ephemeral&&r.push("ephemeral");t.unprocessed&&r.push("unprocessed");t.show_resend_controls&&r.push("resend");t.highlight&&r.push("highlight");t.highlight_as_new&&r.push("new");t.app_id&&r.push("is_app");t.is_pinned&&r.push("is_pinned");t.show_broadcast_indicator&&r.push("show_broadcast_indicator");t.standalone?r.push("standalone"):r.push("dirty_hover_container");if(t.show_user)r.push("first");else{t.file&&r.push("first");t.is_in_conversation&&r.push("first")}if(t.file){r.push("file_reference");t.is_mention?r.push("file_mention"):r.push("file_share")}t.comment&&(t.is_file_convo_continuation?r.push("comment_continuation"):r.push("first"));t.is_root_msg&&r.push("selected");t.is_root_msg&&TS.boot_data.feature_file_threads&&r.push("feature_file_threads");t.is_new_reply&&r.push("new_reply");t.is_tombstone&&r.push("deleted");t.is_broadcast&&r.push("thread_broadcast");_.get(t.member,"is_unknown")&&r.push("member_is_unknown");return r}function r(e){var t=TS.utility.msgs.getFileOnMsg(e);if(!t)return false;return t.name===TS.utility.welcome_post.WELCOME_POST_NAME&&"USLACKBOT"===e.user&&t.user===TS.model.user.id}var n=/(snippet)/})()},I1WX:function(e,t,r){var n=r("lSNA");var i=r("cDf5");function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}));r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),true).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}(function(){TS.registerModule("templates.helpers",{onStart:function e(){TS.templates.helpers.register()},register:function n(){Handlebars.registerHelper("debugger",function(){});Handlebars.registerHelper("i18n_ns",function(e){if(!_.isObject(this)){TS.warn('Cannot set i18n namespace "'+e+'". Chances are you\u2019ve inadvertently changed the context in a Handlebars partial to something that\u2019s not an object.');return}this._i18n_ns&&(this._i18n_ns_history?this._i18n_ns_history.push(this._i18n_ns):this._i18n_ns_history=[this._i18n_ns]);this._i18n_ns=e});Handlebars.registerHelper("_i18n_ns_end",function(){this._i18n_ns_history&&this._i18n_ns_history.length&&(this._i18n_ns=this._i18n_ns_history.pop())});Handlebars.registerHelper("i18n_img",function(e){var t=e.fn(this);var r=e&&e.hash&&e.hash.locales?e.hash.locales:null;if(r){r=r.replace(/\s/g,"");r.split(",").indexOf(TS.interop.i18n.locale)>-1&&(t=t.replace(/(\..+$)/,"."+TS.interop.i18n.locale+"$1"))}return t});Handlebars.registerHelper("t",function(e){var t;if("string"===typeof e){t=e;e=arguments[1]}else t=e.fn();var r;r=void 0!==e.hash.ns?e.hash.ns:void 0!==this._i18n_ns?this._i18n_ns:e.data.root&&e.data.root._i18n_ns?e.data.root._i18n_ns:"";var n=this;_.isObject(n)||(n={this:n});var i={};var a;_.forOwn(e.hash,function(e,t){i[t]=n[t];n[t]=Handlebars.Utils.escapeExpression(e)});var s=t.match(/{[^\s}]+}/g);if(s&&s.length){var o=function e(t){var r=t.split(".");if(r.length>1){var i=0;var a=r.length;var s=n;for(i;i<a;i+=1){s=s[r[i]];if(void 0===s)return}return s}return n[t]};var l;var u=0;var d=s.length;for(u;u<d;u+=1){a=s[u].slice(1,-1);if(void 0===e.hash[a]){l=o(a);if(void 0!==l){i[a]=n[a];n[a]=Handlebars.Utils.escapeExpression(l)}}}}if(e.hash.debug){TS.info("debug handlerbars t helper");TS.info(this)}n.__handlebars=true;t=TS.interop.i18n.t(t,r)(n);_.forOwn(i,function(e,t){n[t]=e});return t});Handlebars.registerHelper("zdLocale",function(){return TS.interop.i18n.zdLocale({featureFlags:{featureLocaleKoKr:TS.boot_data.feature_locale_ko_KR,featureLocaleItIt:TS.boot_data.feature_locale_it_IT,featureLocaleZhCn:TS.boot_data.feature_locale_zh_CN,featureLocaleZhTw:TS.boot_data.feature_locale_zh_TW,featureLocaleRuRu:TS.boot_data.feature_locale_ru_RU}})});Handlebars.registerHelper("exampleEmail",function(e){return TS.utility.exampleEmailAddress(e)});Handlebars.registerHelper("convertTimestampToMilliseconds",function(e){return 1e3*e});Handlebars.registerHelper("i18n_number",function(e){return TS.interop.i18n.number(e)});Handlebars.registerHelper("listify",function(e,t){t.hash.map&&(e=_.map(e,t.hash.map));var r=_.get(t.hash,"conjunction");var n=_.get(t.hash,"strong");var i=_.get(t.hash,"no_escape");var a=TS.interop.i18n.listify(e,{conj:r,strong:n,noEscape:i});return new Handlebars.SafeString(a.join(""))});Handlebars.registerHelper("ifInArray",function(e,t,r){if(t.indexOf(e)>-1)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("getDisplayNames",function(e){var t=e.map(function(e){var t=_.isString(e)?e:e.id;return TS.interop.members.getPrefCompliantMemberNameById(t,true,false)});return t});Handlebars.registerHelper("isClient",function(e){if("client"===TS.boot_data.app)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isChrome",function(e){if(TS.model.is_chrome_desktop||TS.model.is_chrome_mobile)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isFF",function(e){if(TS.model.is_FF)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isSafariDesktop",function(e){if(TS.model.is_safari_desktop)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isWeb",function(e){if("web"===TS.boot_data.app||"space"===TS.boot_data.app||"calls"===TS.boot_data.app)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isMac",function(e){if(TS.model.is_mac)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isWin",function(e){if(TS.model.is_win)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isLin",function(e){if(TS.model.is_lin)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isOurApp",function(e){if(TS.model.is_our_app)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("needCrossWorkspaceLink",function(e,t){if(TS.model.is_our_app&&e&&TS.interop.rules.channels.isFromAnotherTeam(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("isCrossWorkspace",function(e,t){if(e&&TS.interop.rules.channels.isFromAnotherTeam(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("unlessOurApp",function(e){return Handlebars.helpers.isOurApp.call(this,{fn:e.inverse,inverse:e.fn,hash:e.hash})});Handlebars.registerHelper("feature",function(e){var t=e.hash.flag;if(1==TS.qs_args[t]||1==TS.boot_data[t])return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("pageNeedsEnterprise",function(e){if(TS.boot_data.page_needs_enterprise)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("sharedChannelsEnabled",function(e){if(TS.permissions.members.canRequestSharedChannel())return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("canDisconnectSharedChannels",function(e){if(TS.permissions.members.canDisconnectSharedChannels())return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isChannelRequired",function(e,t){return TS.interop.rules.channels.isRequired(e)?t.fn(this):t.inverse(this)});Handlebars.registerHelper("canPostInModelOb",function(e,t){return TS.permissions.members.canPostInModelOb(e)?t.fn(this):t.inverse(this)});Handlebars.registerHelper("experiment",function(e){var t=e.hash.name;var r=e.hash.group||"treatment";if(TS.interop.experiments.getGroupForUser(t)===r)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("removeDoubleRings",function(e){var t=TS.boot_data.feature_remove_double_rings;if(t)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("enterprisePOEmail",function(){if(TS.boot_data.page_needs_enterprise){var e=TS.redux.teams.getSelfEnterpriseTeam().primary_owner.email;return e}return""});Handlebars.registerHelper("versioned_x_icon",function(){return cdn_url+"/52b9/img/enterprise/icon_times_in_circle.svg"});Handlebars.registerHelper("comments",function(e){return new Handlebars.SafeString(TS.templates.builders.buildComments(e))});Handlebars.registerHelper("comment_standalone",TS.templates.builders.buildCommentStandalone);Handlebars.registerHelper("star",function(e,t,r){return new Handlebars.SafeString(TS.templates.builders.buildStar(e,t,r))});Handlebars.registerHelper("starWithTip",function(e,t,r){return new Handlebars.SafeString(TS.templates.builders.buildStarWithTip(e,t,r))});Handlebars.registerHelper("isInlineFilePreviewExpanded",function(e){var r=e.hash.container_id;var n=e.hash.file_id;var i=360;var a=false;var s=t(n,i);a=s?TS.inline_imgs.shouldExpand(r,TS.model.inline_imgs[s]):TS.inline_file_previews.shouldExpand(r,n);if(a)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("shouldTruncateInlineFilePreview",function(e,t){"string"===typeof e&&(e=TS.files.getFileById(e));if(e&&TS.inline_file_previews.shouldTruncate(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("shouldNotTruncateInlineFilePreview",function(e,t){return Handlebars.helpers.shouldTruncateInlineFilePreview.call(this,e,{fn:t.inverse,inverse:t.fn,hash:t.hash})});Handlebars.registerHelper("isInlineFilePreviewTruncated",function(e,t,r){"string"===typeof t&&(t=TS.files.getFileById(t));if(t&&TS.inline_file_previews.isTruncated(e,t))return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("isInlineFilePreviewNotTruncated",function(e,t,r){return Handlebars.helpers.isInlineFilePreviewTruncated.call(this,e,t,{fn:r.inverse,inverse:r.fn,hash:r.hash})});Handlebars.registerHelper("formatActionLink",function(e,t,r){if(!e)return"";var n="<"+e.url+"|"+e.title+">";var i=TS.format.formatWithOptions(n,t,{no_highlights:true,no_specials:true,enable_slack_action_links:true===r});return new Handlebars.SafeString(i)});Handlebars.registerHelper("ellipsize",function(e,t){TS.info("len"+t);return TS.utility.ellipsize(e,t)});Handlebars.registerHelper("stripWhitespace",function(e){return e.replace(/\s+/g,"")});Handlebars.registerHelper("cash",function(e){var t=e.hash.all_digits||false;var r=e.hash.currency_code||"USD";var n=parseInt(e.hash.value,10);return TS.interop.currency.formatCurrency(n,r,{displayTrailingZeroes:t})});Handlebars.registerHelper("possessive",function(e){return TS.interop.i18n.possessive(e)});Handlebars.registerHelper("fullPossessiveString",function(e){return TS.interop.i18n.fullPossessiveString(e)});Handlebars.registerHelper("possessiveForMemberById",function(e){var t=TS.interop.members.getMemberById(e);if(!t)return"";return Handlebars.helpers.possessiveForMember(t)});Handlebars.registerHelper("possessiveForMember",function(e){var t=TS.interop.members.getPrefCompliantMemberName(e);return TS.interop.i18n.possessive(t)});Handlebars.registerHelper("concatStr",function(){return Array.prototype.slice.call(arguments,0,arguments.length-1).join("")});Handlebars.registerHelper("toLowerCase",function(e){return e.toLowerCase()});Handlebars.registerHelper("initialsSafe",function(e){var t=TS.interop.rules.teams.getTeamInitials(e,{limit:2});return new Handlebars.SafeString(t)});Handlebars.registerHelper("json",function(e){if("object"===i(e)&&null!==e&&"json"===e.name)return JSON.stringify(this);return JSON.stringify(e)});Handlebars.registerHelper("prettyJson",function(e){if("object"===i(e)&&null!==e&&"json"===e.name)return JSON.stringify(this,null,2);return JSON.stringify(e,null,2)});Handlebars.registerHelper("currentTeamName",function(){return _.escape(_.get(TS.model.team,"name",""))});Handlebars.registerHelper("currentTeamNameSafe",function(){return new Handlebars.SafeString(_.escape(_.get(TS.model.team,"name","")))});Handlebars.registerHelper("currentTeamHostSafe",function(){return new Handlebars.SafeString(window.location.hostname)});Handlebars.registerHelper("canUserCreatePrivateChannels",function(e){return TS.permissions.members.canCreateGroups()?e.fn(this):e.inverse(this)});Handlebars.registerHelper("canCreateMpims",function(e){return TS.permissions.members.canCreateMpims()?e.fn(this):e.inverse(this)});Handlebars.registerHelper("canKickFromChannels",function(e){return TS.permissions.members.canKickFromChannels()?e.fn(this):e.inverse(this)});Handlebars.registerHelper("canKickFromGroups",function(e){return TS.permissions.members.canKickFromGroups()?e.fn(this):e.inverse(this)});Handlebars.registerHelper("shouldShowMemberEmail",function(e){return e.is_self||TS.prefs.getTeamPref("display_email_addresses")});Handlebars.registerHelper("isSlackbot",function(e){return TS.interop.rules.members.isSlackbot(e)});Handlebars.registerHelper("teamUsesCustomizedCustomStatusPresets",function(e){return TS.prefs.getTeamPref("uses_customized_custom_status_presets")?e.fn(this):e.inverse(this)});Handlebars.registerHelper("numberWithMax",function(e,t){if(e>=t)return t-1+"+";return e});Handlebars.registerHelper("convertFilesize",function(e){return TS.interop.utility.convertFilesize(e)});Handlebars.registerHelper("roundToThree",function(e){return TS.utility.roundToThree(e)});Handlebars.registerHelper("toDate",function(e){return TS.interop.datetime.toDate(e)});Handlebars.registerHelper("toCalendarDate",function(e){return TS.interop.datetime.toCalendarDate(e)});Handlebars.registerHelper("toCalendarDateShort",function(e){var t={shortenMonth:true};return TS.interop.datetime.toCalendarDate(e,t)});Handlebars.registerHelper("toCalendarDateOrNamedDay",function(e){return TS.interop.datetime.toCalendarDateOrNamedDay(e)});Handlebars.registerHelper("toCalendarDateIfYesterdayOrToday",function(e){return TS.interop.datetime.toCalendarDateIfYesterdayOrToday(e)});Handlebars.registerHelper("toCalendarDateOrNamedDayShort",function(e){return TS.interop.datetime.toCalendarDateOrNamedDay(e,{shortenMonth:true})});Handlebars.registerHelper("dayDividerPretty",function(e){return TS.interop.datetime.formatDate(e,"{day_divider_pretty}")});Handlebars.registerHelper("toTime",function(e,t,r){e&&!_.isObject(e)||(e=window.moment().unix());return TS.interop.datetime.toTime(e,{do24hrTime:TS.utility.date.do24hrTime(),includeMeridiem:false!==t,includeSeconds:true===r})});Handlebars.registerHelper("toTimeShort",function(e){if(TS.utility.date.do24hrTime())return TS.interop.datetime.toTime(e,{timeFormat:"HH:mm"});return TS.interop.datetime.toTime(e,{timeFormat:"h:mm"})});Handlebars.registerHelper("toTimeAgo",function(e){return TS.interop.datetime.toTimeAgo(e,{alwaysAgo:true})});Handlebars.registerHelper("toTimeAgoShort",function(e,t){t=!!_.isBoolean(t)&&t;var r=TS.interop.datetime.toTimeAgo(e,{compact:t,alwaysAgo:true});var n='<span class="relative_ts" data-ts="'+_.escape(e)+'" data-really-short="'+!!t+'">'+_.escape(r)+"</span>";return new Handlebars.SafeString(n)});Handlebars.registerHelper("toTimeDuration",function(e){return TS.interop.datetime.toTimeDuration(e)});Handlebars.registerHelper("msgTsTitle",function(e,t){var r;var n;var i=TS.model.unread_view_is_showing&&_.isString(t)&&t===TS.templates.makeMsgDomIdInUnreadView(e.ts);var a=TS.model.threads_view_is_showing&&_.isString(t)&&t===TS.templates.makeMsgDomIdInThreadsView(e.ts);i?n=TS.interop.i18n.t("Jump to conversation","templates_helpers")():a&&(n=e.ts===e.thread_ts?TS.interop.i18n.t("Open in channel","templates_helpers")():TS.interop.i18n.t("Open in sidebar","templates_helpers")());var s=TS.interop.i18n.t("{date} at {time}","templates_helpers")({date:e.ts&&TS.interop.datetime.toCalendarDateOrNamedDay(e.ts,{shortenMonth:true}),time:e.ts&&TS.interop.datetime.toTime(e.ts,{do24hrTime:TS.utility.date.do24hrTime(),includeSeconds:true})}).replace(/\s/g,"&nbsp;");r=n?n+'<br><span class="subtle_silver no_wrap">'+s+"</span>":s;return new Handlebars.SafeString(r)});Handlebars.registerHelper("toHour",function(e){return TS.interop.datetime.toHour(e)});Handlebars.registerHelper("shouldShowMemberTimezone",function(e){return e.tz&&!e.is_slackbot&&!e.is_bot});Handlebars.registerHelper("memberLocalTime",function(e){var t=e&&e.tz?e.tz:"America/Los_Angeles";var r=TS&&TS.boot_data&&TS.boot_data.dst_offsets&&TS.boot_data.dst_offsets[e.tz]&&TS.boot_data.dst_offsets[e.tz].tz_offset?TS.boot_data.dst_offsets[e.tz].tz_offset:-25200;var n=TS.interop.datetime.memberLocalTime(Date.now(),{timeZone:t,timeZoneOffset:r,do24hrTime:TS.utility.date.do24hrTime()});var i=TS.interop.i18n.t('<span class="timezone_value">{local_time}</span> local time',"date_utilities")({local_time:n});return new Handlebars.SafeString(i)});Handlebars.registerHelper("memberUTCOffset",function(e){return TS.utility.date.memberUTCOffset(e)});Handlebars.registerHelper("isInDifferentTimeZone",function(e,t){if(e.tz_offset!==TS.model.user.tz_offset)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("isToday",function(e,t){if(TS.interop.datetime.isToday(TS.interop.datetime.toDateObject(e)))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("toMonthYearFormat",function(e){return TS.interop.datetime.toCalendarDate(e,{excludeDay:true})});Handlebars.registerHelper("if_equal",function(t,r){r=e(r);if(t==r.hash.compare)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("if_not_equal",function(t,r){r=e(r);if(t!=r.hash.compare)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("if_gt",function(t,r){r=e(r);if(t>r.hash.compare)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("if_lt",function(t,r){r=e(r);if(t<r.hash.compare)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("if_starts_with",function(t,r){r=e(r);if(0===(t||"").indexOf(r.hash.compare||""))return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("or",function(t,r,n){n=e(n);if(t||r)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("and",function(t,r,n){n=e(n);if(t&&r)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("foreach",function(e,t){if(t.inverse&&!e.length)return t.inverse(this);return e.map(function(r,n){var i={index:n,value:r,length:e.length};i.first=0===n;i.last=n===e.length-1;return t.fn(i)}).join("")});Handlebars.registerHelper("repeat",function(e,t){var r="";for(var n=0;n<e;n+=1)r+=t.fn(n);return r});Handlebars.registerHelper("makeDayDividerDomId",function(e){return TS.templates.makeDayDividerDomId(e)});Handlebars.registerHelper("getFileShareMetaTextHtml",function(e){var t=TS.templates.builders.msgs.buildFileShareMetaText(e);return new Handlebars.SafeString(t)});Handlebars.registerHelper("formatFileTitle",function(e){return new Handlebars.SafeString(TS.templates.builders.formatFileTitle(e))});Handlebars.registerHelper("formatMessageByType",function(e,t,r,n,i){return new Handlebars.SafeString(TS.templates.builders.formatMessageByType(e,t,r,n,i))});Handlebars.registerHelper("formatAttachments",function(e,t,r,n){return new Handlebars.SafeString(TS.templates.builders.formatAttachments(e,t,r,n))});Handlebars.registerHelper("formatMessage",function(e,t){return new Handlebars.SafeString(TS.format.formatDefault(e,t))});Handlebars.registerHelper("formatNoHighlightsNoSpecials",function(e,t){return TS.format.formatNoHighlightsNoSpecials(e,t)});Handlebars.registerHelper("formatMessageAttachmentPartEscaped",TS.utility.attachments.formatMessageAttachmentPart);Handlebars.registerHelper("formatMessageAttachmentPart",function(e,t,r,n,i,a){return new Handlebars.SafeString(TS.utility.attachments.formatMessageAttachmentPart(e,t,r,n,i,a))});Handlebars.registerHelper("formatMessageAttachmentSlackFooter",function(e,t){var r;r=e.channel_name&&e.channel_id?TS.utility.attachments.getSlackMessageFooterText(e,t,true):TS.format.formatJustText(TS.format.cleanMsg(e.footer));return new Handlebars.SafeString(r)});Handlebars.registerHelper("getAttachmentPermalinkText",function(e,t){return new Handlebars.SafeString(TS.utility.attachments.getSlackMessageFooterPermalinkText(e,t))});Handlebars.registerHelper("formatTopicOrPurpose",function(e){return new Handlebars.SafeString(TS.utility.formatTopicOrPurpose(e))});Handlebars.registerHelper("unFormatMessage",function(e,t){return TS.format.unFormatMsg(e,t)});Handlebars.registerHelper("formatCurrentStatus",function(e,t){t=t||{};t=t.hash||t;return new Handlebars.SafeString(TS.format.formatCurrentStatus(e,void 0,t))});Handlebars.registerHelper("formatCurrentStatusWithoutAnimations",function(e,t){t=t||{};t=t.hash||t;return new Handlebars.SafeString(TS.format.formatCurrentStatus(e,void 0,_.assign({stop_animations:true},t)))});Handlebars.registerHelper("rxnPanel",function(e){var t=TS.templates.builders.rxnPanel(e);if(!t)return"";return new Handlebars.SafeString(t)});Handlebars.registerHelper("makeRefererSafeLink",function(e){if("string"!==typeof e.hash.url)return"";return new Handlebars.SafeString(TS.utility.makeRefererSafeLink(e.hash.url))});Handlebars.registerHelper("makeSafeForDomId",TS.utility.makeSafeForDomId);Handlebars.registerHelper("makeMsgAttachmentTextExpanderDomId",TS.templates.makeMsgAttachmentTextExpanderDomId);Handlebars.registerHelper("makeMsgDomId",TS.templates.makeMsgDomId);Handlebars.registerHelper("makeMsgLabelDomId",TS.templates.makeMsgLabelDomId);Handlebars.registerHelper("makeMSRDomId",TS.templates.makeMSRDomId);Handlebars.registerHelper("makeMSRDomIdWithModule",TS.templates.makeMSRDomIdWithModule);Handlebars.registerHelper("makeMemberColorClass",function(){return TS.templates.builders.makeMemberColorClass.apply(this,arguments)});Handlebars.registerHelper("getAttachmentAuthorMemberId",function(e){var t=TS.utility.attachments.getDecoratedAttachment(e);if(!t)return"";return t._slack_author_id||""});Handlebars.registerHelper("newWindowName",TS.templates.builders.newWindowName);Handlebars.registerHelper("nl2br",function(e){if(!e)return e;e=_.escape(e);return e.replace(/\n/g,"<br />").replace(/&amp;#95;/g,"_")});Handlebars.registerHelper("smartnl2br",function(e){if(!e)return e;e=_.escape(e);e=e.replace(/\n\r\n\r/g,'<span class="para_break"><br /></span>');e=e.replace(/\n\r\n/g,'<span class="para_break"><br /></span>');e=e.replace(/\n\n/g,'<span class="para_break"><br /></span>');e=e.replace(/\n/g,"<br />");return new Handlebars.SafeString(e.replace(/&amp;#95;/g,"_"))});Handlebars.registerHelper("truncate",function(e,t){var r=truncate(e,t);return r.replace(/&#64;/g,"@")});Handlebars.registerHelper("truncateToNearestWordBoundary",TS.utility.truncateToNearestWordBoundary);Handlebars.registerHelper("proxyImgUrls",function(e){var t=$("<div>"+e+"</div>");TS.templates.builders.proxyImgUrlsForEmails(t);return t.html()});Handlebars.registerHelper("stripImageTags",function(e){var t=$("<div>"+e+"</div>");var r=t.find("img").remove().end().html();return new Handlebars.SafeString(r)});Handlebars.registerHelper("isArchived",function(e){return TS.interop.rules.channels.isArchived(e)});Handlebars.registerHelper("generalName",function(){var e=TS.interop.channels.getGeneralChannel();return e?e.name:""});Handlebars.registerHelper("makeChannelDomId",function(e){return TS.templates.makeChannelDomId(e)});Handlebars.registerHelper("makeLinksFromModelObs",function(e){return new Handlebars.SafeString(TS.templates.builders.makeLinksFromModelObs(e,{new_lines:true,overflow_ellipsis:true}))});Handlebars.registerHelper("makeChannelDragData",function(e){return TS.templates.makeChannelDragData(e)});Handlebars.registerHelper("makeFileDragData",function(e){return TS.templates.makeFileDragData(e)});Handlebars.registerHelper("ChannelNameMaxLength",function(){return TS.model.channel_name_max_length});Handlebars.registerHelper("ChannelPurposeMaxLength",function(){return TS.model.channel_purpose_max_length});Handlebars.registerHelper("ChannelTopicMaxLength",function(){return TS.model.channel_topic_max_length});Handlebars.registerHelper("makeUnreadMsgsDomId",function(e){return TS.templates.makeUnreadMsgsDomId(e)});Handlebars.registerHelper("getCorGNameWithPrefixById",function(e,t){var r=TS.redux.channels.getEntityById(e);if(!r){var n="getCorGNameWithPrefixById: Could not find model ob for ID "+e;TS.warn(n);if(t)return;return e}if(r.is_group)return TS.model.group_prefix+r.name;if(r.is_channel)return new Handlebars.SafeString(TS.templates.builders.makeChannelPrefix(r)+r.name);if(t)return;return e});Handlebars.registerHelper("makeChannelPrefix",function(e){return new Handlebars.SafeString(TS.templates.builders.makeChannelPrefix(e))});Handlebars.registerHelper("makeChannelLink",function(e,t){t=t||{};t=t.hash||t;return new Handlebars.SafeString(TS.templates.builders.makeChannelLink(e,t))});Handlebars.registerHelper("makeModelObNameForDisplay",function(e,t){t=t||{};t=t.hash||t;return new Handlebars.SafeString(TS.templates.builders.makeModelObNameForDisplay(e,t))});Handlebars.registerHelper("makeChannelPath",TS.templates.builders.makeChannelPath);Handlebars.registerHelper("makeChannelLinkById",function(e){var t=TS.interop.channels.getPublicChannelById(e);if(t)return TS.templates.builders.makeChannelLink(t)});Handlebars.registerHelper("makeChannelLinkAriaLabelSafe",TS.templates.builders.makeChannelLinkAriaLabelSafe);Handlebars.registerHelper("makeUnreadHighlightDomId",function(e){return TS.templates.makeUnreadHighlightDomId(e)});Handlebars.registerHelper("makeChannelDomClass",function(e){var t="";TS.model.active_channel_id==e.id&&(t+="active ");e.unread_cnt>0&&(t+="unread ");e.unread_highlight_cnt>0&&(t+="mention ");e.is_starred&&(t+="is_starred ");TS.notifs.isCorGMuted(e.id)&&(t+="muted_channel ");(e._show_in_list_even_though_no_unreads||_.trim(e.last_msg_input))&&(t+="show_in_list_even_though_no_unreads ");return t});Handlebars.registerHelper("makeChannelOrGroupLinkById",function(e,t){var r=TS.redux.channels.getEntityById(e);var n="";r.is_mpim?n=TS.templates.builders.makeMpimLink(r,false):r.is_group?n=TS.templates.builders.makeGroupLink(r,{omit_prefix:t}):r.is_channel&&(n=TS.templates.builders.makeChannelLink(r,{omit_prefix:t}));return new Handlebars.SafeString(n)});Handlebars.registerHelper("makeChannelOrGroupSSBLinkById",function(e){var t=TS.redux.channels.getEntityById(e);if(!t)return;var r;var n="slack://channel?team="+TS.model.team.id+"&id="+e;if(t.is_mpim){r=_.escape(TS.mpims.legacyGetDisplayName(t));return"<a href="+n+">"+r+"</a>"}if(t.is_group||t.is_private){r=TS.model.group_prefix+t.name;return"<a href="+n+">"+r+"</a>"}if(t.is_channel){var i=TS.interop.channels.getPublicChannelById(e);r="#"+i.name;return"<a href="+n+">"+r+"</a>"}});Handlebars.registerHelper("isEnterpriseTeam",function(e){return TS.boot_data.page_needs_enterprise?e.fn(this):e.inverse(this)});Handlebars.registerHelper("memberIsUnavailable",function(t,r){r=e(r);var n=TS.interop.rules.members.isUnavailable(TS.redux.getState(),t);if(n)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("isLocalTeam",function(t,r){r=e(r);if(!TS.boot_data.page_needs_enterprise)return r.inverse(this);if(t==TS.model.team.id)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("currentEnterpriseName",function(){if(!TS.boot_data.page_needs_enterprise)return"";var e=TS.redux.teams.getSelfEnterpriseOrgName();return e||""});Handlebars.registerHelper("getEnterpriseOrgURL",function(){if(!TS.boot_data.page_needs_enterprise)return"";return TS.interop.teams.getSelfEnterpriseOrgUrl(TS.redux.getState())});Handlebars.registerHelper("isOnEnterpriseTeam",function(e){if(!TS.boot_data.page_needs_enterprise)return e.inverse(this);return TS.model.user.enterprise_user.teams.indexOf(e.hash.team_id)>-1?e.fn(this):e.inverse(this)});Handlebars.registerHelper("isModelObExtShared",function(e,t){if(TS.interop.utility.isModelObjectExternal(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("shouldUseInitialsIcon",function(e,t,r){if(e&&e.icon&&(e.icon.image_default||t))return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("makeTeamlabel",function(e,t){var r=TS.templates.builders.makeTeamlabel(e,t);return new Handlebars.SafeString(r)});Handlebars.registerHelper("makeTeamNameList",function(e,t){t=t||{};t=t.hash||t;if(!e)return"";var r=_.map(e,function(e){return TS.teams.getTeamById(e)}).map(function(e){return TS.interop.rules.teams.isUnknown(e)?TS.templates.unknown_team({id:e.id,subtler:t.subtler}):_.escape(TS.interop.rules.teams.getTeamDisplayName(e))});var n=TS.interop.i18n.listify(r,s({},t,{noEscape:true})).join("");if(n)return new Handlebars.SafeString(n)});Handlebars.registerHelper("isPendingSharedForTeamId",function(e,t){return TS.interop.rules.channels.isPendingSharedForTeamId(e,t)});Handlebars.registerHelper("makeGroupDomId",function(e){return TS.templates.makeGroupDomId(e)});Handlebars.registerHelper("groupPrefix",function(){return new Handlebars.SafeString(TS.model.group_prefix)});Handlebars.registerHelper("makeGroupLink",function(e,t){t=t||{};t=t.hash||t;var r=TS.templates.builders.makeGroupLink(e,t);return new Handlebars.SafeString(r)});Handlebars.registerHelper("makeGroupLinkById",function(e){var t=TS.interop.channels.getGroupById(e);if(t)return TS.templates.builders.makeGroupLink(t)});Handlebars.registerHelper("makeGroupLinkAriaLabelSafe",TS.templates.builders.makeGroupLinkAriaLabelSafe);Handlebars.registerHelper("makeGroupDomClass",function(e){var t="";TS.model.active_group_id==e.id&&(t+="active ");e.unread_cnt>0&&(t+="unread ");e.unread_highlight_cnt>0&&(t+="mention ");e.is_starred&&(t+="is_starred ");TS.notifs.isCorGMuted(e.id)&&(t+="muted_channel ");(e._show_in_list_even_though_no_unreads||_.trim(e.last_msg_input))&&(t+="show_in_list_even_though_no_unreads ");return t});Handlebars.registerHelper("mpimMemberCount",function(e){return TS.mpims.getMemberCount(e)});Handlebars.registerHelper("mpimDisplayName",function(e,t,r,n,i){t=true===t;i=true===i;var a=TS.mpims.legacyGetDisplayName(e,t,true===r,n,i);if(t||i)return new Handlebars.SafeString(a);return a});Handlebars.registerHelper("makeMpimDomClass",function(e){var t="";if(!e)return t;e.id===TS.model.active_mpim_id&&(t+="active ");(e.unread_cnt>0||e.unread_highlight_cnt>0)&&(t+="unread mention ");TS.notifs.isCorGMuted(e.id)&&(t+="muted_channel ");e.is_starred&&(t+="is_starred ");_.trim(e.last_msg_input)&&(t+="show_in_list_even_though_no_unreads ");return t});Handlebars.registerHelper("makeMpimDomId",function(e){return TS.templates.makeMpimDomId(e)});Handlebars.registerHelper("makeMpimLink",function(e,t){var r=TS.templates.builders.makeMpimLink(e,t);return new Handlebars.SafeString(r)});Handlebars.registerHelper("mpimArchivesPath",function(e){return"/archives/"+e.id});Handlebars.registerHelper("isCorGMuted",function(e,t){if(TS.notifs.isCorGMuted(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("currentUserId",function(){return TS.model.user.id});Handlebars.registerHelper("makeMemberDomId",function(e){return TS.templates.makeMemberDomId(e)});Handlebars.registerHelper("makeChannelListDomId",function(e){return TS.templates.makeChannelListDomId(e)});Handlebars.registerHelper("makeMemberPresenceDomClass",function(e){return TS.templates.makeMemberPresenceDomClass(e.id)});Handlebars.registerHelper("makeMemberPresenceIcon",function(e){TS.warn("Presence icons should not be used outside of the client application, because they rely on a WS connection to keep presence up to date. Rendering anyway, but be careful out there!");return new Handlebars.SafeString(TS.templates.makeMemberPresenceIcon(e))});Handlebars.registerHelper("makeMemberStatusDomClass",function(e){return TS.templates.makeMemberStatusDomClass(e.id)});Handlebars.registerHelper("makeMemberDomClass",function(e){var t="";if(!e)return t;var r=TS.redux.presence.getPresenceByMemberId(e.id);e.is_self||"away"!==r||(t+="away ");if(TS.model.active_im_id){var n=TS.interop.channels.getImById(TS.model.active_im_id);n.user==e.id&&(t+="active ")}var i=TS.redux.channels.getImByMemberId(e.id);if(i){(i.unread_cnt>0||i.unread_highlight_cnt>0)&&(t+="unread mention ");i.is_starred&&(t+="is_starred ");_.trim(i.last_msg_input)&&(t+="show_in_list_even_though_no_unreads ")}return t});Handlebars.registerHelper("showDraftIcon",function(e,t){if(TS.templates.builders.legacyShowDraftIcon(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("makeMemberListDomClass",function(e){var t="member ";var r=TS.redux.presence.getPresenceByMemberId(e.id);"away"===r&&(t+="away ");return t});Handlebars.registerHelper("makeMemberPreviewLink",function(){var e=TS.templates.builders.makeMemberPreviewLink.apply(this,arguments);return new Handlebars.SafeString(e)});Handlebars.registerHelper("makeMemberTitleByMsg",function(e,t){if(TS.utility.msgs.isEKMAccessDeniedMessage(e))return new Handlebars.SafeString(TS.interop.utility.getTombstonedMessageTitle(e));return Handlebars.helpers.makeMemberPreviewLinkById.call(this,e.user,t)});Handlebars.registerHelper("makeMemberPreviewLinkById",function(e,t){true!==t&&(t=false);var r=TS.redux.members.getPotentiallyUnknownMemberById(e);r&&!r.is_non_existent||(r=TS.interop.bots.getBotById(e));if(!r)return new Handlebars.SafeString(_.escape(e));return new Handlebars.SafeString(TS.templates.builders.makeMemberPreviewLink(r,t))});Handlebars.registerHelper("makeMemberPreviewLinkImage",function(){return new Handlebars.SafeString(TS.templates.builders.makeMemberPreviewLinkImage.apply(this,arguments))});Handlebars.registerHelper("makeProfileImage",TS.templates.builders.makeProfileImage);Handlebars.registerHelper("makePendingUserImage",function(){return new Handlebars.SafeString(TS.templates.builders.makePendingUserImage.apply(this,arguments))});Handlebars.registerHelper("emojiGraphicReplace",function(e,t){var r={};t&&"string"===typeof t?r.force_style=t:r.obey_emoji_mode_pref=true;return new Handlebars.SafeString(TS.emoji.graphicReplace(e,r))});Handlebars.registerHelper("emojiGraphicReplaceByName",function(e){return TS.emoji.graphicReplace(":"+e+":")});Handlebars.registerHelper("emojiModePref",function(){return TS.interop.rules.emoji.getEmojiMode()});Handlebars.registerHelper("makeUsernameImage",function(e,t){var n;var i;var a;var s;var o;var l=TS.redux.bots.getBotByMsg(e);e.icons?o=e.icons:l&&l.icons?o=l.icons:e.bot_profile&&e.bot_profile.icons&&(o=e.bot_profile.icons);o&&(o.image_36&&!TS.environment.is_retina?n=o.image_36:o.image_72&&TS.environment.is_retina?n=o.image_72:o.image_48?n=o.image_48:o.emoji&&":"===o.emoji.substr(0,1)&&":"===o.emoji.substr(o.emoji.length-1,1)&&(a=o.emoji));var u={};var d=TS.templates.builders.makeBotLink(l,u);var c=e&&e.is_ephemeral&&"slackbot"===e.username?TS.interop.members.getMemberById("USLACKBOT"):null;switch(t){case 24:i="thumb_24";s=cdn_url+"/df10d/img/avatars/ava_0002-24.png";c&&(s=c.profile.image_24);break;case 32:i="thumb_32";s=cdn_url+"/df10d/img/avatars/ava_0002-32.png";c&&(s=c.profile.image_32);break;case 36:i="thumb_36";s=cdn_url+"/df10d/img/avatars/ava_0002-48.png";c&&(s=c.profile.image_48);break;case 72:i="thumb_72";s=cdn_url+"/df10d/img/avatars/ava_0002-72.png";c&&(s=c.profile.image_72);break;case 192:i="thumb_192";s=cdn_url+"/df10d/img/avatars/ava_0002-192.png";c&&(s=c.profile.image_192);break;default:i="thumb_48";s=cdn_url+"/df10d/img/avatars/ava_0002-192.png";c&&(s=c.profile.image_48);break}var m;if(n)if(e.bot_profile&&TS.interop.bots.isBotExternal(e.bot_profile)){u.classes="member_image "+i;u.style="background-image:url('"+n+"')";u.external_badge=TS.templates.member_type_external_badge({team:TS.teams.getTeamById(e.bot_profile.team_id),size:t,badge_size:r(16),with_tooltip:true});d=TS.templates.builders.makeBotLink(l,u);m=""+d.start_a+d.end_a}else m=d.start_a+'<img style="border: 0" src="'+n+'" class="member_image '+i+'" />'+d.end_a;else if(a){var f;TS.boot_data.feature_sonic_emoji&&(f={emojiSize:TS.interop.emojiComponent.EmojiSizes.LARGE});m=d.start_a+'<div style="border: 0" class="member_image '+i+'">'+TS.emoji.graphicReplace(_.escape(a),f)+"</div>"+d.end_a}else m=c?d.start_a+'<img src="'+s+'" class="member_image '+i+'" />'+d.end_a:d.start_a+'<img src="'+s+'" class="member_image bot_icon_default '+i+'" />'+d.end_a;return new Handlebars.SafeString(m)});Handlebars.registerHelper("getMemberPreviewLinkImageArgs",function(e,t,r,n,a,s,o){var l;l="object"===i(e)?e:TS.interop.members.getMemberById(e);if(!l||!l.profile)return"";r=true===r;n=true===n;a=true===a;s=true===s;o="string"===typeof o&&o;"USLACKBOT"===e&&o&&(l=TS.utility.slackbot.getWithFeels(o));var u;var d;var c;d="background-image: ";c=[];switch(t){case 20:u=TS.environment.is_retina?l.profile.image_48:l.profile.image_24;break;case 24:u=TS.environment.is_retina?l.profile.image_48:l.profile.image_24;break;case 32:u=TS.environment.is_retina?l.profile.image_72:l.profile.image_32;break;case 36:u=TS.environment.is_retina?l.profile.image_72:l.profile.image_48;break;case 48:u=TS.environment.is_retina?l.profile.image_72:l.profile.image_48;break;case 56:u=TS.environment.is_retina?l.profile.image_192:l.profile.image_72;break;case 72:u=TS.environment.is_retina?l.profile.image_192:l.profile.image_72;break;case 192:u=TS.environment.is_retina&&l.profile.image_512||l.profile.image_192;break;case 512:u=TS.environment.is_retina?l.profile.image_1024||l.profile.image_512||l.profile.image_192:l.profile.image_512||l.profile.image_192;break;default:u=TS.environment.is_retina?l.profile.image_72:l.profile.image_48;break}c.push("url('"+u+"')");if(512===t){var _=TS.environment.is_retina?l.profile.image_72:l.profile.image_48;c.push("url('"+_+"')")}d=r?c.length?c.join(", "):"":c.length?d+c.join(", "):"";var m={omit_link:n,omit_badge:a,lazy:r,member:l,size:t,include_restricted_overlay:!s||true,bg_img_style:d};return m});Handlebars.registerHelper("getGuestBadgeSize",function(e){var t;switch(e){case 24:t=10;break;case 32:case 36:case 48:t=16;break;case 72:t=24;break;case 192:t=48;break;case 512:t=96;break;default:t=16}return t});Handlebars.registerHelper("getTeamBadgeSize",r);Handlebars.registerHelper("getMemberNameById",function(e){var t=TS.interop.members.getMemberById(e);return t?t.name:e});Handlebars.registerHelper("getPrefCompliantMemberNameById",function(e){return TS.interop.members.getPrefCompliantMemberNameById(e)});Handlebars.registerHelper("getMemberNameNoModel",function(e,t){if(TS.boot_data.name_tagging_client)return e.display_name||e.real_name||t;return e.real_name||t});Handlebars.registerHelper("getMemberComponentPrimaryName",function(e,t){if(t){if("real_name"===t)return TS.interop.members.getMemberRealName(e);return TS.interop.members.getMemberMentionName(e)}return TS.interop.members.getPrefCompliantMemberName(e,false,false)});Handlebars.registerHelper("memberIsInvited",function(e,t){if(e&&e.is_invited_user)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("memberComponentHasSecondaryName",function(e,t,r){var n=false;e&&(n=t?"real_name"===t?!!TS.interop.members.getMemberProfileFieldDisplayName(e):!!TS.interop.members.getMemberRealName(e):!!TS.interop.members.getMemberSecondaryName(e));if(n&&!e.is_invited_user)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("getMemberComponentSecondaryName",function(e,t){if(t){if("real_name"===t)return TS.interop.members.getMemberProfileFieldDisplayName(e);if("display_name"===t){if(TS.interop.members.getMemberProfileFieldDisplayName(e))return TS.interop.members.getMemberRealName(e);return""}}return TS.interop.members.getMemberSecondaryName(e)});Handlebars.registerHelper("getPrefCompliantMemberName",function(e,t,r){return TS.interop.members.getPrefCompliantMemberName(e,true===t,true===r)});Handlebars.registerHelper("getMemberAsContentsString",function(e){return TS.interop.texty.getMemberAsContentsString(e)});Handlebars.registerHelper("shouldShowMemberRestrictionBanner",function(t,r){r=e(r);_.isString(t)&&(t=TS.interop.members.getMemberById(t));if(!t)return r.inverse(this);var n=t.is_restricted||t.isExternal;if(n)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("shouldShowInvitedGuest",function(t,r){r=e(r);_.isString(t)&&(t=TS.interop.members.getMemberById(t));if(!t)return r.inverse(this);var n=t.is_restricted||t.isExternal;if(n&&t.is_invited_user)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("shouldShowInvitedUserBanner",function(t,r){r=e(r);_.isString(t)&&(t=TS.interop.members.getMemberById(t));if(!t)return r.inverse(this);var n=t.is_invited_user&&!t.deleted;if(n)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("shouldShowMemberActionBar",function(t,r){r=e(r);_.isString(t)&&(t=TS.interop.members.getMemberById(t));if(TS.interop.rules.members.isActionable(TS.redux.getState(),t))return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("shouldShowMemberProfileBlock",function(e){var t=e.is_admin&&e.team_id===TS.model.user.team_id;var r=e.is_self||TS.prefs.getTeamPref("display_email_addresses");return TS.interop.rules.members.isActionable(TS.redux.getState(),e)&&e.profile&&(e.profile.display_name||Handlebars.helpers.shouldShowMemberTimezone(e)||e.profile.phone||e.profile.email&&r||t||Handlebars.helpers.getVisibleTeamProfileFieldsForMember(e).length)});Handlebars.registerHelper("getTeamNameByMember",function(e){if(!_.isObject(e))return null;var t=TS.teams.getTeamById(e.team_id);if(!_.isObject(t))return null;if(TS.interop.rules.teams.isUnknown(t))return new Handlebars.SafeString(TS.templates.unknown_team({id:t.id}));return TS.interop.rules.teams.getTeamDisplayName(t)});Handlebars.registerHelper("getTeamById",function(e){return TS.teams.getTeamById(e)});Handlebars.registerHelper("getTeamNameById",function(e){var t=TS.teams.getTeamById(e);if(TS.interop.rules.teams.isUnknown(t))return new Handlebars.SafeString(TS.templates.unknown_team({id:e}));return TS.interop.rules.teams.getTeamDisplayName(t)});Handlebars.registerHelper("getTeamDisplayName",function(e){if(TS.interop.rules.teams.isUnknown(e))return new Handlebars.SafeString(TS.templates.unknown_team({id:e.id}));return TS.interop.rules.teams.getTeamDisplayName(e)});Handlebars.registerHelper("getMemberPreviewLinkTarget",function(e){if(TS.utility.shouldLinksHaveTargets())return new Handlebars.SafeString('target="/team/'+e.id+'"');return""});Handlebars.registerHelper("getMemberProfileFieldDisplayName",function(e){return TS.interop.members.getMemberProfileFieldDisplayName(e)});Handlebars.registerHelper("getMemberSecondaryName",function(e){return TS.interop.members.getMemberSecondaryName(e)});Handlebars.registerHelper("memberHasSecondaryName",function(e,t){var r=false;e&&(r=!!TS.interop.members.getMemberSecondaryName(e));if(r)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("unlessMemberHasSecondaryName",function(e,t){return Handlebars.helpers.memberHasSecondaryName.call(this,e,{fn:t.inverse,inverse:t.fn,hash:t.hash})});Handlebars.registerHelper("getMemberProfileFieldDisplayName",function(e){return TS.interop.members.getMemberProfileFieldDisplayName(e)});Handlebars.registerHelper("memberHasProfileFieldDisplayName",function(e,t){var r=false;e&&(r=!!TS.interop.members.getMemberProfileFieldDisplayName(e));if(r)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("unlessMemberHasProfileFieldDisplayName",function(e,t){return Handlebars.helpers.memberHasProfileFieldDisplayName.call(this,e,{fn:t.inverse,inverse:t.fn,hash:t.hash})});Handlebars.registerHelper("memberHasDifferentDisplayAndFullName",function(e,t){var r=false;e&&(r=!!TS.interop.members.getMemberProfileFieldDisplayName(e)&&TS.interop.members.getMemberProfileFieldDisplayName(e)!==TS.interop.members.getMemberRealName(e));if(r)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("getMemberRealName",function(e){return TS.interop.members.getMemberRealName(e)});Handlebars.registerHelper("getMemberProfileFieldDisplayNameandRealNameInCorrectOrder",function(e){var t=_.escape(TS.interop.members.getPrefCompliantMemberName(e));var r;r=e.is_self?TS.interop.i18n.t("(you)","templates_helpers")():_.escape(TS.interop.members.getMemberSecondaryName(e));var n='<span class="member_real_name">'+t+"</span>";var i='<span class="member_preferred_name">'+r+"</span>";return new Handlebars.SafeString(n+i)});Handlebars.registerHelper("getMemberCurrentStatusEmoji",function(e,t){t=t||{};t=t.hash||t;return Handlebars.helpers.formatCurrentStatusWithoutAnimations(TS.interop.members.getMemberCurrentStatus(TS.redux.getState(),e&&e.id).emoji,_.assign({transform_missing_emoji:true,show_icon_for_emoji_in_as_text_mode:true},t))});Handlebars.registerHelper("getMemberCurrentStatusText",function(e){var t=TS.interop.members.getMemberCurrentStatus(TS.redux.getState(),e&&e.id).text;return Handlebars.helpers.formatCurrentStatusWithoutAnimations(t,{prevent_copy_paste:false})});Handlebars.registerHelper("getMemberCurrentStatusForDisplay",function(e){return new Handlebars.SafeString(TS.templates.builders.getMemberCurrentStatusForDisplay(e))});Handlebars.registerHelper("getMemberCurrentStatusForDisplayWithoutAnimations",function(e,t){t=t||{};t=t.hash||t;return new Handlebars.SafeString(TS.templates.builders.getMemberCurrentStatusForDisplay(e,_.assign({stop_animations:true},t)))});Handlebars.registerHelper("getMemberCurrentStatusExpiration",function(e,t){t=t||{};t=t.hash||t;if(e&&!e.is_self)return"";return new Handlebars.SafeString(TS.templates.builders.buildMemberCustomStatusExpiration(e,t))});Handlebars.registerHelper("seesCurrentStatusInProfileView",function(t,r){r=e(r);if(t.profile.status_text||t.profile.status_emoji||"client"===TS.boot_data.app&&t.is_self)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("getTeamCustomStatusPresets",function(){return TS.team.getTeamCustomStatusPresets()});Handlebars.registerHelper("getDisplayNameOfUserForIm",function(e){if(!e)return"MISSING_IM";return TS.ims.getDisplayNameOfUserForIm(e)});Handlebars.registerHelper("getIMIdByMemberId",function(e){var t=TS.redux.channels.getImByMemberId(e);return t?t.id:""});Handlebars.registerHelper("memberHasIm",function(e){var t=e.hash.member;var r=false;t&&TS.redux.channels.getImByMemberId(t.id)&&(r=true);if(r)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("memberHasImUnreadCount",function(e){var t=e.hash.member;var r=false;if(t){var n=TS.redux.channels.getImByMemberId(t.id);n&&n.unread_cnt&&(r=true)}if(r)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("getUnreadCountForIMByMemberId",function(e){var t=TS.redux.channels.getImByMemberId(e);if(t)return t.unread_cnt;return""});Handlebars.registerHelper("makeMemberLinksWithDisplayNames",function(e){if(!e)return"";var t=e.split(/\s*,\s*/).map(function(e){return TS.templates.builders.makeMemberPreviewLink(TS.interop.members.getMemberById(e))}).join(", ");return new Handlebars.SafeString(t)});function a(e){var t=TS.interop.members.getMemberById(e.user);if(!t){TS.warn("Missing member in makeIMLink: "+e.user);return TS.templates.search_im_link({im_exists:false,im_member_id:e.user,im_name:e.user,im_id:e.id,member_color:"unknown"})}var r={im_exists:!TS.interop.channels.isImWithDeletedMember(e),im_member_id:t.id,im_name:TS.ims.getDisplayNameOfUserForIm(e),im_id:e.id,member_color:"color_"+(t?t.id+" color_"+t.color:"unknown")};if(TS.utility.shouldLinksHaveTargets()){var n="/messages/"+e.id;TS.interop.channels.isImWithDeletedMember(e)&&(n=TS.templates.builders.newWindowName());r.target=n}return TS.templates.search_im_link(r)}Handlebars.registerHelper("makeIMLink",function(e){return new Handlebars.SafeString(a(e))});Handlebars.registerHelper("makeIMLinkById",function(e){var t=TS.interop.channels.getImById(e);if(t)return new Handlebars.SafeString(a(t))});Handlebars.registerHelper("getBotName",TS.templates.builders.getBotName);Handlebars.registerHelper("getBotNameWithLink",TS.templates.builders.getBotNameWithLink);function o(e){if(!e)return"color_unknown";return"color_bot_"+TS.utility.makeSafeForDomClass(e)}Handlebars.registerHelper("getBotColorClassByUserName",o);function l(e){var t=TS.interop.members.getMemberById(e);if(!t)return"color_unknown";return"color_"+t.id+" color_"+t.color}Handlebars.registerHelper("getMemberColorClassById",l);Handlebars.registerHelper("getMemberColorClassByImId",function(e){var t=TS.interop.channels.getImById(e);if(!t)return"color_unknown";return l(t.user)});Handlebars.registerHelper("msgIsFromSelf",function(e){var t=e.hash.msg;var r=t.user;!r&&"file_comment"===t.subtype&&t.comment&&(r=t.comment.user);var n=TS.interop.members.getMemberById(r);if(!n)return e.inverse(this);if(n.is_self)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("memberIsSelf",function(e){var t=TS.interop.members.getMemberById(e.hash.id);if(!t)return e.inverse(this);if(t.is_self)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("memberIsAdmin",function(e){var t=TS.interop.members.getMemberById(e.hash.id);if(!t)return e.inverse(this);if(t.is_admin)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("currentUserIsAdmin",function(e){if(TS.model.user.is_admin)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("currentUserIsOwner",function(e){if(TS.model.user.is_owner)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("currentUserIsRA",function(e){if(TS.model.user.is_restricted)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("currentUserIsURA",function(e){if(TS.model.user.is_ultra_restricted)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("tinyspeck",function(e){if(TS.boot_data.feature_tinyspeck)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("makeUnshareLinkById",function(e){var t=TS.files.getFileById(TS.web.file.file_id);var r=TS.redux.channels.getEntityById(e);if(r)return TS.templates.builders.makeUnshareLink(r,t)});Handlebars.registerHelper("makeUnshareLink",function(e){var t=TS.files.getFileById(TS.web.file.file_id);return TS.templates.builders.makeUnshareLink(e,t)});Handlebars.registerHelper("makeFileDomId",function(e){return TS.templates.makeFileDomId(e)});Handlebars.registerHelper("makeFileCommentsDomId",function(e){return TS.templates.makeFileCommentsDomId(e)});Handlebars.registerHelper("makeFileContentsDomId",function(e){return TS.templates.makeFileContentsDomId(e)});Handlebars.registerHelper("makeFileCommentHelpHTML",function(e){return new Handlebars.SafeString(TS.templates.builders.makeFileCommentHelpHTML(e))});Handlebars.registerHelper("makeFileHeader",function(e,t){var r=TS.files.getFileActions(e);r.file=e;r.is_post="space"===e.mode||"post"===e.mode;r.download="hosted"===e.mode;r.member=t;return TS.templates.file_header(r)});Handlebars.registerHelper("makeFilePreviewHeader",function(e,t){var r=TS.files.getFileActions(e);r.file=e;r.member=t;r.download="hosted"===e.mode;r.edit_link="post"===e.mode?e.edit_link:e.permalink;r.is_post="space"===e.mode||"post"===e.mode;r.is_snippet="snippet"===e.mode;r.preview=true;return new Handlebars.SafeString(TS.templates.file_header(r))});Handlebars.registerHelper("makeFileSize",function(e){return TS.interop.utility.convertFilesize(e.size)+" "+e.pretty_type});Handlebars.registerHelper("formatSpaceHtml",function(e){var t=$("<div>").html(e);TS.templates.builders.replaceEmojiForPosts(t[0]);TS.utility&&TS.utility.attachments&&TS.utility.attachments.unfurlPlaceholders(t);return new Handlebars.SafeString(t.html())});Handlebars.registerHelper("fileIsImage",function(e){var t=TS.files.getFileById(e.hash.id);if(!t)return e.inverse(this);if(t.mimetype&&0===t.mimetype.indexOf("image/"))return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("mimeTypeIsImage",function(e){if(e.hash.type&&0===e.hash.type.indexOf("image/"))return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("fileDefaultIsNewWindow",function(t){t=e(t);var r=TS.files.getFileById(t.hash.id);if(!r)return t.inverse(this);var n=r.mimetype&&0===r.mimetype.indexOf("image/")&&-1===r.mimetype.indexOf("svg");var i="pdf"===r.filetype;if(n||i)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("fileOpensOnTeamSite",function(t){t=e(t);if(!TS.boot_data.feature_file_threads)return t.fn(this);var r=TS.files.getFileById(t.hash.id);if(!r)return t.inverse(this);var n=r.mode;if("space"===n||"email"===n||"snippet"===n)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("fileIconTypeDownload",function(){var t=Array.prototype.slice.call(arguments);var r=e(t.pop());var n=t[0];"string"===typeof n&&(n=TS.files.getFileById(n));if(!n)return r.inverse(this);var i="external"===n.mode;var a=n.mimetype&&0===n.mimetype.indexOf("image/")&&-1===n.mimetype.indexOf("svg");var s="pdf"===n.filetype;if(i||a||s)return r.inverse(this);return r.fn(this)});Handlebars.registerHelper("nonImageCanUseFSFV",function(e,t){if(TS.files.nonImageCanUseFSFV(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("makeFilePrivacyLabel",function(e){var t="";var r=e.is_public;var n=e.groups.length>0||e.ims.length>0;var i="email"===e.mode;var a="snippet"===e.mode;var s="post"!=e.mode&&"space"!=e.mode&&!i&&!a;"post"===e.mode||"space"===e.mode?t=r?TS.interop.i18n.t("Shared","templates_helpers")():n?TS.interop.i18n.t("Private","templates_helpers")():TS.interop.i18n.t("Draft","templates_helpers")():r&&i?t=TS.interop.i18n.t("Shared email","templates_helpers")():r&&a?t=TS.interop.i18n.t("Shared snippet","templates_helpers")():r&&s?t=TS.interop.i18n.t("Shared file","templates_helpers")():n&&i?t=TS.interop.i18n.t("Private email","templates_helpers")():n&&a?t=TS.interop.i18n.t("Private snippet","templates_helpers")():n&&s&&(t=TS.interop.i18n.t("Private file","templates_helpers")());return t});Handlebars.registerHelper("makeExternalFiletypeHTML",function(e){return new Handlebars.SafeString(TS.templates.builders.makeExternalFiletypeHTML(e))});Handlebars.registerHelper("makeFileShareLabel",function(e){return new Handlebars.SafeString(TS.templates.builders.makeFileShareLabel(e))});Handlebars.registerHelper("isFileAuthorExternal",function(e){return TS.files.isFileAuthorExternal(e)});Handlebars.registerHelper("nl2brAndHighlightSearchMatches",function(e){if(!e)return;e=_.escape(e);e=e.replace(/\n/g,"<br />");return new Handlebars.SafeString(TS.utility.msgs.handleSearchHighlights(e))});Handlebars.registerHelper("maybeGetIconForTeamProfileField",function(e){var t=["slack","apple","android","twitter","github","google","windows","youtube","skype","facebook","asana","linkedin","tumblr","instagram","soundcloud","flickr","pinterest","tripit","hangouts","viber","line"];e=e.toLowerCase();if(t.indexOf(e)>-1)return'<i class="ts_icon ts_icon_'+e+'"></i>'});Handlebars.registerHelper("getVisibleTeamProfileFieldsForMember",function(e,t){var r=TS.team.getVisibleTeamProfileFieldsForMember(e);return new Handlebars.SafeString(TS.templates.team_profile_fields({fields:r,lazy_load_profile_fields:t&&t.hash.lazy_load_profile_fields}))});Handlebars.registerHelper("isSkypeTeamProfileField",function(e,t){if("text"===e.type&&"skype"===e.label.toLocaleLowerCase())return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("getSafeSkypeURLComponent",function(e){var t=e.match(/^[a-zA-Z][a-zA-Z0-9.,\-_@]{5,31}/);return t?t[0]:""});Handlebars.registerHelper("highlightSearchMatches",function(e){if(!e)return;e=_.escape(e);return TS.utility.msgs.handleSearchHighlights(e)});Handlebars.registerHelper("highlightSearchMatchesInSpacesHtml",function(e){if(!e)return;var t=Handlebars.helpers.formatSpaceHtml(e);return new Handlebars.SafeString(TS.utility.msgs.handleSearchHighlights(t))});Handlebars.registerHelper("highlightSearchMatchesInFileTitle",function(e){if(!e)return;e=_.unescape(e);e=_.escape(e);e=TS.emoji.graphicReplace(e);return new Handlebars.SafeString(TS.utility.msgs.handleSearchHighlights(e))});Handlebars.registerHelper("makeUnreadMessagesDomId",function(e){return TS.templates.makeUnreadMessagesDomId(e)});Handlebars.registerHelper("makeUnreadGroupMessagesDomId",function(e){return TS.templates.makeUnreadGroupMessagesDomId(e)});Handlebars.registerHelper("makeUnreadDmsDomId",function(e){return TS.templates.makeUnreadDmsDomId(e)});Handlebars.registerHelper("makeSentMessagesDomId",function(e){return TS.templates.makeSentMessagesDomId(e)});Handlebars.registerHelper("makeSentGroupMessagesDomId",function(e){return TS.templates.makeSentGroupMessagesDomId(e)});Handlebars.registerHelper("makeSentDmsDomId",function(e){return TS.templates.makeSentDmsDomId(e)});Handlebars.registerHelper("makeIssueListDomId",function(e){return TS.templates.makeIssueListDomId(e)});Handlebars.registerHelper("math",function(e,t,r){if(arguments.length<4){r=t;t="+"}e=parseFloat(e);r=parseFloat(r);return{"+":e+r,"-":e-r,"*":e*r,"/":e/r,"%":e%r}[t]});Handlebars.registerHelper("loadingHTML",function(){return new Handlebars.SafeString(TS.templates.builders.loadingHTML())});Handlebars.registerHelper("versioned_loading_animation",function(){return cdn_url+"/80588/img/loading.gif"});Handlebars.registerHelper("versioned_loading_hash_animation",function(){return cdn_url+"/80588/img/loading_hash_animation_@2x_vogue.gif"});Handlebars.registerHelper("versioned_services_box_32",function(){return cdn_url+"/80588/img/plugins/box/service_32.png"});Handlebars.registerHelper("versioned_services_gdrive_16",function(){return cdn_url+"/80588/img/services/gdrive_16.png"});Handlebars.registerHelper("versioned_services_onedrive_32",function(){return cdn_url+"/80588/img/plugins/onedrive/service_32.png"});Handlebars.registerHelper("versioned_slackbot_48",function(){return cdn_url+"/80588/img/slackbot_48.png"});Handlebars.registerHelper("versioned_slackbot_72",function(){return cdn_url+"/80588/img/slackbot_72.png"});Handlebars.registerHelper("versioned_twitter_64",function(){return cdn_url+"/80588/img/services/twitter_64.png"});Handlebars.registerHelper("versioned_upload_file_icon",function(e){if("1x"===e)return cdn_url+"/80588/img/upload_file_icon.png";if("2x"===e)return cdn_url+"/80588/img/upload_file_icon@2x.png"});Handlebars.registerHelper("versioned_default_application_icon",function(){return cdn_url+"/80588/img/apps/default_new_app_icon.png"});Handlebars.registerHelper("versioned_join_shared_channel",function(e){if("1x"===e)return cdn_url+"/80588/img/join-channel/join_shared_channel.png";if("2x"===e)return cdn_url+"/80588/img/join-channel/join_shared_channel@2x.png"});Handlebars.registerHelper("versioned_tos_book_illustration",function(e){if("1x"===e)return cdn_url+"/80588/img/signup/book_illustration.png";if("2x"===e)return cdn_url+"/80588/img/signup/book_illustration@2x.png"});Handlebars.registerHelper("versioned_join_team_channel",function(e){if(TS.model.is_mac){if("1x"===e)return cdn_url+"/80588/img/join-channel/default/join_team_channel.png";if("2x"===e)return cdn_url+"/80588/img/join-channel/default/join_team_channel@2x.png"}else{if("1x"===e)return cdn_url+"/80588/img/join-channel/google/join_team_channel.png";if("2x"===e)return cdn_url+"/80588/img/join-channel/google/join_team_channel@2x.png"}});Handlebars.registerHelper("versioned_signin_no_teams",function(e){if("1x"===e)return cdn_url+"/80588/img/enterprise/signin-no-teams.png";if("2x"===e)return cdn_url+"/80588/img/enterprise/signin-no-teams@2x.png"});Handlebars.registerHelper("versioned_basic_analytics_coming_soon",function(e){if("1x"===e)return cdn_url+"/80588/img/enterprise/ent_basic_analytics_coming_soon.png";if("2x"===e)return cdn_url+"/80588/img/enterprise/ent_basic_analytics_coming_soon@2x.png"});Handlebars.registerHelper("versioned_slack_logo_240",function(){return cdn_url+"/80588/img/slack_logo_240_vogue.png"});Handlebars.registerHelper("versioned_file_drop_blue",function(){return cdn_url+"/80588/img/file-drop-blue@2x.png"});Handlebars.registerHelper("versioned_basic_analytics_upsell_banner_image",function(){return cdn_url+"/80588/img/enterprise/ent_basic_analytics_upsell_banner_image.gif"});Handlebars.registerHelper("pinToLabel",function(e){var t="";e.is_channel&&(t+="#");e.is_im||e.is_mpim?t+=TS.interop.i18n.t("this conversation","pins")():t+=_.escape(e.name);return new Handlebars.SafeString(t)});Handlebars.registerHelper("preventWidow",function(e){var t=e.split(" ");if(t.length>1){t[t.length-2]+="&nbsp;"+t[t.length-1];t.pop();e=t.join(" ")}return new Handlebars.SafeString(e)});Handlebars.registerHelper("number",function(e){if(_.isUndefined(e))return"";return TS.interop.i18n.number(e)||""});Handlebars.registerHelper("buildReplyBarHTML",function(e,t){return new Handlebars.SafeString(TS.templates.builders.buildReplyBarHTML(e,t))});Handlebars.registerHelper("atLabel",function(e){return TS.templates.builders.atLabel(e)});Handlebars.registerHelper("renderAttachmentActions",function(e,t,r){return new Handlebars.SafeString(TS.templates.builders.buildAttachmentActions(e,t,r))});Handlebars.registerHelper("renderAttachmentActionSelectOption",function(e,t){var r=_.merge({},e,{is_group_item:t.hash.is_group_item});var n=TS.templates.attachment_actions_select_option(r);return new Handlebars.SafeString(n)});Handlebars.registerHelper("renderAttachmentMedia",function(e,t){var r;var n=TS.utility.attachments.getMediaType(e);var i;switch(n){case"other":e.other_html&&(r=TS.templates.builders.buildInlineOtherDiv(e.other_html,t,e.safe_other_html));break;case"video":if(e.video_html&&e.thumb_url){i=e.from_url||e.thumb_url;r=TS.templates.builders.buildInlineVideoDiv(i,t)}break;case"image":if(e.image_url){i=e.from_url||e.image_url;var a={};a.flush_with_attachment=true;a.is_giphy_shuffle=e.fallback&&e.fallback.indexOf("giphy")>=0&&e.actions&&e.actions[1]&&"shuffle"===e.actions[1].name;r=TS.templates.builders.buildInlineImgDiv(i,t,a)}break;case"audio":e.audio_html?r=TS.templates.builders.buildInlineAudioDiv(e.audio_html,t,e.safe_audio_html):e.audio_url&&(r=TS.templates.builders.formatSoundUrl(e));break;default:break}if(r)return new Handlebars.SafeString(r)});Handlebars.registerHelper("renderAttachmentFile",function(e,t){var r=TS.files.getFileTemplateArguments(e,null,t);var n="";if(TS.interop.files.isTombstone(e))n=TS.templates.file_tombstone();else if(TS.interop.files.isHiddenByStorageLimit(e))n=TS.templates.file_hidden_by_limit(r);else if(TS.interop.files.fileIsImage(e))n=TS.templates.file_image(s({},r,{file:e}));else{var i=s({},e,{thumb_pdf:void 0,thumb_480:void 0,has_rich_preview:void 0,filetype:"space"===e.filetype||"docs"===e.filetype?"post":e.filetype});n=TS.templates.file_generic(s({},r,{file:i,attachment_file:true,file_is_video:void 0,file_is_audio:void 0,action:TS.interop.files.getMainAction(e,TS.boot_data.feature_file_threads)}))}return new Handlebars.SafeString(n)});Handlebars.registerHelper("getFileMetaText",function(e){var t=TS.interop.rules.files.getFileType(e);var r="image"===t||"snippet"===t;var n=e.pretty_type||TS.interop.i18n.t("file","files");var i=new Handlebars.SafeString(TS.templates.builders.formatFileTitle(e))||e.name||TS.interop.i18n.t("Untitled","files");return r?i:n});Handlebars.registerHelper("shouldIncludeUploaderName",function(e,t,r){var n=e&&t&&e.user!==t.user&&e.bot_id!==t.bot_id;if(n)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("getMemberTypeClass",TS.templates.builders.getMemberTypeClass);Handlebars.registerHelper("inlineSaver",function(e){var t=TS.templates.inline_saver({hide_text:e.hash.hide_text,target:e.hash.target});return new Handlebars.SafeString(t)});Handlebars.registerHelper("dangerouslyRenderHTML",function(e){return new Handlebars.SafeString(e)});Handlebars.registerHelper("attachmentMediaCaret",function(e,t){var r="";var n=TS.utility.attachments.getMediaType(e);var i;switch(n){case"video":i=e.from_url||e.thumb_url;r=TS.templates.builders.buildInlineVideoToggler(i,t,true);break;case"audio":i=e.audio_html||e.audio_url;r=TS.templates.builders.buildInlineAudioToggler(i,t);break;case"other":r=TS.templates.builders.buildInlineOtherToggler(e.other_html,t);break;case"image":i=e.from_url||e.image_url;var a={};a.is_giphy_shuffle=e.fallback&&e.fallback.indexOf("giphy")>=0&&e.actions&&e.actions[1]&&"shuffle"===e.actions[1].name;r=TS.templates.builders.buildInlineImgToggler(i,t,false,a);break;default:r=TS.templates.builders.buildInlineAttachmentToggler(e.from_url,t);break}r&&(r='<span class="media_caret">'+r+"</span>");return new Handlebars.SafeString(r)});Handlebars.registerHelper("isMsgReply",function(e){var t=e.hash.msg;var r=TS.interop.messages.isReply(t);if(r)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("buildMsgHTMLForThreadsView",function(e,t,r,n){var i=TS.templates.builders.buildThreadMsgHTML(e,t,r,n);return new Handlebars.SafeString(i)});Handlebars.registerHelper("buildThreadParticipantListHTML",function(e){return new Handlebars.SafeString(TS.templates.builders.buildThreadParticipantListHTML(e))});Handlebars.registerHelper("getTeamIconOfSize",function(e,t){if(e&&e.icon)return e.icon["image_"+t];return null});Handlebars.registerHelper("listItemCount",function(e){if(_.isUndefined(e)){TS.error("The template helper listItemCount failed because it was passed undefined");return 0}e=TS.utility.parseJSONOrElse(e,e);if(_.isString(e)&&e.length)return e.split(",").length;return e.length});Handlebars.registerHelper("objectKeyCount",function(e){return _.isObject(e)?_.keys(e).length:0});Handlebars.registerHelper("getIconSizeToFit",function(e){return TS.interop.utility.getIconSizeToFit(e,[230,132,102,88,68,44,34])});Handlebars.registerHelper("teamRetentionDuration",function(e){if(e&&TS.interop.rules.channels.isPrivateChannel(e))return TS.prefs.getTeamPref("group_retention_duration");return TS.prefs.getTeamPref("retention_duration")});Handlebars.registerHelper("teamRetentionType",function(e){if(e&&TS.interop.rules.channels.isPrivateChannel(e))return TS.prefs.getTeamPref("group_retention_type");return TS.prefs.getTeamPref("retention_type")});Handlebars.registerHelper("formatWorkspaceDiscoverability",function(e){return TS.utility.enterprise.getWorkspaceVisibilityLabel(e)});Handlebars.registerHelper("escape",function(e){return _.escape(e)});Handlebars.registerHelper("crossWorkspaceJumperLink",function(e){if(!e||!e.id)return"";var t=TS.interop.rules.channels.teamIdForChannelFromAnotherTeam(TS.redux.getState(),e);var r=TS.teams.getTeamById(t);return TS.utility.enterprise.buildTeamUrl(_.get(r,"domain"))+"messages/"+e.id});Handlebars.registerHelper("getTeamIdForChannelFromAnotherTeam",function(e){if(!e)return"";return TS.interop.rules.channels.teamIdForChannelFromAnotherTeam(TS.redux.getState(),e)});Handlebars.registerHelper("pinnedItemFileMessage",function(e){if(!e)return"";if(!TS.interop.messages.shouldRenderFileThread(e))return"";var t=_.first(e.files);if(!t)return"";var r=_.isString(t)?TS.files.getFileById(t):t;if(!r)return"";var n=TS.templates.builders.formatFileTitle(r);var i=TS.interop.i18n.safeString('<a class="file_preview_link" data-file-id="'+r.id+'" href="'+r.permalink+'">'+n+"</a>");var a="";a=e.upload?TS.interop.i18n.t("Uploaded a file: {name}","pinned_item")({name:i}):TS.interop.i18n.t("Shared a file: {name}","pinned_item")({name:i});var s=["greigh"];e.text&&s.push("very_small_top_margin");return new Handlebars.SafeString('<div class="'+s.join(" ")+'">'+a+"</div>")});Handlebars.registerHelper("isDefined",function(e){return void 0!==e})},test:function r(){return{_optionsFnInverseBooleanHelper:e,_inlineImgSrcForFile:t}}});var e=function e(t){"function"!==typeof t.fn&&(t.fn=function(){return true});"function"!==typeof t.inverse&&(t.inverse=function(){return false});return t};var t=function e(t,r){"string"===typeof t&&(t=TS.files.getFileById(t));if(!t)return false;if(!TS.files.fileIsImage(t))return false;r||(r=480);return TS.files.getThumbSrcForFile(t,{maxSize:r})};var r=function e(t){var r;switch(t){case 32:case 36:case 48:r=16;break;case 72:r=22;break;case 192:case 512:break;default:r=16}return r}})()},IZwQ:function(e,t){(function(){TS.registerModule("ui.lazy_filter_select",{STYLES:{default:"default",filter_in_list:"filter_in_list",normal:"normal",small:"small"},onStart:function e(){$("select[data-lazy-filter-select], label[data-lazy-filter-select] select").addClass("hidden").lazyFilterSelect({use_data_attributes:true})},create:function t(r,n){if(n.use_data_attributes){var a=Object.keys(r.data());a.forEach(function(e){if(e.indexOf("lazyFilterSelect")>-1&&"TS-lazyFilterSelect"!==e&&""!==r.data(e)){var t=r.data(e);"true"!==t&&"false"!==t||(t="true"===t);n[e.replace("lazyFilterSelect","").toLowerCase()]=t}})}"SELECT"===r.prop("tagName")&&"undefined"===typeof n.single&&(n.single=!r.prop("multiple"));var s=$.extend({},e,n);void 0===n.approx_divider_height&&(s.approx_divider_height*=1);void 0===n.approx_item_height&&(s.approx_item_height*=1);var o=$('<div class="lazy_filter_select">');s.classes&&o.addClass(s.classes);r.prop("disabled")&&(s.disabled=true);s.disabled&&o.addClass("disabled");s.style=_.get(TS.ui.lazy_filter_select.STYLES,s.style,TS.ui.lazy_filter_select.STYLES.default);if(re(s)&&!s.single){TS.warn("Multi-select lazyFilterSelect instances can't use the 'filter_in_list' style. Using 'default' style instead.");s.style=TS.ui.lazy_filter_select.default}var l=TS.templates.lazy_filter_select_container({instance:s,aria_labelledby:r.attr("aria-labelledby"),STYLES:TS.ui.lazy_filter_select.STYLES});o.html(l);s.append?o.appendTo(r):o.insertAfter(r);o.addClass(s.style+"_style");s.single&&o.addClass("single");s.width&&o.css("width",s.width);s.css&&o.css(s.css);s.$container=o;s.$select=r;s.$input_container=o.find(".lfs_input_container");s.$lfs_value=o.find(".lfs_value");s.$input=o.find(".lfs_input");s.$list_container=o.find(".lfs_list_container");s.$list=o.find(".lfs_list");s.$status=o.find(".lfs_status");s.$status_loading_indicator=s.$status.find(".lfs_status_loading_indicator");s.$status_content=s.$status.find(".lfs_status_content");re(s)?s.$filter_input=o.find(".lfs_filter_input"):s.$filter_input=s.$input;s._page_number=1;s._slug_id_counter=1;s.run=F;if(s.data_promise){D(s)&&s._running_promise.cancel("Uhhh...");s._running_promise=j(s,"").then(function(e){s.data=e;s.run();i(s)},function(e){i(s);TS.interop.utility.getLogger({getState:TS.redux.getState}).error(e,"LFS error");ie(s,e,"Something failed while trying to return the initial data for lazyFilterSelect.")})}else{s.data&&(s.data=s.data.slice());_.forEach(s.data,function(e,t,r){e&&e._is_interop_channel_object&&(r[t]=_.assign({},e))});s.run();i(s)}s.current_items_in_view_signal=new signals.Signal;return s},convertHTMLDataToRLFSData:x,is_list_open:false});var e={allow_item_unselect:false,allow_list_position_above:false,always_visible:false,append:false,approx_divider_height:28,approx_item_height:30,data_promise:null,data_qa:"lfs",disabled:false,filter:function e(t,r){var n=t.toString();r=r.toLowerCase();if(t instanceof jQuery||t instanceof HTMLElement){n=$(t).text();var i=$(t).attr("data-additional-search-field");if(i&&i.toLowerCase().indexOf(r)>-1)return true}return n.toLowerCase().indexOf(r)>-1},input_debounce_wait_time:void 0,listItemClass:null,max_selected_items:Infinity,min_query_length:0,monkey_scroll:true,no_default_selection:false,noResultsTemplate:function e(t){if(ne(this)&&t.length<this.min_query_length)return TS.interop.i18n.t("{query_length, plural, =0 {Start typing to see results\u2026} other {Keep typing to see results\u2026}}","lazy_filter_select")({query_length:t.length});return TS.interop.i18n.t("No items matched {query}","lazy_filter_select")({query:TS.interop.i18n.safeString("<strong>"+_.escape(t)+"</strong>")})},errorTemplate:function e(t){return t||TS.interop.i18n.t("Couldn't load results.","lazy_filter_select")()},onInputBlur:_.noop,onInputFocus:_.noop,onReady:function e(){},onItemAdded:function e(){},onItemRemoved:function e(){},onKeyDown:function e(){},onMaxItemsSelected:function e(){},onListShown:_.noop,onListHidden:_.noop,adjustAvailableSpaceAbove:_.identity,adjustAvailableSpaceBelow:_.identity,placeholder_text:TS.interop.i18n.t("Choose an option\u2026","lazy_filter_select")(),filter_placeholder_text:TS.interop.i18n.t("Search","lazy_filter_select")(),renderDividerFunc:null,render_item_func:null,restrict_input_container_height:false,restrict_preselected_item_removal:false,scroll_threshold:1e3,set_height:true,should_graphic_replace_emoji:false,single:false,sluggify:{enabled:false,delimiter:null,key_name:null,validator:null},style:TS.ui.lazy_filter_select.STYLES.default,template:function e(t){var r=t.toString();var n;var i;if(t instanceof jQuery||t instanceof HTMLElement){r=$(t).text();n=Z($(t).attr("data-additional-search-field"),this);i=Z($(t).attr("data-ts-icon"),this)}r=Z(r,this);n&&(r+=' <span class="addl_text">'+n+"</span>");i&&(r+=' <ts-icon class="addl_icon '+i+'"></ts-icon>');return new Handlebars.SafeString(r)},tokenClass:null,tokenTemplate:null,tokenTemplateSingle:null,use_data_attributes:false,_$active:null,_all_done_fetching:false,_list_built:false,_list_visible:false,_mouse:{},_page_number:1,_prevent_blur:false,_previous_val:"",_running_promise:null,_scroll_callback_was_called:false,_selected:[],_showing_status:false};$.widget("TS.lazyFilterSelect",{_create:function e(){this.instance=TS.ui.lazy_filter_select.create(this.element,this.options)},_destroy:function e(){this.instance.$container.remove();delete this.instance},blur:function e(){this.instance.$filter_input.blur()},clearValue:function e(){if(this.instance.single){if(this.instance._selected.length){var t=this.instance.$input_container.find(".lfs_item");P(this.instance,t)}}else E(this.instance)},container:function e(){return this.instance.$container},disable:function e(){c(this.instance)},disabled:function e(){return this.instance.disabled},enable:function e(){f(this.instance)},focus:function e(){this.instance.$filter_input.focus()},getInstance:function e(){return this.instance},hideList:function e(){T(this.instance,{force:true});le(this.instance)},recomputeHeight:function e(){Q(this.instance)},setValue:function e(t,r){var n=this.element[0].selectedIndex;this.element.val(t);this.element[0].selectedIndex<0&&(this.element[0].selectedIndex=0);var i=this.element[0].options[this.element[0].selectedIndex];if(this.instance.single){if(this.element[0].selectedIndex==n&&!r)return}else E(this.instance);var a=g(this.instance,$(i));N(this.instance,a)},forceSelectItem:function e(t){this.instance.$lfs_value.html(a(this.instance,t,{force_selected:true}));this.instance.$container.addClass("value")},showList:function e(){W(this.instance)},update:function e(t){J(this.instance,t)},updatePlaceholder:function e(t){this.instance.placeholder_text=t;this.instance.$input.prop("placeholder",t)},updateFilterPlaceholder:function e(t){if(!re(this.instance))return;this.instance.filter_placeholder_text=t;this.instance.$filter_input.prop("placeholder",t)},value:function e(){return this.instance._selected}});var t=function e(t,n){if(!v(t))return;if(!n.trim())return;if(!d(t))return;var i={};i[t.sluggify.key_name]=n.trim();i.lfs_id=null;i.lfs_slug_id=t._slug_id_counter;t._slug_id_counter+=1;t._selected.push(i);var a=TS.templates.lazy_filter_select_item({content:t.tokenTemplate(i),applied_classes:"lfs_token",slug_id:i.lfs_slug_id,data_qa:t.data_qa}).replace(/(\r\n|\n|\r)/gm,"");var s=$(a);s.insertBefore(t.$input);t.sluggify.validator&&t.sluggify.validator(s);C(t,t.data);W(t);t.$filter_input.val("");t._previous_val="";r(t);t.onItemAdded(i);d(t)||t.onMaxItemsSelected()};var r=function e(t){if(!t.single){t.$input.prop("size",t.$filter_input.val().length+1);if(t.$filter_input.val().length+t._selected.length===0)G(t);else{t.$input_container.removeClass("empty");t.$input_container.removeClass("error");ee(t)}}};var n=function e(t){t.data_promise&&t.$list.on("scroll",function(){var e=$(this).scrollTop();var r=t.$list.height();var n=t.$list.find(".list_items").height();var i=n-e-r;if(i<=t.scroll_threshold&&!t._scroll_callback_was_called&&!t._all_done_fetching){u(t,t._previous_val,t._page_number+1);t._scroll_callback_was_called=true}else if(i>t.scroll_threshold&&t._scroll_callback_was_called){D(t)&&t._running_promise.cancel("User scrolled back and we do not need to add more data");t._scroll_callback_was_called=false}})};var i=function e(t){t.$container.on("mouseleave",ue.bind(null,t));t.$container.on("click",de.bind(null,t));t.$container.parents("label").on("click",ce.bind(null,t));t.$input_container.on("focus",_e.bind(null,t));t.$input.on("focus",me.bind(null,t));var r;r=_.isUndefined(t.input_debounce_wait_time)?fe:_.debounce(fe,t.input_debounce_wait_time);t.$filter_input.on("input",r.bind(null,t));t.$filter_input.on("keydown",pe.bind(null,t));t.$filter_input.on("blur",he.bind(null,t));t.$lfs_value.on("click",be.bind(null,t));t.$lfs_value.on("mousedown",ye.bind(null,t));t.$input_container.on("click",".lfs_token",we.bind(null,t));t.$input_container.on("mousedown",".lfs_token",ke.bind(null,t));t.$list_container.on("mousedown",xe.bind(null,t));t.$list_container.on("mouseup",Ce.bind(null,t));t.$list_container.on("mousemove",".lfs_item",Me.bind(null,t));t.$list_container.on("mouseleave",".lfs_item.active",Ie.bind(null,t));t.$list_container.on("click",".lfs_item",Ee.bind(null,t));t.onReady()};var a=function e(t,r,n){var i=$(r);n=n||{};var a=n.force_selected||b(t,r);var s=r.disabled||r.lfs_disabled;t.restrict_preselected_item_removal&&r.preselected&&(s=true);var o;o=n.should_tokenize&&_.isFunction(t.tokenTemplate)?t.tokenTemplate(r):t.single&&_.isFunction(t.tokenTemplateSingle)?t.tokenTemplateSingle(r):t.template(r);var l=Z(i.data("lfs-item-desc"),t);var u={active:""!==t._previous_val&&!a&&!s,disabled:s,lfs_token:n.should_tokenize,selected:a,single:t.single,group_item:i.hasClass("group_item")};_.isFunction(t.tokenClass)&&(u[t.tokenClass(r)]=true);return TS.templates.lazy_filter_select_item({content:o,icon:i.data("lfs-item-icon"),desc:new Handlebars.SafeString(l),applied_classes:TS.utility.getAppliedClasses(u),lfs_id:r.lfs_id,data_qa:t.data_qa}).replace(/(\r\n|\n|\r)/gm,"")};var s="position_above";var o="show_status";var l=function e(t){if(!t._list_built&&!t._showing_status)return;t.$list_container.removeClass(s);var r=t.$list.css("max-height");t.$list.css({"max-height":0});var n=t.$list[0].scrollHeight;var i=parseInt(t.$list_container.css("padding-top"),10)+parseInt(t.$list_container.css("padding-bottom"),10)+parseInt(t.$list_container.css("border-top-width"),10)+parseInt(t.$list_container.css("border-bottom-width"),10)+parseInt(t.$list_container.css("margin-top"),10)+parseInt(t.$list_container.css("margin-bottom"),10);re(t)&&(i+=t.$filter_input.outerHeight()+parseInt(t.$filter_input.css("margin-bottom"),10));var a=parseInt(t.$list_container.css("max-height"),10);var o=2*t.approx_item_height+i;var l=Math.min(n+i,a);var u=$(window).height();var d=t.$input_container[0].getBoundingClientRect().bottom+parseInt(t.$input_container.css("margin-bottom"),10);var c=t.adjustAvailableSpaceBelow(u-d);if(t.allow_list_position_above){var _=t.$input_container[0].getBoundingClientRect().top+parseInt(t.$input_container.css("margin-top"),10);var m=t.adjustAvailableSpaceAbove(_);var f=m>=l;var p=c>=l&&c>o;if(f&&!p){c=m;t.$list_container.addClass(s)}}var h=Math.floor(Math.min(c,l)-i);t.$list.css({"max-height":h||r})};var u=function e(t,r,n){D(t)&&t._running_promise.cancel("Scrolling happened");if(t._all_done_fetching)return;t._running_promise=t.data_promise(r,n).then(function(e){var r=e;r.items&&(r=r.items);if(r&&r.length){t._page_number+=1;t._current_data||(t._current_data=t.data.slice());"undefined"!==typeof e.all_items_fetched&&(t._all_done_fetching=!!e.all_items_fetched);"undefined"!==typeof e.num_remaining&&0===e.num_remaining&&(t._all_done_fetching=true);var n;var i=parseInt(e.num_new,10)||0;n=r.slice(-i);if(n.length){e._replace_all_items||e.replace_all_items?t._current_data=n:t._current_data=t._current_data.concat(n);m(t,t._current_data)}else t._all_done_fetching=true}else t._all_done_fetching=true},function(e){TS.interop.utility.getLogger({getState:TS.redux.getState}).error(e,"LFS error");ie(t,e,"Something failed while trying to return the next batch of data for lazyFilterSelect.")})};var d=function e(t){return t._selected.length<t.max_selected_items};var c=function e(t){if(t.disabled)return;t.disabled=true;t.$container.addClass("disabled");t.$input.prop("disabled",true);t.$filter_input.prop("disabled",true)};var m=function e(t,n){I(t,n);C(t,n);var i=t._list_built&&(!t.data||0===t.data.length||t.always_visible);i&&W(t,true);r(t)};var f=function e(t){if(!t.disabled)return;t.disabled=false;t.$container.removeClass("disabled");t.$input.prop("disabled",false);t.$filter_input.prop("disabled",false)};var p=function e(t,r){var n=t.data;var i=[];for(var a=0;a<n.length;a+=1){var s=n[a];if(s.lfs_group||s.is_divider){var o=[];for(var l=0;l<s.children.length;l+=1){var u=s.children[l];t.filter(u,r)&&o.push(u)}o.length>0&&i.push({is_divider:true,lfs_group:true,label:s.label,children:o})}else t.filter(s,r)&&i.push(s)}return i};var h=function e(t){return t.attr("data-lfs-id")||t.prop("lfs_id")||null};var g=function e(t,r,n){var i=h(r);var a;if(n)a=t._selected;else{a=t.data_promise&&t._current_data?t._current_data:t.data;if(-1!==i.indexOf(".")){var s=parseInt(i.split(".")[0],10);a=a[s]?a[s].children:a[0].children}}var o=a.filter(function(e){return e.lfs_id===i});if(o.length)return o[0];return null};var S=function e(t,r){var n=parseInt(r.attr("data-lfs-slug-id"),10);var i=t._selected;var a=i.filter(function(e){return e.lfs_slug_id===n});if(a.length)return a[0];return null};var T=function e(t,r){r=r||{};var n=!t._list_visible||t.always_visible||t.disabled;if(n&&!r.force)return;t._list_visible=false;t.$list_container.removeClass("visible");t.$container.removeClass("list_visible");t.$input_container.removeClass("active");t._list_built&&t.$list.longListView("setHidden",true);t._$active=null;t.onListHidden()};var v=function e(t){if(!t.sluggify.enabled)return false;if(!t.sluggify.delimiter){TS.error("You must pass a delimiter regular expression to use sluggify with lazyFilterSelect.");return false}if(!t.sluggify.key_name){TS.error("You must pass a key name to use sluggify with lazyFilterSelect.");return false}if(t.single){TS.error("Sluggify only works in multi-select versions of lazyFilterSelect.");return false}return true};var b=function e(t,r){if(!t._selected.length)return false;var n=t._selected.filter(function(e){return e.lfs_id===r.lfs_id});return!!n.length};var y=function e(t){if(t instanceof jQuery)return!!t.attr("data-lfs-slug-id");return void 0!==t.lfs_slug_id};var w=function e(t,n,i){if(!v(t))return;if(!y(n))return;var a=$(n);var s=Z(a.data("lfs-item-desc"),t);t._slug_id_counter=Math.max(n.lfs_slug_id,t._slug_id_counter)+1;t._selected.push(n);var o;var l=TS.templates.lazy_filter_select_item({content:t.tokenTemplate(n),icon:a.data("lfs-item-icon"),desc:new Handlebars.SafeString(s),applied_classes:"lfs_token",slug_id:n.lfs_slug_id,data_qa:t.data_qa}).replace(/(\r\n|\n|\r)/gm,"");o=$(l);o.insertBefore(t.$input);r(t);t.sluggify.validator&&t.sluggify.validator(o);t.data=i.filter(function(e){return e.lfs_slug_id!==n.lfs_slug_id});return t.data};var k=function e(t){var r=t.children("option, optgroup");var n=r.length>0?[]:void 0;r.each(function(){if("OPTGROUP"===$(this).prop("tagName")){var e=$(this).children("option").toArray();$(this).prop("disabled")&&(e=e.map(function(e){e.lfs_disabled=true;return e}));n.push({is_divider:true,lfs_group:true,label:$(this).prop("label"),children:e})}else n.push(this)});return n};function x(e){var t=k(e);t=t.map(function(e,t){e instanceof HTMLOptionElement&&(e={id:String(e.lfs_id||t),original_item:e,label:$(e).text(),value:e.value,preselected:e.selected});return e});return t}var C=function e(t,r){r||(r=t.data);if(!r){ie(t);return}if(0===r.length){ae(t);return}le(t,{keep_input_active:true});if(t._list_built){var n=M(r);t.$list.longListView("setItems",n,true);t._current_data=r;Q(t)}else{t.data&&0!==t.data.length||(t.data=r);z(t)}l(t)};var M=function e(t){var r=[];t.forEach(function(e){r.push(e);if(e.children&&e.children.length)for(var t=0;t<e.children.length;t+=1)r.push(e.children[t])});return r};var I=function e(t,r){r||(r=t.data);if(!r)return;var n="";var i=!t.single;var s=0;while(s<r.length){var o=r[s];if(y(o)){r=w(t,o,r);continue}o.children&&o.children.length&&(o.lfs_group=true);if(o.lfs_group||o.is_divider){o.is_divider=true;var l=s;for(var u=0;u<o.children.length;u+=1){var d=o.children[u];d.lfs_id=d.lfs_id||l+"."+u;if((d.selected||d.preselected)&&false===t.no_default_selection){if(t.single&&t._selected.length>0||b(t,d))continue;t._selected.push(d);n+=a(t,d,{should_tokenize:i})}}}else{o.lfs_id=o.lfs_id||String(s);if((o.selected||o.preselected)&&false===t.no_default_selection){if(t.single&&t._selected.length>0||b(t,o)){s+=1;continue}t._selected.push(o);n+=a(t,o,{should_tokenize:i})}}s+=1}if(n.length>0){t.$container.addClass("value");if(t.single)t.$lfs_value.html(n);else{$(n).insertBefore(t.$input);t.$input_container.removeClass("empty");t.$input_container.removeClass("error");ee(t)}}};var E=function e(t){while(t.$input_container.find(".lfs_token").length>0)A(t)};var A=function e(t){var r=t.$input_container.find(".lfs_token").last();r.length&&P(t,r)};var P=function e(t,r){if(t.disabled)return;if(y(r)){O(t,r);return}var n=g(t,r,true);if(n.disabled||t.restrict_preselected_item_removal&&n.preselected)return;t._selected=t._selected.filter(function(e){return e!==n});var i=t.$list.find('[data-lfs-id="'+n.lfs_id+'"]');i.removeClass("selected");r.remove();X(t);t.$filter_input.val().length+t._selected.length===0&&G(t);0===t._selected.length&&t.$container.removeClass("value");t.onItemRemoved(n)};var O=function e(t,r){if(!v(t))return;var n=S(t,r);t._selected=t._selected.filter(function(e){return e!==n});r.remove();X(t);t.$filter_input.val().length+t._selected.length===0&&G(t);t.onItemRemoved(n)};var F=function e(){this.data&&0===this.data.length&&TS.warn("Data passed to lazyFilterSelect is empty.");J(this,this.data);this.always_visible&&W(this);if(this.restrict_input_container_height){this.$container.addClass("has_restricted_input_container_height");TS.environment.supports_custom_scrollbar||this.$input_container.monkeyScroll()}};var H=function e(t,n,i){if(t.disabled)return;if(n===t._previous_val)return;t._all_done_fetching=false;t._previous_val=n;t._$active=null;r(t);t._page_number=1;t._list_built&&t.$list.longListView("scrollToTop",true);if(t.data_promise){D(t)&&t._running_promise.cancel("User entered more text");t._running_promise=j(t,n).then(function(e){m(t,e);W(t,i)},function(e){TS.interop.utility.getLogger({getState:TS.redux.getState}).error(e,"LFS error");ie(t,e,"Something failed while trying to return the filtered data for lazyFilterSelect.")})}else{W(t,i);var a=p(t,n);C(t,a);r(t)}};var j=function e(t,r){return new Promise(function(e,n){if(r.length<t.min_query_length){t._all_done_fetching=true;e([])}else{_.delay(function(){D(t)&&se(t)},650);t.data_promise(r).then(function(r){r=r||{};_.isUndefined(r.all_items_fetched)||(t._all_done_fetching=!!r.all_items_fetched);0===r.num_remaining&&(t._all_done_fetching=true);var n=(r.items||r).slice();e(n);le(t,{keep_input_active:true})},function(e){n(e);le(t)})}})};var D=function e(t){return t._running_promise&&t._running_promise.isPending()};var L=function e(t,r){if(t.disabled)return;if(!t._list_visible){W(t);return}var n;n=t._$active?t._$active[r](".lfs_item:not(.disabled, .hidden)").first():t.$list.find(".lfs_item:not(.disabled, .hidden)").first();if(n.length){n.scrollintoview({duration:0});t._$active&&t._$active.removeClass("active");n.addClass("active");t._$active=n}};var R=function e(t){return!(t.hasClass("selected")||t.hasClass("disabled"))};var N=function e(t,r){if(!d(t))return;if(t.single&&t._selected.length){var n=t.$list.find('[data-lfs-id="'+t._selected[0].lfs_id+'"]');n.removeClass("selected");t._selected.length=0;t.$lfs_value.empty()}t._selected.push(r);X(t);var i=$(a(t,r,{should_tokenize:!t.single}));_.isFunction(t.tokenClass)&&i.addClass(t.tokenClass(r));if(t.single)t.$lfs_value.html(i);else{i.addClass("lfs_token");i.insertBefore(t.$input)}if(!t.single){t.$input_container.removeClass("empty");t.$input_container.removeClass("error");ee(t)}t.$container.addClass("value");t.onItemAdded(r);d(t)||t.onMaxItemsSelected();t.single||t.$filter_input.focus()};var B=function e(t){return L(t,"nextAll")};var U=function e(t){if(t.disabled)return;var r=t._$active;if(!r.length)return;if(!R(r))return;if(!d(t))return;r.addClass("selected");r.removeClass("active");t._$active=null;var n=g(t,r);N(t,n)};var q=function e(t){return L(t,"prevAll")};var G=function e(t){t.$input_container.addClass("empty");te(t)};var W=function e(t,r){if(t.disabled)return;TS.utility.rAF(function(){t.$filter_input.focus()});if(t._list_visible)return;if(t._showing_status&&t.always_visible)return;t._list_built||z(t);if(t._list_built||t._showing_status){t._list_visible=true;t.$list_container.addClass("visible");t.$container.addClass("list_visible");re(t)||t.$input_container.addClass("active");t._list_built&&t.$list.longListView("setHidden",false)}if(t.single&&!r){t.$filter_input.val("");t._previous_val="";t.$filter_input.focus();ne(t)&&(t.data=[]);C(t)}if(t.set_height){l(t);t.monkey_scroll&&!TS.environment.supports_custom_scrollbar&&t.$list.monkeyScroll()}t.onListShown()};var z=function e(t){if(!t.data||0===t.data.length)return;var r=M(t.data);t._list_built=true;var i={items:r,approx_item_height:t.approx_item_height,approx_divider_height:t.approx_divider_height,preserve_dom_order:true,calcDividerHeight:function e(t){return t.outerHeight()},makeDivider:function e(){return $('<div class="lfs_group"></div>')},makeElement:function e(){return $(TS.templates.lazy_filter_select_item().replace(/(\r\n|\n|\r)/gm,""))},renderDivider:function e(r,n,i){if(t.renderDividerFunc)return t.renderDividerFunc(r,n,i);r.html(Z(n.label,t))},renderItem:function e(r,n,i){if(t.render_item_func)return t.render_item_func(r,n,i);var a=$(n);var s="active selected disabled single group_item lfs_token";var o={disabled:n.disabled||n.lfs_disabled,selected:b(t,n),single:t.single,group_item:a.hasClass("group_item")};_.isFunction(t.listItemClass)&&(o[t.listItemClass(n)]=true);var l=TS.utility.getAppliedClasses(o);var u={"data-qa":t.data_qa+"-item-"+n.lfs_id,"data-lfs-id":n.lfs_id,title:n.title};r.attr(u).removeClass(s).addClass(l).html(t.template(n).string);if(a.data("lfs-item-icon")){var d="url("+a.data("lfs-item-icon")+")";var c=$('<span class="lfs_item_icon">').css("background-image",d);r.prepend(c)}if(a.data("lfs-item-desc")){var m=Z(a.data("lfs-item-desc"),t);var f=$('<span class="lfs_item_desc">').html(m);r.append(f)}}};t.$list.longListView(i);n(t);t.$list_items=t.$container.find(".list_items");TS.utility.rAF(function(){t.monkey_scroll&&!TS.environment.supports_custom_scrollbar&&t.$list.monkeyScroll();t.$list.longListView("resizeImmediately");TS.utility.rAF(function(){t.current_items_in_view_signal.dispatch(t.$list.longListView("getCurrentItemsInView")||[])})});t.$list.longListView("getCurrentItemsInViewSignal")&&t.$list.longListView("getCurrentItemsInViewSignal").add(function(e){t.current_items_in_view_signal.dispatch(e)})};var K=function e(t){t.stopPropagation();t.preventDefault()};var V=function e(t,r){if(t.single||!t.allow_item_unselect)return;var n=g(t,r,true);r.removeClass("selected");t._selected=t._selected.filter(function(e){return e!==n});t.$input_container.find('.lfs_item[data-lfs-id="'+n.lfs_id+'"]').remove();X(t);t.$filter_input.val().length+t._selected.length===0&&G(t);0===t._selected.length&&t.$container.removeClass("value");t.onItemRemoved(n)};var Y=function e(t,n){if(!v(t)||!y(n))return;var i=n.text().trim();n.length&&O(t,n);t.$filter_input.val(i);r(t);t.$filter_input.select()};var J=function e(t,r){t.data=r||k(t.$select);if(t.data){t._selected=[];I(t);if(t.$filter_input.val().length){var n=t.$filter_input.val();t._previous_val="";H(t,n)}}};var Q=function e(t){t.restrict_input_container_height&&TS.ui.utility.updateClosestMonkeyScroller(t.$input_container,true);if(t.monkey_scroll&&!TS.environment.supports_custom_scrollbar){l(t);TS.utility.rAF(function(){TS.ui.utility.updateClosestMonkeyScroller(t.$list,true)})}};var X=function e(t){if(t.append)return;var r=t._selected.filter(function(e){return e instanceof HTMLOptionElement}).map(function(e){return $(e).val()});t.$select.val(r).trigger("change")};var Z=function e(t,r){t=_.escape(t);_.get(r,"should_graphic_replace_emoji")&&(t=TS.emoji.graphicReplace(t));return t};var ee=function e(t){t.$input.attr("placeholder","");re(t)&&t.$filter_input.attr("placeholder","")};var te=function e(t){t.$input.attr("placeholder",t.placeholder_text);re(t)&&t.$filter_input.attr("placeholder",t.filter_placeholder_text)};var re=function e(t){return t.style===TS.ui.lazy_filter_select.STYLES.filter_in_list};var ne=function e(t){return _.isFunction(t.data_promise)&&t.min_query_length};var ie=function e(t,r,n){oe(t,t.errorTemplate(r),{internal_error_message:n,clear_active_items:true})};var ae=function e(t){var r=t.noResultsTemplate(t.$filter_input.val());oe(t,r,{clear_active_items:true})};var se=function e(t){var r=TS.interop.i18n.t("Loading results\u2026","lazy_filter_select")();oe(t,r,{show_loading_indicator:true})};var oe=function e(t,r,n){n=n||{};t._showing_status=true;n.internal_error_message&&TS.error(n.internal_error_message);re(t)||t.$input_container.addClass("active");n.show_loading_indicator&&t.$status_loading_indicator.removeClass("hidden");n.clear_active_items&&(t._$active=null);t.$status_content.html(r);t.$list_container.addClass(o)};var le=function e(t,r){r=r||{};t._showing_status=false;r.keep_input_active||t.$input_container.removeClass("active");t.$status_loading_indicator.addClass("hidden");t.$list_container.removeClass(o)};var ue=function e(t){t._prevent_blur=false};var de=function e(t){if(t.disabled)return;W(t)};var ce=function e(t,r){if(t.disabled)return;r.preventDefault();W(t)};var _e=function e(t){t.$input_container.click();t.$input.focus()};var me=function e(t){if(!t._input_is_focused){t._input_is_focused=true;t.$input_container.click();t.onInputFocus()}t.single||t.$input_container.addClass("active")};var fe=function e(r){var n=r.$filter_input.val();if(v(r)&&n.match(r.sluggify.delimiter)){var i=n.split(r.sluggify.delimiter);i.forEach(function(e){e.length&&t(r,e)})}else H(r,n,true)};var pe=function e(t,r){if(t.disabled)return;switch(r.keyCode){case TS.utility.keymap.down:K(r);B(t);break;case TS.utility.keymap.up:K(r);q(t);break;case TS.utility.keymap.enter:ge(t,r);break;case TS.utility.keymap.del:Se(t,r);break;case TS.utility.keymap.tab:Te(t,r);break;case TS.utility.keymap.esc:ve(t,r);break;default:break}t.onKeyDown(r,r.isDefaultPrevented())};var he=function e(t){if(!t._prevent_blur){T(t);le(t)}t._input_is_focused=false;t.onInputBlur()};var ge=function e(t,r){if(t._$active&&t._$active.length&&t._list_visible){K(r);var n=t._$active;var i=!t.single&&t.allow_item_unselect&&b(t,g(t,n));if(i)V(t,n);else{if(!d(t))return;U(t);var a=$(r.currentTarget);if(""!==a.val()){a.val("");t._previous_val="";C(t)}if(t.single){T(t);le(t)}}}};var Se=function e(t,r){if(""===t.$filter_input.val()){K(r);var n=t.$input_container.find(".lfs_token").last();v(t)&&y(n)?Y(t,n):A(t)}};var Te=function e(r,n){if(r.$filter_input.val().trim()&&v(r)){K(n);t(r,r.$filter_input.val())}else if(r.tab_to_nav){K(n);n.shiftKey?q(r):B(r)}};var ve=function e(t,r){K(r);T(t);le(t);t.$filter_input.blur()};var be=function e(t,r){if(t.disabled)return;r.stopPropagation();W(t);t._prevent_blur=false};var ye=function e(t,r){1===r.which&&(t._prevent_blur=true)};var we=function e(t,r){if(t.disabled)return;P(t,$(r.currentTarget));t._prevent_blur=false};var ke=function e(t,r){1===r.which&&(t._prevent_blur=true)};var xe=function e(t,r){1===r.which&&(t._prevent_blur=true)};var Ce=function e(t){t._prevent_blur&&t.$filter_input.focus()};var Me=function e(t,r){if(t.disabled)return;if(r.clientX==t._mouse.lastX&&r.clientY==t._mouse.lastY)return;var n=$(r.currentTarget);t._$active&&t._$active.removeClass("active");if(!n.hasClass("active")&&R(n)){n.addClass("active");t._$active=n}t._mouse.lastX=r.clientX;t._mouse.lastY=r.clientY};var Ie=function e(t,r){$(r.currentTarget).removeClass("active");t._$active=null};var Ee=function e(t,r){if(t.disabled)return;r.preventDefault();var n=$(r.currentTarget);t._$active=n;var i=!t.single&&t.allow_item_unselect&&b(t,g(t,n));if(i)V(t,n);else{var a=R(n);if(!a&&!t.single)return;if(!d(t))return;if(!a&&t.single){T(t);r.stopPropagation();return}U(t);if(""!==t.$filter_input.val()){t.$filter_input.val("");t._previous_val="";C(t)}if(t.single){T(t);r.stopPropagation()}}t._prevent_blur=false}})()},Ijbi:function(e,t){function r(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}e.exports=r},J4zp:function(e,t,r){var n=r("wTVA");var i=r("m0LI");var a=r("wkBT");function s(e,t){return n(e)||i(e,t)||a()}e.exports=s},J7dF:function(e,t){(function(){TS.registerModule("permissions.members",{onStart:function e(){},canThread:function e(t){return TS.interop.rules.channels.canThread(t)},canPostInChannel:function e(t){if(!t)return false;return TS.interop.rules.user.canPostInChannel(t.id)},canPostInGeneral:function e(){return TS.interop.rules.user.canPostInGeneral()},canTriggerCustomResponses:function e(){return TS.interop.rules.user.canTriggerCustomResponses()},canPostInModelOb:function e(t){return TS.permissions.members.canPostInChannel(t)},canNonAdminsAtMentionEveryoneBySettings:function e(){var t=TS.shared.legacyGetActiveModelOb();if(!t)return false;return TS.interop.rules.user.canNonAdminsAtMentionEveryoneBySettings(t.id)},canAtMentionEveryone:function e(t){var r=TS.redux.channels.getEntityById(t)||TS.shared.legacyGetActiveModelOb();if(!r)return false;return TS.interop.rules.user.canAtMentionEveryone(r.id)},canNonAdminsAtChannelOrGroupBySettings:function e(t){return TS.interop.rules.user.canNonAdminsAtMentionEveryoneBySettings(t)},canAtChannelOrGroup:function e(t){var r=TS.redux.channels.getEntityById(t)||TS.shared.legacyGetActiveModelOb();if(!r)return false;return TS.interop.rules.user.canAtChannelOrGroup(r.id)},canArchiveChannels:function t(){if(TS.model.user.is_restricted)return false;return e("who_can_archive_channels",TS.model.user)},canCreateChannels:function e(){return TS.interop.rules.user.canUserCreatePublicChannels()},canCreateGroups:function e(){return TS.interop.rules.user.canUserCreatePrivateChannels()},canCreateMpims:function e(){if(TS.model.user.is_ultra_restricted)return false;return true},canCreateAndDeleteUserGroups:function e(){return TS.interop.userGroups.canCreateAndDeleteUserGroups()},canEditUserGroups:function e(){return TS.interop.userGroups.canEditUserGroups()},canUserSeeMember:function e(t){if(!TS.model.user.is_restricted)return true;if(t.is_self)return true;if(TS.interop.rules.members.isSlackbot(t))return true;return!!_.find(TS.members.getMembersForUser(),function(e){return t.id===e.id})},canKickFromChannels:function e(){return TS.interop.rules.user.canKickFromPublicChannels()},canKickFromGroups:function e(){return TS.interop.rules.user.canKickFromPrivateChannels()},canCreateConvertOrgSharedChannels:function e(){if(!TS.boot_data.page_needs_enterprise)return false;if(TS.model.user.enterprise_user&&TS.model.user.enterprise_user.is_owner)return true;return TS.permissions.members.canManageOrgSharedChannels()},canManageOrgSharedChannels:function e(){if(!TS.prefs.getTeamPref("who_can_manage_shared_channels"))return true;if(!TS.boot_data.page_needs_enterprise)return false;var t=TS.model.user;if(t.is_restricted)return false;if(void 0!==TS.prefs.getTeamPref("can_user_manage_shared_channels"))return TS.prefs.getTeamPref("can_user_manage_shared_channels");var r=TS.prefs.getTeamPref("who_can_manage_shared_channels").type[0];if("regular"===r)return true;if("admin"===r)return t.is_admin||t.is_owner||!!(t.enterprise_user&&(t.enterprise_user.is_admin||t.enterprise_user.is_owner));if("owner"===r){if(t.enterprise_user&&(t.enterprise_user.is_admin||t.enterprise_user.is_owner))return true;if(TS.prefs.getTeamPref("who_can_manage_shared_channels").user&&TS.prefs.getTeamPref("who_can_manage_shared_channels").user.indexOf(TS.model.user.id)>-1)return true;return false}return false},canRequestSharedChannel:function e(){return TS.interop.rules.teams.isSharedChannelsEnabled(TS.redux.getState(),TS.model.team)},canDisconnectSharedChannels:function e(){return TS.interop.rules.user.canUserDisconnectExternalSharedChannel(TS.redux.getState())},canUserInviteToChannel:function e(t){if(!t)return false;return TS.interop.rules.user.canUserInviteToChannel(t.id)},canNonAdminInviteToWorkspace:function e(){if(!TS.model.team||!TS.model.user)return false;if(TS.model.user.is_restricted)return false;return!TS.prefs.getTeamPref("invites_only_admins")||TS.boot_data.page_needs_enterprise&&TS.prefs.getTeamPref("who_can_manage_guests")&&TS.interop.rules.teams.canOrgUserManageGuests(TS.model.team,TS.model.user)},canUserInviteToWorkspace:function e(){if(!TS.model.user)return false;return TS.model.user.is_admin||TS.permissions.members.canNonAdminInviteToWorkspace()},test:function t(){var r={};Object.defineProperty(r,"_checkPrefCascade",{get:function t(){return e},set:function t(r){e=r}});return r}});var e=function e(t,r,n){"undefined"===typeof n&&(n=true);if(r.is_restricted)return"ra"===TS.prefs.getTeamPref(t);if("ra"===TS.prefs.getTeamPref(t))return true;if("regular"===TS.prefs.getTeamPref(t))return true;if("admin"===TS.prefs.getTeamPref(t))return!!r.is_admin;if("owner"===TS.prefs.getTeamPref(t))return!!r.is_owner;return n}})()},Jzty:function(e,t){(function(){TS.registerModule("ui.inline_msg_input",{onStart:_.noop,make:function i(a,s){var o=TS.templates.inline_message_input({input_id:_.uniqueId("inline_message_input_"),include_emo:false,include_plus_button:s.include_plus_button});var l=$(o);l.appendTo(a);var u=l.find(".message_input");s.placeholder&&TS.utility.contenteditable.placeholder(u,s.placeholder);e(l,u,s);t(l,u);s.include_plus_button&&r(l,s);s.scrollIntoView&&n(l,u);return l}});var e=function e(t,r,n){var i=n.onSubmit||_.noop;var a=n.onCancel||_.noop;TS.utility.contenteditable.create(r,{modules:{keyboard:{onUpArrow:function e(){if(!TS.prefs.getPref("arrow_history"))return o(r,false,n)},onUpArrowCmd:function e(){o(r,true,n)}},tabcomplete:{searchOptions:{model_ob:n.model_ob,in_thread:!!n.in_thread},completers:n.completers,positionMenu:function e(t){var i=r.offset();var a=$(window).width()-i.left-2;t.style.width=Math.min(r.outerWidth(),a)+"px";t.style.minWidth=0;TS.tabcomplete.positionUIRelativeToInput(t,r,n.autocomplete_below_input)}}},placeholder:n.placeholder,ariaLabel:n.aria_label,isJumbomojiEnabled:!!n.jumbomoji&&TS.utility.contenteditable.isJumbomojiEnabled,enableBroadcastKeywords:n.enableBroadcastKeywords,onEnter:function e(){s(r,t,i);n.onEnter&&n.onEnter();return false},onEscape:function e(){n.onEscape&&n.onEscape()},onTab:function e(){n.onTab&&n.onTab();return true},onTextChange:function e(){TS.msg_edit.checkLengthAndUpdateMessage(r);n.onTextChange&&n.onTextChange(r)}});TS.utility.contenteditable.enable(r);t.bind("destroyed",function(){a(t)});t.bind("submit",function(e){e.preventDefault();s(r,t,i)})};var t=function e(t,r){var n=t.find(".emo_menu");n.removeClass("hidden");n.bind("click.open_dialog",function(e){TS.ui.react_emoji_menu.start({e:e,input_to_fill:r})})};var r=function e(t,r){var n=r.model_ob,i=r.thread_ts;t.find(".inline_file_upload").click(function(e){e.preventDefault();TS.menu.file.startWithNewFileOptions(e,$(this),{model_ob_id:n.id,thread_ts:i})})};var n=function e(t,r){t.scrollintoview({duration:500,px_offset:100,complete:function e(){TS.utility.contenteditable.focus(r);TS.utility.contenteditable.setCursorAtEnd(r)}})};var i=function e(t,r){var n=t.closest("ts-message");if(r&&n.length){var i=n.data("ts");var a=TS.utility.msgs.getMsg(i,r.msgs);if(a&&TS.interop.messages.canEditMessage(TS.model.user.id,a,r,TS.prefs.getTeamPref("msg_edit_window_mins")))return a}return null};var a=function e(t,r){var n=TS.msg_edit.isMessageTooLong(t);if(n)return false;if(!$.trim(r))return false;return true};var s=function e(t,r,n){var i={enableBroadcastKeywords:false};var s=TS.utility.contenteditable.value(t);s=TS.utility.contenteditable.legacySynchronouslyReplacePotentialMentions(s,i);a(t,s)&&n(r,s)};var o=function e(t,r,n){var i=jQuery.Event("keydown",{altKey:false,shiftKey:false,which:TS.utility.keymap.up});r&&(TS.model.is_mac?i.metaKey=true:i.ctrlKey=true);l(t,n)};var l=function e(t,r){var n=r.getMsgDivForEditing||i;var a=r.model_ob;var s=n(t,a);if(s&&s.length){var o=s.data("ts");var l=s.data("model-ob-id");a=TS.redux.channels.getEntityById(l);var u=s.closest("#convo_container").length>0;var d=u?"convo":null;TS.msg_edit.startEdit(o,a,d)}}})()},L48h:function(e,t){(function(){TS.registerModule("ui.admin_edit_team_profile",{onStart:function e(){$("body").on("click",'[data-action="edit_team_profile_modal"]',TS.ui.admin_edit_team_profile.start)},start:function e(){C()&&a()}});var e;var t;var r;var n=[];var i=50;var a=function e(){var t={body_template_html:TS.templates.admin_edit_team_profile_modal(),onShow:s,onCancel:o};TS.ui.fs_modal.start(t)};var s=function r(){e=$("#edit_team_profile_container");t=$("body");e.on("click",'[data-action="edit_team_profile_to_custom"]',v);e.on("click",'[data-action="edit_team_profile_to_add"]',T);e.on("click",'[data-action="edit_team_profile_to_edit"]',b);e.on("click",'[data-action="edit_team_profile_to_hide"]',y);e.on("click",'[data-action="edit_team_profile_to_delete"]',w);e.on("click",'[data-action="edit_team_profile_cancel"]',S);e.on("click",'[data-action="edit_team_profile_confirm_edit"]',h);e.on("click",'[data-action="edit_team_profile_confirm_hide"]',m);e.on("click",'[data-action="edit_team_profile_confirm_delete"]',c);e.on("click",'[data-action="edit_team_profile_remove_option"]',A);e.on("click",'[data-action="edit_team_profile_add_option"]',P);e.on("focusin",'[data-action="edit_team_profile_update_preview_label"], [data-action="edit_team_profile_update_preview_hint"], .option_header_row + .option_row [data-action="edit_team_profile_update_preview_option"]',H);e.on("focusout",'[data-action="edit_team_profile_update_preview_label"], [data-action="edit_team_profile_update_preview_hint"], .option_header_row + .option_row [data-action="edit_team_profile_update_preview_option"]',j);e.on("input",'[data-action="edit_team_profile_update_preview_label"], [data-action="edit_team_profile_update_preview_hint"], .option_header_row + .option_row [data-action="edit_team_profile_update_preview_option"]',F);e.on("click",'[data-action="edit_team_profile_list_menu"]',N);e.on("input","input",V);t.on("keydown.admin_submit",l);u().then(S).catch(TS.error)};var o=function i(){M(true);e=null;n=[];r=null;t.off("keydown.admin_submit");t=null};var l=function e(t){if(t.which==TS.utility.keymap.enter){$(r).find('button[type="submit"]').trigger("click");return false}};var u=function e(){return TS.team.ensureTeamProfileFields()};var d=function e(t,r){if(!t)return;return TS.interop.api.call(t,r).then(function(e){"team.profile.delete"===t?TS.interop.members.deleteProfileFields(TS.model.team.id,JSON.parse(r.profile).fields):"team.profile.reorder"===t?TS.interop.teams.reorderTeamProfileFields(TS.model.team.id,_.get(e,"data.profile.fields")):TS.interop.members.updateProfileFields(TS.boot_data.team_id,_.get(e,"data.profile.fields"));return Promise.resolve(e)},function(e){return Promise.reject(e)})};var c=function e(t){var r=$(t.target);var n=r.data("id");n||(r=r.closest("[data-id]"));n=r.data("id");if(!n)return;var i=TS.team.getTeamProfileFieldById(n);if(!i)return;g("team.profile.delete",[n]).then(S,_.noop)};var m=function e(t){p(t,true)};var f=function e(t){p(t,false)};var p=function e(t,r){var n=$(t.target);var i=n.data("id");i||(n=n.closest("[data-id]"));i=n.data("id");if(!i)return;var a=TS.team.getTeamProfileFieldById(i);if(!a)return;a=$.extend({},a);a.is_hidden=r;r&&(a.ordering=a.ordering||R());function s(){S();K(i)}g("team.profile.set",[a]).then(s,_.noop)};var h=function t(r){var n=e.find("#edit_team_profile_edit");if(!TS.ui.validation.validate(n,{quiet:true,fast:true})){TS.ui.validation.validate(n);Ladda.stopAll();$("#edit_team_profile_confirm_edit_btn").addClass("disabled");return}var i=$(r.target);var a=i.data("id");a||(i=i.closest("[data-id], [data-type]"));a=i.data("id");var s=e.find('input[name="label"]');var o=e.find('input[name="hint"]');var l=TS.team.getTeamProfileFieldById(a)||{};var u=JSON.stringify(l);l=$.extend({},l);l.type=l.type||i.data("type")||"text";l.label=s.val().trim();l.hint=o.val().trim();l.ordering=l.ordering||R();"options_list"===l.type&&(l.possible_values=e.find('input[name^="option_"]').map(function(){return $(this).val().trim()}).toArray());function d(){S();K(a)}if(JSON.stringify(l)==u){d();Ladda.stopAll()}else g("team.profile.set",[l]).then(d,_.noop)};var g=function e(t,r){r=r&&r.length?r:TS.model.team.profile.fields;var n={profile:JSON.stringify({fields:r})};return d(t,n).catch(function(e){if("no_perms"!==e.data.error&&"missing_scope"!==e.data.error){if("field_bad_order"===e.data.error){TS.error("Failed to create profile field: "+e.data.error);return TS.generic_dialog.alert(TS.interop.i18n.t("Apologies, but the maximum number of profile fields you can add is {max_no_of_fields, number}. Please remove some existing fields if you\u2019d like to add different ones.","team_profile")({max_no_of_fields:i}))}TS.error("Failed to customize profile: "+e.data.error);return TS.generic_dialog.alert(TS.interop.i18n.t("Sorry! Something went wrong. Please try again.","team_profile")())}var t=TS.boot_data.page_needs_enterprise;var r=t?TS.interop.i18n.t("Sorry! An organization owner or admin is required to update this setting.","team_profile","21d269f8b1a2802d90b32308195ac5b67c9413f6")():TS.interop.i18n.t("Sorry! An owner in your workspace has restricted who can customize your members\u2019 profile.","team_profile")();TS.generic_dialog.start({body:r,show_cancel_button:false,esc_for_ok:true,fullscreen:false,onEnd:TS.ui.fs_modal.close})}).finally(Ladda.stopAll)};var S=function t(){n.length=0;n.push({back:t});var r={};r.team_profile_fields=q();r.hidden_team_profile_fields=G();r.default_team_profile_fields=z();var i=TS.templates.admin_edit_team_profile_list(r);e.find("#edit_team_profile_header").text(TS.interop.i18n.t("Customize profile","team_profile")()).removeClass("hidden center_and_narrow");var a;a=TS.model.team.profile&&TS.model.team.profile.fields.length>=50?'<div class="alert alert_info"><i class="ts_icon ts_icon_info_circle"></i>'+TS.interop.i18n.t("You have reached the maximum number of fields that can be added to profiles.","team_profile")()+"</div>":TS.interop.i18n.t("Expand your members\u2019 profiles by adding additional fields below","team_profile")();e.find("#edit_team_profile_value_note").html(a).removeClass("hidden center_and_narrow");e.find("#edit_team_profile_list").html(i);U("#edit_team_profile_list");L();x();M(true)};var T=function t(){n.push({back:t});var r={};r.default_team_profile_fields=z();var i=TS.templates.admin_edit_team_profile_add(r);e.find("#edit_team_profile_header").text(TS.interop.i18n.t("Select a field type","team_profile")()).removeClass("center_and_narrow");e.find("#edit_team_profile_value_note").addClass("hidden");e.find("#edit_team_profile_add").html(i);U("#edit_team_profile_add");x();M()};var v=function t(){n.push({back:t});var r=TS.templates.admin_edit_team_profile_custom();e.find("#edit_team_profile_header").text(TS.interop.i18n.t("Create a new field","team_profile")()).removeClass("center_and_narrow");e.find("#edit_team_profile_value_note").text(TS.interop.i18n.t("Which type of field would you like to create?","team_profile")()).removeClass("hidden center_and_narrow");e.find("#edit_team_profile_custom").html(r);U("#edit_team_profile_custom");x();M();D()};var b=function t(r){var i=$(r.target);if(i.hasClass("ts_icon_grabby_patty"))return false;var a=i.data("id");a||(i=i.closest("[data-id], [data-type]"));a=i.data("id");var s={};var o;if(a){s=TS.team.getTeamProfileFieldById(a);if(!s)return;o=TS.interop.i18n.t("Edit profile field","team_profile")()}else{s.type=i.data("type");s.label=i.data("label");o=TS.interop.i18n.t("Customize profile field","team_profile")()}r.stopPropagation();n.push({back:t,event:r});var l=TS.templates.admin_edit_team_profile_edit(s);e.find("#edit_team_profile_header").text(o).removeClass("center_and_narrow");e.find("#edit_team_profile_value_note").addClass("hidden");e.find("#edit_team_profile_edit").html(l);U("#edit_team_profile_edit");I();E();D();Ladda.bind("#edit_team_profile_confirm_edit_btn");x();M();V()};var y=function t(r){var i=$(r.target);var a=i.data("id");a||(i=i.closest("[data-id]"));a=i.data("id");if(!a)return;var s=TS.team.getTeamProfileFieldById(a);if(!s)return;r.stopPropagation();n.push({back:t,event:r});var o=TS.templates.admin_edit_team_profile_hide({id:s.id,can_delete:!_.get(s,"options.is_scim",false)});var l=TS.interop.i18n.t('Hide "{field_label}"',"team_profile")({field_label:s.label});e.find("#edit_team_profile_header").text(l).addClass("center_and_narrow");var u=TS.interop.i18n.t("All data entered for this field will no longer be visible on your members\u2019 profiles. You can un-hide it later.","team_profile")();e.find("#edit_team_profile_value_note").text(u).addClass("center_and_narrow").removeClass("hidden");e.find("#edit_team_profile_hide").html(o);U("#edit_team_profile_hide");Ladda.bind("#edit_team_profile_confirm_hide_btn");k();M()};var w=function t(r){var i=$(r.target);var a=i.data("id");a||(i=i.closest("[data-id]"));a=i.data("id");if(!a)return;var s=TS.team.getTeamProfileFieldById(a);if(!s)return;r.stopPropagation();n.push({back:t,event:r});var o=TS.templates.admin_edit_team_profile_delete(s);var l=TS.interop.i18n.t('Delete "{field_label}"',"team_profile")({field_label:s.label});e.find("#edit_team_profile_header").text(l).addClass("center_and_narrow");var u=TS.interop.i18n.t("<strong>Are you sure?</strong> All data associated with this field will be permanently deleted. This <strong>cannot be undone</strong>.","team_profile")();e.find("#edit_team_profile_value_note").html(u).addClass("center_and_narrow").removeClass("hidden");e.find("#edit_team_profile_delete").html(o);U("#edit_team_profile_delete");Ladda.bind("#edit_team_profile_confirm_delete_btn");k();M()};var k=function t(){e.closest(".contents").addClass("display_flex flex_direction_column").css("height","70vh");e.css({margin:"auto 0",height:"auto","padding-top":0})};var x=function t(){e.closest(".contents").removeClass("display_flex flex_direction_column").css("height","");e.css({margin:"",height:"","padding-top":""})};var C=function e(){if(!(TS.model.team&&TS.model.team.plan))return false;var t=TS.model.user;if(!t)return false;if("admin"===TS.prefs.getTeamPref("who_can_change_team_profile"))return t.is_admin;if("owner"===TS.prefs.getTeamPref("who_can_change_team_profile"))return t.is_owner;return true};var M=function e(t){if(t){TS.ui.fs_modal.unbindBackButton();TS.ui.fs_modal.hideBackButton()}else{TS.ui.fs_modal.bindBackButton(function(){n.pop();var e=n.pop();e.back(e.event)});TS.ui.fs_modal.showBackButton()}};var I=function t(){var r=e.find(".option_row");r.length>=3?r.addClass("show_remove_action"):r.removeClass("show_remove_action")};var E=function t(){F({target:e.find('.option_header_row + .option_row [data-action="edit_team_profile_update_preview_option"]')})};var A=function e(t){$(t.target).closest(".row.option_row").remove();V();I();E();O()};var P=function t(){var r=TS.templates.admin_edit_team_profile_option_row({index:e.find(".row.option_row").length});e.find("#option_rows").append(r).find(".row.option_row").last().find("input").focus();V();I();O()};var O=function t(){50===e.find(".row.option_row").length?e.find('[data-action="edit_team_profile_add_option"]').addClass("hidden").next().removeClass("hidden"):e.find('[data-action="edit_team_profile_add_option"]').removeClass("hidden").next().addClass("hidden")};var F=function t(r){var n=$(r.target);var i=n.val();i&&(i=i.trim());void 0===i||i.length||(i=n.data("default"));e.find('.profile_field_preview [data-id="'+n.data("target")+'"]').text(i)};var H=function t(r){var n=e.find('.profile_field_preview [data-id="'+$(r.target).data("target")+'"]');var i=n.closest("select");i.length&&(n=i);n.addClass("highlight_yellow_bg")};var j=function t(r){var n=e.find('.profile_field_preview [data-id="'+$(r.target).data("target")+'"]');var i=n.closest("select");i.length&&(n=i);n.removeClass("highlight_yellow_bg")};var D=function t(){var r=e.find(".edit_team_profile_lazy_filter_select");if(!r.length)return;var n="USLACKBOT";TS.boot_data.feature_deprecate_get_member_by_name||(n=TS.interop.members.getMemberByName("slackbot").id);var i={append:true,classes:"disabled",preselected_ids:[n]};TS.ui.people_picker.make(r,i)};var L=function t(){e.find("#edit_team_profile_list_drag_and_drop_area").sortable({items:".visible_row[data-id]",handle:".ts_icon_grabby_patty",forcePlaceholderSize:true}).on("sortupdate",function(e){e.stopPropagation();var t=[];$(this).find(".row[data-id]").each(function(e){var r=TS.team.getTeamProfileFieldById($(this).data("id"));if(r&&r.ordering!=e){r.ordering=e;t.push({id:r.id,ordering:e})}});var r=TS.team.sortTeamProfileFieldsByOrdering(TS.model.team.profile.fields);TS.redux.teams.upsertTeam(_.assign({},TS.model.team,{profile:{fields:r}}));g("team.profile.reorder",t)})};var R=function e(){if(!TS.model.team.profile.fields.length)return 0;return _.max(TS.model.team.profile.fields.map(function(e){return e.ordering}))+1};var N=function e(t){t.stopPropagation();var r=$(t.target).closest("[data-id]").get(0);var n={};n.is_scim=$(t.target).closest("[data-is-scim]").data("is-scim");var i=jQuery.Event("click",{target:r,currentTarget:r});TS.menu.startWithEditTeamProfileListActions(i,B,n)};var B=function e(t){t.preventDefault();var r=$(t.target).closest("[data-id]");r.is('[data-action="edit_team_profile_to_show"]')?f(t):r.is('[data-action="edit_team_profile_to_hide"]')?y(t):r.is('[data-action="edit_team_profile_to_delete"]')&&w(t);TS.menu.end()};var U=function t(n){var i=["#edit_team_profile_loading","#edit_team_profile_list","#edit_team_profile_add","#edit_team_profile_custom","#edit_team_profile_edit","#edit_team_profile_hide","#edit_team_profile_delete"].filter(function(e){return e!==n}).join(", ");e.find(i).addClass("hidden");e.find(n).removeClass("hidden");r=n};var q=function e(){var t=TS.team.getVisibleTeamProfileFields();return t.length?t:null};var G=function e(){var t=TS.team.getHiddenTeamProfileFields();return t.length?t:null};var W=function e(){return TS.model.team.profile.fields.reduce(function(e,t){e[t.label.toLowerCase()]=true;return e},{})};var z=function e(){var t=W();var r=[{type:"text",label:TS.interop.i18n.t("Address","team_profile")()},{type:"date",label:TS.interop.i18n.t("Birthdate","team_profile")()},{type:"user",label:TS.interop.i18n.t("Direct Reports","team_profile")()},{type:"link",label:TS.interop.i18n.t("Facebook","team_profile")()},{type:"link",label:TS.interop.i18n.t("Flickr","team_profile")()},{type:"link",label:TS.interop.i18n.t("GitHub","team_profile")()},{type:"link",label:TS.interop.i18n.t("Instagram","team_profile")()},{type:"link",label:TS.interop.i18n.t("LinkedIn","team_profile")()},{type:"user",label:TS.interop.i18n.t("Manager","team_profile")()},{type:"link",label:TS.interop.i18n.t("Pinterest","team_profile")()},{type:"text",label:TS.interop.i18n.t("Skype","team_profile")()},{type:"link",label:TS.interop.i18n.t("SoundCloud","team_profile")()},{type:"date",label:TS.interop.i18n.t("Start Date","team_profile")()},{type:"link",label:TS.interop.i18n.t("Tumblr","team_profile")()},{type:"link",label:TS.interop.i18n.t("Twitter","team_profile")()},{type:"link",label:TS.interop.i18n.t("YouTube","team_profile")()}].filter(function(e){return!t[e.label.toLowerCase()]});return r.length?r:[]};var K=function t(r){var n=r?"[data-id="+r+"]":".visible_row[data-id]";var i=e.find("#edit_team_profile_list").find(n).last();var a=-2*i.outerHeight();i.highlight(1500,"",null,0);i.scrollintoview({duration:200,px_offset:a,direction:"y"})};var V=function t(){$("#edit_team_profile_confirm_edit_btn").toggleClass("disabled",!TS.ui.validation.validate(e.find("#edit_team_profile_edit"),{quiet:true,fast:true}))}})()},LzIY:function(e,t){(function(){TS.registerModule("compression",{compress:function e(t,r,i,s){var o=Date.now();if(i){var l=LZString.compress(r);var u=Date.now()-o;TS.has_pri[a]&&TS.log(a,t+" took "+u+"ms to _compress immediately str.length: "+r.length);return s({k:t,str:l})}n(t,r,function(e,r){var n=Date.now()-o;TS.has_pri[a]&&TS.log(a,t+" took "+n+"ms for the compression worker to callback ("+r+"ms spent within the worker) result.length: "+e.length);s({k:t,str:e})})},deCompress:function e(t,r){return""},terminate:function t(){e&&e.terminate();e=null}});var e=null;var t=0;var r={};var n=function n(a,s,o){e||i();t+=1;var l="job_key"+t;r[l]=function(e,t){o(e,t);delete r[l]};e.postMessage({request:"compress",input:s,job_key:l,k:a})};var i=function t(){if(e){TS.error("_makeWorker but there is a _worker");return}var n=_.get(TS,"boot_data.vvv_paths.lz_string","/js/libs/lz-string-1.4.4.js");var i=TS.environment.is_dev;(TS.qs_args.local_assets||i)&&0!==n.indexOf("http")&&(n=location.protocol+"//"+location.host+n);e=TS.utility.makeWebWorker("function() {\t\t\tself.importScripts('"+n+"');\t\t\tself.onmessage = function(e) {\t\t\t\tvar start = Date.now();\t\t\t\tvar result;\t\t\t\tif (e.data.request === 'compress') {\t\t\t\t\tresult = LZString.compress(e.data.input)\t\t\t\t}\t\t\t\tvar elapsed = Date.now() - start;\t\t\t\tpostMessage({\t\t\t\t\trequest: e.data.request,\t\t\t\t\tresult: result,\t\t\t\t\tjob_key: e.data.job_key,\t\t\t\t\tk: e.data.k,\t\t\t\t\telapsed: elapsed\t\t\t\t});\t\t\t}\t\t}",function(e){var t=r[e.data.job_key];if(!t){TS.error("e.data.job_key:"+e.data.job_key+" had no record in _callbacks??");return}t(e.data.result,e.data.elapsed)})};var a=488})()},Nwtb:function(e,t){(function(){TS.registerModule("tips.texty",{onStart:function t(){e.delegate(".ts_tip_texty","mouseenter",r);e.delegate(".ts_tip_texty","mouseleave",n)},show:function e(t,r){i(t,r)},hide:function e(){a()},isShowing:function e(){return t}});var e=$("BODY");var t=false;var r=function e(t){i(t.target)};var n=function e(){a()};var i=function r(n,i){var a=$(n).closest(".ql-container");if(!a.length||a.hasClass("texty_hide_tooltips"))return;if(TS.boot_data.feature_sonic_inputs&&a.hasClass("p-message_input_field"))return;var s=n.getAttribute("data-title")||null;var o=n.getAttribute("data-id")&&"UNVERIFIED"!==n.getAttribute("data-id")?TS.interop.members.getMemberById(n.getAttribute("data-id")):null;$("#ts_tip_texty_tip").remove();if(!s&&!o)return;var l=$('<div id="ts_tip_texty_tip"'+(i?' class="ts_tip_texty_slow"':"")+"></div>");var u=n.getBoundingClientRect();TS.interop.mountTooltipTip(TS.boot_data.team_id,l[0],o?o.id:null,{children:s,position:"top",className:o?"c-tooltip__tip--member":""});e.append(l);var d=e.height()-u.top;var c=u.left;c-=l.width()/2;c+=u.width/2;l.css({bottom:d+"px",left:c+"px",opacity:1});t=true};var a=function e(){if(TS.boot_data.feature_sonic_inputs)return;var r=document.getElementById("ts_tip_texty_tip");if(!r)return;var n=$(r).hasClass("ts_tip_texty_slow")?200:100;$(r).fadeOut(n,function(){TS.interop.unmountTooltipTip(r);$(r).remove();t=false})}})()},Nyv6:function(e,t){(function(){TS.registerModule("utility.enterprise",{getSelf:function e(){return _.get(TS.enterprise.model.get(),"org.user")},splitQueryIntoTerms:function e(t,r,n){var i=r;var a;t=t.trim();if(t.length>=2){i=_.isArray(r)?_.slice(r):[];a=t.split(/\s+/);_.each(a,function(e){i.push({type:n||"fuzzy_with_email",value:e})})}return i},doFormatSearchQuery:function e(t,r,n){r=r||"";var i=[];switch(t){case"members":i.push({type:"is",value:"user"});n&&!_.isEqual(n,"all")&&i.push(TS.utility.enterprise.doFormatMemberFilterClauses(n));break;case"groups":i.push({type:"is",value:"group"});break;case"teams":i.push({type:"is",value:"team"});break;default:}return{query:TS.utility.enterprise.splitQueryIntoTerms(r,i)}},doFormatMemberFilterClauses:function e(t){switch(t){case"admins":return{type:"or",clauses:[{type:"level",value:"admin"},{type:"level",value:"owner"},{type:"level",value:"primary_owner"}]};case"guests":return{type:"or",clauses:[{type:"level",value:"restricted"},{type:"level",value:"ultra_restricted"},{type:"level",value:"invited_guest"}]};case"invited":return{type:"or",clauses:[{type:"level",value:"invited"},{type:"level",value:"invited_guest"}]};case"members":default:return{type:"level",value:"regular"}}},getSSOProviderLabel:function e(t,r){if(!t)return r;var n=_.get(t,"type","");var i=_.get(t,"name","");var a=""===n;var s="saml"===n;if(a||s)return r;return i||r},getProviderLabel:function e(t,r){var n=r||"IDP";if(!t)return n;r=_.get(t,"saml_provider")||n;"saml"===r.toLowerCase()&&(r=n);return TS.utility.enterprise.getSSOProviderLabel(_.get(t,"sso_provider"),r)},getWorkspaceVisibilityLabel:function e(t){switch(t){case"open":return TS.interop.i18n.t("Open","enterprise_dashboard")();case"unlisted":return TS.interop.i18n.t("Hidden","enterprise_dashboard")();case"closed":return TS.interop.i18n.t("By Request","enterprise_dashboard")();case"invite_only":return TS.interop.i18n.t("Invite Only","enterprise_dashboard")();default:return t}},getGroupsTitle:function e(t){var r=TS.utility.enterprise.getProviderLabel(t);if("IDP"===r)return TS.interop.i18n.t("IDP Groups","enterprise_dashboard")();return TS.interop.i18n.t("{provider_label} Groups","enterprise_dashboard")({provider_label:r})},wrapWithStrongTags:_.wrap(_.escape,function(e,t){return"<strong>"+e(t)+"</strong>"}),buildTeamUrl:function e(t){return"https://"+(t||"my")+"."+TS.boot_data.abs_root_url.replace(/(http:\/\/|https:\/\/)/,"")},buildOrgUrl:function e(t){return"https://"+t+".enterprise."+TS.boot_data.abs_root_url.replace(/(http:\/\/|https:\/\/)/,"")},getSanitizedIdpLabel:function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.locale,i=void 0===n?TS.interop.i18n.locale:n;return{simple:"IDP"!==t&&t?t:"",your:"IDP"!==t&&t?t:TS.interop.i18n.t("your IdP","enterprise_utility")(),possessive:"IDP"!==t&&t?TS.interop.i18n.fullPossessiveString(t,{locale:i}):TS.interop.i18n.t("your IdP\u2019s","enterprise_utility")()}},formatChannelsData:function e(t){var r=[];if(t.private_channels){t.private_channels=_.isArray(t.private_channels)?t.private_channels:[t.private_channels];r=_.map(t.private_channels,function(e){var t=TS.interop.members.getMemberById(e.creator)||{};var r=e.members;var n=Array.isArray(r)?r.length:e.members;var i={creator_display:t.real_name?t.real_name:t.name,creator_id:e.creator,creator_username:t.name,date_created:e.created,member_count:e.member_count||n,purpose:e.purpose.value,topic:e.topic.value,private:true};return _({}).assign(e,i).omit("members").value()})}t.channels&&(r=r.concat(_.map(t.channels,function(e){var t=TS.interop.members.getMemberById(e.creator)||{};var r=e.members;var n=Array.isArray(r)?r.length:e.members;var i={creator_display:t.real_name?t.real_name:t.name,creator_id:e.creator,creator_username:t.name,date_created:e.created,member_count:n||0,purpose:_.get(e,"purpose.value",""),topic:_.get(e,"topic.value",""),private:false};return _({}).assign(e,i).omit("members").value()})));return r},pollUntilCondition:function e(t){return new Promise(function(e,r){var n={api_method:null,api_params:{},condition_method:null,interval:5e3,interval_backoff:1e3,attempts_max:10,call_immediately:true};t=_.merge(n,t||{});var i={attempts:0,last_api_response:null,interval:parseInt(t.interval,10)||1e3,interval_backoff:parseInt(t.interval_backoff,10)||0};function a(){if(i.attempts>=t.attempts_max)return r(new Error("Giving up on "+t.api_method+", reached max attempts of "+t.attempts_max));i.attempts+=1;i.interval+=i.interval_backoff;TS.interop.api.call(t.api_method,t.api_params).then(function(r){i.last_api_response=r;if(t.condition_method(r))return e(r);return s()}).catch(function(e){i.last_api_response=e;return s()})}function s(){window.setTimeout(a,i.interval)}if(!t.api_method)return r(new Error("missing required api_method in params"));if(!t.condition_method)return r(new Error("missing required condition_method in params"));t.call_immediately?a():s()})},getUserRoleLabel:function e(t,r){var n;var i;n=r?{primary_owner:TS.interop.i18n.t("Primary Org Owner","enterprise_dashboard")(),owner:TS.interop.i18n.t("Org Owner","enterprise_dashboard")(),admin:TS.interop.i18n.t("Org Admin","enterprise_dashboard")(),single_channel_guest:TS.interop.i18n.t("Single-Channel Guest","enterprise_dashboard")(),multi_channel_guest:TS.interop.i18n.t("Multi-Channel Guest","enterprise_dashboard")(),member:TS.interop.i18n.t("Member","enterprise_dashboard")()}:{primary_owner:TS.interop.i18n.t("Primary Owner","enterprise_dashboard")(),owner:TS.interop.i18n.t("Owner","enterprise_dashboard")(),admin:TS.interop.i18n.t("Admin","enterprise_dashboard")(),single_channel_guest:TS.interop.i18n.t("Single-Channel Guest","enterprise_dashboard")(),multi_channel_guest:TS.interop.i18n.t("Multi-Channel Guest","enterprise_dashboard")(),member:TS.interop.i18n.t("Member","enterprise_dashboard")()};i=t.is_ultra_restricted?n.single_channel_guest:t.is_restricted?n.multi_channel_guest:t.is_primary_owner?n.primary_owner:t.is_owner?n.owner:t.is_admin?n.admin:n.member;return i},buildAnalyticsApiOptionsFor:function e(t){var r=function e(t){return _.reduce(t,function(e,t,r){var n=TS.enterprise.model.get(["analytics",t]);n&&(e[r]=n);return e},{})};switch(t){case"teams":return r({query:"teams_search_term",sort_prefix:"teams_sort_prefix",sort_dir:"teams_sort_dir",cursor_mark:"teams_api_cursor",date_range:"current_date_range",start_date:"start_date",end_date:"end_date"});case"team_overview":return r({date_range:"current_date_range",start_date:"start_date",end_date:"end_date",team_id:"team_overview_id"});case"members":return r({query:"members_search_term",sort_prefix:"members_sort_prefix",sort_dir:"members_sort_dir",cursor_mark:"members_api_cursor",date_range:"current_date_range",start_date:"start_date",end_date:"end_date"});case"channels":return r({query:"channels_search_term",sort_prefix:"channels_sort_prefix",sort_dir:"channels_sort_dir",cursor_mark:"channels_api_cursor",date_range:"current_date_range",start_date:"start_date",end_date:"end_date"});default:return r({date_range:"current_date_range",start_date:"start_date",end_date:"end_date"})}},maybeGetUpdatedAtTime:function e(t){return t?TS.interop.datetime.toTimeAgo(t):null},getObjectsForIds:function e(t,r){if(_.isEmpty(t)||_.isEmpty(r))return[];return _.intersectionWith(t,r,function(e,t){return e.id===t})},getQueryForIds:function e(t){if(_.isEmpty(t))return;if(1===t.length)return{query:{type:"id",value:_.head(t)}};return{query:{type:"or",clauses:_.map(t,function(e){return{type:"id",value:e}})}}},buildApiOptionsForAnalyticsCSVExport:function e(t){var r={};t.type&&(r.type=t.type);t.date_range&&(r.date_range=t.date_range);_.get(t.selected_columns,"length")&&(r.cols=t.selected_columns.join(","));t.team_id&&(r.team_id=t.team_id);if(t.sort_prefix){r.sort_prefix=t.sort_prefix;t.sort_dir&&(r.sort_dir=t.sort_dir)}if(t.search_term){var n=TS.utility.enterprise.splitQueryIntoTerms(t.search_term,[],"fuzzy_with_email");if(n.length){var i=1===n.length?_.head(n):{type:"and",clauses:n};r.query=JSON.stringify(i)}}return r},recordAnalyticsPricingEvents:function e(t,r,n){n=n||{};var i={};switch(r){case"overview_impression":i.action="impression";i.step="team_stats_overview";break;case"coachmark_impression":i.action="impression";i.step="team_stats_overview_"+_.get(n,"callout_module")+"_coachmark";break;case"coachmark_resolve":i.action="click";i.step="team_stats_overview_"+_.get(n,"callout_module")+"_coachmark";i.ui_element="learn_more_btn";break;case"coachmark_reject":i.action="dismiss";i.step="team_stats_overview_"+_.get(n,"callout_module")+"_coachmark";i.ui_element="skip_this";break;case"msg_files_pricing_btn_click":i.action="click";i.step="team_stats_overview";i.ui_element="msg_files_chart_link_btn";break;case"single_callout_upgrade_link_impression":i.action="impression";i.step="team_stats_overview";i.ui_element=_.get(n,"callout_module")+"_upgrade_link";break;case"multi_callout_upgrade_link_impression":i.action="impression";i.step="team_stats_overview";i.ui_element="multi_lim_upgrade_link";break;case"data_table_upsell_banner_impression":i.action="impression";i.step="team_stats_"+_.get(n,"report_name");break;case"data_table_upsell_banner_click":i.action="click";i.step="team_stats_"+_.get(n,"report_name");i.ui_element="see_pricing_plans_btn";break;default:}TS.interop.clog.track(t,{contexts:{ui_context:i}})},recordAnalyticsImpression:function e(t,r,n,i,a){var s="ENTERPRISE_ANALYTICS";var o={};var l={};o.action="impression";o.ui_element=r;l.entity_key=n;l.tracking_code=i;l.anchor_page=t;l.target_team_id=a||(TS.enterprise.model.get("org.enterprise.id")||_.get(TS.boot_data,"team_id"));TS.interop.clog.track(s,_.assign({},l,{contexts:{ui_context:o}}))},recordAnalyticsTooltipHover:function e(t){var r="ENTERPRISE_ANALYTICS";var n={};var i={};n.action="hover";n.ui_element="NOTING_BADGE";i.entity_key=t;var a=TS.enterprise.model.get("org.enterprise.id");var s=TS.enterprise.model.get("analytics.overview_open");if(a&&!s){i.anchor_page="organization_overview";i.target_team_id=a}else if(s){i.anchor_page="workspace_overview";i.target_team_id=TS.enterprise.model.get("analytics.team_overview_id")}else{i.anchor_page="workspace_overview";i.target_team_id=_.get(TS.boot_data,"team_id")}TS.interop.clog.track(r,_.assign({},i,{contexts:{ui_context:n}}))},recordAnalyticsSearchEvent:function e(t,r,n){var i="ENTERPRISE_ANALYTICS";var a={};var s={};a.action="impression";a.action_status=n?2:1;a.ui_element="SEARCH_BAR";s.entity_key=r;s.anchor_page=t;s.target_team_id=TS.enterprise.model.get("org.enterprise.id")||_.get(TS.boot_data,"team_id");TS.interop.clog.track(i,_.assign({},s,{contexts:{ui_context:a}}))},convertDateRangeToThriftID:function e(t){switch(t){case"30d":return"FILTER_LAST_30DAYS";case"all":return"FILTER_ALL_TIME";default:}},convertTimeseriesTabToClogKey:function e(t){switch(t){case"active-users_weekly_active_users":return"wau_ts";case"active-users_daily_active_users":return"dau_ts";case"messages-and-files_messages_sent":return"messages_sent_ts";case"messages-and-files_files_uploaded":return"files_uploaded_ts";case"transparency_where_messages_sent":return"transparency_sent_ts";case"transparency_where_messages_read":return"transparency_read_ts";default:}},getNumberAnnotation:function e(t){var r="";if("ja-JP"===TS.interop.i18n.locale)switch(t){case"channels":case"messages":r="\u4ef6";break;case"users":r="\u4eba";break;case"files":case"apps":r="\u500b";break;default:}return r}})})()},OHyl:function(e,t){(function(){TS.registerModule("ui.react_emoji_menu",{is_showing:false,onStart:function e(){TS.prefs.emoji_mode_changed_sig.add(w)},start:function e(t){c(t)}});var e=15;var t=0;var r=-6;var n="top-left";var i="reactroot_emoji_picker";var a;var s;var o="#msg_input";var l;var u;var d;var c=function e(t){l=t.rxn_key;u=l?function e(r){var n=!TS.rxns.doesRxnsHaveRxnFromUser(TS.rxns.getExistingRxnsByKey(t.rxn_key),r);TS.rxns.changeRxnsFromUserAction(t.rxn_key,r,n);t.callback&&t.callback()}:t.callback;o=!l&&(t.input_to_fill||o);var r=t.position;s=$(t.e&&t.e.target);p({open:true,is_rxn:!!l});TS.tips.hideAll();d=t.target_bounds||s.dimensions_rect();var n=window.pageYOffset;d.top+=n;d.bottom+=n;TS.ui.react_emoji_menu.is_showing=true;var i={};var a={position:r,offset_x:t.offset_x,offset_y:t.offset_y,should_return_focus_after_close:t.should_return_focus_after_close};f(i,a);TS.model.is_our_app&&TS.interop.desktop.legacyAreDragRegionsRequired()&&_.get(window,"desktop.app.updateDragRegion")&&window.desktop.app.updateDragRegion([])};var m=function e(){p({open:false,is_rxn:!!l});s=null;o="#msg_input";l=null;u=null;_handy_rxns=null;TS.tips.unhideAll();TS.ui.react_emoji_menu.is_showing=false;f()};var f=function e(t,r){var n=S(t);var i=T(r);TS.telemeter.mark("react_emoji_menu_render_mark");a||(a=k());TS.interop.mountEmojiPicker(TS.boot_data.team_id,a,n,i)};var p=function e(t){if(t.is_rxn){s.closest(".menu_rxn").toggleClass("active",t.open);s.closest(".rxn_panel").toggleClass("active",t.open);s.closest("ts-message").toggleClass("active",t.open);s.toggleClass("active",t.open)}else{s.closest(".emo_menu").toggleClass("active",t.open);s.closest(".handy_rxns_row").toggleClass("active",t.open);s.closest(".current_status_emoji_picker").toggleClass("active",t.open)}};var h=function e(t,r){var n=$(o);var i=r.display_name||r.name;var a=!(t&&t.shiftKey);if(TS.interop.utility.isContentEditableElement(n))if(TS.utility.contenteditable.inlineEmojiIsEnabled()){var s=TS.interop.texty.convertContentsStringToContents(r.name,{shouldRenderEmojiAsText:TS.interop.rules.emoji.shouldRenderEmojiAsText(),emojiNames:TS.emoji.legacyGetEmojiNames(),useSonicEmoji:TS.boot_data.feature_sonic_emoji,locale:TS.interop.i18n.locale});setTimeout(TS.utility.contenteditable.insertContentsAtCursor,0,n,s,a)}else setTimeout(TS.utility.contenteditable.insertTextAtCursor,0,n,i,a);else{var l=TS.utility.contenteditable.cursorPosition(n).start;var u=l+i.length;var d=TS.utility.contenteditable.value(n);var c=d.substr(0,l)+i+d.substr(l);TS.utility.populateInput(n,c);a&&setTimeout(TS.utility.contenteditable.cursorPosition,0,o,u)}};var g=function e(t,r){if(TS.boot_data.feature_sonic_emoji)return;var n=_.find(TS.model.emoji_map,{name_with_colons:TS.emoji.stripLocalizedSkinTone(t.name)});r&&(r=r.replace(/^:/,""));n&&TS.ui.frecency.record(n,r)};var S=function e(){var t={onSkinToneChanged:y,groups:TS.model.emoji_groups,onSelected:v,onClosed:b,emojiMap:TS.model.emoji_map,showHandyReactions:!!l};return t};var T=function i(a){a=a||{};return{targetBounds:d,allowanceX:e,allowanceY:e,position:a.position||n,offsetX:_.isUndefined(a.offset_x)?t:a.offset_x,offsetY:_.isUndefined(a.offset_y)?r:a.offset_y,isOpen:TS.ui.react_emoji_menu.is_showing,onClose:b,ariaRole:"dialog",ariaLabel:TS.interop.i18n.t("Emoji picker dialog","emoji_picker")(),shouldReturnFocusAfterClose:a.should_return_focus_after_close}};var v=function e(t,r,n){if(TS.boot_data.feature_sonic_emoji){var i=r;r={name:":"+i+":"}}g(r,n);if(u){setTimeout(u,0,r.name);return}if(!o)return TS.error("Could not find an _input_to_fill.");h(t,r)};var b=function e(){m()};var y=function e(t){TS.prefs.legacyOnPrefChanged({name:"preferred_skin_tone",value:t});TS.prefs.setPrefByAPI({name:"preferred_skin_tone",value:t});if(TS.ui.react_emoji_menu.is_showing){var r={skin_tone_id:t};f(r)}};var w=function e(){TS.ui.react_emoji_menu.is_showing&&_.defer(f)};var k=function e(){if(!document.getElementById(i)){var t=document.createElement("div");t.setAttribute("id",i);document.body.appendChild(t)}return document.getElementById(i)}})()},Oszc:function(e,t){(function(){TS.registerModule("channels.read_only",{list_updated_sig:new signals.Signal,refetching_channel_info_ids:{},stashAndFetchChannelPostingUpdates:function e(t,r,n){if(TS.channels.read_only.refetching_channel_info_ids[t])return;TS.channels.read_only.refetching_channel_info_ids[t]=true;var i={id:t};var a=true;switch(r){case 6:i.is_read_only=true;i.is_thread_only=false;i.is_non_threadable=false;break;case 7:i.is_read_only=false;i.is_thread_only=true;i.is_non_threadable=false;break;case 8:i.is_read_only=false;i.is_thread_only=false;i.is_non_threadable=true;break;default:a=false;break}if(a){TS.interop.channels.upsertChannel(i);TS.channels.read_only.list_updated_sig.dispatch()}TS.shared.promiseToRefetchModelOb(t,n).then(function(){delete TS.channels.read_only.refetching_channel_info_ids[t];TS.channels.read_only.list_updated_sig.dispatch()})},addChannelToList:function e(t){TS.model.read_only_channels=_.uniq(_.concat(TS.model.read_only_channels,t));TS.channels.read_only.list_updated_sig.dispatch()},removeChannelFromList:function e(t){TS.model.read_only_channels=TS.model.read_only_channels.filter(function(e){return e!==t});TS.channels.read_only.list_updated_sig.dispatch()},isReadOnly:function e(t){if(TS.boot_data.page_needs_enterprise){if(TS.model.user.enterprise_user&&TS.model.user.enterprise_user.is_owner)return false}else if(TS.model.user.owner)return false;if(!TS.interop.utility.looksLikeChannelId(t))return false;var r=false;var n=TS.redux.channels.getEntityById(t,r);if(!n)return false;if(n.is_im||n.is_mpim)return false;if(!_.isUndefined(n.is_read_only))return n.is_read_only;return TS.model.read_only_channels.indexOf(t)>-1}})})()},PU4x:function(e,t){(function(){TS.registerModule("ui.react_message_menu",{onStart:function t(){e=document.getElementById(s)},showMessageMenu:function r(n,i){var a=i.channel,s=i.message,l=i.message_container_type;t=$(n&&n.target);var u="";l===TS.interop.constants.MESSAGE_CONTAINERS.THREADS_FLEXPANE&&(u="convo");TS.interop.messages.addMessages([s]);var d={channelId:a.id,ts:s.ts,messageContainerType:l,onSelectAction:function e(t,r){var n=TS.interop.mountMessageActionsMenu.actionIds;if(r.id===n.editMessage){TS.msg_edit.startEdit(s.ts,a,u);return true}return false},onTriggerClose:TS.ui.react_message_menu.closeMessageMenu,onMenuItemSelected:TS.ui.react_message_menu.closeMessageMenu};var c=o();t.closest("ts-message").addClass("active");TS.interop.mountMessageActionsMenu(TS.interop.selfTeamIds.getTeamId(TS.redux.getState()),e,d,c)},closeMessageMenu:function r(){if(t){t.closest("ts-message").removeClass("active");t=null}TS.interop.mountMessageActionsMenu(TS.interop.selfTeamIds.getTeamId(TS.redux.getState()),e,{},{isOpen:false})}});var e;var t;var r=15;var n=46;var i="right-bottom";var a={x:4,y:-8};var s="message_actions_menu_mount_point";var o=function e(){return{targetBounds:t?t.dimensions_rect():{},position:i,allowanceX:n,allowanceY:r,offsetX:a.x,offsetY:a.y,isOpen:true,onClose:TS.ui.react_message_menu.closeMessageMenu}}})()},PhMi:function(e,t,r){var n=r("lSNA");function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}));r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),true).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}(function(){TS.registerModule("stars",{member_stars_fetched_sig:new signals.Signal,member_stars_being_fetched_sig:new signals.Signal,channel_starred_sig:new signals.Signal,channel_unstarred_sig:new signals.Signal,has_more:false,fetched_once:false,onStart:function e(){TS.files.team_file_changed_sig.add(o);TS.channels.message_changed_sig.add(s);TS.ims.message_changed_sig.add(s);TS.mpims.message_changed_sig.add(s);TS.groups.message_changed_sig.add(s);r=$("#member_stars_more_btn")},getAllStars:function e(){return i},fetchUserStarredItems:function e(){var t=d();TS.stars.fetched_once||(TS.stars.fetched_once=true);return TS.interop.api.call("stars.list",t).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;l&&l(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;l&&l(i,t,r,n);return{data:t,args:r,request_id:n}})},userStarStatusHasChanged:function e(t,r,n){c(t,r,n);var i=false;if("message"===r.type){m(r.message.ts,r.channel,t,false);var a=TS.redux.messages.wasMessageDeleted(r.channel,r.message.ts);a||TS.redux.messages.replaceMessage(TS.interop.messages.preprocessImsg(r.message,r.channel))}else if("file"===r.type)r.file.is_starred!=t&&p(r.file.id,t);else if("file_comment"===r.type)r.comment.is_starred!=t&&f(r.comment.id,r.file.id,t);else if("channel"===r.type){var s=TS.interop.channels.getPublicChannelById(r.channel,i);s?s.is_starred!=t&&h(r.channel,t):TS.warn("userStarStatusHasChanged channel_id:"+r.channel+" not found")}else if("group"===r.type){var o=TS.interop.channels.getGroupById(r.channel,i);o||(o=TS.interop.channels.getMpimById(r.channel,i));o?o.is_starred!=t&&(o.is_mpim?T(r.channel,t):g(r.channel,t)):TS.warn("userStarStatusHasChanged group_id:"+r.channel+" not found")}else if("im"===r.type){var l=TS.interop.channels.getImById(r.channel,i);l?l.is_starred!=t&&S(r.channel,t):TS.warn("userStarStatusHasChanged im_id:"+r.channel+" not found")}else TS.error("userStarStatusHasChanged needs to handle star item type:"+r.type)},checkForStarClick:function e(t,r){if(!t.target)return false;var n=$(t.target);_.isFunction(r)||(r=_.noop);var i;var a=false;if(n.closest(".star").length)i=n.closest(".star");else{i=n.closest(".star_link");a=true}var s=false;if(!i||!i.length)if(n.is("button.file_star"))i=n.children(".star");else if(n.closest(".starred_icon").length){s=true;i=n.closest(".starred_icon")}if(!i||!i.length)return false;if(i.hasClass("not-clickable"))return false;var o=i.hasClass("starred");var l={};var u;if(s){var d=TS.redux.channels.getEntityById(i.data("c-id"));if(d){l.channel=d.id;o=d.is_starred;u=function e(t){d.is_channel?h(l.channel,t):d.is_im?S(l.channel,t):d.is_mpim?T(l.channel,t):d.is_group&&g(l.channel,t)}}}else if(i.hasClass("star_message")){l.channel=i.data("c-id");l.timestamp=i.data("msg-id");u=function e(t){m(l.timestamp,l.channel,t,true)}}else if(i.hasClass("star_file")){l.file=i.data("file-id");u=function e(t){p(l.file,t,a)}}else if(i.hasClass("star_file_comment")){l.file_comment=i.data("comment-id");u=function e(t){f(l.file_comment,i.data("file-id"),t)}}else if(i.hasClass("star_channel")){l.channel=i.data("channel-id");u=function e(t){h(l.channel,t)}}else if(i.hasClass("star_group")){l.channel=i.data("group-id");u=function e(t){g(l.channel,t)}}else if(i.hasClass("star_im")||i.hasClass("star_app")){l.channel=i.data("im-id");var c=false;i.hasClass("star_app")&&(c=true);u=function e(t){S(l.channel,t,c)}}else{if(!i.hasClass("star_mpim")){TS.error("checkForStarClick doesn't know what to do with a click on "+i[0].outerHTML);return false}l.channel=i.data("mpim-id");u=function e(t){T(l.channel,t)}}t.preventDefault();u(!o);r(!o);if(o){var v=function e(t,n){if(t)return;if("not_starred"===n.error){u(false);r(false)}else{u(true);r(true)}};TS.interop.api.call("stars.remove",l).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;v(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;v(i,t,r,n);return{data:t,args:r,request_id:n}})}else{var b=function e(t,n){if(t)return;if("already_starred"===n.error){u(true);r(true)}else{u(false);r(false)}};TS.interop.api.call("stars.add",l).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;b(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;b(i,t,r,n);return{data:t,args:r,request_id:n}})}return true},updateMsgStar:function e(t,r,n,i){m(t,r,n,i)},updateFileStar:function e(t,r){p(t,r)},updateFileCommentStar:function e(t,r,n){f(t,r,n)},updateChannelStar:function e(t,r){h(t,r)},toggleStarOnMsg:function e(t,r,n){if(!t||!r)return;var i=TS.utility.msgs.findMsg(t,r.id);if(!i)return;var a={channel:r.id,timestamp:t};var s=i.is_starred?"stars.remove":"stars.add";var o=function e(t,i){t?n&&n(r):i.error&&TS.error(i.error)};TS.interop.api.call(s,a).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;o(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;o(i,t,r,n);return{data:t,args:r,request_id:n}})},toggleStar:function e(t,r){var n=r?TS.redux.channels.getEntityById(r):TS.shared.legacyGetActiveModelOb();if(!n)return;var i=n.is_starred;var a={};a.channel=n.id;if(i){var s=function e(r,i){r?t&&t(n):i.error&&TS.error(i.error)};TS.interop.api.call("stars.remove",a).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;s(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;s(i,t,r,n);return{data:t,args:r,request_id:n}})}else{var o=function e(r,i){r?t&&t(n):i.error&&TS.error(i.error)};TS.interop.api.call("stars.add",a).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;o(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;o(i,t,r,n);return{data:t,args:r,request_id:n}})}}});var e=1;var t=20;var r;var n=false;var i=[];var s=function e(t,r){true===r.is_starred&&TS.stars.maybeUpdateUserStarredList()};var o=function e(t){if(t.hasOwnProperty("is_starred")){var r=$(".star_item");var n=TS.files.containerHasFileListItem(t,r);var i=!TS.interop.files.isObjectFresh(t.id);if(i&&n){TS.files.getFileById(t.id);return}if(n){p(t.id,t.is_starred,t.id);TS.files.updateFileListItem(t,r,TS.interop.constants.MESSAGE_CONTAINERS.STARS_FLEXPANE)}}};var l=function t(a,s,o){TS.stars.member_stars_being_fetched_sig.dispatch(TS.model.user,false);if(n){TS.stars.maybeUpdateUserStarredList();return}if(!a){TS.stars.member_stars_fetched_sig.dispatch({error:"api_not_ok"});return}for(var l=0;l<s.items.length;l+=1){var d=s.items[l];TS.stars.userStarStatusHasChanged(true,d,"stars.list")}if(1==o.page)i=s.items;else{i=i.concat(s.items);i=_.uniqWith(i,_.isEqual)}r.data("ladda")&&r.data("ladda").stop();u();TS.stars.has_more=s.paging.pages>s.paging.page;o._update||(e+=1);TS.stars.member_stars_fetched_sig.dispatch(null,TS.model.user)};var u=function e(){if("treatment"!=TS.stars.badge_star_menu)return;var t=Date.now()/1e3-259200;var r=_.countBy(i,function(e){return e.date_create>t});var n=_.get(r,true,0);0===n?$("#star_badge").hide():$("#star_badge").show().text(n>=20?"20+":n)};var d=function r(){var n={user:TS.model.user.id,exclude:"Ch,Gh,Dh",page:e,count:t};return n};var c=function e(t,r,n){if("message"===r.type){r.message._rxn_key=TS.rxns.getRxnKey("message",r.message.ts,r.channel);"channel_topic"!==r.message.type&&"channel_purpose"!==r.message.type&&"channel_join"!==r.message.type&&"channel_leave"!==r.message.type||(r.message.subtype=r.message.type);r.message.type="message"}else if("file"===r.type||"file_comment"===r.type){if(!r.file){TS.error("WTF no file in type "+r.type+" in "+n);return false}if(r.file_id){var i=TS.files.getFileById(r.file_id);if(!i)return false;TS.files.upsertAndSignal(a({},i,{is_starred:t}),"slurpStarItem")}else TS.files.upsertAndSignal(r.file,"slurpStarItemFilesInfo");var s=r.file&&r.file.id;Object.defineProperty(r,"file",{enumerable:true,configurable:true,get:function e(){return TS.files.getFileById(s)},set:function e(){return false}});if("file_comment"===r.type){if(!r.comment){TS.error("WTF no comment in type "+r.type+" in "+n);return false}r.comment=TS.files.addCommentToFile(r.comment,r.file)}}else if("channel"===r.type);else if("group"===r.type);else if("im"!==r.type){TS.error("need to handle star item type:"+r.type+" in "+n);return false}return true};var m=function e(t,r,n,i){var a=TS.redux.channels.getEntityById(r);var s;a&&(s=TS.utility.msgs.findMsg(t,r));var o='.star_message[data-msg-id="'+t+'"][data-c-id="'+r+'"]';var l=$(o);if(i){var u={};var d=n?"STAR_ADD_CLICKED":"STAR_REMOVE_CLICKED";TS.interop.clog.track(d,u)}v(l,n,s)};var f=function e(t,r,n){var i=TS.files.getFileById(r);var a;i?a=TS.files.getFileCommentById(i,t):TS.warn("updateFileCommentStar file_id:"+r+" not found");var s='.star_comment[data-comment-id="'+t+'"]';v($(s),n,a)};var p=function e(t,r,n){var i=TS.files.getFileById(t);i||TS.warn("updateFileStar file_id:"+t+" not found");var a='.star_file[data-file-id="'+t+'"]';v($(a),r,i,n)};var h=function e(t,r){var n=TS.interop.channels.getPublicChannelById(t);n||TS.warn("updateChannelStar channel_id:"+t+" not found");n.is_starred=r;var i='.star_channel[data-channel-id="'+t+'"]';v($(i),r,n)};var g=function e(t,r){var n=TS.interop.channels.getGroupById(t);n||TS.warn("updateGroupStar group_id:"+t+" not found");n.is_starred=r;var i='.star_group[data-group-id="'+t+'"]';v($(i),r,n)};var S=function e(t,r,n){var i=TS.interop.channels.getImById(t);i||TS.warn("updateImStar im_id:"+t+" not found");i.is_starred=r;var a="";a=n?'.star_app[data-im-id="'+t+'"]':'.star_im[data-im-id="'+t+'"]';v($(a),r,i)};var T=function e(t,r){var n=TS.interop.channels.getMpimById(t);n||TS.warn("updateMpimStar mpim_id:"+t+" not found");n.is_starred=r;var i='.star_mpim[data-mpim-id="'+t+'"]';v($(i),r,n)};var v=function e(t,r,n,i){r?t.hasClass("starred")||t.addClass("starred ts_icon_star").removeClass("ts_icon_star_o"):t.removeClass("starred ts_icon_star").addClass("ts_icon_star_o");i&&t.each(function(e){TS.tips.manuallyToggleTipTitle(t.eq(e))});var a=t.find(".ts_tip_multiline_inner");var s=a&&a.length?a.text():"";s&&t.attr("aria-label",s);n&&(n.is_starred=r)}})()},Pv2O:function(e,t){(function(){TS.registerModule("utility.teams",{isMemberGuest:function e(t){if(!_.isObject(t))return false;if(t.isExternal||t.is_restricted)return true;return false},isMsgFromOtherTeam:function e(t){if(!_.isObject(t))return false;if(!t.source_team_id)return false;if(t.source_team_id&&TS.model.team.id!=t.source_team_id)return true;return false},getMembersForTeam:function e(t){if(!_.isObject(t))return;if(!t.id)return;var r=_.filter(TS.model.members,{team_id:t.id});return r}})})()},QqCU:function(e,t){(function(){TS.registerModule("inline_file_previews",{expand_sig:new signals.Signal,collapse_sig:new signals.Signal,onStart:function e(){_();this.collapse_sig.add(a);this.expand_sig.add(s);$("#messages_container").on("keydown",".preview_show_more .preview_show_btn",i);$("#messages_container").on("keydown",".preview_show_less .preview_show_btn",i)},checkForInlineFilePreviewClick:function e(t){var r=$(t.target);var i;var a=r.closest(".message");if(0===a.length)return;if(r.hasClass("service_link")||r.closest(".service_link")>0)return;var s=a.attr("id");var u=r.closest(".msg_inline_file_preview_toggler");var c=r.closest(".msg_inline_media_toggler");var _=TS.boot_data.feature_file_threads?c.length>0:u.length>0;if(_){t.preventDefault();i=u.data("file-id");var m=a.attr("data-ts");u.hasClass("collapsed")?n(s,m,i):o(s,m,i);return true}var f=r.closest(".inline_file_preview_container, .file_container");if(0===f.length)return;var p=r.closest("ts-message");var h=""+p.data("ts");var g=p.data("model-ob-id");var S={message_timestamp:h,channel_id:g,channel_type:g?g.charAt(0):"",member_id:p.data("member-id"),app_id:p.data("app-id"),bot_id:p.data("bot-id")};if(r.closest(".preview_show.preview_show_more").length>0){t.preventDefault();l(t,a,f);TS.interop.clog.track("PREVIEW_EXPAND",S);return true}if(r.closest(".preview_show.preview_show_less .preview_show_btn, .preview_show_less_header").length>0){t.preventDefault();d(t,a,f);TS.interop.clog.track("PREVIEW_COLLAPSE",S);return true}if(r.closest("a").length)return false;i=f.data("file-id");var T=TS.files.getFileById(i);if(!T)return false;if(("space"===T.mode||"post"===T.mode||"docs"===T.mode||"email"===T.mode||"snippet"===T.mode)&&f.hasClass("inline_collapsed")){t.preventDefault();l(t,a,f);return true}return false},shouldTruncate:function e(t){if(!t)return false;if("snippet"===t.mode){if(t.lines_more>0||t.preview_is_truncated)return true}else if("post"===t.mode||"space"===t.mode||"docs"===t.mode){if(!t.preview)return false;if(t.preview.length>=400)return true;if(t.preview.split(" ").length>=50)return true;if(t.preview.split("\n").length>=4)return true;var r=t.preview.match(/<\/(?:h\d|p|li|pre|blockquote)>/g)||[];var n=t.preview.match(/<hr>/g)||[];var i=r.concat(n);if(i.length>=4)return true}else if("email"===t.mode)return true;return false},isTruncated:function t(r,n){if(!n)return false;return!e[r+"_"+n.id]},expandableState:function e(t,r){if(TS.model.expandable_state["inline_file_"+t+r])return true;if(false===TS.model.expandable_state["inline_file_"+t+r])return false},shouldExpand:function e(t,r){var n=TS.inline_file_previews.expandableState(t,r);if("boolean"===typeof n)return n;return true},expandAllInCurrent:function e(){t=true;$(".msg_inline_file_preview_toggler").each(function(e,t){var r=$(t);var i=r.data("file-id");var a=r.closest(".message").attr("id");var s=r.closest(".message").attr("data-ts");n(a,s,i)});t=false},collapseAllInCurrent:function e(){$(".msg_inline_file_preview_toggler").each(function(e,t){var r=$(t);var n=r.data("file-id");var i=r.closest(".message").attr("id");var a=r.closest(".message").attr("data-ts");o(i,a,n)})},test:function e(){return{actuallyExpandContent:u}}});var e={};var t=false;var r=false;var n=function e(r,n,i){var a="inline_file_msg_"+n.replace(".","_")+i;TS.model.expandable_state[a]=true;TS.storage.storeExpandableState(TS.model.expandable_state);var s="#"+TS.utility.makeSafeForDomId(r);var o=$(s);if(!o.length)return;var l=function e(){if(TS.boot_data.feature_file_threads&&$(this).find('a[data-file-id="'+i+'"]').length>0)return true;return $(this).data("file-id")==i};var u=o.find(".inline_file_preview_container, .file_container").filter(l);o.find(".msg_inline_file_title_hider").filter(l).addClass("hidden");o.find('.msg_inline_file_preview_toggler[data-file-id="'+i+'"]').removeClass("collapsed").addClass("expanded");u.removeClass("hidden");u.css("opacity",0).stop().animate({opacity:1},300);t||u.scrollintoview({duration:200,offset:"bottom",px_offset:0,direction:"y"});TS.inline_file_previews.expand_sig.dispatch(r)};var i=function e(t){13!=t.which&&32!=t.which||(r=true)};var a=function e(){r&&$(".preview_show_more .preview_show_btn").focus().addClass("focus-ring");r=false};var s=function e(){r&&$(".preview_show_less .preview_show_btn").focus().addClass("focus-ring");r=false};var o=function e(t,r,n){var i="inline_file_msg_"+r.replace(".","_")+n;TS.model.expandable_state[i]=false;TS.storage.storeExpandableState(TS.model.expandable_state);var a="#"+TS.utility.makeSafeForDomId(t);var s=$(a);if(!s.length)return;var o=function e(){if(TS.boot_data.feature_file_threads&&$(this).find('a[data-file-id="'+n+'"]').length>0)return true;return $(this).data("file-id")==n};var l=s.find(".inline_file_preview_container, .file_container").filter(o);s.find(".msg_inline_file_title_hider").filter(o).removeClass("hidden");s.find('.msg_inline_file_preview_toggler[data-file-id="'+n+'"]').removeClass("expanded").addClass("collapsed");l.addClass("hidden");TS.inline_file_previews.collapse_sig.dispatch(t);setTimeout(function(){},0)};var l=function e(t,r,n){var i=n.data("file-id");var a=TS.files.getFileById(i);if(!a)return;if("post"===a.mode||"space"===a.mode||"snippet"===a.mode||"docs"===a.mode){var s=n.find(".preview_show_more .preview_show_btn");s.data("stashed_text",s.html()).empty();var o=new Spinner({lines:9,length:0,width:4,radius:5,corners:1,rotate:0,direction:1,color:"#ffffff",speed:1,trail:25,shadow:false,hwaccel:false,className:"spinner",zIndex:2e9,top:"-8px",left:"-4px",opacity:.1});o.spin(s.get(0));n.addClass("loading");TS.files.fetchFileInfo(i,function(e,t){o.stop();s.html(s.data("stashed_text"));n.removeClass("loading");(t.content_html||t.content_highlight_html)&&u(r,t);TS.utility.welcome_post.clogWelcomePostExpand(t)})}else if("email"===a.mode)if(a.simplified_html)u(r,a);else{r.find(".email_content").addClass("loading");var l=setTimeout(function(){r.find(".inline_file_preview_container, .file_container").addClass("expanded")},1e3);TS.files.fetchFileInfo(i,function(e,t){clearTimeout(l);u(r,t);r.find(".email_content").removeClass("loading")})}};var u=function t(r,n){var i=r.attr("id");var a=i+"_"+n.id;e[a]=true;if(!r.parent("body").length){var s=$("#"+i);s.length&&(r=s)}r.find(".inline_file_preview_container, .file_container").removeClass("inline_collapsed").addClass("inline_expanded");TS.inline_file_previews.expand_sig.dispatch(r)};var d=function r(n,i,a){var s=i.attr("id");var o=a.data("file-id");var l=TS.files.getFileById(o);if(!l)return;var u=s+"_"+o;delete e[u];i.find(".inline_file_preview_container, .file_container").removeClass("inline_expanded").addClass("inline_collapsed");if(!t){var d=i[0].getBoundingClientRect();d.top<0&&i.scrollintoview({duration:0,offset:"top",px_offset:0,direction:"y"})}TS.inline_file_previews.collapse_sig.dispatch(i)};var c;var _=function e(){c&&clearInterval(c);var t=function e(){var t=$("#msgs_div .file_time_ago");var r=[];t.each(function(){var e=$(this).data("file-id");var t=TS.files.getFileById(e);if(!t){r.push($(this).text());return}r.push(TS.interop.datetime.toTimeAgo(t.updated));t=null});t.each(function(e,t){$(t).text(r[e]);t=null});t=null};t=TS.utility.throttleFunc(t,5e3);c=setInterval(t,6e4)}})()},R0Lu:function(e,t){(function(){TS.registerModule("ui.people_picker",{STYLES:{normal:"normal",small:"small"},onStart:function e(){},preload:function e(r){t(r)("");return r},make:function e(r,n){n=n||{};n.append||r.addClass("hidden");n.style=_.get(TS.ui.people_picker.STYLES,n.style,TS.ui.people_picker.STYLES.normal);r.lazyFilterSelect({append:!!n.append,always_visible:!!n.always_visible,approx_item_height:n.approx_item_height||50,data_promise:t(n),placeholder_text:n.placeholder_text||TS.interop.i18n.t("Search by name","people_picker")(),classes:"people_picker",scroll_threshold:2500,single:!!n.single,style:n.style,sluggify:n.sluggify,disabled:n.disabled,template:n.template||function(e){var t=TS.templates.member_small({member:e.member});return new Handlebars.SafeString(t)},tokenTemplate:n.tokenTemplate||function(e){var t=TS.templates.member_token({member:e.member});return new Handlebars.SafeString(t)},tokenClass:function e(t){return TS.templates.builders.getMemberTypeClass(t.member)},noResultsTemplate:n.noResultsTemplate||function(e){if(!e)return TS.interop.i18n.t("No one found","people_picker")();return TS.interop.i18n.t("No one found matching <strong>{query}</strong>","people_picker")({query:TS.interop.i18n.safeString(_.escape(e))})},onItemAdded:n.onItemAdded,onItemRemoved:n.onItemRemoved})},value:function e(t){return t.lazyFilterSelect("value")},clearValue:function e(t){return t.lazyFilterSelect("clearValue")},recomputeHeight:function e(t){return t.lazyFilterSelect("recomputeHeight")}});var e=["include_slackbot","include_self","include_bots","only_local_team","only_admins"];var t=function e(t){var n={};var i={};t.preselected_ids&&t.preselected_ids.length&&_.forEach(t.preselected_ids,function(e){e&&(i[e]=true)});var a={};t.omitted_ids&&t.omitted_ids.length&&_.forEach(t.omitted_ids,function(e){e&&(a[e]=true)});var s=function e(s,o){"@"===s.charAt(0)&&(s=s.substring(1));if(""===s&&t.empty_query_result){if(o>0)return Promise.resolve([]);return Promise.resolve(t.empty_query_result.map(function(e){return{member:e,lfs_id:String(e.id),preselected:!!i[e.id]}}))}if(""===s&&t.initial_load_promise){if(_.isUndefined(o))return t.initial_load_promise;t.initial_load_promise=r(t.initial_load_promise,i,a);return t.initial_load_promise}if(n.query!==s){n.query=s;n.include_org=TS.boot_data.page_needs_enterprise;n.include_slackbot=!!t.include_slackbot;n.include_self=t.include_self;n.full_profile_filter=false;n.include_bots=!!t.include_bots;n.only_local_team=!!t.only_local_team;n.only_admins=!!t.only_admins}var l=TS.interop.members.ensureMembersArePresent(_.keys(i)).then(function(){return r(n,i,a)});""!==s||t.initial_load_promise||(t.initial_load_promise=l);return l};return s};var r=function t(r,n,i){return Promise.resolve().then(function(){var e=[];var t=_.keys(n);t.forEach(function(t){var r=TS.interop.members.getMemberById(t);r||e.push(t)});if(e.length)return TS.interop.members.ensureMembersArePresent(e).catch(_.noop);return Promise.resolve()}).then(function(){return TS.members.promiseToSearchMembers(r).then(function(t){var a=[];if(""===t.query){var s=_.pick(r,e);a=TS.members.getMembersWithOptions(s)}else a=t.items;t.items=a.filter(function(e){return!i[e.id]}).map(function(e){if(e.member&&"undefined"!==typeof e.preselected)return e;return{member:e,lfs_id:String(e.id),preselected:!!n[e.id]}});return t})})}})()},RIqP:function(e,t,r){var n=r("Ijbi");var i=r("EbDI");var a=r("Bnag");function s(e){return n(e)||i(e)||a()}e.exports=s},RvrE:function(e,t){(function(){TS.registerModule("tabcomplete.emoji",{type:"emoji",getMatch:function e(t,r){if(!_.isString(t))return;var n;var i;var a=/(^|\n|[^+-])([+-]?[:|\uff1a][^~@#$%^&*()=[\]{}\\|!?`;:\uff1a",.<>/ ]*)$/i;t.replace(a,function(e,r,a,s){var o=r[r.length-1];if(TS.interop.texty.trimAllowedMatchPrefix(o))return;if(r.trim()&&/^[+-]/.test(a)){a=a.slice(1);s+=1}i=s+r.length;n=t.substr(i,a.length)});if(!n)return;if(TS.interop.utility.getEmoticonsRx().test(n))return;if(!r&&!u(n,TS.interop.i18n.locale))return;return{match:n,index:i}},shouldDisplayResults:function e(t,r,n){if(!t||_.isEmpty(r)||_.isEmpty(r.results))return false;if(1===r.results.length&&n)return false;return true},getResultAtIndex:function e(t,r){if(!t||!t.results||!_.isNumber(r))return;var n=t.results[r];if(!n)return;return{action:t.action,emoji:n}},getInsertData:function e(t){if(!t||!t.emoji)return;TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_select",trigger:"emoji"}}});var r=t.emoji.name;var n=t.emoji.display_name||t.emoji.name;if(TS.boot_data.feature_sonic_emoji){r=t.emoji.emojiBestNameMatchCanonical;n=TS.emoji.maybeGetLocalizedEmojiName(r)}var i=":"+n+":";TS.utility.contenteditable.inlineEmojiIsEnabled()&&(i=":"+r+":");var a=t.emoji.is_skin;TS.boot_data.feature_sonic_emoji&&(a=TS.interop.emoji.isEmojiNameSkinToneModifiable(r));if(a){var s=!TS.utility.contenteditable.inlineEmojiIsEnabled();i+=TS.emoji.getChosenSkinToneModifier(s)||""}var o=i;var l="";if("add_rxn"===t.action){o="+"+i;l="+"}else if("remove_rxn"===t.action){o="-"+i;l="-"}if(TS.utility.contenteditable.inlineEmojiIsEnabled())return{text:l,slackemoji:{text:i}};return{text:o}},getNumResults:function e(t){return t.results.length},getNextSelectedIndex:function e(a){var s;switch(a.keyCode){case TS.utility.keymap.right:s="right";break;case TS.utility.keymap.left:s="left";break;case TS.utility.keymap.up:s="up";break;case TS.utility.keymap.down:s="down";break;default:break}if(!s)return;var o=t(a.menu);if(1===o.length)return 0;if("right"===s)return a.selectedIndex<o.length-1?a.selectedIndex+1:0;if("left"===s)return a.selectedIndex>0?a.selectedIndex-1:o.length-1;if(a.keyCode===TS.utility.keymap.home||"up"===s&&a.metaKey)return 0;if(a.keyCode===TS.utility.keymap.end||"down"===s&&a.metaKey)return o.length-1;var l=_.map(o,function(e,t){var n=r(e);n.index=t;return n});var u=l[a.selectedIndex];var d=n(u,l,"down"===s);var c=i(u,d);if(!c){if("down"===s)return o.length-1;if("up"===s)return 0}return c.index},search:function t(r,n,i){TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_typing",trigger:"emoji"}}});var o=/^(\+|-):/.test(r)?r[0]:"";var l=n.index;var u=TS.shared.legacyGetActiveModelOb();var d=e(u);r=TS.emoji.normalizeSearchTerm(r);r=TS.tabcomplete.trimTrailingCharacterModifier(r);if(TS.boot_data.feature_sonic_emoji){s(r).then(function(e){var t=null;var r="search";if(e&&e.length){if(0===l&&o)if("+"===o){e=_.differenceBy(e,d,function(e){return e.name||e.item&&e.item.name});r="add_rxn"}else"-"===o&&(r="remove_rxn");t={action:r,results:e}}i(null,t)});return}var c=a(r);var m;if(0===l&&o){if("-"===o)m={action:"remove_rxn",results:c};else if("+"===o){var f=_.difference(c,d);_.isEmpty(f)||(m={action:"add_rxn",results:f})}}else m={action:"search",results:c};"U02592DNU"===TS.model.user.id&&TS.interop.utility.getLogger({getState:TS.redux.getState}).error(JSON.stringify({query:r,results:m}),"emoji_tabcomplete_results");m&&!m.results.length&&(m=null);i(null,m)},render:function e(t,r){var n=TS.templates.tabcomplete_emoji_header({text:t,action:r.action});var i=_.map(r.results,function(e){var t=e;if(TS.boot_data.feature_sonic_emoji){var n=e.emojiBestNameMatchCanonical;var i=TS.emoji.maybeGetLocalizedEmojiName(n);t={name:n,display_name:i}}return l(t,r.action)});var a=TS.templates.tabcomplete_emoji_results({results:i});return TS.tabcomplete.renderMenu(n,a)},onSelect:function e(t,r){if(!t||!t.emoji)return;r||(r="");r=r.replace(/^:/,"");if(TS.boot_data.feature_sonic_emoji){var n=TS.interop.emoji.getEmojiFrecencyIdFromName(t.emoji.name);TS.redux.dispatch(TS.interop.searcher.recordFrecencyEvent({id:n,text:r}));return}TS.ui.frecency.record(t.emoji,r)},onSelectedIndexChange:function e(t){TS.tabcomplete.onSelectedIndexChange(t)},test:function r(){var n={};Object.defineProperty(n,"_getResultElements",{get:function e(){return t},set:function e(r){t=r}});Object.defineProperty(n,"_getLocalResults",{get:function e(){return a},set:function e(t){a=t}});Object.defineProperty(n,"_getPrevMsgRxns",{get:function t(){return e},set:function t(r){e=r}});Object.defineProperty(n,"_sortResults",{get:function e(){return o},set:function e(t){o=t}});return n}});var e=function e(t){if(!t)return;var r=TS.utility.msgs.getDisplayedMsgs(t.msgs);var n=_.find(r,function(e){return!e.is_ephemeral});if(!n)return;var i=TS.rxns.getMemberRxnsFromMessage(n,TS.model.user.id);var a=_.map(i,function(e){var t=e.name.replace(/(:.+)$/,"");return TS.boot_data.feature_sonic_emoji?{name:t}:TS.emoji.getEmojiByName(t)});return _.compact(a)};var t=function e(t){if(!t)return[];return _.toArray(t.querySelectorAll(".tab_complete_ui_item"))};var r=function e(t){var r=t.offsetLeft;return{left:r,right:r+t.offsetWidth,top:t.offsetTop}};var n=function e(t,r,n){if(!t||!r||!r.length)return;var i=_.groupBy(r,"top");var a=_.map(_.keys(i),_.toNumber);var s=a.indexOf(t.top);var o=n?s+1:s-1;var l=a[o];return i[l]};var i=function e(t,r){if(!t||!r||!r.length)return;var n=r.filter(function(e){if(_.inRange(e.left,t.left,t.right))return true;if(_.inRange(e.right,t.left,t.right))return true;if(e.left<t.left&&e.right>t.right)return true;return false});if(!n)return;var i=_.maxBy(n,function(e){var r=Math.max(e.left,t.left);var n=Math.min(e.right,t.right);return n-r});return i};var a=function e(t){return o(t,TS.model.emoji_map)};var s=function e(t){var r=t.replace(/^(\+|-)?:/,"");return TS.redux.dispatch(TS.interop.searcher.search({query:r,options:{entities:{emoji:true},sort:{frecency:true},limit:50,returnMetadata:true}}))};var o=function e(t,r){if(!r||!r.length)return[];var n={emoji:r};var i={allow_empty_query:true,frecency:true,limit:50,prefer_exact_match:true};var a=t.replace(/^(\+|-)?:/,"");r=TS.sorter.search(a,n,i);return _.map(r,"model_ob")};var l=function e(t){var r=":"+t.name+":";var n=":"+(t.display_name||t.name)+":";var i={emoji_is_plain_text_only:TS.interop.rules.emoji.shouldRenderEmojiAsText(),emoji_name_with_colons:r,emoji_display_name_with_colons:n};var a=t.is_skin;TS.boot_data.feature_sonic_emoji&&(a=TS.interop.emoji.isEmojiNameSkinToneModifiable(t.name));if(a){i.show_skin_tone_variant=a;i.emoji_name_with_colons_and_skin=r+TS.emoji.getChosenSkinToneModifier();i.emoji_display_name_with_colons_and_skin=n+TS.emoji.getChosenSkinToneModifier(true)}return i};var u=function e(t,r){switch(r){case"ja-JP":return t.length>=2;default:return t.length>=3}}})()},"S+GT":function(e,t,r){var n=r("lSNA");function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}));r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),true).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}(function(){TS.registerModule("utility.calls",{share_url_prefix:document.location.origin+"/call/",calls_window_changed_sig:new signals.Signal,room_id_sig:new signals.Signal,started_platform_call_sig:new signals.Signal,window_types:{call_window:"call_window",mini_panel:"mini_panel",incoming_call:"incoming_call"},messages_to_call_window_types:{invite_response:"invite_response",invite_cancel:"invite_cancel",start_call:"start_call",caller_id:"caller_id",mini_panel_action:"mini_panel_action",did_close_window:"did_close_window",ping:"ping",ms_msg:"ms_msg",reachability:"reachability",calls_status:"calls_status",regions:"regions",got_server:"got_server",got_server_error:"got_server_error"},messages_to_mini_panel_types:{update_state:"update_state"},messages_from_call_window_types:{update_mini_panel:"update_mini_panel",set_call_window_loaded:"set_call_window_loaded",set_call_window_busy:"set_call_window_busy",show_growl_notification:"show_growl_notification",set_is_publisher_screensharing:"set_is_publisher_screensharing",pong:"pong",close:"close",restart_cursors_window_if_open:"restart_cursors_window_if_open",hide_call_window:"hideCallWindow",get_calls_status:"get_calls_status",force_janus_disconnect:"force_janus_disconnect",get_regions:"get_regions",get_server:"get_server",get_member_data:"get_member_data",play_sound:"play_sound",launch_dev_tools_mini_panel:"launch_dev_tools_mini_panel",launch_dev_tools_cursors:"launch_dev_tools_cursors",interactive_screen_share_happened:"interactive_screen_share_happened",update_injection_urls:"update_injection_urls",dm_call_is_usable:"dm_call_is_usable"},messages_from_incoming_call_types:{user_clicked_accept_or_reject:"user_clicked_accept_or_reject"},messages_from_mini_panel_types:{user_clicked_action:"user_clicked_action"},invite_response_types:{accept:"accept",reject:"reject",on_call:"on_call",dnd:"dnd",hangup:"hangup"},invite_cancel_types:{cleanup:"cleanup",timeout:"timeout",inviter_cancel:"inviter_cancel",accepted_timeout:"accepted_timeout",caller_hangup:"caller_hangup"},invite_unsupported_types:{platform:"platform",client_version:"client_version",offline:"offline",max_teams:"max_teams"},openMasMigrationDialog:function e(){TS.generic_dialog.start({title:TS.interop.i18n.t("Close Slack to download the app?","calls")(),body:TS.interop.i18n.t("We'll close Slack for you, and open the downloads page on our website. The app will download automatically \u2014 just follow the three quick installation steps listed at the end!","calls")(),show_cancel_button:true,go_button_text:TS.interop.i18n.t("Start Download Now","calls")(),onGo:function e(){TS.utility.openInNewTab("https://slack.com/downloads/instructions/osx?ddl=1","_blank");_.delay(function(){return _.invoke(desktop.app,"quit")},2e3)}})},onStart:function t(){e=TS.calls&&TS.calls.api?TS.calls.api:TS.interop.api;u.in_slack_app=false;u.in_call_window=!!TS.calls;u.calls_url_prefix=document.location.origin+"/call/";u.send_sunset_interactive_message_after_call=false;d=TS.interop.useGantryCallsInLegacySlack()},startCallInModelOb:function e(t,r,n){var i;var a=!r&&"Slack"!==TS.prefs.getTeamPref("calling_app_name");if(TS.interop.utility.looksLikeMemberId(t.id)){var s=t.id;t=TS.redux.channels.getImByMemberId(s);if(!t){TS.ims.promiseToStartImByMemberId(s,true,false).then(function(){t=TS.redux.channels.getImByMemberId(s);i={id:t.id,is_dm:t.is_im,is_mpdm:t.is_mpim,is_video_call:n};a?TS.utility.calls.launchPlatformCalls(i):TS.utility.calls.launchVideoCall(i)});return}}i={id:t.id,is_dm:t.is_im,is_mpdm:t.is_mpim,is_video_call:n};a?TS.utility.calls.launchPlatformCalls(i):TS.utility.calls.launchVideoCall(i)},getCallsUrlPrefix:function e(){return u.calls_url_prefix},isEnabled:function e(){if(!TS.model||!TS.model.team)return false;return TS.prefs.getTeamPref("allow_calls")},isCallWindowReady:function e(){return u.is_reachability_online&&u.is_ms_connected},isMultiPartyEnabled:function e(){return TS.utility.calls.isEnabled()&&TS.utility.calls.isPaidTeam()},isPaidTeam:function e(){return""!==TS.model.team.plan},isCurrentContextMultiParty:function e(){if(TS.model.active_channel_id||TS.model.active_group_id||TS.model.active_mpim_id)return true;return false},launchPlatformCalls:function t(r){if(!r)return;if(!r.id)return;var n=["AD6B97QES","A9SD542KA","ABE6T3L7Q","ADHD298UB","A5P5FDK33"];var i=["AN2CSGQUR","ANAAG9CKA","AN1CDQZKL","AN80VL39P"];var a=n.concat(i);var s=a.indexOf(TS.prefs.getTeamPref("calling_app_id"))>=0;TS.utility.calls.started_platform_call_sig.dispatch({is_loading:true});e.call("calls.request",{channel:r.id,app:TS.prefs.getTeamPref("calling_app_id")}).then(function(e){if(!e.data.ok){c(e);return}var t=window.open(s?e.data.url:encodeURI(e.data.url),TS.prefs.getTeamPref("calling_app_name"));try{t.focus()}catch(e){}}).catch(function(e){c(e)}).finally(function(){TS.utility.calls.started_platform_call_sig.dispatch({is_loading:false})})},isInteractiveScreenShareHostingSupported:function e(){return TS.model.supports_screen_sharing&&!TS.model.is_lin&&!TS.utility.calls.isInteractiveDisabledByMas()&&!TS.utility.isAppVersionBefore("2.8.0")},isInteractiveDisabledByMas:function e(){return TS.model.is_our_app&&TS.model.is_mac&&TS.interop.desktop.isAppStoreBuild()},launchVideoCall:function e(t){if(!TS.model.supports_voice_calls){m();return}if(!t)return;if(!t.id)return;if(!TS.utility.calls.isCallWindowReady())return;if(u.incoming_caller_info){var r=TS.redux.channels.getImByMemberId(u.incoming_caller_info.user_id);r&&r.id===t.id&&T().then(function(e){if(e){TS.utility.calls.closeIncomingCallWindow();TS.utility.calls.sendInvitationResponseToCaller({user_id:u.incoming_caller_info.user_id,room_id:u.incoming_caller_info.room_id,response:TS.utility.calls.invite_response_types.accept,did_choose_video:false})}})}b().then(function(e){if(e){x();return}TS.utility.calls_log.logEvent({event:l.log_events.start_call,value:t});M("call_initiated_by_user",t.id);y(u.calls_url_prefix+t.id,t.id,{start_with_video:t.is_video_call})})},sendInvitationResponseToCaller:function t(r){if(!r||!r.user_id||!r.room_id||!r.response||!TS.utility.calls.invite_response_types[r.response]){TS.utility.calls_log.logError("sendInvitationResponseToCaller: invalid args: ",r);return}TS.utility.calls.room_id_sig.dispatch({room_id:r.room_id});if(r.response){var n=function e(t,r){t||TS.utility.calls_log.logError("inviteResponse API failed with: ",r)};e.callImmediately("screenhero.rooms.inviteResponse",{caller:r.user_id,room:r.room_id,response:r.response}).then(function(e){var t=e.data,r=e.args,i=e.request_id;var a=true;n(a,t,r,i);return{data:t,args:r,request_id:i}}).catch(function(e){var t=e.data,r=e.args,i=e.request_id;var a=false;n(a,t,r,i);return{data:t,args:r,request_id:i}});if(r.response===TS.utility.calls.invite_response_types.accept){u.accepted_caller_id=r.user_id;r.currently_calling_caller||w(r.room_id,r.did_choose_video)}else E()}Promise.join(b(),T(),function(e,t){TS.utility.calls_log.logEvent({event:l.log_events.invite_response_send,value:{response_type:r.response,user_id:r.user_id,room_id:r.room_id,is_call_window_busy:e,is_in_incoming_call:t}});return null})},closeIncomingCallWindow:function e(t){TS.utility.calls_log.logEvent({event:l.log_events.close_incoming_call});if(TS.model.is_our_app){if(window.desktop&&u.incoming_call_token){TS.interop.desktop.legacyCloseWindow(u.incoming_call_token);delete u.incoming_call_token}}else T().then(function(e){e&&TS.incoming_call.timeout()});delete u.incoming_caller_info;t?TS.sounds.stop("call/incoming_ring_"+TS.boot_data.call_sounds_version+".mp3",{ignore_mute:true}):S()},maybeEnterMasToDdlFlow:function e(t){if(!TS.utility.calls.isInteractiveDisabledByMas())return false;t=TS.utility.normalizeDevHost(t);if(-1===t.indexOf("slack.com/downloads")||-1===t.indexOf("?ddl=1"))return false;TS.utility.calls.openMasMigrationDialog();return true},maybeHandleCallLink:function e(t){if(!u.in_slack_app)return false;t=$(t);if(!t||!t.length)return false;if(!t.is("a"))return false;var r=t.attr("href");if(!r)return false;r=TS.utility.normalizeDevHost(r);r=r.replace("https://","").replace("http://","");var n=TS.utility.normalizeDevHost(u.calls_url_prefix);n=n.replace("https://","").replace("http://","");0===r.indexOf(n)&&(r=r.replace(n,"call/"));while(0===r.indexOf("/"))r=r.substr(1);if(0!==r.indexOf("call/"))return false;var i=r.split("/");if(i.length<2)return false;var a=i[1];if(!a)return false;if(!TS.utility.calls.isCallWindowReady())return true;T().then(function(e){if(e){TS.utility.calls_log.logEvent({event:l.log_events.call_object_click_in_incoming_call});return}TS.utility.calls.room_id_sig.dispatch({room_id:a});w(a)});return true},getParentWindow:function e(){if(window.desktop&&!(window.parentInfo||window.parentBrowserWindowId))TS.utility.calls_log.logWarn("WinSSB: Trying to get parent window before browser window ID is initialized");else if(window.opener)return window.opener},promiseToGetRegions:function e(n){if(t)return t;var i;var a="https://universal.slack-core.com/region.json";t=new Promise(function(e){n&&"R"===n.charAt(0)?e(""):$.ajax({type:"GET",url:a,async:true,cache:false,timeout:2e3,success:function t(r){TS.utility.calls_log.logEvent({event:"Regions",value:r.region_text});i=r.region_text;TS.interop.environment.isDev&&(i="dev");e(i)},error:function t(r,n,a){TS.utility.calls_state_logging.error("CALLS_REGION_REQUEST_ERROR",{error:n,error_msg:a});i="";TS.interop.environment.isDev&&(i="dev");e(i)}})});clearTimeout(r);r=_.delay(function(){t=void 0},s);return t},promiseToGetServer:function t(r,a){if(n[a])return n[a];var o;var l={regions:r,protocol:"1.0",use_room_scoped_token:true};if("R"===a.charAt(0)){o="screenhero.rooms.join";l.room=a}else{o="screenhero.rooms.create";l.channel=a;var u=false;var d=TS.storage.fetchCallsState();if(d.call_server_override){l.call_server=d.call_server_override;d.call_server_override=null;u=true}if(d.call_regions_override){l.regions=d.call_regions_override;d.call_regions_override=null;u=true}u&&TS.storage.storeCallsState(d)}n[a]=e.callImmediately(o,l).then(function(e){return _.omit(e,"data.args")});clearTimeout(i[a]);i[a]=_.delay(function(){TS.utility.calls.clearServerPromise(a)},s);return n[a]},clearServerPromise:function e(t){delete n[t]},dummyMediaServerRequest:function e(t,r){$.ajax({type:"HEAD",url:"https://"+t+":"+r+"/janus",async:true,timeout:1e3,success:function e(){},error:function e(t,r,n){}})},getCallActive:function e(){return b()},isScreenSharing:function e(){return u.is_publisher_screensharing},isSupportedMessage:function e(t){var r=["user_change","pref_change","team_join","channel_created","channel_deleted","channel_archive","channel_unarchive","channel_rename","channel_joined","channel_left","group_deleted","group_archive","group_unarchive","group_rename","group_joined","group_left","im_open","mpim_joined","mpim_open","mpim_close"];return-1!==r.indexOf(t)},getPlatformErrorMessageForModal:function e(){if(TS.model.is_our_app)return TS.interop.i18n.t("Unfortunately, this version of Slack is out of date. Update your Slack app for access to calls &mdash; as well as bug fixes and an all-around smoother experience.","utility")();return TS.utility.calls.getPlatformErrorMessageForCallWindow()},getPlatformErrorMessageForCallWindow:function e(){if(TS.model.is_our_app)return TS.interop.i18n.t("To join or start calls, you'll need to use the latest version of the Slack app.","utility")();return TS.interop.i18n.t("Unfortunately, Slack calls aren't available in this browser. We recommend downloading the Slack desktop app, or you can switch to Chrome.","utility")()},getPlatformErrorModalTitle:function e(){if(TS.model.is_our_app)return TS.interop.i18n.t("To join calls, you\u2019ll need to update Slack","utility")();return TS.interop.i18n.t("Please download the app to use calls","utility")()},getPlatformErrorButtonText:function e(){if(TS.model.is_our_app)return TS.interop.i18n.t("Update Slack","utility")();return TS.interop.i18n.t("Download Slack","utility")()},verifyOriginUrl:function e(t){return TS.interop.url.getHostName(t)==window.location.hostname&&_.startsWith(t,"https:")},getUrlForRoom:function e(t){return TS.utility.calls.getUrlForRoomId(t.id)},getUrlForRoomId:function e(t){return TS.utility.calls.share_url_prefix+t},isWin7:function e(){return navigator.userAgent.indexOf("Windows NT 6.1")>=0},dbg:{getState:function e(){return{config:l,state:u}},isCallWindowBusy:function e(){b().then(function(e){TS.info("_isCallWindowBusy: "+e)})},isIncomingCallWindowBusy:function e(){T().then(function(e){TS.info("_isInIncomingCall: "+e)})}}});var e;var t;var r;var n={};var i={};var s=6e4;var o=[];var l={call_window_dims:{width:1070,height:600,min_width:600,min_height:500},mini_panel_dims:{width:280,height:64,min_width:280,min_height:44,x_offset:50,y_offset:50},incoming_call_window_dims:{width:240,height:373},log_events:{previous_crash:"PreviousCrash",incoming_call:"IncomingCall",invite_response_from_callee:"InviteResponseFromCallee",ms_connected:"MSConnected",ms_disconnected:"MSDisconnected",reachability_changed:"ReachabilityChanged",window_closed:"WindowClosed",window_crashed:"WindowCrashed",call_window_load_timeout:"CallWindowLoadTimeout",call_window_load_start:"CallWindowLoadStart",incoming_call_timeout:"IncomingCallTimeout",send_msg_no_call_window:"SendMsgNoCallWindow",send_msg_no_mini_panel:"SendMsgNoMiniPanel",call_window_loaded:"CallWindowLoaded",call_window_busy:"CallWindowBusy",invalid_msg_from_child_window:"InvalidMsgFromChildWindow",call_window_pong:"CallWindowPong",unknown_msg_from_call_window:"UnknownMsgFromCallWindow",incoming_call_click:"IncomingCallClick",unknown_msg_from_incoming_call_window:"UnknownMsgFromIncomingCallWindow",mini_panel_click:"MiniPanelClick",unknown_msg_from_mini_panel:"UnknownMsgFromMiniPanel",call_object_click_in_incoming_call:"CallObjectClickInIncomingCall",invite_response_send:"InviteResponseSend",close_incoming_call:"CloseIncomingCall",no_mini_panel_in_update:"NoMiniPanelInUpdate",start_call:"StartCall",join_call:"JoinCall"},CALL_WINDOW_LOAD_TIMEOUT_MSECS:3e4,INCOMING_RING_TIMEOUT_MSECS:27e3};var u={};var d=false;var c=function e(){};var m=function e(){TS.generic_dialog.start({title:TS.utility.calls.getPlatformErrorModalTitle(),body:TS.utility.calls.getPlatformErrorMessageForModal(),show_cancel_button:true,go_button_text:TS.utility.calls.getPlatformErrorButtonText(),onGo:function e(){var t="_"+Math.random();TS.utility.openInNewTab("https://slack.com/downloads",t)}})};var f=function e(){return _.get(window,"desktop.app.areTransparentWindowsSupported",true)};var p=function e(t){var r;if(d&&window.desktop&&TS.utility.compareSemanticVersions(window.process.versions.electron,"3.0.0")<0){window.confirm("[TS-only] You're opted in to the Friends of Calls alpha release, but you need to download a SlackPilot Desktop build to use modern Calls.");return}if(!TS.utility.calls.isEnabled())return;if(u.call_window_token&&!d){v({message_type:TS.utility.calls.messages_to_call_window_types.start_call,args:{url:t}});TS.interop.desktop.focusWindow(u.call_window_token)}else{TS.telemeter.mark("start_loading_call_window");r=a({url:t||u.calls_url_prefix,title:"",background:true,backgroundColor:"#2c2d30",width:l.call_window_dims.width,height:l.call_window_dims.height,minWidth:l.call_window_dims.min_width,minHeight:l.call_window_dims.min_height,hideMenuBar:true,windowType:"calls",show:true,no_spinner:true,hides_on_close:false},TS.model.is_mac&&{webPreferences:{nativeWindowOpen:true}});if(window.desktop){var n=TS.interop.desktop.legacyGetAppDisplay();r.x=n.bounds.x+(n.bounds.width-l.call_window_dims.width)/2;r.y=n.bounds.y+(n.bounds.height-l.call_window_dims.height)/2}u.call_window_token=null;TS.utility.calls_log.logInfo("_startCallWindow: returned token: ",u.call_window_token);u.injection_url_promise=new Promise(function(e){u.injection_url_resolver=e})}u.injection_url_promise.then(function(){h();g()})};var h=function e(){if(!window.desktop||u.mini_panel_token)return;var t=TS.interop.desktop.getDisplayForWindow(u.call_window_token);var r={x:t.bounds.x+(t.bounds.width-l.mini_panel_dims.x_offset-l.mini_panel_dims.width),y:t.bounds.y+l.mini_panel_dims.y_offset,width:l.mini_panel_dims.width,height:l.mini_panel_dims.height,minWidth:l.mini_panel_dims.min_width,minHeight:l.mini_panel_dims.min_height,hideMenuBar:true,resizable:false,alwaysOnTop:true,frame:false,windowType:"calls_mini_panel",show:false,useContentSize:true,skip_css:true,skipTaskbar:true,fullscreenable:false};TS.model.is_mac&&f()&&(r.transparent=true);r.content_html=TS.templates.calls_minipanel({is_linux:TS.model.is_lin,is_screenhero_disabled_by_admin:!TS.prefs.getTeamPref("allow_calls_interactive_screen_sharing"),locale:TS.interop.i18n.locale,no_border:!TS.model.is_mac,js_urls:u.injection_urls?u.injection_urls.calls_mini_panel.js:[],css_urls:u.injection_urls?u.injection_urls.calls_mini_panel.css:[]});u.mini_panel_token=null;TS.interop.desktop.showWindowInactive(u.mini_panel_token);TS.interop.desktop.hideWindow(u.mini_panel_token)};var g=function e(){};var S=function e(){TS.sounds.stop("call/incoming_ring_"+TS.boot_data.call_sounds_version+".mp3",{ignore_mute:true});if(u.incoming_ring_timer){clearTimeout(u.incoming_ring_timer);delete u.incoming_ring_timer}delete u.in_incoming_call;delete u.incoming_caller_info;C()};var T=function e(){if(!TS.model.is_our_app||!TS.interop.desktop.supportsCallWindowStatus())return Promise.resolve(!!u.in_incoming_call);return TS.interop.desktop.isIncomingCallWindowBusy()};var v=function e(t){if(TS.model.is_our_app){var r=u.call_window_token;if(!r){TS.utility.calls_log.logEventWarn({event:l.log_events.send_msg_no_call_window,value:t});return}window.desktop&&window.desktop.window&&window.desktop.window.postMessage(t,r)}else if(u.window_handle)try{u.window_handle.postMessage(t,"*")}catch(e){"DataCloneError"==e.name?u.window_handle.postMessage(_.cloneDeep(t),"*"):TS.error("Unexpected failure in sending a post message:",e.name)}};var b=function e(){if(d)return Promise.resolve(false);if(!TS.model.is_our_app||!TS.interop.desktop.supportsCallWindowStatus())return Promise.resolve(!!u.is_call_window_busy);return TS.interop.desktop.isCallWindowBusy()};var y=function e(t,r,n){n=n||{};if(d){var i="R"===r[0]?{callId:r}:{channelId:r};TS.redux.dispatch(TS.interop.calls.startOrJoinCall(i));return}t+="?_fast_members=1&_end_call_sound=1"+(n.start_with_video?"&_start_with_video=1":"");TS.pri&&(t+="&pri="+TS.pri);TS.model.is_mac&&(t+="&_use_in_process_cursor_window=1");TS.qs_args._calls_halt_at_loading_screen&&(t+="&_calls_halt_at_loading_screen=1");TS.qs_args.locale&&(t+="&locale="+TS.qs_args.locale);TS.qs_args.js_path&&(t+="&js_path="+encodeURIComponent(TS.qs_args.js_path));TS.utility.calls.promiseToGetRegions(r).then(function(e){TS.utility.calls.promiseToGetServer(e,r).then(function(e){TS.utility.calls.dummyMediaServerRequest(e.data.hostname,e.data.port)})});TS.interop.clog.track("CALLS_USER_JOIN_INTENT");TS.model.is_our_app?p(t):u.window_handle=window.open(t,r);u.call_channel=r};var w=function e(t,r){if(!TS.model.supports_voice_calls){m();return}if(!TS.utility.calls.isCallWindowReady())return;b().then(function(e){if(e){x();return}TS.utility.calls_log.logEvent({event:l.log_events.join_call,value:{room_id:t,start_with_video:r}});M("call_accepted_by_user",t);I("incoming_call_window_shown_to_accepted_time","incoming_call_window_shown",t);y(u.calls_url_prefix+t,t,{start_with_video:r})})};var k=function e(t){var r;r=t?TS.interop.i18n.t("You\u2019re already in a call on another workspace ({team_name})","utility")({team_name:t}):TS.interop.i18n.t("You\u2019re already in a call on another workspace","utility")();TS.generic_dialog.start({title:r,body:'<p class="no_bottom_margin">'+TS.interop.i18n.t("You can only be in one call at a time. Please end that call and try again.","utility")()+"</p>",go_button_text:TS.interop.i18n.t("OK","utility")(),show_cancel_button:false})};var x=function e(){TS.utility.calls_log.logInfo("_handleAlreadyInCall");if(!TS.model.is_our_app){u.window_handle.focus();return}if(!TS.interop.desktop.supportsCallWindowStatus()){TS.interop.desktop.focusWindow(u.call_window_token);return}TS.interop.desktop.getCallWindowTeamId().then(function(e){e===TS.model.team.id?TS.interop.desktop.focusWindow(u.call_window_token):TS.interop.desktop.getCallWindowTeamName().then(function(e){k(e)})})};var C=function e(){var t=function e(){TS.interop.desktop.setIncomingCallWindowBusy(false);TS.interop.desktop.clearIncomingCallWindowToken();TS.interop.desktop.clearIncomingCallWindowTeamId();TS.interop.desktop.clearIncomingCallWindowTeamName()};if(!TS.model.is_our_app)return;if(!u.incoming_call_token){t();return}var r=String(u.incoming_call_token);TS.interop.desktop.getIncomingCallWindowToken().then(function(e){if(e!==r)return;t()})};var M=function e(t,r){TS.telemeter.mark(t);o[t]=r};var I=function e(t,r,n){if(o[r]==n){TS.telemeter.measureAndClear(r,t);o[r]=void 0}};var E=function e(){TS.telemeter.clearMarks("call_initiated_by_user");TS.telemeter.clearMarks("call_accepted_by_user");TS.telemeter.clearMarks("incoming_call_window_shown");TS.telemeter.clearMarks("start_loading_call_window")}})()},SaiC:function(e,t,r){var n=r("RIqP");(function(){TS.registerModule("members.view",{team_filter_changed_sig:new signals.Signal,filter_timer:null,onStart:function e(){P=TS.web&&TS.web.admin;var t=500;u=TS.utility.debounceWithPromise(k,t);d=TS.utility.debounceWithPromise(k,t);c=TS.utility.debounceWithPromise(k,t)},switchTabs:function e(t){P&&"invites"===TS.web.admin.view?$("#"+t+"_invites_tab").trigger("click"):$("#"+t+"_members_tab").trigger("click")},bindTeamFilter:function t(r,n,i){i=i||{};var a=$(r);var s=a.find("input.member_filter");var o=a.find(".icon_close");p(n,i);e=null;i.full_profile_filter&&!i.is_long_list_view&&s.on("focus",function(){TS.team.ensureTeamProfileFields()});s.bind("keyup update-team-filter",function(){var t=s.val();TS.members.view.filter_timer&&window.clearTimeout(TS.members.view.filter_timer);var a=function a(){t.trim().toLocaleLowerCase()!==e&&TS.members.view.filterTeam(t,r,n,i);o.toggleClass("hidden",!t.trim())};i.is_long_list_view?a():TS.members.view.filter_timer=window.setTimeout(a,TS.members.getMembersForUser().length>500?250:50)});o.bind("click",function(){TS.members.view.clearFilter(r,n);e=null;setTimeout(function(){s.focus()},0)})},filterTeam:function e(t,r,n,i){var a=h(n);if(_.get(i,"full_profile_filter")||_.get(a,"full_profile_filter"))return TS.team.ensureTeamProfileFields().then(function(){if(f(a))return v(t,r,n,a);x(t,r,n,i);return Promise.resolve()});x(t,r,n);return Promise.resolve()},getTeamFilter:function t(){return e},selectMatch:function e(t){var r=$(t);var n=r.data("list-items-id");var i=$(n);var a=i.find(".member_item");var s=a.filter(".active");if(1==s.length){var o=s.first();var l=o.data("member-id");if(l){TS.ims.legacyStartImByMemberId(l);TS.menu.end()}}},clearFilter:function r(n,i){var a=h(i);var s=$(n);var o=s.find("input.member_filter");var l=s.find(".icon_close");var u=s.data("list-items-id");var d=$(u);var c=d.find(".member_item");e="";TS.storage.storeFilterState(e);if(TS.members.view.filter_timer){window.clearTimeout(TS.members.view.filter_timer);TS.members.view.filter_timer=null}o.val("");l.addClass("hidden");if(f(a)){T(i);TS.members.view.filterTeam(e,n,i,a)}else{$(".restricted_header, .bot_header, .ra_invite_prompt, .restricted_info").removeClass("hidden");d.find(".no_results").addClass("hidden");c.addClass("active");if(t[i]){t[i].detachEvents();delete t[i]}d.find(".member_item.clone").remove();d.find(".filter_header").remove();TS.members.view.team_filter_changed_sig.dispatch("",TS.members.getMembersForUser().length)}},findMatchesInMemberList:function e(t,r,n){return O(t,r,n)},getHeaderLabelForMatchKey:function e(t){return C(t)}});var e="";var t={};var r={};var i={};var a={};var s={members:{},restricted:{},deleted:{}};var o=100;var l=116;var u;var d;var c;var m=function e(){if("list"===_.get(TS,"web.admin.view")&&TS.boot_data.page_needs_enterprise)return false;return TS.boot_data.page_needs_enterprise};var f=function e(t){if(TS.boot_data.page_needs_enterprise&&t&&t.is_long_list_view)return true;if("list"===_.get(TS,"web.admin.view"))return true};var p=function e(t,r){i[t]=r};var h=function e(t){var r=i[t];if(!r){TS.error("Missing arguments for a bound filter");return}_.isFunction(r)&&(r=r()||{});r.include_org=m();return r};var g=function e(t){var r=$(t).find(".ts_icon_search");if(r.next().is(t+"_spinner"))return;var n=TS.templates.loading_indicator({id:t.substring(1)+"_spinner"});r.after(n);r.addClass("hidden")};var S=function e(t){$(t).find(".ts_icon_search").removeClass("hidden");$(t+"_spinner").remove()};var T=function e(){s.filter_p&&s.filter_p.cancel();s.filtered_items&&(s.filtered_items={});s.filter_last_query=null;s.filter_last_include_org=null;s.members.filter_cursor_mark="";s.members.filter_num_remaining=0;s.members.filter_num_found=0;s.members.filter_scroll_mark=0;s.restricted.filter_cursor_mark="";s.restricted.filter_num_remaining=0;s.restricted.filter_num_found=0;s.restricted.filter_scroll_mark=0;s.deleted.filter_cursor_mark="";s.deleted.filter_num_remaining=0;s.deleted.filter_num_found=0;s.deleted.filter_scroll_mark=0;TS.web&&$(window).off("scroll.filter").scrollTop(0)};var v=function t(r,n,i,a){var o=r.trim();e=o.toLocaleLowerCase();TS.storage.storeFilterState(e);var l=s.filter_last_query!==e||s.filter_last_include_org!==a.include_org||s.filter_last_sort!==a.sort||s.filter_last_sort_dir!==a.sort_dir;if(l){T(i);s.filter_last_query=e;s.filter_last_include_org=a.include_org;a.sort&&(s.filter_last_sort=a.sort);a.sort_dir&&(s.filter_last_sort_dir=a.sort_dir)}g(n);var u=function t(){return Promise.resolve().then(function(){return b(s,l,e,a)}).then(function(t){S(n);return y(t,s,l,e,o,n,i,a)}).finally(function(){TS.utility.rAF(function(){})})};s.filter_p=l?u():s.filter_p.then(u);return s.filter_p};var b=function e(t,r,i,a){var s=r||"active_members"===TS.model.ui_state.tab_name&&t.members.filter_num_remaining;var o=r||"restricted_members"===TS.model.ui_state.tab_name&&t.restricted.filter_num_remaining;var l=r||"disabled_members"===TS.model.ui_state.tab_name&&t.members.filter_num_remaining;if(!s&&!o&&!l)return Promise.resolve(t.filtered_items);var m=_.assign({},a,{restricted:false});t.members.filter_p=s?u(t.members,i,m):Promise.resolve([]);var f=_.assign({},a,{restricted:true});t.restricted.filter_p=o?d(t.restricted,i,f):Promise.resolve([]);var p=_.assign({},a,{include_deleted:2,include_restricted_and_full_members:true});t.deleted.filter_p=l?c(t.deleted,i,p):Promise.resolve([]);return Promise.join(t.members.filter_p,t.restricted.filter_p,t.deleted.filter_p,function(e,i,s){var o=(a.sort?A:TS.members.legacyAllocateTeamListMembers)(e.concat(i,s));o.members=_.uniqBy(o.members,function(e){return e.id});o.disabled_members=_.uniqBy(o.disabled_members,function(e){return e.id});o.restricted_members=_.uniqBy(o.restricted_members,function(e){return e.id});o.ultra_restricted_members=_.uniqBy(o.ultra_restricted_members,function(e){return e.id});if(r)t.filtered_items=o;else{t.filtered_items.members.push.apply(t.filtered_items.members,o.members);t.filtered_items.disabled_members.push.apply(t.filtered_items.disabled_members,o.disabled_members);t.filtered_items.deleted_bots.push.apply(t.filtered_items.deleted_bots,o.deleted_bots);t.filtered_items.bots.push.apply(t.filtered_items.bots,o.bots);t.filtered_items.restricted_members.push.apply(t.filtered_items.restricted_members,o.restricted_members);t.filtered_items.ultra_restricted_members.push.apply(t.filtered_items.ultra_restricted_members,o.ultra_restricted_members)}return F([].concat(n(t.filtered_items.restricted_members),n(t.filtered_items.ultra_restricted_members))).then(function(){return Promise.resolve(t.filtered_items)})})};var y=function e(t,r,n,i,u,d,c,m){if(!t)return;if(_.get(TS,"web.admin"))return TS.web.admin.setLongListAdminListItems({items:t,no_dividers:!!i,query:i,new_query:!!n,num_found:{members:s.members.filter_num_found||0,restricted:s.restricted.filter_num_found||0,disabled:s.deleted.filter_num_found||0},remaining:{members:s.members.filter_num_remaining||0,restricted:s.restricted.filter_num_remaining||0,disabled:s.deleted.filter_num_remaining||0}},function(){v(i,d,c,m)});var f=false;"disabled_members"===TS.model.ui_state.tab_name&&0===(s.deleted.filter_num_found||0)&&(f=true);"restricted_members"===TS.model.ui_state.tab_name&&0===(s.restricted.filter_num_found||0)&&(f=true);var p=TS.model.user_groups.filter(function(e){return!e.date_delete});"user_groups"===TS.model.ui_state.tab_name&&0===p.length&&(f=true);if(f){TS.model.ui_state.tab_name="active_members";TS.storage.storeUIState(TS.model.ui_state);$("#active_members_tab").trigger("click")}var h=$("#active_members_list");if(h.length){h.longListView("setItems",a.active_members_list_items);n&&h.longListView("scrollToTop")}var g=$("#restricted_members_list");if(g.length){g.longListView("setItems",a.restricted_members_list_items);n&&g.longListView("scrollToTop")}var S=$("#deleted_members_list");if(S.length){S.longListView("setItems",a.deleted_members_list_items);n&&S.longListView("scrollToTop")}var T=t.members.concat(t.bots);var b=t.restricted_members.concat(t.ultra_restricted_members);var y=t.disabled_members.concat(t.deleted_bots);var w=[{name:"active",label:TS.interop.i18n.t("full members","members_view")(),matches:T},{name:"restricted",label:TS.interop.i18n.t("multi-channel guests","members_view")(),matches:b},{name:"disabled",label:TS.interop.i18n.t("deactivated accounts","members_view")(),matches:y}];w.forEach(function(e){var t=$("#"+e.name+"_no_results");function r(){var r={query:u,tab:e,active_matches:T,show_active_matches:"active"!==e.name&&T.length>0,restricted_matches:b,show_restricted_matches:"restricted"!==e.name&&b.length>0,disabled_matches:y,show_disabled_matches:"disabled"!==e.name&&y.length>0};var n=TS.templates.team_list_no_results(r);t.removeClass("hidden").html(n);t.find(".clear_members_filter").one("click",function(){TS.members.view.clearFilter(d,c)})}e.matches.length>0||!i?t.addClass("hidden").empty():r()});if(n){"#team_list_scroller"===c&&TS.web&&$(window).off("scroll.filter").on("scroll.filter",_.throttle(function(){var e=0;var t=0;var n=0;var u=null;if("active_members"===TS.model.ui_state.tab_name){e=_.parseInt($("#active_members_list > .list_items").css("height"));t=_.reject(a.active_members_list_items,{is_divider:true}).length;n=r.members.filter_num_remaining;u=r.members.filter_p}if("restricted_members"===TS.model.ui_state.tab_name){e=_.parseInt($("#restricted_members_list > .list_items").css("height"));t=_.reject(a.restricted_members_list_items,{is_divider:true}).length;n=r.restricted.filter_num_remaining;u=r.restricted.filter_p}if("disabled_members"===TS.model.ui_state.tab_name){e=_.parseInt($("#disabled_members_list > .list_items").css("height"));t=_.reject(a.deleted_members_list_items,{is_divider:true}).length;n=r.deleted.filter_num_remaining;u=s.deleted.filter_p}var f=.9*Math.min(t,o);e=_.isNaN(e)?0:e;e-=f*l;e&&n&&$(this).scrollTop()>e&&u&&u.isResolved()&&v(i,d,c,m)},50,{leading:true}));var k=(r.members.filter_num_found||0)+(r.restricted.filter_num_found||0)+(r.deleted.filter_num_found||0);TS.members.view.team_filter_changed_sig.dispatch(u,k)}};var w=function e(t,r,n){var i=[];r&&(i=r.split(/\s*,\s*|\s+/).map(function(e){return"@"===e.charAt("0")?e.substring(1):e}).filter(function(e){return!!e}).map(function(e){if(1===e.length||!n.full_profile_filter){var t=TS.utility.search.makeClause("real_name",e);var r=TS.utility.search.makeClause("display_name",e);var i=TS.utility.search.makeConjunction("OR",[t,r]);return i}return TS.utility.search.makeClause("fuzzy_with_email",e)}));i.push(TS.utility.search.makeClause("is","user"));if(n.restricted){var a=TS.utility.search.makeClause("level","restricted");var s=TS.utility.search.makeClause("level","ultra_restricted");i.push(TS.utility.search.makeConjunction("OR",[a,s]))}var l=i.length>1?TS.utility.search.makeConjunction("AND",i):i[0];var u={query:l,count:o,include_bots:n.include_bots,exclude_slackbot:n.exclude_slackbot,include_deleted:n.include_deleted};n.sort&&(u.sort=n.sort);n.sort_dir&&(u.sort_dir=n.sort_dir);n.include_org&&(u.all_of_org=n.include_org);t.filter_cursor_mark&&(u.cursor_mark=t.filter_cursor_mark);n.endpoint&&(u.endpoint=n.endpoint);TS.web&&(u.solr=true);return u};var k=function e(t,r,n){var i=w(t,r,n);i.raw_query=r;return TS.utility.search.promiseToSearch(i).then(function(i){if(!t.filter_num_remaining){t.filter_num_remaining=i.data.num_found;t.filter_num_found=i.data.num_found}t.filter_num_remaining-=i.data.items.length;t.filter_cursor_mark=i.data.next_cursor_mark;if(!i.data.items.length)return Promise.resolve([]);var a=i.data.items.map(function(e){var t=TS.interop.members.getMemberById(e.id);t&&_.isEqual(t,e)||(t=TS.members.legacyUpsertMember(e).member);return t});n.restricted||n.include_restricted_and_full_members||(a=a.filter(function(e){return!e.is_restricted}));if(a.length)return Promise.resolve(a);if(t.filter_num_remaining)return e(t,r,n);return Promise.resolve([])})};var x=function r(n,i,a,s){var o=$(i);var l=n.trim();e=l.toLocaleLowerCase();var u=o.data("list-items-id");var d=$(u);var c=d.find(".member_item:not(.clone)");var _=c.filter(".active");var m=d.find(".member_item.clone");var f=d.find(".filter_header");var p=!TS.web&&"#team_filter"===i;var h={};var g;var S;var T;TS.storage.storeFilterState(e);var v=false;var b;P&&"#team_filter"===i&&(b=d.find(".tab_pane.selected"));b||TS.web||"#team_filter"!==i||(b=$("#team_list_members"));b&&b.length&&b.addClass("hidden");if(v){g=c.parent();S=document.activeElement?$(document.activeElement):null;c.detach()}if(t[a]){t[a].detachEvents();delete t[a]}m.remove();f.remove();_.removeClass("active");d.find(".no_results").addClass("hidden");if(v){g.append(c);S&&S.focus()}var y;if(P&&"invites"===TS.web.admin.view){var w=[];var k=[];var x=[];$.each(c,function(e,t){var r;t=$(t);r=t.data("invite-id");h[r]=t});k=O(TS.web.admin.pending_invites,e).name||[];x=O(TS.web.admin.accepted_invites,e).name||[];w=k.concat(x);if(w.length>0){$.each(w,function(e,t){t&&t.member&&t.member.id&&h[t.member.id]&&h[t.member.id].addClass("active")});a&&$(a).trigger("resize")}y=[{name:"pending",label:TS.interop.i18n.t("pending invitations","members_view")(),matches:k},{name:"accepted",label:TS.interop.i18n.t("accepted invitations","members_view")(),matches:x}];y.forEach(function(e){var t=$("#"+e.name+"_no_results");if(e.matches.length>0){t.addClass("hidden").empty();return}var r={query:l,tab:e,pending_matches:k,show_pending_matches:"pending"!==e.name&&k.length>0,accepted_matches:x,show_accepted_matches:"accepted"!==e.name&&x.length>0};var n=TS.templates.team_list_no_results(r);t.removeClass("hidden").html(n);t.find(".clear_members_filter").on("click",function(){TS.members.view.clearFilter(i,a)})});T=w}else{var C;var M=[];var I=[];var A=[];C=P?n.length?TS.members.getMembersForUser():TS.web.admin.getMembersForUser():TS.members.getMembersForUser();$(".restricted_header, .bot_header, .ra_invite_prompt, .restricted_info").toggleClass("hidden",!!e);$.each(c,function(e,t){var r;t=$(t);r=t.data("member-id");h[r]=t});w=O(C,e,s.full_profile_filter);var F=Object.keys(w);if(F.length>0){E(w,F,h,A,I,M,p?a:"");if(a){var H=$(a);H.trigger("resize");TS.ui.utility.updateClosestMonkeyScroller(H)}}else if("#file_member_filter"===i){d.find(".query").text(l);d.find(".no_results").removeClass("hidden")}if("#team_filter"===i){y=[{name:"active",label:TS.interop.i18n.t("full members","members_view")(),matches:M},{name:"restricted",label:TS.interop.i18n.t("multi-channel guests","members_view")(),matches:I},{name:"disabled",label:TS.interop.i18n.t("deactivated accounts","members_view")(),matches:A}];y.forEach(function(e){var t=$("#"+e.name+"_no_results");function r(){var r={query:l,tab:e,active_matches:M,show_active_matches:"active"!==e.name&&M.length>0,restricted_matches:I,show_restricted_matches:"restricted"!==e.name&&I.length>0,disabled_matches:A,show_disabled_matches:TS.web&&"disabled"!==e.name&&A.length>0};var n=TS.templates.team_list_no_results(r);t.removeClass("hidden").html(n);t.find(".clear_members_filter").on("click",function(){TS.members.view.clearFilter(i,a)})}if(e.matches.length>0){t.addClass("hidden").empty();return}r()})}T=M.concat(I,A)}b&&b.length&&b.removeClass("hidden");TS.ui.utility.updateClosestMonkeyScroller($(a));TS.members.view.team_filter_changed_sig.dispatch(l,T.length)};var C=function e(t){return r[t]||t};var M=function e(t,r){var n=document.createElement("div");var i=document.createElement("strong");n.classList.add("filter_header");i.appendChild(document.createTextNode(t));r.length&&i.appendChild(document.createTextNode(": "));n.appendChild(i);r.forEach(function(e,t){n.appendChild(e);t<r.length-1&&n.appendChild(document.createTextNode(", "))});return n};var I=function e(t,r){var n=document.createElement("span");var i=document.createElement("strong");var a=t.split(r);i.appendChild(document.createTextNode(r));n.appendChild(document.createTextNode(a.shift()));n.appendChild(i);n.appendChild(document.createTextNode(a.join(r)));return n};var E=function e(n,i,a,s,o,l,u){var d=$(u);var c=document.createDocumentFragment();var _=document.createDocumentFragment();var m=document.createDocumentFragment();var f;var p;var h;var g=P&&TS.web.admin.isSubsetCase();i.sort(function(e,t){return TS.interop.i18n.sorter(r[e],r[t])}).forEach(function(e){var t=document.createDocumentFragment();var r=document.createDocumentFragment();var i=document.createDocumentFragment();var u=[];var d=[];var S=[];var T={};var v={};var b={};if(g&&!h){h=$("#active_members > div:first-of-type");p=$("#restricted_members > div:first-of-type");f=$("#disabled_members > div:first-of-type")}n[e].forEach(function(n){var c=n.member;var _;var m=false;if(c&&c.id){_=a[c.id];if(!_&&g){_=$(TS.web.admin.buildMemberHTML(c,false,false));m=true}if(_)if("name"!==e||m)if(c.deleted){f||(f=_.parent());n.value&&!T[n.value]&&(T[n.value]=u.push(I(n.value,n.match)));t.appendChild(_.clone().addClass("active clone").get(0))}else if(c.is_restricted){p||(p=_.parent());n.value&&!v[n.value]&&(v[n.value]=d.push(I(n.value,n.match)));r.appendChild(_.clone().addClass("active clone").get(0))}else{h||(h=_.parent());n.value&&!b[n.value]&&(b[n.value]=S.push(I(n.value,n.match)));i.appendChild(_.clone().addClass("active clone").get(0))}else _.addClass("active");c.deleted?s.push(c):c.is_restricted?o.push(c):l.push(c)}});if(t.childNodes&&t.childNodes.length){c.appendChild(M(C(e),u));c.appendChild(t)}if(r.childNodes&&r.childNodes.length){_.appendChild(M(C(e),d));_.appendChild(r)}if(i.childNodes&&i.childNodes.length){m.appendChild(M(C(e),S));m.appendChild(i)}t=null;r=null;i=null;u=null;d=null;S=null;T=null;v=null;b=null});f&&f.append(c);p&&p.append(_);h&&h.append(m);if(d.length){var S=d.find(".member_item.clone");t[u]=S.find(".lazy").lazyload({container:d,ignore_when_hidden_element:d,all_images_same_size:true});S.one("remove",function(){if(t[u]){t[u].detachEvents();delete t[u]}})}if(g){if(TS.web.admin.lazyload&&TS.web.admin.lazyload.detachEvents){TS.web.admin.lazyload.detachEvents();TS.web.admin.lazyload=null}TS.web.admin.lazyload||(TS.web.admin.lazyload=$("#admin_list").find(".lazy").lazyload())}c=null;_=null;m=null;f=null;p=null;h=null};var A=function e(t){return _.reduce(t,function(e,t){t.deleted?t.is_bot?e.deleted_bots.push(t):e.disabled_members.push(t):t.is_ultra_restricted?e.ultra_restricted_members.push(t):t.is_restricted?e.restricted_members.push(t):t.is_bot||TS.interop.rules.members.isSlackbot(t)?e.bots.push(t):e.members.push(t);return e},{members:[],disabled_members:[],deleted_bots:[],bots:[],restricted_members:[],ultra_restricted_members:[]})};var P;var O=function e(t,n,i){var a=new RegExp("^"+TS.utility.regexpEscape(n),"i");var s=new RegExp("(-|_|\\+|\\s|\\.|@)"+TS.utility.regexpEscape(n),"i");var o={};var l=i&&n?TS.team.getVisibleTeamProfileFields():[];r={title:"What I Do",name:"Name"};t.forEach(function(e){var t;t=e._real_name_lc&&(e._real_name_lc.match(a)||e._real_name_lc.match(s))||e.email&&(e.email.match(a)||e.email.match(s))||e.profile&&e.profile.email&&(e.profile.email.match(a)||e.profile.email.match(s))||e.profile&&e.profile.real_name_normalized&&(e.profile.real_name_normalized.match(a)||e.profile.real_name_normalized.match(s))||e.profile&&e.profile.real_name&&(e.profile.real_name.match(a)||e.profile.real_name.match(s))||e.profile&&e.profile.display_name_normalized&&(e.profile.display_name_normalized.match(a)||e.profile.display_name_normalized.match(s))||e.profile&&e.profile.preferred_name&&(e.profile.preferred_name.match(a)||e.profile.preferred_name.match(s));if(t){o.name||(o.name=[]);o.name.push({member:e})}if(i&&n){t=e.profile&&e.profile.title&&(e.profile.title.match(a)||e.profile.title.match(s));if(t){o.title||(o.title=[]);o.title.push({member:e})}}l.length&&e.profile&&e.profile.fields&&l.forEach(function(n){var i=e.profile.fields[n.id];if(!i)return;t=null;if("user"===n.type){if(i.value){var l="";i.value.split(/\s*,\s*/).some(function(e){l=TS.interop.members.getPrefCompliantMemberNameById(e,false);return l.match(a)||l.match(s)});if(t){o[n.id]||(o[n.id]=[]);o[n.id].push({member:e,value:l,match:t[0]})}}}else{t=i.value&&(i.value.match(a)||i.value.match(s));if(t){o[n.id]||(o[n.id]=[]);o[n.id].push({member:e,value:i.value,match:t[0]})}else{t=i.alt&&(i.alt.match(a)||i.alt.match(s));if(t){o[n.id]||(o[n.id]=[]);o[n.id].push({member:e,value:i.alt,match:t[0]})}}}t&&!r[n.id]&&(r[n.id]=n.label)})});return o};var F=function e(t){if(!P)return Promise.resolve();var r=[];_.map(t,function(e){var t=_.get(TS.boot_data.channel_membership,e.id);if(t){var i=_.chain(t.channels).keys().concat(_.keys(t.groups)).value();r.push.apply(r,n(i));e.channels=t.channels||{};e.groups=t.groups||{};e.more_groups=t.more_groups}});return TS.shared.ensureModelObsArePresent(r,"admin_guest_channels")}})()},SkS5:function(e,t){(function(){TS.registerModule("notifs",{onStart:function e(){},canModelObHaveChannelMentions:function e(t){return TS.redux.notifications.canChannelHaveAtChannelMentions(t)},hasUserSuppressedCorGChannelMentions:function e(t){if(TS.boot_data.feature_turn_mpdm_notifs_on)return!!TS.redux.notifications.getNotificationsChannelPref(t.id,"suppress_at_channel");var r=TS.model.at_channel_suppressed_channels.indexOf(t.id);if(-1!=r)return true;return false},isCorGMuted:function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}return TS.redux.channels.isChannelMutedById(t)},getCorGsNotUsingGlobalNotificationSetting:function e(){var t={nothing:[],mentions:[],everything:[],muted:[],suppressed:[]};var r=TS.interop.channels.getPublicChannelsUserIsIn();_.forOwn(r,function(e){if(TS.interop.rules.channels.isArchived(e))return;if(!e.is_member)return;n(e.id)&&t.nothing.push(e);i(e.id)&&t.mentions.push(e);a(e.id)&&t.everything.push(e);TS.notifs.isCorGMuted(e.id)&&t.muted.push(e);TS.notifs.hasUserSuppressedCorGChannelMentions(e)&&t.suppressed.push(e)});_.forOwn(TS.model.groups,function(e){if(TS.interop.rules.channels.isArchived(e))return;n(e.id)&&t.nothing.push(e);i(e.id)&&t.mentions.push(e);a(e.id)&&t.everything.push(e);TS.notifs.isCorGMuted(e.id)&&t.muted.push(e);TS.notifs.hasUserSuppressedCorGChannelMentions(e)&&t.suppressed.push(e)});_.forOwn(TS.model.mpims,function(e){if(TS.interop.rules.channels.isArchived(e))return;n(e.id)&&t.nothing.push(e);i(e.id)&&t.mentions.push(e);a(e.id)&&t.everything.push(e);TS.notifs.isCorGMuted(e.id)&&t.muted.push(e);TS.notifs.hasUserSuppressedCorGChannelMentions(e)&&t.suppressed.push(e)});return t},getCalculatedCorGNotifySetting:function n(i){if(!i){TS.error('wtf no c_id "'+i+'"');return false}if(TS.boot_data.feature_turn_mpdm_notifs_on){var a=TS.redux.notifications.getCalculatedDesktopNotifySetting(i);if("mentions_dms"===a)return"mentions";return a}var s=r(i);if(s){if(e(i))return"everything";if(t(i))return"nothing";return"mentions"}if(TS.prefs.getPref("growls_enabled")){if(TS.prefs.getPref("all_channels_loud"))return"everything";return"mentions"}return"nothing"},muteOrUnmuteCorG:function e(t){if(!t)return;var r=TS.redux.channels.getEntityById(t);if(!r)return;if(r.is_im)return;var n=TS.notifs.isCorGMuted(t);if(n)TS.notifs.makeCorGNOTMuted(t);else{TS.notifs.makeCorGMuted(t);r.is_mpim&&TS.mpims.legacyMarkMostRecentReadMsg(r,TS.model.marked_reasons.muted)}var i=TS.redux.channels.getMutedChannelsAsArray().join(",");TS.prefs.legacyOnPrefChanged({name:"muted_channels",value:i});TS.prefs.setPrefByAPI({name:"muted_channels",value:i})},makeCorGMuted:function e(t){var r=TS.interop.channels.getPublicChannelById(t);var n=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!r&&!n&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=true;TS.redux.channels.setMutedChannelById(t,a);TS.prefs.setMutedChannels(TS.redux.channels.getMutedChannelsAsArray().join(","))},makeCorGNOTMuted:function e(t){var r=TS.interop.channels.getPublicChannelById(t);var n=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!r&&!n&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=false;TS.redux.channels.setMutedChannelById(t,a);TS.prefs.setMutedChannels(TS.redux.channels.getMutedChannelsAsArray().join(","))},makeCorGDTopEverything:function e(t){var r=TS.interop.channels.getPublicChannelById(t);var n=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!r&&!n&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.never_channels.indexOf(t);-1!=a&&TS.model.never_channels.splice(a,1);TS.prefs.setNeverChannels(TS.model.never_channels.join(","));a=TS.model.loud_channels.indexOf(t);if(TS.prefs.getPref("growls_enabled")&&TS.prefs.getPref("all_channels_loud")){-1!=a&&TS.model.loud_channels.splice(a,1);d(t)}else{-1==a&&TS.model.loud_channels.push(t);u(t)}TS.prefs.setLoudChannels(TS.model.loud_channels.join(","))},makeCorGDTopMentions:function e(t){var r=TS.interop.channels.getPublicChannelById(t);var n=TS.interop.channels.getGroupById(t);var i=TS.interop.channels.getMpimById(t);if(!r&&!n&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.loud_channels.indexOf(t);-1!=a&&TS.model.loud_channels.splice(a,1);TS.prefs.setLoudChannels(TS.model.loud_channels.join(","));a=TS.model.never_channels.indexOf(t);-1!=a&&TS.model.never_channels.splice(a,1);TS.prefs.setNeverChannels(TS.model.never_channels.join(","));TS.prefs.getPref("growls_enabled")&&!TS.prefs.getPref("all_channels_loud")?d(t):u(t)},getCalculatedCorGPushNotifySetting:function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.boot_data.feature_turn_mpdm_notifs_on){var r=TS.redux.notifications.getCalculatedMobileNotifySetting(t);if("mentions_dms"===r)return"mentions";return r}var n=l(t);if(n){if(s(t))return"everything";if(o(t))return"mentions";return"nothing"}if(TS.prefs.getPref("push_everything"))return"everything";if(TS.prefs.getPref("push_mention_alert")||TS.prefs.getPref("push_dm_alert"))return"mentions";return"nothing"},getGlobalNotificationSetting:function e(){if(TS.boot_data.feature_turn_mpdm_notifs_on){var t=TS.redux.notifications.getGlobalDesktopNotifySetting();if("mentions_dms"===t)return"mentions";return t}if(!TS.prefs.getPref("growls_enabled"))return"nothing";if(TS.prefs.getPref("all_channels_loud"))return"everything";return"mentions"},setGlobalNotificationPrefByKey:function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];"mentions"===r&&(r="mentions_dms");return TS.interop.api.call("users.prefs.setNotifications",{global:true,name:t,value:r,sync:n}).then(function(e){var r=e.data;if(r&&r.all_notifications_prefs){TS.prefs.legacyOnPrefChanged({name:"all_notifications_prefs",value:JSON.stringify(r.all_notifications_prefs)});"global_keywords"===t&&_.get(r.all_notifications_prefs,"global.global_keywords")&&TS.prefs.legacyOnPrefChanged({name:"highlight_words",value:r.all_notifications_prefs.global.global_keywords})}})}});var e=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.loud_channels.indexOf(t)>-1)return true;return false};var t=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.never_channels.indexOf(t)>-1)return true;return false};var r=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.loud_channels_set&&TS.model.loud_channels_set.indexOf(t)>-1)return true;return false};var n=function e(t){if(TS.prefs.getPref("growls_enabled")&&"nothing"===TS.notifs.getCalculatedCorGNotifySetting(t))return true;return false};var i=function e(t){var r=TS.notifs.getCalculatedCorGNotifySetting(t);if("mentions"!==r)return false;if(!TS.prefs.getPref("growls_enabled")||TS.prefs.getPref("all_channels_loud"))return true;return false};var a=function e(t){if((!TS.prefs.getPref("growls_enabled")||!TS.prefs.getPref("all_channels_loud"))&&"everything"===TS.notifs.getCalculatedCorGNotifySetting(t))return true;return false};var s=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.push_loud_channels.indexOf(t)>-1)return true;return false};var o=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.push_mention_channels.indexOf(t)>-1)return true;return false};var l=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.push_loud_channels_set&&TS.model.push_loud_channels_set.indexOf(t)>-1)return true;return false};var u=function e(t){var r=TS.model.loud_channels_set.indexOf(t);-1==r&&TS.model.loud_channels_set.push(t);TS.prefs.setLoudChannelsSet(TS.model.loud_channels_set.join(","))};var d=function e(t){var r=TS.model.loud_channels_set.indexOf(t);-1!=r&&TS.model.loud_channels_set.splice(r,1);TS.prefs.setLoudChannelsSet(TS.model.loud_channels_set.join(","))}})()},SmOH:function(e,t){(function(){TS.registerModule("format",{hex_rx:/(\W|^)(#[A-Fa-f0-9]{6})(\b)/g,onStart:function e(){t()},replaceHighlightMarkers:function e(t,r,n){if(!t)return"";r=r||"";n=n||"";return t.replace(/\ue000/g,r).replace(/\ue001/g,n)},hasOnlyValidMemberIds:function e(t){if(!_.isString(t))return true;return _.every(t.match(n),function(e){return TS.interop.members.getMemberById(e)})},cleanMsg:function e(t){return TS.interop.format.cleanMessageTextWithState(TS.redux.getState(),t,{isInternalMessage:false})},cleanInternalMsg:function e(t){return TS.interop.format.cleanMessageTextWithState(TS.redux.getState(),t,{isInternalMessage:true})},legacyDoEmoticonConversion:function e(t){d.length=0;t=t.replace(i,f);t=t.replace(a,f);t=t.replace(s,f);t=TS.emoji.legacyReplaceEmoticons(t);t=TS.format.deTokenizeStr(d,t);return t},tokenizeStr:function e(t,r,n){if(!r)return"";n=n||"";var i=0===r.indexOf("\n")?"\n":"";var a=S(i+m+(c+=1)+Date.now());a=n+a+n;t.push({str:r,token:a});return a},deTokenizeStr:function e(t,r){var n;var i=t.length-1;for(i;i>-1;i-=1){n=t[i];r=r.replace(n.token,n.str.replace(/\$/g,"$$$$"))}return r},unFormatMsg:function e(t,r){return TS.format.formatWithOptions(t,r,{for_edit:true})},formatJustText:function e(t){return TS.format.formatWithOptions(t)},formatDefault:function e(t,r){return TS.format.formatWithOptions(t,r)},formatNoHighlightsNoSpecials:function e(t,r){return TS.format.formatWithOptions(t,r,{no_highlights:true,no_specials:true})},formatNoHighlightsNoSpecialsNoInlineImgs:function e(t,r){return TS.format.formatWithOptions(t,r,{no_highlights:true,no_specials:true,do_inline_imgs:false})},formatNoHighlightsNoInlineImgs:function e(t,r){return TS.format.formatWithOptions(t,r,{do_inline_imgs:false,no_highlights:true})},formatNoSpecials:function e(t,r){return TS.format.formatWithOptions(t,r,{no_specials:true})},formatNotification:function e(t,r){return TS.format.formatWithOptions(t,r,{for_growl:true})},formatCurrentStatus:function e(t,r,n){n=n||{};return TS.format.formatWithOptions(t,r,_.assign({no_jumbomoji:true,no_linking:true,no_specials:true,no_highlights:true,no_emoji_text:true,prevent_copy_paste:true},n))},formatBroadcastExcerpt:function e(t,r){var n="&hellip;<br>";var i=n+'<span class="multiline_block">';var a="</span>";var s=TS.format.formatWithOptions(t,r,{no_highlights:true,no_hex_colors:true,do_inline_imgs:false,enable_slack_action_links:false,do_theme_install_buttons:false,no_jumbomoji:true,no_linking:true,custom_linebreak:n,token_overrides:{"<PRE:START>":i,"<PRE:END>":a,"<QUOTE:START>":i,"<QUOTE:END>":a,"<CODE:START>":"<span>","<CODE:END>":"</span>","<PARA:BREAK>":n}});_.startsWith(s,n)&&(s=s.substring(n.length));return s},extractIds:function e(t){var r=[];var n=[];if(!t)return{c_ids:r,m_ids:n};var i=t.match(/<[#@]+(.*?)>/g);i&&i.forEach(function(e){var t;var i;if(0===e.indexOf("<@")){t=e.replace(/<|>/g,"");i=TS.utility.msgs.getMemberIdFromMemberMarkup(t);TS.interop.utility.looksLikeMemberId(i)&&TS.utility.ensureInArray(n,i)}else{t=e.replace(/<|>|#/g,"");i=t.split("|")[0];TS.interop.utility.looksLikeChannelId(i)&&TS.utility.ensureInArray(r,i)}});return{c_ids:r,m_ids:n}},calculateOptions:function e(t,r){return T(t,r)},formatWithOptions:function e(t,r,n){if(!$.trim(t))return"";var i=T(r,n);var a=v(t,r,i);return a},applyStringifyTransformsToChildren:function e(t,r,n){if(!t)return false;_.isObject(r)||(r={});if(!t.childElementCount)return false;var i=!n&&1===t.childNodes.length&&1===t.firstChild.nodeType&&t.firstChild.hasAttribute("data-stringify-requires-siblings");if(i)return;"PRE"!==t.tagName&&_.each(t.querySelectorAll("pre br"),function(e){e.parentElement.replaceChild(document.createTextNode("\n"),e)});var a=_.filter(t.querySelectorAll("*"),function(e){if(!P(e))return false;if(_.isFunction(r.excludeFn)&&r.excludeFn(e))return false;e.childElementCount&&TS.format.applyStringifyTransformsToChildren(e,r,true);var n;n=_.isFunction(r.customFn)&&r.customFn(e)?r.customFn(e):TS.format.stringifyNode(e);var i=n!==e.textContent;i&&("IMG"===e.tagName?t.replaceChild(document.createTextNode(n),e):e.textContent=n);return i});return a.length>0},formatSelection:function e(t,r){if(!t||!t.rangeCount)return;_.isObject(r)||(r={});var n=TS.selection.combineRanges(t);if(!n)return;var i;if(_.isElement(n.commonAncestorContainer)){if($(n.commonAncestorContainer).is(".ql-editor"))return t.toString();if(TS.model.is_safari_desktop){var a=n.commonAncestorContainer.querySelectorAll("ts-message");if(a.length>1)return}var s=n.commonAncestorContainer.cloneNode();s.appendChild(n.cloneContents());s.classList.add("offscreen","user_select_text");n.commonAncestorContainer.parentElement.appendChild(s);var o="\ufeff";s.innerHTML=s.innerHTML.replace(/&nbsp;/g,o);!s.lastChild||s.lastChild.textContent||P(s.lastChild)||s.removeChild(s.lastChild);var l=s.getElementsByClassName("para_break");if(l.length){_.eachRight(l,function(e){var t=document.createElement("br");e.parentElement.replaceChild(t,e);var r=document.createElement("br");t.parentElement.insertBefore(r,t.nextSibling)});s.innerHTML=s.innerHTML.replace(/<br>((<br>){2,})/g,"$1")}_.each(s.querySelectorAll([".ts_tip_tip",".c-message_list__unread_divider",".unread_divider",".c-message_list__day_divider__label",".c-reaction_bar",".c-message__reply_bar",".c-message__broadcast_repliers",".c-file__slide",".c-file__actions",".c-file_container__expand_container",".c-button",".c-message_attachment__row--actions",".c-message_attachment__border",".c-message_attachment__media_trigger",".c-message__label",".c-message--adjacent .c-message__gutter"].join(",")),function(e){e&&e.parentNode&&e.parentNode.removeChild(e)});TS.format.applyStringifyTransformsToChildren(s,r);var u=TS.selection.snapshot();t=TS.selection.selectNodeContents(s);i=t.toString();var d=/\ufeff/g;i=i.replace(/ {2}/g," ").replace(d," ");s.parentElement.removeChild(s);u()}else i=t.toString();i=TS.interop.format.replaceUnicodeDoppelgangers(i);i=i.replace(/^\n+/,"");i=i.replace(/\n+$/,"");return i},stringifyNode:function e(t){if(!t)return"";if(!P(t))return t.textContent;var r=t.textContent;_.each(o,function(e,n){t.hasAttribute(n)&&(r=e(t,r))});return r},shouldAllowIntraWordFormatting:function e(){return TS.boot_data.feature_allow_intra_word_formatting},test:function e(){var t={encodeSpecialFormattingChars:g,encodeSpecialFormattingCharsAndColon:S,getTokenMap:l,getUserGroupDisplayName:x,doUserGroupHighlighting:p,doHighlighting:h,maybeRenderUnknownOrNonExistentUserGroup:C};Object.defineProperty(t,"_hasStringifyTransformations",{get:function e(){return P},set:function e(t){P=t}});Object.defineProperty(t,"doHighlighting",{get:function e(){return h},set:function e(t){h=t}});Object.defineProperty(t,"doUserGroupHighlighting",{get:function e(){return p},set:function e(t){p=t}});return t}});var e=[];var t=function t(){TS.interop.broadcast_keywords.getAllBroadcastKeywords().forEach(function(t){e.push(t.ms_name);t.alias&&e.push(t.alias)})};var r=/((?:#[A-Fa-f0-9]{6} {0,}, {0,}){7})(#[A-Fa-f0-9]{6})(\b)/g;var n=/(^|\s|\{|\[|\(|&gt;|&lt;|\*|_|\/|"|\u201c|\u2018|')(@([^~`!@#$%^&*()+=[\]{}\\|;:'"\u201d\u2019,<>/?\s]+))/g;var i=/(^|\s|[_*?.,\-!^;:{([%$#+=\u2000-\u206F\u2E00-\u2E7F"])```([\s\S]*?)?```(?=$|\s|[_*?.,\-!^;:})\]%$#+=\u2000-\u206F\u2E00-\u2E7F\u2026"])/g;var a=/(^|\s|[?.,\-!^;:{([%$#+=\u2000-\u206F\u2E00-\u2E7F"])`([^`]*?\S *)?`/g;var s=/(^|\n)&gt;(?![\W_](?:&lt;|&gt;|[|/\\[\]{}()Dpb](?=\s|$)))(([^\n]*)(\n&gt;[^\n]*)*)/g;var o={"data-stringify-text":function e(t){return t.getAttribute("data-stringify-text")},"data-stringify-prefix":function e(t,r){var n=t.getAttribute("data-stringify-prefix");return TS.interop.format.surroundTextWith({text:r,prefix:n})},"data-stringify-suffix":function e(t,r){var n=t.getAttribute("data-stringify-suffix");return TS.interop.format.surroundTextWith({text:r,suffix:n})}};var l=function e(){var t={"<QUOTE:START>":'<div class="special_formatting_quote"><div class="quote_bar"><div class="shim"></div></div><div class="content dynamic_content_max_width">',"<QUOTE:PREFIX>":'<span class="copyonly">&gt;</span>',"<LONGQUOTE:PREFIX>":'<span class="copyonly">&gt;&gt;&gt;</span>',"<QUOTE:END>":"</div></div>","<LINK:END>":"</a>","<LINE:BREAK>":"<br>","<PARA:BREAK>":'<span class="para_break"><i class="copy_only"><br></i></span>',"<SPACE:HARD>":"&nbsp;"};var r="ja-JP"===TS.interop.i18n.locale?"\uff0a":"*";var n="ja-JP"===TS.interop.i18n.locale?"\uff3f":"_";var i="ja-JP"===TS.interop.i18n.locale?"\uff40":"`";var a="ja-JP"===TS.interop.i18n.locale?"\uff40\uff40\uff40":"```";t["<B:START>"]='<b data-stringify-prefix="'+r+'" data-stringify-suffix="'+r+'" data-stringify-requires-siblings>';t["<B:END>"]="</b>";t["<STRIKE:START>"]='<strike data-stringify-prefix="~" data-stringify-suffix="~" data-stringify-requires-siblings>';t["<STRIKE:END>"]="</strike>";t["<CODE:START>"]='<code class="special_formatting" data-stringify-prefix="'+i+'" data-stringify-suffix="'+i+'" data-stringify-requires-siblings>';t["<CODE:END>"]="</code>";t["<I:START>"]='<i data-stringify-prefix="'+n+'" data-stringify-suffix="'+n+'" data-stringify-requires-siblings>';t["<I:END>"]="</i>";t["<PRE:START>"]='<pre class="special_formatting" data-stringify-prefix="'+a+'" data-stringify-suffix="'+a+'" data-stringify-requires-siblings>';t["<PRE:END>"]="</pre>";return t};var u=l();var d=[];var c=0;var m="^$-+\u2014!?][{}^$-+\u2014!?][{}^$-+\u2014!?][{}^$-+\u2014!?][{}^$-+\u2014!?][{}^$-+\u2014!?][{}^$-+\u2014!?][{}".split("").sort(function(){return.5-Math.random()}).join("");var f=function e(t,r){var n=t.slice(r.length);return r+TS.format.tokenizeStr(d,n)};var p=function e(t){var r=t.id;if(TS.interop.userGroups.isUserGroupMember(r))return'<span class="mention">@'+t.handle+"</span>";return"@"+t.handle};var h=function e(t){var r=TS.interop.format.locateHighlightWords(t,TS.interop.prefs.getHighlightWords());_.forEachRight(r,function(e){var r=e.index;var n=r+e.length;var i=t.slice(r,n);var a=t.slice(0,r);var s='<span class="mention">'+i+"</span>";var o=t.slice(n);t=a+s+o});return t};var g=function e(t){if(!t)return"";return t.replace(/\*/g,"&ast;").replace(/_/g,"&#95;").replace(/`/g,"&#96;")};var S=function e(t){if(!t)return"";return g(t).replace(/:/g,"&#58;")};var T=function e(t,r){r=r||{};var n=!!r.do_inline_imgs||void 0;var i=!!r.for_growl||void 0;var a=!!r.for_edit||void 0;var s=!!r.no_highlights||void 0;var o=!!r.no_specials||void 0;var l=!!r.enable_slack_action_links||void 0;var u=!!r.no_jumbomoji||void 0;var d=!!r.no_preformatted||void 0;var c=r.custom_linebreak||void 0;var m=!!r.stop_animations||void 0;var f=!!r.no_emoji_text||void 0;var p=!!r.transform_missing_emoji||void 0;var h=!!r.show_icon_for_emoji_in_as_text_mode||void 0;var g=!!r.ignore_emoji_mode_pref||void 0;var S=!!r.prevent_copy_paste||void 0;var T=!!r.no_linking||void 0;var v=r.token_overrides||void 0;var b=r.emoji_mode;!_.isString(b)&&TS.prefs.prefs_loaded&&(b=TS.interop.rules.emoji.getEmojiMode());true!==u&&(u=!TS.prefs.getPref("jumbomoji"));s=t&&"no_highlights"in t?!!t.no_highlights:!!s;_.isBoolean(o)||(o=!!(t&&"mrkdwn"in t)&&false===t.mrkdwn);a&&(o=true);var y=t&&t.no_emoji;var w=!(n&&(!t||"bot_message"!==t.subtype));true!==w&&(w=!!TS.prefs.getPref("hide_hex_swatch"));var k="NORMAL";o&&(k="NOMRKDWN");i&&(k="GROWL");a&&(k="EDIT");return{tsf_mode:k,no_highlights:s,no_emoji:y,no_hex_colors:w,do_inline_imgs:n,enable_slack_action_links:l,do_theme_install_buttons:false,no_jumbomoji:u,no_preformatted:d,custom_linebreak:c,stop_animations:m,no_emoji_text:f,transform_missing_emoji:p,show_icon_for_emoji_in_as_text_mode:h,ignore_emoji_mode_pref:g,prevent_copy_paste:S,no_linking:T,token_overrides:v,emoji_mode:b}};var v=function e(t,n,i){var a=i.tsf_mode;var s=i.no_highlights;var o=i.no_emoji;var l=i.no_hex_colors;var d=i.do_inline_imgs;var c=i.enable_slack_action_links;var m=i.do_theme_install_buttons;var f=i.no_jumbomoji;var p=i.no_preformatted;var g=i.custom_linebreak;var S=i.stop_animations;var T=i.no_emoji_text;var v=i.transform_missing_emoji;var x=i.show_icon_for_emoji_in_as_text_mode;var C=i.ignore_emoji_mode_pref;var P=i.prevent_copy_paste;var F=i.no_linking;var H=i.token_overrides;var j=i.emoji_mode;var D=u;if(g||H){var L=H||{};g&&(L["<LINE:BREAK>"]=g);D=_.extend({},D,L)}var R=[];if(m){var N=r;var B=(t.match(N)||[]).length;var U=[];var q=0;t=t.replace(N,function(e,t,r){q+=1;var n=B>1?I(e,q):I(e);U.push(n);var i=B>1?" ("+q+")\t":"";return t+TS.format.tokenizeStr(R,"<nobr>",",")+r+i+TS.format.tokenizeStr(R,"</nobr>")});t+=TS.format.tokenizeStr(R,E(U))}var G=TSF.getTokensArray($.trim(t),a,{jumbomoji:!f,allow_intra_word_formatting:TS.format.shouldAllowIntraWordFormatting()});p&&(G=G.map(A));F&&(G=_.reject(G,O));var W="";var z;var K;var V;var Y;var J;var Q;var X;var Z;var ee;var te;var re;var ne;var ie;var ae;var se;var oe;var le;var ue;var de;if("GROWL"===a||"EDIT"===a)for(Y=0;Y<G.length;Y+=1){V=G[Y];if(0===V.indexOf("<"))if(D[V])TS.error('unexpected: mode == "GROWL" || "EDIT", and yet we got something in the formatting map? '+V);else if(0===V.indexOf("<!"))W+=k(a,V);else if(0===V.indexOf("<@")){de=w(a,V);W+=de}else 0===V.indexOf("<#")?W+=b(a,V):TS.error('unexpected: mode == "GROWL" || "EDIT", and yet we got '+V);else if(-1==V.indexOf("<"))if("EDIT"===a){TS.interop.i18n.locale===TS.interop.i18n.DEFAULT_LOCALE||TS.utility.contenteditable.inlineEmojiIsEnabled()||(V=TS.emoji.maybeGetLocalizedEmojiString(V));W+=_.unescape(V)}else if(TS.utility.platformSupportsHtmlNotifications())W+=TS.emoji.graphicReplace(V,{force_img:true,stop_animations:S});else{var ce=_.unescape(V);ce=TS.emoji.maybeUnifiedReplace(ce);TS.interop.i18n.locale!==TS.interop.i18n.DEFAULT_LOCALE&&(V=TS.emoji.maybeGetLocalizedEmojiString(V));W+=ce}else TS.error("token has a < in it but it is not the first character!\n"+V)}else{var _e="";var me;var fe;var pe;for(Y=0;Y<G.length;Y+=1){V=G[Y];if(0===V.indexOf("<"))if(D[V]){W+=D[V];if(V==TSF.LINK_END){W+=_e;_e=""}}else if(0===V.indexOf("<!"))W+=k(a,V,s,F);else if(0===V.indexOf("<@")){de=w(a,V,s,F);W+=de}else if(0===V.indexOf("<#"))W+=b(a,V,F);else if(0===V.indexOf(TSF.LINK_START.split(" ")[0])){var he=function(e){var t=$.trim(e.replace(TSF.LINK_START.split(" ")[0],""));return t.substr(0,t.length-1)}(V);var ge=TS.interop.utility.getBotIdFromUrl(he);var Se;var Te="";var ve;var be="";if(ge){ve=TS.interop.bots.getBotById(ge);if(!ve){TS.warn("No bot found for "+ge);if(TS.interop.rules.channels.isExternallySharedChannel(TS.shared.legacyGetActiveModelOb())&&n.user){Se=_.get(TS.interop.members.getMemberById(n.user),"profile.team");ve={id:ge,name:TS.interop.bots.getBotNameByBotLink(n.text)?TS.interop.bots.getBotNameByBotLink(n.text):"",source_team_id:Se}}}}if(!ge||!ve||ve.is_unknown||ve.isUnknown||ve.isNonExistent)if(0===he.indexOf(""+TS.utility.msgs.old_api_url_prefix))W+='<a class="api_url muted">(Disabled) ';else if(0===he.indexOf(TS.utility.msgs.new_api_url_prefix))if(c){me=_.escape(JSON.stringify(""+he));W+='<a onclick="TS.utility.msgs.doNewApiUrl('+me+')" class="api_url">'}else W+='<a class="api_url muted">(Disabled) ';else if(0===he.indexOf("javascript:"))W+="<a>";else{var ye=TS.utility.getFileIDFromURL(he);var we=false;if(ye&&TS.model&&TS.model.user&&TS.model.user.is_primary_owner){var ke=!!TS.files&&TS.files.getFileById(ye);ke&&TS.utility.welcome_post&&ke.name==TS.utility.welcome_post.WELCOME_POST_NAME&&(we=true)}var xe=we?"file_new_window_link welcome_post_slackbot_message":"file_preview_link";var Ce=ye?' class="no_jumbomoji '+xe+'"':"";var Me=ye?' data-file-id="'+ye+'"':"";W+="<a "+TS.utility.makeRefererSafeLink(he)+' target="_blank"'+Ce+Me+">";_e&&TS.error("WTF we should have no attach_html");_e="";var Ie;if(n&&n.ts&&d){Ie=TS.inline_attachments.getAttachmentByFromUrl(n.attachments,he);Ie&&(TS.boot_data.feature_attachments_inline||TS.templates.builders.shouldDoSimpleAttachment(Ie,n))&&(_e=TS.templates.builders.buildAttachmentHTML({attachment:Ie,url:he,msg:n,show_initial_caret:true}))}}else{pe=true;Z=TS.utility.shouldLinksHaveTargets()?'target="'+he+'" ':"";fe=s?ve.name:h(ve.name);G[Y+1]&&G[Y+1]==he&&(fe=he);fe=fe.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");ve.app_id&&(Te=ve.app_id);ve.source_team_id&&(be="data-team-id="+ve.source_team_id+" ");W+='<a href="'+he+'" '+Z+'data-bot-id="'+ge+'" data-app-id="'+Te+'" '+be+'class="internal_bot_link app_preview_link">'+fe}}else 0===V.indexOf(TSF.JUMBOMOJI_COLONS.split(" ")[0])?W+=y(V,{tsf_mode:a,no_emoji:o,do_jumbomoji:!f,stop_animations:S,no_emoji_text:T,transform_missing_emoji:v,show_icon_for_emoji_in_as_text_mode:x,ignore_emoji_mode_pref:C,emoji_mode:j}):0===V.indexOf(TSF.EMOJI_COLONS.split(" ")[0])?W+=y(V,{tsf_mode:a,no_emoji:o,do_jumbomoji:false,stop_animations:S,no_emoji_text:T,transform_missing_emoji:v,show_icon_for_emoji_in_as_text_mode:x,ignore_emoji_mode_pref:C,emoji_mode:j}):0===V.indexOf(TSF.HEX_BLOCK.split(" ")[0])?W+=M(a,V,l):TS.error("markup token not handled:"+V);else if(-1===V.indexOf("<"))if(pe)pe=false;else{s||(V=h(V));P&&(V=_.map($.parseHTML(V),function(e){if(e.nodeType===Node.TEXT_NODE)return'<span class="prevent_copy_paste" aria-label="'+_.escape(e.textContent)+'"></span>';return e.outerHTML}).join(""));W+=V}else TS.error("token has a < in it but it is not the first character!\n"+V)}}if(n&&("sh_room_created"===n.subtype||"sh_room_shared"===n.subtype)){var Ee=TS.ui.growls.extractFromNameFromCorGMessage(n);if(Ee){("GROWL"!==a||TS.utility.platformSupportsHtmlNotifications())&&(Ee=_.escape(Ee));Ee+=": "}W="sh_room_created"===n.subtype?TS.interop.i18n.t("{from_name} Started a call","string_format")({from_name:Ee}):TS.interop.i18n.t("{from_name} Shared a call","string_format")({from_name:Ee})}W=TS.format.deTokenizeStr(R,W);return W};var b=function e(t,r,n){var i=r.replace(/<|>|#/g,"");var a=i.split("|");var s=a[0];var o=a[1];var l=TS.redux.channels.getEntityById(s);if(l&&TS.interop.rules.channels.isUnknown(l)&&"EDIT"!==t&&"GROWL"!==t)return TS.templates.unknown_channel({id:s});var u;var d;var c;var _;if(l){var m=TS.interop.rules.channels.isPrivateChannel(l);c=TS.interop.rules.channels.isPublicChannel(l);d=TS.interop.rules.channels.isNonExistent(l);_=TS.interop.rules.channels.isFromAnotherTeam(l);(m||c)&&(u=l.name)}var f=TS.interop.format.formatChannelName({fallbackName:o,channelName:u,isNonExistent:d});if(!l||!c||d||"GROWL"===t||"EDIT"===t||n||_)return f;var p=TS.utility.shouldLinksHaveTargets()?'target="/archives/'+l.id+'"':"";return'<a href="/archives/'+l.id+'" '+p+' data-channel-name="'+l.name+'" data-channel-id="'+l.id+'" class="internal_channel_link">'+f+"</a>"};var y=function e(t,r){r=r||{};var n=t.split(" ")[1].replace(">","");if(r.no_emoji)return n;var i;var a=TS.emoji.isValidName(n);i=r.transform_missing_emoji&&!a?TS.emoji.MISSING_EMOJI_HTML:r.show_icon_for_emoji_in_as_text_mode&&"as_text"===r.emoji_mode?TS.emoji.graphicReplace(n,{show_icon_for_emoji_in_as_text_mode:true}):TS.emoji.graphicReplace(n,{obey_emoji_mode_pref:!r.ignore_emoji_mode_pref,include_title:true,include_text:!r.no_emoji_text,jumbomoji:r.do_jumbomoji,stop_animations:r.stop_animations});i&&-1!==i.indexOf(">>")&&TS.warn("TS.emoji.graphicReplace may be malformed: "+i);return i};var w=function e(t,r,n,i){var a=r.replace(/<|>/g,"");var s=TS.utility.msgs.getMemberIdFromMemberMarkup(a);if(!TS.interop.utility.looksLikeMemberId(s))return a;var o=TS.utility.msgs.getMemberFromMemberMarkup(a);if(o&&"EDIT"!==t&&"GROWL"!==t){if(o.is_unknown)return TS.templates.unknown_member({id:o.id});if(o.is_non_existent&&TS.interop.utility.looksLikeMemberId(o.id))return TS.templates.message_member_non_existent({id:o.id})}if(!o){if("GROWL"===t)return r;var l=a.split("|");if(l.length>1&&l[1])return"@"+l[1];return a}var u=["internal_member_link"];var d={"member-id":o.id,"stringify-text":"@"+o.id};if(o.is_bot&&o.profile){var c=_.get(o.profile,"bot_id");if(c){d["bot-id"]=c;var m=TS.interop.bots.getBotById(c);_.get(m,"app_id")&&(d["app-id"]=m.app_id)}u=_.pull(u,"internal_member_link");u.push("app_preview_link");u.push("app_preview_link_slug")}var f="";_.forEach(d,function(e,t){f+="data-"+t+'="'+e+'" '});var p=_.escape("@"+TS.interop.members.getMemberMentionName(o));u.push("ts_tip ts_tip_top ts_tip_lazy ts_tip_float ts_tip_member");f+='data-tip-member="'+o.id+'" ';if("EDIT"===t)return"<@"+o.id+"|"+p+">";if("GROWL"===t||!TS.permissions.members.canUserSeeMember(o))return"@"+TS.interop.members.getMemberMentionName(o);var h=TS.utility.shouldLinksHaveTargets()?'target="/team/'+o.id+'" ':"";o.id==TS.model.user.id&&u.push("mention");if(i)return p;f+='data-member-label="'+p+'" ';return'<a href="/team/'+o.id+'" '+h+f+'class="'+u.join(" ")+'">'+p+"</a>"};var k=function t(r,n,i,a){if(TS.boot_data.page_needs_enterprise){var s=TS.shared.legacyGetActiveModelOb()||{};if(TS.interop.rules.channels.isOrgShared(s)&&TS.interop.rules.channels.isOrgDefaultChannel(s)){i=true;a=true}}var o=n.replace(/<|>/g,"");var l=o.split("|");var u=l[0].substr(1);if(_.includes(e,u)){var d=TS.interop.format.formatBroadcastCommand({type:u,tsfMode:r});if("GROWL"===r||"EDIT"===r||a)return d;return'<b class="mention" data-broadcast-id="BK'+u+'" data-stringify-text="'+d+'">'+d+"</b>"}var c=l[1]?l[1]:u;if(-1===u.indexOf("^")){if("GROWL"===r||"EDIT"===r)return"<"+c+">";return"&lt;"+c+"&gt;"}var m=u.split("^");u=m.shift();if("date"===u&&m.length>=2){var f=m[0];var p=m[1];var h=TS.interop.datetime.formatDate(f,p,{fallbackString:c});var g=m.length>2?m[2]:"";if("GROWL"===r||"EDIT"===r||!g||a)return h;return"<a "+TS.utility.makeRefererSafeLink(g)+' target="_blank">'+h+"</a>"}if("subteam"!==u||1!==m.length){if("GROWL"===r||"EDIT"===r)return"<"+c+">";return"&lt;"+c+"&gt;"}var S=TS.interop.userGroups.getUserGroupById(m[0]);var T=C({user_group:S,tsf_mode:r,cmd_label:c});if(T)return T;if(S&&!TS.interop.rules.user_groups.isUnknownOrNonExistent(S)&&S.handle){var v=TS.utility.shouldLinksHaveTargets()?'target="/usergroups/'+S.id+'" ':" ";var b=_.escape(S.handle);var y=x({no_highlights:i,tsf_mode:r,userGroup:S});var w=["internal_user_group_link"];if("GROWL"===r||"EDIT"===r){if("EDIT"===r)return"<@"+S.id+"|"+y+">";return"@"+S.handle}if(a)return y;y="@"+b;TS.interop.userGroups.isUserGroupMember(S.id)&&w.push("mention");return'<a data-qa="user_group_message_mention" href="/usergroups/'+S.id+'" '+v+'data-user-group-id="'+S.id+'" class="'+w.join(" ")+'" data-stringify-text="@'+b+'">'+y+"</a>"}if("GROWL"!==r&&"EDIT"!==r)return c;return""};var x=function e(t){var r=t.no_highlights,n=t.tsf_mode,i=t.userGroup,a=void 0===i?{}:i;var s=_.escape(a.handle);if(r||"EDIT"===n)return"@"+s;return p(a)};var C=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.user_group,n=t.tsf_mode,i=t.cmd_label;if(r&&"EDIT"!==n&&"GROWL"!==n){if(TS.interop.rules.user_groups.isUnknown(r))return TS.templates.unknown_usergroup({id:r.id,handle:i});if((TS.interop.rules.user_groups.isNonExistent(r)||TS.interop.userGroups.isUserGroupFromAnotherTeam(r.id)||!TS.interop.userGroups.isUserGroupActive(r))&&TS.interop.utility.looksLikeUserGroupId(r.id))return TS.templates.nonexistent_usergroup({id:r.id,label:r.handle?"@"+r.handle:i})}return""};var M=function e(t,r,n){var i=r.split(" ")[1].replace(">","");if(!n)return' <div class="inline_color_block" style="background:'+i+';"></div>';return""};var I=function e(t,r){var n=TS.interop.i18n.t("Switch sidebar theme","string_format")();r&&(n+=" ("+r+")");return'<a data-theme="'+_.escape(t)+'" class="btn btn_small btn_outline very_small_top_margin very_small_bottom_margin tiny_right_margin theme_installer_btn">'+n+"</a>"};var E=function e(t){if(t&&t.length)return'<br/><span class="theme_install_btns">'+t.join(" ")+"</span>";return""};function A(e){switch(e){case TSF.PRE_START:return TSF.CODE_START;case TSF.PRE_END:return TSF.CODE_END;default:break}return e}var P=function e(t){if(!t||t instanceof Text)return false;return _.some(o,function(e,r){return t.hasAttribute(r)})};var O=function e(t){F||(F=TSF.LINK_START.split(" ")[0]);if(_.startsWith(t,F))return true;if(t===TSF.LINK_END)return true;return false};var F})()},T0l3:function(e,t){(function(){TS.registerModule("automount",{onStart:function e(){var t=TS.redux.getStoreInstance();TS.interop.automount.mountAllWithStore(t)}})})()},UP61:function(e,t){(function(){TS.registerModule("ui.validation",{completed_sig:new signals.Signal,onStart:function e(){u();$("body").on("input.validation paste.validation change.validation","[data-validation]",TS.utility.debounce(function(e){$(e.target).is(".ql-editor")||$(e.target).is(".ql-clipboard")?f($(e.target).closest(".ql-container"),{},e):f($(e.target),{},e)},500));$("body").on("input.channel-name-validation paste.channel-name-validation change.channel-name-validation",'[data-validation*="channel_name"]',function(e){var t=$(e.target);if(!t.is('input[type="text"]'))return;var r={query:Q(t),count:1};TS.interop.channels.fetchAndUpsertChannelsWithQuery({query:r})});$("body").on("submit.validation","form[data-validation-form]",function(e){var t=$(e.target);var r=TS.ui.validation.validate(t);r||e.preventDefault();TS.ui.validation.completed_sig.dispatch(t,{event:e,passed:r})})},validate:function e(t,r){r=r||{};var n=document;if(t){if(t.is("[data-validation]")){if(1===t.length)return f(t,r);return t.toArray().every(function(e){return f($(e),r)})}n=t.get(0)}var i=Array.prototype.slice.call(n.querySelectorAll("[data-validation]"));if(r&&r.fast)return i.every(function(e){return f($(e),r)});if(r&&r.verbose){var a={};i.forEach(function(e){a[e.name]=f($(e),r)});return a}return i.reduce(function(e,t){return f($(t),r)&&e},true)},register:function e(t,r){if(m[t]){TS.warn(t+" cannot be registered because that key is already in use.");return}if("function"!==typeof r){TS.warn("Only functions can be registered as validators.");return}m[t]=r},showCustomValidation:function e(t,r,n,i){U(t,n.error_message||r,n.class,n,i)},getErrorMessage:function e(t,r){switch(t){case"invalid_name_required":return i.required;case"invalid_name_punctuation":return i.punctuation;case"invalid_name_maxlength":return i.maxlength;case"invalid_name_specials":return i.specials;case"name_taken":return i.name_taken({name:r.name});case"restricted_action":return l.restricted_action;case"name_invalid_name_required":return o.required;case"invalid_starts_with_at":return o.at_sign;case"name_invalid_name_maxlength":case"too_long":return o.maxlength;case"invalid_reserved_word":return o.reserved;case"name_invalid_name_specials":return o.specials;case"invalid_emoji_not_allowed":return X(r.name||"");case"display_name_not_allowed":return o.sso_display_name;case"invalid_email":return d.invalid;case"url_in_message":return c.url_in_message;case"invalid_target_domain":return a.invalid_target_domain;case"invalid_target_domain_sameorg":return a.invalid_target_domain_sameorg;case"invalid_target_domain_self":return a.invalid_target_domain_self;default:return TS.interop.i18n.t("For some weird reason, that didn\u2019t work. Please try again to continue.","ui_validation")()}},maybeConvertNameErrorCode:function e(t){if("invalid_name_specials"===t)return"name_invalid_name_specials";if("invalid_name_maxlength"===t)return"name_invalid_name_maxlength";if("invalid_name_required"===t)return"name_invalid_name_required";return t},showError:function e(t,r,n,i){U(t,n.error_message||r,"validation_error",n,i)},showWarning:function e(t,r,n,i){U(t,n.warning_message||r,"validation_warning",n,i)},showSuccess:function e(t,r,n,i){U(t,n.success_message||r,"validation_success",n,i)},test:function e(){return{validations:m}}});var e=80;var t=80;var r=21;var n=TS.interop.i18n.t("Channel names can\u2019t be longer than {maxLength} characters.","ui_validation")({maxLength:t});var i={name_taken:TS.interop.i18n.t("{name} is already taken by a channel, username, or user group.","ui_validation"),lowercase:TS.interop.i18n.t("Channel names must be all lowercase. Try again?","ui_validation")(),maxlength:n,required:TS.interop.i18n.t("Don\u2019t forget to name your channel.","ui_validation")(),specials:TS.interop.i18n.t("Channel names can\u2019t contain spaces, periods, or most punctuation. Try again?","ui_validation")(),punctuation:TS.interop.i18n.t("Names can\u2019t consist solely of punctuation. Please elaborate!","ui_validation")()};var a={invalid_target_domain:TS.interop.i18n.t("{targetDomain}.slack.com\xa0doesn\u2019t appear to be in use.","shared"),invalid_target_domain_sameorg:TS.interop.i18n.t("{targetDomain} is a part of your organization.","shared"),invalid_target_domain_self:TS.interop.i18n.t("You\u2019ll need to enter the Slack URL of the other organization.","shared")()};if(TS.boot_data.feature_shared_channels_multi_org){a.invite_exists=TS.interop.i18n.t("{targetDomain} is already invited to this channel.","shared");a.shared_channel_exists=TS.interop.i18n.t("{targetDomain} is already in this channel.","shared");a.over_limit=TS.interop.i18n.t("<b>Can\u2019t add any more organizations</b>. This channel is already shared with 11 organizations. To add another, you\u2019ll need to remove one.","shared")}var s={firstalphanumeric:TS.interop.i18n.t("Usernames must start with a letter or number. Sorry about that!","ui_validation")(),lowercase:TS.interop.i18n.t("Sorry, usernames must be lowercase!","ui_validation")(),maxlength:TS.interop.i18n.t("Sorry, that\u2019s a bit too long! Usernames must be fewer than {max_length_plus_one} characters.","ui_validation","10f62c929475d76c2b47d666c9703843310ef356")({max_length_plus_one:r+1}),required:TS.interop.i18n.t("Please fill in a username.","ui_validation")(),specials:TS.interop.i18n.t("Usernames can\u2019t contain special characters. Sorry about that!","ui_validation")()};var o={required:TS.interop.i18n.t("Unfortunately, you can\u2019t leave this blank.","ui_validation")(),at_sign:TS.interop.i18n.t("Names can\u2019t start with the @ sign \u2014\xa0that\u2019s how your teammates will mention you in conversation.","ui_validation")(),maxlength:TS.interop.i18n.t("Unfortunately, names can\u2019t be longer than {maxlength} characters.","ui_validation")({maxlength:e}),reserved:TS.interop.i18n.t("That name\u2019s already being used by Slack.","ui_validation")(),specials:TS.interop.i18n.t("Mostly, names can\u2019t contain punctuation. (Apostrophes, spaces, and periods are fine.)","ui_validation")(),emoji:TS.interop.i18n.t("For all manner of complex reasons, names simply cannot contain emoji. Try again?","ui_validation")(),sso_display_name:TS.interop.i18n.t("Display names are automatically set by your organization.","ui_validation")()};var l={};var u=function e(){l={restricted_action:TS.interop.i18n.t("Sorry! An admin in your workspace has restricted who can create private channels.","ui_validation")()}};var d={invalid:TS.interop.i18n.t("This doesn\u2019t seem like an email address. Sorry!","ui_validation")()};var c={url_in_message:TS.interop.i18n.t("Unfortunately, custom messages can\u2019t contain URLs.","ui_validation")()};var m={dateandformat:I,firstalphanumeric:P,hasnourl:b,isurl:T,isouathredirecturl:v,lowercase:E,maxcsv:C,maxlength:w,mincsv:x,minlength:y,nospace:A,required:h,reservedwords:g,keywords:S,username:O,channel_name:H,team_name:j,is_email:D,membername:F,is_time:R};var f=function e(t,r,n){r=r||{};t.is("[data-validation-for]")&&(r.custom_for=t.attr("data-validation-for"));r.success_message=TS.interop.i18n.t("Nice, thanks!","ui_validation")();t.is("[data-validation-success]")&&(r.success_message=t.attr("data-validation-success"));t.is("[data-validation-warning]")&&(r.warning_message=t.attr("data-validation-warning"));t.is("[data-validation-error]")&&(r.error_message=t.attr("data-validation-error"));t.is("[data-validation-trim-value]")&&(r.trim_value=true);V(t)&&K(t,r);var i=p(t).every(function(e){if(-1===e.indexOf("="))return m[e.trim()](t,r);var n=e.split("=");return m[n[0]](t,r,n[1])});TS.ui.validation.completed_sig.dispatch(t,{event:n,passed:i});B(t,i,r)&&TS.ui.validation.showSuccess(t,r.success_message,r,3e3);t.attr("aria-invalid",!i);return i};var p=function e(t){if(t.is("[data-validation]"))return _.compact(t.attr("data-validation").replace(/\s*(,|=)\s*/g,"$1").split(/\s+/));return[]};function h(e,t){if(e.is('input[type="radio"]')){if($(document.querySelectorAll('[name="'+e.prop("name")+'"][data-validation]')).filter(":checked").length)return true;TS.ui.validation.showWarning(e,TS.interop.i18n.t("Please select an option","ui_validation")(),t)}else if(e.is('input[type="checkbox"]')){if($(document.querySelectorAll('[name="'+e.prop("name")+'"][data-validation]')).filter(":checked").length)return true;TS.ui.validation.showWarning(e,TS.interop.i18n.t("Please select at least one option","ui_validation")(),t)}else if(e.is("select")){var r=_.get(e.data(),"TSLazyFilterSelect",false);if(r&&!_.isEmpty(r.value()))return true;if(!r&&!_.isEmpty(e.val()))return true;TS.ui.validation.showWarning(e,TS.interop.i18n.t("Please select an option","ui_validation")(),t)}else if(V(e)){if(Y(e).trim())return true;TS.ui.validation.showWarning(e,TS.interop.i18n.t("This field can\u2019t be empty","ui_validation")(),t)}else TS.error("Error: cannot validate")}function g(e,t,r){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(V(e)){var n=Y(e).trim().toLowerCase();var i=r.split(",");if(-1===i.indexOf(n))return true;TS.ui.validation.showWarning(e,TS.interop.i18n.t('"{word}" is a reserved word. Try something else!',"ui_validation")({word:TS.interop.i18n.safeString(_.escape(n))}),t)}else TS.error("WTF: cannot validate")}function S(e,t){return g(e,t,TS.model.RESERVED_KEYWORDS.join(","))}function T(e,t,r){var n=Y(e);t&&t.trim_value&&(n=n.trim());var i=TS.interop.i18n.t("This doesn\u2019t seem like a proper link. Sorry!","ui_validation")();var a;var s=false;var o=false;if(!n)return true;if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(!V(e)){TS.error("Error: cannot validate");return}if(r){a=r.split(",");-1!=a.indexOf("https")&&(i=TS.interop.i18n.t("Please use https (for security).","ui_validation")());-1!=a.indexOf("http")&&-1==a.indexOf("https")&&a.push("https");for(var l=0;l<a.length;l+=1)0===n.indexOf(a[l]+"://")&&(s=true)}else{s=true;-1==n.indexOf("://")&&(n="http://"+n)}o=TS.interop.url.simpleIsUrl(n);if(o&&s)return true;TS.ui.validation.showWarning(e,i,t)}function v(e,t,r){if(T(e,t,r)){var n=Y(e);if(-1==n.indexOf("#"))return true;var i=TS.interop.i18n.t("Oauth redirect URLs should not contain a fragment component (#)","ui_validation")();TS.ui.validation.showWarning(e,i,t)}}function b(e,t){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(V(e)){var r=Y(e);if(!r)return true;if(!TS.interop.url.findUrlsInString(r).length)return true;TS.ui.validation.showWarning(e,c.url_in_message,t)}else TS.error("Error: cannot validate")}function y(e,t,r,n){return k(e,"minlength",t,r,n)}function w(e,t,r,n){return k(e,"maxlength",t,r,n)}function k(e,t,r,n,i){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(V(e)){var a=Y(e);n=+n;if(void 0===a||isNaN(n)){TS.error("Error: no length to validate");return}if("minlength"===t){if(TS.interop.utility.getStringLength(a)>=n)return true;TS.ui.validation.showError(e,TS.interop.i18n.t("This field can\u2019t be less than {minlength, plural, =1{# character}other{# characters}}","ui_validation")({minlength:n}),r)}else if("maxlength"===t){i||W(e,a.length,n,r);if(TS.interop.utility.getStringLength(a)<=n)return true;TS.ui.validation.showError(e,TS.interop.i18n.t("This field can\u2019t be more than {maxlength, plural, =1{# character}other{# characters}}","ui_validation")({maxlength:n}),r)}}else TS.error("Error: cannot validate")}function x(e,t,r){return M(e,"mincsv",t,r)}function C(e,t,r){return M(e,"maxcsv",t,r)}function M(e,t,r,n){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(V(e)){var i=Y(e).trim();n=+n;if(void 0===i||isNaN(n)){TS.error("Error: no length to validate");return}if("mincsv"===t){if(i.split(/\s*,\s*/).length>=n)return true;TS.ui.validation.showError(e,TS.interop.i18n.t("This field can\u2019t have less than {minlength, plural, =1{# value}other{# values}}","ui_validation")({minlength:n}),r)}else if("maxcsv"===t){if(i.split(/\s*,\s*/).length<=n)return true;TS.ui.validation.showError(e,TS.interop.i18n.t("This field can\u2019t have more than {maxlength, plural, =1{# value}other{# values}}","ui_validation")({maxlength:n}),r)}}else TS.error("Error: cannot validate")}function I(e,t,r){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(V(e)){var n=Y(e).trim();if(!n)return true;var i;var a;var s;var o;switch(r){case"Y-m-d":i="YYYY-MM-DD";a=n.match(/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/);s=a&&1===a.length&&a[0]===n;s&&(o=N(n+"T00:00:00.000Z"));break;case"m-d":i="MM-DD";a=n.match(/^[0-9]{2}-[0-9]{2}$/);s=a&&1===a.length&&a[0]===n;s&&(o=N("0000-"+n+"T00:00:00.000Z"));break;default:TS.error("Error: cannot validate");return}if(s&&o)return true;s?o||TS.ui.validation.showWarning(e,TS.interop.i18n.t("{value} doesn\u2019t appear to be a valid date. Sorry!","ui_validation")({value:TS.interop.i18n.safeString(_.escape(n))}),t):TS.ui.validation.showWarning(e,TS.interop.i18n.t("This needs to be in the format {pattern}. Sorry!","ui_validation")({pattern:i}),t)}else TS.error("Error: cannot validate")}function E(e,t){var r=V(e)?Y(e):e.val();var n=r===r.toLocaleLowerCase();if(n)return true;TS.ui.validation.showWarning(e,TS.interop.i18n.t("This field must be lowercase only","ui_validation")(),t)}function A(e,t){var r=V(e)?Y(e):e.val();var n=/\s/.test(r);if(!n)return true;TS.ui.validation.showWarning(e,TS.interop.i18n.t("This field can\u2019t contain spaces","ui_validation")(),t)}function P(e,t){var r=V(e)?Y(e):e.val();var n=/^[^\W_]/.test(r);if(n)return true;TS.ui.validation.showWarning(e,TS.interop.i18n.t("This first character must be a letter or number","ui_validation")(),t)}function O(e,t){var n=$.extend({},t,{quiet:true});if(h(e,n))if(w(e,n,r,true))if(A(e,n))if(L(e,n,/^[\w._-]+$/))if(P(e,n)){if(E(e,n))return!!g(e,t,TS.interop.constants.RESERVED_USERNAMES.join(","));TS.ui.validation.showWarning(e,s.lowercase,t)}else TS.ui.validation.showWarning(e,s.firstalphanumeric,t);else TS.ui.validation.showWarning(e,s.specials,t);else TS.ui.validation.showWarning(e,s.specials,t);else TS.ui.validation.showWarning(e,s.maxlength,t);else TS.ui.validation.showWarning(e,s.required,t)}function F(t,r,n){var a=$.extend({},r,{quiet:true});if(t.is('input[type="radio"]')||t.is('input[type="checkbox"]')||t.is("select"))return true;if(!V(t)){TS.error("Error: cannot validate");return}var s=_.trim(Y(t));var l=TS.interop.i18n.deburr(s.toLowerCase());var u=J(n);if(_.includes(u,"required")&&!h(t,a)){TS.ui.validation.showWarning(t,o.required,r);return false}if(!w(t,a,e,true)){TS.ui.validation.showWarning(t,o.maxlength,r);return false}var d=TS.interop.constants.RESERVED_USERNAMES.concat(TS.model.RESERVED_KEYWORDS).map(function(e){return TS.interop.i18n.deburr(e)});if(-1!==d.indexOf(l)){TS.ui.validation.showWarning(t,o.reserved,r);return false}if("@"===s.charAt(0)){TS.ui.validation.showWarning(t,o.at_sign,r);return false}if(L(t,a,/^[-_.'\u2018\u2019",(){}[\]/;]+$/)){TS.ui.validation.showWarning(t,i.punctuation,r);return false}if(L(t,a,/[`~!@#$%^&*+=\\:"<>?|]/)){TS.ui.validation.showWarning(t,o.specials,r);return false}if(TS.emoji.hasUnifiedEmoji(s)){TS.ui.validation.showWarning(t,X(s),r);return false}return true}function H(e,t,r){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(!V(e)){TS.error("Error: cannot validate");return}var n=Y(e);var i=J(r);var a=_.includes(i,"fix");a&&(n=Q(e));var s=TS.validation.channel_name_with_errors(n);if(true!==s){t.should_truncate=false;TS.ui.validation.showWarning(e,s.error_message,t);return false}return true}function j(e,t){t=t||{};var r=Y(e).trim();var n=TS.validation.team_name(r);if(true!==n){t.should_truncate=false;"empty"===n.error_key?TS.ui.validation.showCustomValidation(e,n.error_message,t):TS.ui.validation.showError(e,n.error_message,t);return false}return true}function D(e,t){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(V(e)){var r=Y(e);if(!r)return true;var n=r.match(TS.utility.email_regex);if(n&&1===n.length&&n[0]===r)return true;TS.ui.validation.showWarning(e,d.invalid,t)}else TS.error("Error: cannot validate")}function L(e,t,r){var n=V(e)?Y(e):e.val();if(r.test(n))return true;TS.ui.validation.showWarning(e,TS.interop.i18n.t("This field contains invalid characters","ui_validation")(),t)}function R(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(V(e)){var r=Y(e);if(!r)return true;var n=RegExp(/((1[0-2]|0?[1-9]):([0-5][0-9]) ?([ap][m]))/i);var i=n.test(r);if(i)return true;TS.ui.validation.showWarning(e,"Try the format 10:30am",t)}}var N=function e(t){if(!isNaN(Date.parse(t))){var r=new Date(t);return!r.toISOString().indexOf(t)}};var B=function e(t,r,n){var i=$(document.querySelector('label[for="'+(n.custom_for||t.attr("name"))+'"]'));if(!i.length)return;return!(n&&n.quiet)&&r&&false===i.data("validation-ephemeral")};var U=function e(t,r,n,i,a){i=i||{};_.isUndefined(i.should_truncate)&&(i.should_truncate=true);if(i&&i.quiet)return;var s=$(document.querySelector('label[for="'+(i.custom_for||t.attr("name"))+'"]'));if(!s.length)return;var o=s.data("validation-timeout");clearTimeout(o);var l=s.find(".validation_message");if(!l.length){l=$("<span />").addClass("validation_message").toggleClass("overflow_ellipsis",i.should_truncate);t.is("select")&&s.find("select").length?l.insertBefore(s.find("select")):l.appendTo(s)}G(t,s,n);if(!r){l.remove();return}l.get(0).title=r;l.fadeIn(100);s.data("validation-ephemeral",!!a);a&&s.data("validation-timeout",setTimeout(function(){s.removeData("validation-ephemeral").removeData("validation-timeout");l.fadeOut(100,function(){G(t,s);l.remove()})},a))};var q=["validation_error","validation_warning","validation_success"];var G=function e(t,r,n){if(r.hasClass(n))return;t.removeClass(q.join(" "));t.addClass(n);r.removeClass(q.join(" "));r.addClass(n)};var W=function e(t,r,n,i){n-r<=6?z(t,r,n,i):K(t,i)};var z=function e(t,r,n,i){var a=document.querySelector('label[for="'+(i.custom_for||t.attr("name"))+'"]');if(!a)return;var s=[r,n].join("/");$(a).attr("data-countdown",s).addClass("countdown");var o=window.getComputedStyle(a,":after");var l=parseFloat(o.width)||9*s.length;if(t.hasClass("no_validation_padding"))return;t.data("countdown-padding-right")||t.data("countdown-padding-right",parseFloat(t.css("padding-right")));t.css("padding-right",l+parseFloat(o.right)+t.data("countdown-padding-right"))};var K=function e(t,r){var n=document.querySelector('label[for="'+(r.custom_for||t.attr("name"))+'"]');if(!n)return;$(n).removeClass("countdown");t.removeData("countdown-padding-right");t.css("padding-right","")};var V=function e(t){if(TS.interop&&TS.interop.utility)return t.is("input")||t.is("textarea")||TS.interop.utility.isContentEditableElement(t);return t.is("input")||t.is("textarea")};var Y=function e(t){if(TS.utility&&TS.utility.contenteditable)return TS.utility.contenteditable.value(t);return t.val()};var J=function e(t){if(!_.isString(t))return[];return _(t).split(",").map(_.trim).compact().value()};var Q=function e(t){var r=Y(t);var n=r.toLowerCase().replace(/^#+/,"");n=n.replace(/^\s+/,"");n=n.replace(/\s+$/,"");n=n.replace(/\s/g,"-");if(n&&r!==n){var i=TS.utility.contenteditable.cursorPosition(t).start;n.length<r.length&&(i-=r.length-n.length);t.val(n);TS.utility.contenteditable.cursorPosition(t,i)}return n};var X=function e(t){if(TS.boot_data.feature_i18n_channels_validate_emoji){var r=/(?:\uD83D\uDCA9)/;var n=[TS.interop.i18n.t("For all manner of complex reasons, names simply cannot contain emoji. Try again?","ui_validation")(),TS.interop.i18n.t("Using emoji for names makes some sense, but sadly, not enough. Try again?","ui_validation","29a0641ffb224418f796bb16c7f79013ec377a4c")(),TS.interop.i18n.t("For technical reasons, emoji are not allowed in names. Try again?","ui_validation")(),TS.interop.i18n.t("Of course you want a name with an emoji. Sadly, it is not to be. Try letters?","ui_validation")()];if(t.match(r))return TS.interop.i18n.t("For reasons of party-pooping, names cannot contain emoji. Try again?","ui_validation")();return _.sample(n)}return o.emoji}})()},"V+wu":function(e,t,r){var n=r("J4zp");(function(){TS.registerModule("menu.channel",{onStart:function e(){},startWithChannelPickerForChange:function e(r,n){if(TS.menu.isRedundantClick(r))return;TS.menu.buildIfNeeded();TS.menu.clean();var i=TS.interop.members.getMemberById(n);var a=_.partition(TS.interop.channels.getUnarchivedPublicAndPrivateChannels().filter(function(e){return!i.channels.hasOwnProperty(e.id)&&!i.groups.hasOwnProperty(e.id)}),TS.interop.rules.channels.isPublicChannel);var s={user_id:n,channels:a[0],groups:a[1]};TS.menu.$menu_header.html(TS.templates.menu_channel_picker_header(s));TS.menu.$menu_items.html(TS.templates.menu_channel_picker(s)).css("max-height",274);TS.menu.$menu_items.on("click.menu","li",TS.menu.channel.onChannelPickerItemClickChangeChannel);TS.menu.start(r);var o=$(r.target).closest(".pill");"mobile"===TS.boot_data.app?TS.menu.positionAt(o,16-o.offset().left,0):TS.menu.positionAt(o,-TS.menu.$menu.width()+o.outerWidth(),o.height()+4);TS.menu.$menu.scrollintoview({duration:500,offset:"bottom",px_offset:-25});t(n);TS.kb_nav.setAllowHighlightWithoutBlurringInput(true)},onChannelPickerItemClickChangeChannel:function e(){var t=$(this).data("user-id");var r=$(this).data("channel-id");var n=$(this).data("group-id");r?TS.interop.api.call("users.admin.changeURAChannel",{user:t,channel:r}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;TS.web.admin.onMemberURAChanged&&TS.web.admin.onMemberURAChanged(i,t,r,n);return{data:t,args:r,request_id:n}},function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;TS.web.admin.onMemberURAChanged&&TS.web.admin.onMemberURAChanged(i,t,r,n);return{data:t,args:r,request_id:n}}):n&&TS.interop.api.call("users.admin.changeURAChannel",{user:t,channel:n}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;TS.web.admin.onMemberURAChanged&&TS.web.admin.onMemberURAChanged(i,t,r,n);return{data:t,args:r,request_id:n}},function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;TS.web.admin.onMemberURAChanged&&TS.web.admin.onMemberURAChanged(i,t,r,n);return{data:t,args:r,request_id:n}});TS.menu.channel.end()},startWithChannelPickerForInvite:function e(r,n){if(TS.menu.isRedundantClick(r))return;TS.menu.buildIfNeeded();TS.menu.clean();var i=TS.interop.members.getMemberById(n);var a=_.partition(TS.interop.channels.getUnarchivedPublicAndPrivateChannels().filter(function(e){return!i.channels.hasOwnProperty(e.id)&&!i.groups.hasOwnProperty(e.id)}),TS.interop.rules.channels.isPublicChannel);var s={user_id:n,channels:a[0],groups:a[1]};TS.menu.$menu_header.html(TS.templates.menu_channel_picker_header(s));TS.menu.$menu_items.html(TS.templates.menu_channel_picker(s)).css("max-height",274);TS.menu.$menu_items.on("click.menu","li",TS.menu.channel.onChannelPickerItemClickInviteChannel);TS.menu.start(r);var o=$(r.target).closest(".pill");"mobile"===TS.boot_data.app?TS.menu.positionAt(o,16-o.offset().left,0):TS.menu.positionAt(o,10-o.width(),o.height()+4);TS.menu.$menu.scrollintoview({duration:500,offset:"bottom",px_offset:-25});t(n);TS.kb_nav.setAllowHighlightWithoutBlurringInput(true)},onChannelPickerItemClickInviteChannel:function e(){var t=$(this).data("user-id");var r=$(this).data("channel-id");var n=$(this).data("group-id");var i=r||n;i&&TS.interop.api.call("conversations.invite",{users:t,channel:i}).then(function(e){var t=e.data,i=e.args,a=e.request_id;var s=true;r&&TS.web.admin.onMemberInviteChannel?TS.web.admin.onMemberInviteChannel(s,t,i,a):n&&TS.web.admin.onMemberInviteGroup&&TS.web.admin.onMemberInviteGroup(s,t,i,a);return{data:t,args:i,request_id:a}},function(e){var t=e.data,i=e.args,a=e.request_id;var s=false;r&&TS.web.admin.onMemberInviteChannel?TS.web.admin.onMemberInviteChannel(s,t,i,a):n&&TS.web.admin.onMemberInviteGroup&&TS.web.admin.onMemberInviteGroup(s,t,i,a);return{data:t,args:i,request_id:a}});TS.menu.channel.end()},end:function e(){TS.menu.end()}});var e;var t=function t(n){var i=TS.menu.$menu.find(".no_matches");var a=TS.menu.$menu.find(".icon_close");var s=TS.menu.$menu.find(".menu_filter");a.click(function(){s.val("").trigger("input");s.focus()});s.on("input",function(){var t=$(this).val();e&&e.cancel();e=r(n,t).then(function(e){var r=e.channels,s=e.groups;var o=!!(r.length||s.length);a.removeClass("hidden");var l={user_id:n,channels:r,groups:s};TS.menu.$menu_items.html(TS.templates.menu_channel_picker(l));if(o)i.addClass("hidden");else{i.find(".query").text(t);i.removeClass("hidden")}TS.ui.utility.updateClosestMonkeyScroller(TS.menu.$menu.find("#menu_items_scroller"),true)});TS.kb_nav.clearHighlightedItem();a.toggleClass("hidden",!t)});s.focus()};var r=function e(t,r){var i=TS.interop.members.getMemberById(t);var a={prefer_exact_match:false,frecency:false,allow_empty_query:true,prefer_channels_user_belongs_to:false};var s={channels:{include_archived:false},groups:{include_archived:false},sort:false};return TS.searcher.search(r,s).then(function(e){var t=_(TS.sorter.search(r,e,a)).filter(function(e){return!(i&&i.channels&&(i.channels[e.id]||i.groups[e.id]))}).partition(TS.interop.rules.channels.isPublicChannel).value(),s=n(t,2),o=s[0],l=s[1];return{groups:l,channels:o}})}})()},VACg:function(e,t,r){var n=r("lSNA");function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}));r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),true).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}(function(){TS.registerModule("redux.members",{onStart:function e(){if(TS.boot_data.no_login)return;s=TS.utility.enableFeatureForUser(1);l();Object.defineProperty(TS.model,"members",{get:function e(){return TS.redux.members.getAllMembers()},set:function e(){TS.boot_data.feature_tinyspeck&&TS.warn("TS.redux.members: Set TS.model.members");return false}});Object.defineProperty(TS.model,"user",{get:function e(){return TS.interop.members.getCurrentMember()}})},getPotentiallyUnknownMemberById:function e(t){t&&"@"===t[0]&&(t=t.substring(1));if(!TS.interop.utility.looksLikeMemberId(t)){s&&TS.console.logStackTraceToBackEnd("non-ID passed into getPotentiallyUnknownMemberById","member_name_as_id_lookup",1);if(TS.boot_data.feature_deprecate_get_member_by_name)return null;var r=TS.interop.members.getMemberByName(t);if(r)return r}var n=TS.interop.members.getPotentiallyUnknownMemberById(t);if(!n)return null;if(n.isUnknown){TS.members.legacySetMemberUnknown(t);return _.omit(a({},n,{is_unknown:true}),"isUnknown")}if(n.isNonExistent)return _.omit(a({},n,{is_non_existent:true}),"isNonExistent");return n},getMemberByEmail:function e(t){var r=TS.interop.members.getMemberByEmail(t);if(!r||!r.profile)return null;return r},getAllMembers:function r(){var n=TS.interop.members.getAllMembers();if(n===e)return t;t=_.values(n);e=n;return t},hasMemberWithId:function e(t){return TS.interop.members.hasMemberWithId(t)},addMember:function e(t){if(!t)return;TS.interop.members.markObjectsAsFresh([t.id]);TS.interop.members.dangerouslyAddMember(t)},addToBulkUpsertPayload:function e(t){r.push(t)},bulkUpsertMembers:function e(t){if(!_.isArray(t))return;if(!t.length)return;TS.interop.members.markObjectsAsFresh(t.map(function(e){return e.id}));TS.interop.members.dangerouslyBulkAddMembers(t)},logStats:function e(){var t=_(n).keys().union(_.keys(i)).value();var r={};_.forEach(t,function(e){r[e]={gets:n[e]||0,sets:i[e]||0}});TS.console.table(r)},test:function e(){var t={_addSignalListeners:l};Object.defineProperty(t,"_bulk_upsert_payload",{get:function e(){return r},set:function e(t){r=t}});return t}});var e;var t;var r=[];var n={};var i={};var s;var o=function e(){if(r.length){TS.interop.members.markObjectsAsFresh(r.map(function(e){return e.id}));TS.interop.members.dangerouslyBulkAddMembers(r);r=[]}};var l=function e(){TS.members.batch_upserted_sig.add(o)}})()},VTIS:function(e,t){(function(){TS.registerModule("ui.a11y",{focus_stack:[],unread_message_strings:{},$aria_live_div:null,zoom_level_changed_sig:new signals.Signal,zoomPercentToLevel:function t(r){return e[r]},zoomLevelToPercent:function e(r){return t[r]},onStart:function e(){n();_();f();TS.channels.switched_sig.add(TS.ui.a11y.annouceCurrentChannelOrImOrGroup);TS.ims.switched_sig.add(TS.ui.a11y.annouceCurrentChannelOrImOrGroup);TS.groups.switched_sig.add(TS.ui.a11y.annouceCurrentChannelOrImOrGroup);TS.mpims.switched_sig.add(TS.ui.a11y.annouceCurrentChannelOrImOrGroup);TS.prefs.a11y_animations_changed_sig.add(TS.ui.a11y.replaceAnimatedImages);$(document).on("focus","input[placeholder],textarea[placeholder]",function(e){r($(e.target))});$(document).on("blur","input[placeholder],textarea[placeholder]",function(e){r($(e.target))})},focusAndAddTabindex:function e(t){if(!t)return;t.attr("tabindex")&&t.data("previous-tabindex",t.attr("tabindex"));t.attr("tabindex","0");t.focus()},cleanUpTabindex:function e(t){if(!t)return;t.data("previous-tabindex")?t.attr("tabindex",t.data("previous-tabindex")):t.removeAttr("tabindex")},saveCurrentFocus:function e(){TS.ui.a11y.focus_stack.push(document.activeElement);return document.activeElement},saveCurrentFocusAndFocusOnElement:function e(t){var r=TS.ui.a11y.saveCurrentFocus();TS.ui.a11y.focusAndAddTabindex(t);return r},restorePreviousFocus:function e(){var t=TS.ui.a11y.focus_stack.pop();if(t&&"function"===typeof t.focus){t.focus();return t}},restorePreviousFocusAndCleanUpElement:function e(t){var r=TS.ui.a11y.restorePreviousFocus();TS.ui.a11y.cleanUpTabindex(t);return r},ariaLiveAnnounce:function e(t,r){TS.ui.a11y.$aria_live_div.empty();TS.ui.a11y.$aria_live_div.attr("aria-live",r?"assertive":"polite");TS.ui.a11y.$aria_live_div.text(t)},assembleActiveModelName:function e(){var t=TS.shared.legacyGetActiveModelOb();var r;if(TS.model.unread_view_is_showing)r=TS.interop.i18n.t("All unreads","a11y")();else if(TS.model.threads_view_is_showing)r=TS.interop.i18n.t("Threads","a11y")();else{if(!t)return"";if(t.is_channel)r=TS.interop.i18n.t("Channel #{model_name}","a11y")({model_name:t.name});else if(t.is_im)r=TS.interop.i18n.t("Direct message with {model_name}","a11y")({model_name:TS.interop.members.getPrefCompliantMemberNameById(t.user)});else if(t.is_mpim)r=TS.interop.i18n.t("Direct message with {model_name}","a11y")({model_name:TS.mpims.legacyGetDisplayName(t)});else{if(!t.is_group)return"";r=TS.interop.i18n.t("Private Channel {model_name}","a11y")({model_name:t.name})}}return r},saveUnreadCountMessage:function e(t,r){if(!t||!t.name||!r)return;TS.ui.a11y.unread_message_strings[t.name]=r},annouceCurrentChannelOrImOrGroup:function e(){var t=TS.ui.a11y.assembleActiveModelName();var r=t;var n=TS.shared.legacyGetActiveModelOb();if(!n)return;if(TS.ui.a11y.unread_message_strings[n.name]){r+=", "+TS.ui.a11y.unread_message_strings[n.name];delete TS.ui.a11y.unread_message_strings[n.name]}TS.ui.a11y.ariaLiveAnnounce(r,true)},replaceAnimatedImages:function e(){TS.ui.a11y.replaceAnimatedFiles();TS.ui.a11y.replaceEmoji()},replaceAnimatedFiles:function e(){var t=TS.prefs.getPref("a11y_animations");var r;var n;var i=TS.utility.msgs.getDisplayedMsgs(TS.shared.legacyGetActiveModelOb().msgs);var a;if(false===t)for(a=0;a<i.length;a+=1)if(i[a].file){r=i[a].file;if("gif"===r.filetype){r.deanimate_gif?n=r.deanimate_gif:r.thumb_160&&(n=r.thumb_160);n&&o(r.id,n)}else"space"===r.filetype&&u(i[a].ts)}else i[a].attachments&&l(i[a].ts,i[a].attachments[0]);else for(a=0;a<i.length;a+=1)if(i[a].file){r=i[a].file;if("gif"===r.filetype){r.thumb_360_gif?n=r.thumb_360_gif:r.thumb_360&&(n=r.thumb_360);n&&o(r.id,n)}else"space"===r.filetype&&u(i[a].ts)}else i[a].attachments&&l(i[a].ts,i[a].attachments[0])},replaceEmoji:function e(){var t=emoji;var r=$(".emoji:not(.stop_animations)");var n;for(var i=0;i<r.length;i+=1){var a=t.replace_colons(r[i].innerText);if(!a){var s=":"+r[i].parentNode.getAttribute("data-emoji")+":";a=t.replace_colons(s)}a&&a.match(/.+background-image:url\((.+)\).*/)&&(n=a.match(/.+background-image:url\((.+)\).*/)[1]);r[i].style.backgroundImage='url("'+n+'")'}TS.emoji.makeMenuLists()},getContrastColor:function e(t){var r=false;t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,r,n){return t+t+r+r+n+n});t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(t){var n=parseInt(t[1],16);var i=parseInt(t[2],16);var a=parseInt(t[3],16);var s=(299*n+587*i+114*a)/1e3;r=s>=128?"#000000":"#FFFFFF"}return r},test:function e(){return{createAriaLiveElement:n,destroyAriaLiveElement:i,getMessageInputElement:a,getMessageDivElement:s}}});var e={70:"-3",80:"-2",90:"-1",normal:"0",110:"1",125:"2",150:"3"};var t=Object.keys(e).reduce(function(t,r){t[e[r]]=r;return t},{});var r=function e(t){var r=t.attr("placeholder");var n=t.attr("aria-label")||"";var i=!!n.length;var a=!!t.val().trim().length;if(a&&!i&&r.length){t.attr("aria-label",r);return}!a&&i&&n==r&&t.removeAttr("aria-label")};var n=function e(){TS.ui.a11y.$aria_live_div=$('<div id="aria_live_announcer" role="status"></div>');$("body").append(TS.ui.a11y.$aria_live_div);return TS.ui.a11y.$aria_live_div};var i=function e(){TS.ui.a11y.$aria_live_div.remove();delete TS.ui.a11y.$aria_live_div};var a=function e(){if(TS.boot_data.feature_sonic_inputs){var t=$("#msg_input_mount_point .ql-container");t.length||(t=$("#msg_input_mount_point > div").eq(0));return t}return $()};var s=function e(){return $()};var o=function e(t,r){var n=$('.image_gif[data-file-id="'+t+'"]');n.attr("data-src",r);n.find(".image_bg").attr("data-real-background-image",r);n.find(".image_bg").css("backgroundImage","url("+r+")");n.find("img").data("real-src",r);n.find("img").attr("src",r)};var l=function e(t,r){if(!r)return;if(r.is_animated||r.image_url&&r.image_url.match(/\.gifv?$/)){var n=$('.message[data-ts="'+t+'"]');var i=n.find(".msg_inline_img img");var a=false===TS.prefs.getPref("a11y_animations")?TS.utility.getImgProxyURL(r.image_url,r.image_width,r.image_height):r.image_url;d(i,a)}};var u=function e(t){var r=$('.message[data-ts="'+t+'"] .post_container .msg_inline_img img');$.each(r,function(){var e=$(this);var t=TS.utility.getImgProxyURL(e.attr("src"));d(e,t)})};var d=function e(t,r){t.attr({"data-real-src":r,src:r});var n=t.closest(".msg_inline_img");n.attr("data-real-background-image",r);n.css("backgroundImage","url("+r+")")};var c;var _=function e(){if(!TS.model.is_electron)return;c=TS.interop.desktop.getZoom();$(window).on("resize",m)};var m=function e(){var t=TS.interop.desktop.getZoom();if(c!=t){c=t;TS.ui.a11y.zoom_level_changed_sig.dispatch({zoom_level:t})}};var f=function e(){if(!TS.model.is_electron)return;$("body").append('<div class="zoom_level_indicator hidden"></div>');TS.ui.a11y.zoom_level_changed_sig.add(g)};var p=function e(r){var n=t[r]||"100";var i="normal"===n?"100":n;var a=TS.interop.i18n.t("zoom: <strong>{zoom_percentage}%</strong>","a11y")({zoom_percentage:i});$(".zoom_level_indicator").html(a)};var h;var g=function e(t){if($("body").hasClass("loading"))return;var r=$(".prefs_modal.active");if(r.length&&r.find(".a11y_pref_zoom").length)return;if(h){clearTimeout(h);h=null}p(t.zoom_level);var n=$(".zoom_level_indicator");n.insertAfter(document.body.lastElementChild);n.removeClass("hidden").show(0);var i=n.outerWidth()/2;var a="calc(50vw - "+i+"px)";n.css("left",a);h=setTimeout(function(){n.fadeOut(100)},1e3)}})()},W17R:function(e,t){(function(){var e="HISTORY";TS.registerModule("shared",{msg_sent_sig:new signals.Signal,onStart:function e(){},test:function e(){var t={};Object.defineProperty(t,"_queried_usernames",{get:function e(){return s},set:function e(t){s=t}});return t},legacyMaybeClearUsersCountsInfo:function e(t){if(!t)return;if(u(t.id))return;TS.has_pri[f]&&TS.log(f,"Deleting users_counts_info for "+t.id);TS.shared.legacyDeleteUserCountsInfoForId(t.id)},legacySetUserCountsInfoForId:function e(t,n){if(!t)return;r[t]=n},legacyDeleteUserCountsInfoForId:function e(t){if(!t)return;delete r[t]},legacyGetOldestUnreadTsForId:function e(t){if(!t)return;return n[t]},legacySetOldestUnreadTsForId:function e(t,r){if(!t)return;n[t]=r},legacyOnSendMsg:function e(t,r,n,i){var s=r.temp_ts?TS.utility.msgs.getMsgByProp("temp_ts",r.temp_ts,n.msgs):null;if(!t){if(s){TS.model.unsent_msgs[s.ts]=true;i.msg_not_sent_sig.dispatch(n,s,r)}else TS.error("that makes no sense");return}var o;if(s){o=_.cloneDeep(s);o.text=r.text;o.ts=r.ts;delete o.is_pending;i.legacyRemoveMsg(n.id,s)}else{TS.warn("no temp msg for "+r.reply_to);o={text:r.text,user:TS.model.user.id,ts:r.ts}}r.SENT_MSG.thread_ts&&(o.thread_ts=r.SENT_MSG.thread_ts);i.legacyAddMsg(r.SENT_MSG.channel||n.id,TS.interop.messages.preprocessImsg(o,n.id));n.id&&a(n.id,o)},legacySendMsg:function e(t,r,n,i){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(!r)return false;var s=TS.redux.channels.getEntityById(t);if(!s)return false;var o=TS.shared.legacyGetControllerForModelOb(s);if(a)if(o===TS.groups||o===TS.ims){var l=p(s,r,o,n);if(!l)return false}else if(o===TS.channels){var u=TS.channels.legacyEnsureWeCanSendMessageToChannel(s,r,n);if(!u)return false}TS.redux.dispatch(TS.interop.redux.actions.prepareAndSendMessage({channelId:t,text:r,replyToTs:n?n.thread_ts||n.ts:null,shouldBroadcast:i}));TS.redux.dispatch(TS.interop.typing.currentUserEndedTyping({channelId:t}));return true},legacyMaybeDealWithAllSentTempMsgs:function r(n,i){if(!TS.interop.Flannel.useSocket())return;function a(t){var r=TS.utility.msgs.getMsg(t,n.msgs);if(!r)return;var a=TS.utility.msgs.getNonTempMsgFromUserMatchingText(r.text,TS.model.user.id,n.msgs);if(a){var s=TS.interop.datetime.toDateObject(a.ts);var o=TS.interop.datetime.toDateObject(t);if(s<o){TS.interop.console.info(e,"existing_msg time is older than temp_msg time, so it can\u2019t be the message we were looking for");a=null}}if(!a){TS.warn("not removing, we don\u2019t appear to have this non-temp message: "+r.ts);TS.model.unsent_msgs[r.ts]=true;i.msg_not_sent_sig.dispatch(n,r);return}TS.interop.console.info(e,"removing temp_msg: "+r.ts+" existing_msg:"+a.ts);i||(i=TS.shared.legacyGetControllerForModelOb(n));_.isFunction(i.legacyRemoveMsg)&&i.legacyRemoveMsg(n.id,r);return true}if(!t.hasOwnProperty(n.id))return;t[n.id].forEach(function(e){a(e)});delete t[n.id]},legacyGetControllerForModelOb:function e(t){if(!t)return{};if(t.is_im)return TS.ims;if(t.is_mpim&&t.is_group)return TS.mpims;if(t.is_group)return TS.groups;return TS.channels},legacyGetActiveModelOb:function e(){var t;if(TS.boot_data.channel_id)t=TS.interop.channels.getPublicChannelById(TS.boot_data.channel_id);else if(TS.boot_data.im_id)t=TS.interop.channels.getImById(TS.boot_data.im_id);else if(TS.boot_data.mpim_id)t=TS.interop.channels.getMpimById(TS.boot_data.mpim_id);else if(TS.boot_data.group_id)t=TS.interop.channels.getGroupById(TS.boot_data.group_id);else{TS.warn("error getActiveModelOb found no ob");TS.warn("TS.boot_data.channel_id: "+TS.boot_data.channel_id);TS.warn("TS.boot_data.im_id: "+TS.boot_data.im_id);TS.warn("TS.boot_data.group_id: "+TS.boot_data.group_id)}return t},legacyGetShareModelObId:function e(t,r){if(TS.boot_data.feature_file_threads){if(!t){r(t);return}TS.redux.dispatch(TS.interop.redux.actions.getChannelIdForSharing({channelOrMemberId:t})).then(r);return}var n;var i;if(t&&TS.interop.utility.looksLikeMemberId(t)){n=TS.redux.channels.getImByMemberId(t);if(n){t=n.id;r(t)}else{var a=function e(i,a,s){if(i){TS.ims.legacyOnOpened(i,a,s);n=TS.redux.channels.getImByMemberId(t);n?r(n.id):TS.web?r(a.channel.id):TS.error("legacyGetShareModelObId opened an IM, but it is not in the model? data.channel.id: "+a.channel.id)}else TS.error("legacyGetShareModelObId try to open an IM, but failed data: "+JSON.stringify(a||null))};TS.interop.api.call("conversations.open",{users:t,return_im:true,reason:"TS.shared.legacyGetShareModelObId"}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;a(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;a(i,t,r,n);return{data:t,args:r,request_id:n}})}}else if(t&&"C"===t.charAt(0)){i=TS.interop.channels.getPublicChannelById(t);i.is_member||TS.interop.rules.channels.isArchived(i)?r(t):TS.redux.dispatch(TS.interop.channels.joinConversationApi({channelId:i.id})).catch(_.noop).finally(function(){r(t)})}else r(t)},legacyMaybeMarkReadIfMuted:function e(t){if(!t)return;if(!t.is_mpim)return;if(!TS.notifs.isCorGMuted(t.id))return;if(!t.unreads.length||t.unread_highlights.length)return;if("hide_read_channels"===TS.prefs.getPref("sidebar_behavior")){if(TS.model.active_cid==t.id)return}else if("hide_read_channels_unless_starred"===TS.prefs.getPref("sidebar_behavior")&&!t.is_starred&&TS.model.active_cid==t.id)return;t.is_mpim?TS.mpims.legacyMarkMostRecentReadMsg(t,TS.model.marked_reasons.muted):t.is_group?TS.groups.legacyMarkMostRecentReadMsg(t,TS.model.marked_reasons.muted):TS.channels.legacyMarkMostRecentReadMsg(t,TS.model.marked_reasons.muted)},legacyMarkReadMsg:function e(t,r,n){var i=TS.redux.channels.getEntityById(t);var a=TS.shared.legacyGetControllerForModelOb(i);_.isFunction(a.markReadMsg)&&a.markReadMsg(i.id,r,n)},moveLastMsgInput:function e(t,r){if(!t.last_msg_input)return;r.last_msg_input=t.last_msg_input;r.has_draft=!!r.last_msg_input;t.last_msg_input="";t.has_draft=!!t.last_msg_input;TS.storage.storeLastMsgInput(t.id,t.last_msg_input);TS.storage.storeLastMsgInput(r.id,r.last_msg_input)},legacyCloseArchivedChannel:function e(t){var r=TS.redux.channels.getEntityById(t);if(!r)return;if(!TS.interop.rules.channels.isArchived(r))return;r.was_archived_this_session=false},legacyGetLastMsg:function e(t){if(!t.msgs||0===t.msgs.length)return null;for(var r=0;r<t.msgs.length;r+=1)if(!TS.interop.rules.messages.isHidden(t.msgs[r])&&!t.msgs[r].is_ephemeral)return t.msgs[r];return null},legacyCheckForOldImsToClose:function e(){var t=TS.model.ims;var r=TS.model.mpims;var n=t.concat(r);var i;var a;var s;var o;var l;var u=0;var d=221;var c=11;var m=6048e5;for(l=0;l<n.length;l+=1){i=n[l];if(!i.is_open&&!i.unread_cnt)continue;u+=1}var f=u-c;if(f<1)return;TS.info("legacyCheckForOldImsToClose might close some. this_too_many:"+f);var p=[];for(l=0;l<n.length;l+=1){i=n[l];TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": model_ob_id: "+i.id);if(TS.interop.rules.channels.isSlackbot(i)){TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": don't autoclose slackbot DM");continue}if(TS.interop.rules.channels.isYou(i)){TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": don't close messages with self");continue}if(!i.is_open){TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": if it is not opened we do not have to close it");continue}if(i.unread_cnt){TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": if there are unreads, we should not close it");continue}if(i.last_msg_input){TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": if there is a draft, we should not close it");continue}if(i.is_starred){TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": if it is starred, we should not close it");continue}if(i.opened_this_session){TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": opened_this_session, it should not be closed this session");continue}if(i==TS.shared.legacyGetActiveModelOb()){TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+":  active conversation, we should not close it");continue}var h=false;var g=TS.redux.messages.getRecentMessagesInChannel(i.id,h);var S=_.map(g,"ts");a=TS.interop.rules.channels.getLatestTs(i,S);if(a){s=TS.interop.datetime.toDateObject(a);TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": activity_date from activity_ts: "+s)}else{s=new Date(1e3*i.created);TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": no activity_ts found, activity date based on model_ob.created: "+s)}o=new Date-s;TS.has_pri[d]&&TS.log(d,"legacyCheckForOldImsToClose "+l+": ms_since_activity: "+o);if(o>m){TS.info(i.id+" "+s+" ms_since_activity:"+o+" allow_elapsed_ms:"+m);TS.has_pri[d]&&TS.log(d,"this IM is older than a week, we can leave the model_ob");p.push({model_ob:i,ms_since_activity:o})}else TS.has_pri[d]&&TS.info(d,"there has been activity in this IM in the past week, do not close")}if(!p.length){TS.info("legacyCheckForOldImsToClose found no candidates for closing");return}p.sort(function e(t,r){var n=t.ms_since_activity;var i=r.ms_since_activity;if(n<i)return 1;if(n>i)return-1;return 0});p.length=p.length>f?f:p.length;for(l=0;l<p.length;l+=1){i=p[l].model_ob;TS.warn("legacyCheckForOldImsToClose CLOSING:"+i.id+" ms_since_activity:"+p[l].ms_since_activity);(i.is_im||i.is_mpim)&&TS.redux.dispatch(TS.interop.channels.closeChannelApi({channelId:i.id}))}},promiseToRefetchModelOb:function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"TS.shared.promiseToRefetchModelOb";if(!t||"string"!==typeof t)return Promise.resolve();var n=[t];return TS.interop.channels.fetchAndUpsertChannelsFromFlannel({ids:n}).then(function(e){var t=e.channels;return _.isEmpty(t)?TS.interop.channels.fetchAndUpsertChannelsFromAPI({ids:n,reason:r}):{channels:t}}).then(function(e){var t=e.channels;return t&&t[0]})},ensureModelObsArePresent:function e(t,r){if(!t||!t.length)return Promise.resolve();return TS.interop.channels.fetchAndUpsertChannelsById({ids:t,reason:r}).then(function(e){var t=e.missing;if(_.isEmpty(t))return Promise.resolve();t.forEach(function(e){return TS.interop.channels.upsertChannel({id:e,isNonExistent:true})});return Promise.resolve()})},legacyEnsureModelObsInDataArePresent:function e(t,r){var n=TS.interop.utility.extractAllModelObIds(t);"search.messages"===r&&TS.boot_data.page_needs_enterprise&&l(t,n);return TS.shared.ensureModelObsArePresent(n,r)},legacyAddMsg:function e(t,r){return i(t,[r])},legacyAddMsgFromModern:function e(t,r){var n=TS.shared.legacyGetControllerForModelOb(t);return n.legacyAddMsg(t.id,r)},legacyRemoveMsgFromModern:function e(t,r){var n=TS.shared.legacyGetControllerForModelOb(t);return n.legacyRemoveMsg(t.id,r)},legacyMsgNotSentFromModern:function e(t,r,n){var i=TS.shared.legacyGetControllerForModelOb(t);TS.model.unsent_msgs[r.ts]=true;i.msg_not_sent_sig.dispatch(t,r,n)},legacyAddMsgs:function e(t,r){if(i(t,r))return true;return false},legacyKickMember:function e(t,r){var n=t.is_channel||t.is_group&&!t.is_mpim;if(!n)return;if(TS.interop.rules.channels.isPrivateChannel(t)){if(!TS.permissions.members.canKickFromGroups())return}else if(!TS.permissions.members.canKickFromChannels())return;var i=TS.interop.members.getMemberById(r);if(!i)return;var a=true;var s=true;var o=TS.interop.i18n.safeString(TS.interop.members.getPrefCompliantMemberName(i,a,s));var l=TS.interop.rules.channels.getDisplayNameForChannel(t);TS.interop.membership.ensureChannelMembershipIsKnownForUsers(t.id,[r]).then(function(){var e=TS.interop.membership.getCachedChannelMembershipInfoForUser(t.id,r);if(!e.is_member){TS.generic_dialog.alert(TS.interop.i18n.t("<strong>{user_name}</strong> is not a member of {channel_name}.","shared")({user_name:o,channel_name:l}));return null}var n;n=TS.interop.rules.channels.isPrivateChannel(t)?"<p>"+TS.interop.i18n.t("If you remove <strong>{user_name}</strong> from {channel_name}, they will no longer be able to see any of its messages. To rejoin the private channel, they will have to be re-invited.</p><p>Are you sure you wish to do this?","shared")({user_name:o,channel_name:l})+"</p>":"<p>"+TS.interop.i18n.t("Are you sure you wish to remove <strong>{user_name}</strong> from {channel_name}?","shared")({user_name:TS.interop.i18n.safeString(o),channel_name:l})+"</p>";var a="conversations.kick";TS.generic_dialog.start({title:TS.interop.i18n.t("Remove {user_name}","shared")({user_name:o}),body:n,go_button_text:TS.interop.i18n.t("Yes, remove them","shared")(),onGo:function e(){TS.interop.api.call(a,{channel:t.id,user:r}).catch(function(e){TS.info("Removing user failed; api="+a+"; error="+e.data.error);setTimeout(function(){var t=i.is_ultra_restricted?TS.interop.i18n.t("Single-channel guests","shared")():TS.interop.i18n.t("Multi-channel guests","shared")();if("cant_kick_from_last_channel"===e.data.error&&TS.model.user.is_admin){TS.generic_dialog.start({title:TS.interop.i18n.t("Removing {member_display_name} failed","shared")({member_display_name:o}),body:TS.interop.i18n.t("<p>{account_type} (like <strong>{member_display_name}</strong>) can\u2019t be removed from channels.</p><p>If <strong>{member_display_name}</strong> should no longer have access to your workspace, we suggest deactivating their account.</p>","shared")({account_type:t,member_display_name:o}),go_button_text:TS.interop.i18n.t("Manage Members","shared")(),show_cancel_button:true,onGo:function e(){TS.utility.openInNewTab("/admin#restricted",TS.templates.builders.newWindowName())}});return}var r;switch(e.data.error){case"cant_kick_from_last_channel":r=TS.interop.i18n.t("<p>{account_type} (like <strong>{member_display_name}</strong>) can\u2019t be removed from channels.</p><p>Please contact a Workspace Admin if <strong>{member_display_name}</strong> should no longer have access to your workspace.</p>","shared")({account_type:t,member_display_name:o});break;case"restricted_action":r=TS.interop.i18n.t("<p>Hmm, looks like you don\u2019t have permission to kick from channels.</p><p>Please contact a Workspace Admin if <strong>{member_display_name}</strong> should no longer have access to your workspace.</p>","shared")({member_display_name:o});break;default:r=TS.interop.i18n.t("<p>Something\u2019s gone wrong, and we couldn\u2019t remove <strong>{member_display_name}</strong> from {channel}. We suspect this is only temporary. Try again in a bit?</p>","shared")({member_display_name:o,channel:l})}TS.generic_dialog.alert(r,TS.interop.i18n.t("Removing {member_display_name} failed","shared")({member_display_name:o}))},500)})}});return null})},isRelevantTeam:function e(){var t=true;if(!TS.model.is_our_app||!window.desktop)return t;if(!TS.boot_data.page_needs_enterprise||!TS.model.team||!TS.model.team.enterprise_id||!TS.boot_data.other_accounts)return t;if(!window.desktop)return t;TS.has_pri[c]&&TS.log(c,"isRelevantTeam()");var r=_.get(TS.model.user,"enterprise_user.teams",[]);if(1===r.length)return t;var n=TS.interop.desktop.legacyGetLastActiveTeamIdForTeamIds(r);var i;TS.has_pri[c]&&TS.log(c,"isRelevantTeam(): Got relevant team IDs from SSB",n);if(n instanceof Array&&n.length){i=n[0];TS.has_pri[c]&&TS.log(c,"isRelevantTeam(): Array case - taking the first relevant team id",i,n)}else if(TS.has_pri[c]){TS.log(c,"isRelevantTeam(): relevant_team_ids is not an array, OR, is empty?",n);TS.log(c,"isRelevantTeam(): Electron did not provide any matches for the given team_ids",r)}if(!i){TS.has_pri[c]&&TS.log(c,"Invalid response from SSB lastActiveTeamIdForTeamIds() call? Exiting.");return t}TS.has_pri[c]&&TS.log(c,"comparing most_relevant_team_id ( "+i+") -> TS.model.team_id ("+TS.model.team.id+")");if(i===TS.model.team.id)TS.has_pri[c]&&TS.log(c,"isRelevantTeam(): "+TS.model.team.id+" is relevant. Including.");else{TS.has_pri[c]&&TS.log(c,"isRelevantTeam(): "+TS.model.team.id+" is NOT relevant. Excluding.");t=false}return t},onDisplayEmailAddressesPrefChanged:function e(){if(!TS.model||!TS.model.team)return;TS.info('Team pref "display_email_addresses" -> '+TS.prefs.getTeamPref("display_email_addresses"));var t=0;TS.model.members&&(TS.model.members=_.map(TS.model.members,function(e){if(!e.profile||!e.profile.email)return e;if(e.id===TS.model.user.id)return e;t+=1;TS.prefs.getTeamPref("display_email_addresses")||(e.profile.email=void 0);return e}));TS.prefs.getTeamPref("display_email_addresses")?t||TS.info("display_email_addresses check: pref enabled, but 0 email fields found in TS.model.members."):t?TS.info("display_email_addresses check: found and cleared "+t+" email fields from TS.model.members."):TS.info("display_email_addresses check: TS.model.members is already clear of email fields. \u2713")},dispatchMessageReceived:function e(t,r){var n=TS.shared.legacyGetControllerForModelOb(t);n.message_received_sig.dispatch(t,r)},legacyDispatchUnreadChanged:function e(t){var r=TS.shared.legacyGetControllerForModelOb(t);r.unread_changed_sig.dispatch(t)},legacyDispatchUnreadHighlightChanged:function e(t){var r=TS.shared.legacyGetControllerForModelOb(t);r.unread_highlight_changed_sig.dispatch(t)},legacyDispatchMarkedSig:function e(t){var r=TS.shared.legacyGetControllerForModelOb(t);r.marked_sig.dispatch(t)},legacyBatchUpsertObjects:function e(t){TS.has_pri[m]&&TS.log(m,"Flannel: upserting batch of "+t.length+" objects");var r=[];var n=[];var i=[];_.forEach(t,function(e){TS.interop.utility.looksLikeMemberId(_.get(e,"id"))?TS.redux.members.hasMemberWithId(e.id)?r.push(e):n.push(e):o(e)&&i.push(e)});var a=!!n.length;var s=[];function l(e){TS.has_pri[m]&&TS.log(m,"Flannel: upserting and signaling user "+e.id+" from query results");var t=TS.members.legacyUpsertAndSignal(e).member;s.push(t)}function u(e){TS.has_pri[m]&&TS.log(m,"Flannel: upserting user "+e.id+" from query results");var t=TS.members.legacyUpsertMember(e).member;s.push(t)}r.forEach(l);if(a){TS.members.legacyStartBatchUpsert();n.forEach(u);TS.members.legacyFinishBatchUpsert()}if(i.length){TS.redux.bots.bulkUpsertBots(i);i.forEach(function(e){TS.has_pri[m]&&TS.log(m,"Flannel: upserting bot "+e.id+" from query results");var t=TS.interop.bots.getBotById(e.id);s.push(t)})}return s}});var t={};var r={};var n={};var i=function e(t,r){var n=false;r=_.filter(r,function(e){var r=e.ts&&TS.utility.msgs.getMsg(e.ts,t.msgs);r&&TS.has_pri[d]&&TS.log(d,"Not adding duplicate message "+e.ts+", already in "+t.id);return!r});if(!r.length){TS.has_pri[d]&&TS.log(d,"No messages to add to "+t.id+" - exiting.");return false}TS.has_pri[d]&&TS.log(d,"Adding "+(r.length>1?"messages":"message")+" to "+t.id);r.forEach(function(e){if(TS.utility.msgs.validateMsg(t.id,e,t.msgs)){n=true;TS.utility.msgs.appendMsg(t.msgs,e)}});if(!n)return false;TS.utility.msgs.sortMsgs(t.msgs);TS.utility.msgs.maybeSetOldestMsgsTsAfterMsgAdded(t);return true};var a=function e(t,r){var n={message_timestamp:r.ts,channel_id:t,channel_type:t?t.charAt(0):""};var i=TS.interop.messagePane.getChannelSessionId();null!==i&&(n.channel_session_id=i);TS.interop.clog.track("MSG_SENT",n)};var s={};var o=function e(t){var r=_.get(t,"id[0]");return"B"===r};function l(e,t){var r=TS.model.team.id;_.remove(t,function(t){var n=_.find(e.messages.matches,function(e){return e.channel.id==t},this);var i=_.get(n,"channel");var a=TS.interop.rules.channels.isOrgShared(i)||TS.interop.rules.channels.isExternallySharedChannel(i);if(n&&_.get(n,"team")!=r&&_.startsWith(t,"C")&&!a)return t})}function u(e){if(!e)return;return r[e]}var d=58;var c=1701;var m=1989;var f=888;var p=function e(t,r,n,i){var a=t.is_mpim?TS.interop.i18n.t("conversation","shared")():TS.interop.i18n.t("channel","shared")();var s=t.is_mpim?"conversation":"channel";if(!t)return false;if(TS.interop.rules.channels.isArchived(t))return false;var o=TS.interop.channels.getGeneralChannel();var l=function e(t){TS.generic_dialog.alert(t).then(function(){!i});i||TS.boot_data.feature_sonic_inputs&&TS.interop.message_pane_input.value(TS.model.active_cid,r)};var u=TS.format.cleanMsg(r);var d=!!i;var c;if(TS.interop.messages.atEveryoneRegExp.test(u)&&!d){if(!TS.permissions.members.canAtMentionEveryone()){c=TS.permissions.members.canNonAdminsAtMentionEveryoneBySettings()?"<p>"+TS.interop.i18n.t("Usage of <strong>{everyone}</strong> is restricted to Workspace Admins in the large general channel.","shared")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>":"<p>"+TS.interop.i18n.t("A Workspace Owner has restricted the use of <strong>{everyone}</strong> messages.","shared")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";TS.permissions.members.canAtChannelOrGroup(t.id)?c+="channel"===s?'<p class="no_bottom_margin">'+TS.interop.i18n.t("If you just want to address everyone in this channel, use <strong>{at_label}</strong> instead.","shared")({at_label:TS.templates.builders.atLabel(s)})+"</p>":'<p class="no_bottom_margin">'+TS.interop.i18n.t("If you just want to address everyone in this conversation, use <strong>{at_label}</strong> instead.","shared")({at_label:TS.templates.builders.atLabel(s)})+"</p>":TS.model.user.is_restricted&&(c="<p>"+TS.interop.i18n.t("Your account is restricted, and you cannot send <strong>{everyone}</strong> messages.","shared")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>");l(c);return false}if(o&&o.is_member){var m;m=t.is_mpim?TS.interop.i18n.t('<p class="bold">Would you like to switch to {general_channel} and send your message?</p><p class="">Using <strong>{everyone}</strong> in a message is a way to address your entire workspace, but it must be done in the {general_channel} channel.</p><p class="no_bottom_margin">If you just want to address everyone in this conversation, use <strong>{channel}</strong> instead.</p>',"shared"):TS.interop.i18n.t('<p class="bold">Would you like to switch to {general_channel} and send your message?</p><p class="">Using <strong>{everyone}</strong> in a message is a way to address your entire workspace, but it must be done in the {general_channel} channel.</p><p class="no_bottom_margin">If you just want to address everyone in this channel, use <strong>{channel}</strong> instead.</p>',"shared");TS.generic_dialog.start({title:TS.interop.i18n.t("Send {everyone} a message","shared")({everyone:TS.templates.builders.atLabel("everyone")}),body:m({general_channel:TS.interop.i18n.safeString("#"+_.escape(o.name)),conversation_or_channel:a,everyone:TS.templates.builders.atLabel("everyone"),channel:TS.templates.builders.atLabel("channel")}),show_cancel_button:true,show_go_button:true,go_button_text:TS.interop.i18n.t("Yes, send it","shared")(),onGo:function e(){TS.channels.legacyDisplayChannel({id:o.id,and_send_txt:r})},onCancel:function e(){TS.boot_data.feature_sonic_inputs&&TS.interop.message_pane_input.value(TS.model.active_cid,r)}})}else{c="<p>"+TS.interop.i18n.t("You cannot send <strong>{everyone}</strong> messages.","shared")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";if(TS.permissions.members.canAtChannelOrGroup()){var f;var p=TS.templates.builders.atLabel(s);f=t.is_mpim?TS.interop.i18n.t("If you just want to address everyone in this conversation, use <strong>{at_label}</strong> instead.","shared")({at_label:p}):TS.interop.i18n.t("If you just want to address everyone in this channel, use <strong>{at_label}</strong> instead.","shared")({at_label:p});c+='<p class="no_bottom_margin">'+f+"</p>"}l(c)}return false}var h=TS.interop.messages.atHereRegExp.test(u);var g=(TS.interop.messages.atChannelRegExp.test(u)||TS.interop.messages.atGroupRegExp.test(u))&&!d;if((g||h)&&!TS.permissions.members.canAtChannelOrGroup()){var S=h?TS.templates.builders.atLabel("here"):TS.templates.builders.atLabel("channel");c="<p>"+TS.interop.i18n.t("A Workspace Owner has restricted the use of <strong>{key_word}</strong> messages.","shared")({key_word:S})+"</p>";l(c);return false}if(!d&&TS.ui.needToShowAtChannelWarning(t.id,r)){TS.ui.at_channel_warning_dialog.startInMessagePane(t.id,r);return false}return true}})()},XUc0:function(e,t){(function(){TS.registerModule("api",{})})()},YZHV:function(e,t){(function(){TS.registerModule("channels",{switched_sig:new signals.Signal,joined_sig:new signals.Signal,member_joined_sig:new signals.Signal,left_sig:new signals.Signal,member_left_sig:new signals.Signal,list_fetched_sig:new signals.Signal,message_received_sig:new signals.Signal,message_removed_sig:new signals.Signal,message_changed_sig:new signals.Signal,marked_sig:new signals.Signal,unread_changed_sig:new signals.Signal,unread_highlight_changed_sig:new signals.Signal,topic_changed_sig:new signals.Signal,purpose_changed_sig:new signals.Signal,created_sig:new signals.Signal,deleted_sig:new signals.Signal,renamed_sig:new signals.Signal,archived_sig:new signals.Signal,unarchived_sig:new signals.Signal,msg_not_sent_sig:new signals.Signal,converted_to_shared_sig:new signals.Signal,unshared_sig:new signals.Signal,shared_teams_updated_sig:new signals.Signal,shared_invite_pending_sig:new signals.Signal,shared_invite_revoked_sig:new signals.Signal,shared_invite_accepted_sig:new signals.Signal,changed_is_unknown_sig:new signals.Signal,onStart:function e(){TS.channels.deleted_sig.add(function(e){TS.channels.temp_list_of_removed_channels[e]=true});TS.channels.joined_sig.add(function(e){delete TS.channels.temp_list_of_removed_channels[e.id]})},data_updated_sig:new signals.Signal,temp_list_of_removed_channels:{},legacyAddMsg:function e(t,r){var n=false;var i=TS.interop.channels.getPublicChannelById(t,n);if(!i){TS.channels.temp_list_of_removed_channels[t]||TS.error('unknown channel "'+t+'"');return}if(!TS.redux.messages.addMessage(r,true))return;if(TS.interop.messages.isReply(r)&&!TS.shared.legacyAddMsg(i,r))return;TS.channels.message_received_sig.dispatch(i,r);i.is_mpim&&!i.is_open&&TS.interop.messages.canCountAsUnreadForCurrentUser(r,TS.model.user.id)&&TS.interop.api.call("conversations.open",{channel:i.id,reason:"TS.channels.legacyAddMsg"})},legacyRemoveMsg:function e(t,r){var n=false;var i=TS.interop.channels.getPublicChannelById(t,n);if(!i){TS.error('unknown channel "'+t+'"');return}TS.redux.messages.removeMessage(r);if(TS.interop.messages.isReply(r)){i._archive_msgs&&TS.utility.msgs.spliceMsg(i._archive_msgs,r);var a=i.msgs;TS.utility.msgs.spliceMsg(a,r)}TS.channels.message_removed_sig.dispatch(i,r)},legacyEnsureWeCanSendMessageToChannel:function e(t,r,n){var i;if(!t)return false;if(TS.interop.rules.channels.isArchived(t))return false;if(!t.is_member)return false;var a=TS.interop.channels.getGeneralChannel();var s=function e(t,i){i||TS.generic_dialog.alert(t).then(function(){!n});n||TS.boot_data.feature_sonic_inputs&&TS.interop.message_pane_input.value(TS.model.active_cid,r)};if(!TS.interop.rules.user.canPostInChannel(t.id)){var o=TS.interop.i18n.t("Posting to #*{channel_name}* has been restricted to select members.","channels")({channel_name:t.name});s(o,"general_posting_restricted");return false}var l=TS.format.cleanMsg(r);var u=!!n;var d=TS.interop.messages.atHereRegExp.test(l)||l.match(/(^|\s)@here(\b|$)/i);var c=TS.interop.messages.atChannelRegExp.test(l)&&!u||TS.interop.messages.atGroupRegExp.test(l)&&!u;var _=TS.interop.messages.atEveryoneRegExp.test(l)&&!u||TS.interop.rules.channels.isRequired(t)&&c;if(_){if(!TS.permissions.members.canAtMentionEveryone(t.id)){if(TS.model.user.is_restricted){i="<p>"+TS.interop.i18n.t("Your account is restricted, and you cannot send <b>{everyone}</b> messages.","channels")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";s(i);return false}if(TS.permissions.members.canNonAdminsAtMentionEveryoneBySettings(t.id)){i="<p>"+TS.interop.i18n.t("Usage of <b>{everyone}</b> is restricted to Workspace Admins in the large general channel.","channels")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";TS.telemeter.count("stopped_loud_channel_mention")}else i="<p>"+TS.interop.i18n.t("A Workspace Owner has restricted the use of <b>{everyone}</b> messages.","channels")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";!TS.interop.rules.channels.isRequired(t)&&TS.permissions.members.canAtChannelOrGroup(t.id)&&(i+='<p class="no_bottom_margin">'+TS.interop.i18n.t("If you just want to address everyone in this channel, use <b>{channel}</b> instead.","channels")({channel:TS.templates.builders.atLabel("channel")})+"</p>");s(i);return false}if(!TS.interop.rules.channels.isRequired(t)&&!d){if(a&&a.is_member)TS.generic_dialog.start({title:TS.interop.i18n.t("Send {everyone} a message","channels")({everyone:TS.templates.builders.atLabel("everyone")}),body:TS.interop.i18n.t('<p class="bold">Would you like to switch to #{general_channel} and send your message?</p>\t\t\t\t\t\t\t<p class="">Using <b>{everyone}</b> in a message is a way to address your entire workspace, but it must be done in the #{general_channel} channel.</p>\t\t\t\t\t\t\t<p class="no_bottom_margin">If you just want to address everyone in this channel, use <b>{channel}</b> instead.</p>',"channels")({general_channel:a.name,everyone:TS.templates.builders.atLabel("everyone"),channel:TS.templates.builders.atLabel("channel")}),show_cancel_button:true,show_go_button:true,go_button_text:TS.interop.i18n.t("Yes, send it","channels")(),onGo:function e(){TS.channels.legacyDisplayChannel({id:a.id,and_send_txt:r})},onCancel:function e(){TS.boot_data.feature_sonic_inputs&&TS.interop.message_pane_input.value(TS.model.active_cid,r)}});else{i="<p>"+TS.interop.i18n.t("You cannot send <b>{everyone}</b> messages.","channels")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";TS.permissions.members.canAtChannelOrGroup(t.id)&&(i+='<p class="no_bottom_margin">'+TS.interop.i18n.t("If you just want to address everyone in this channel, use <b>{channel}</b> instead.","channels")({channel:TS.templates.builders.atLabel("channel")})+"</p>");s(i)}return false}}if((c||d)&&!TS.permissions.members.canAtChannelOrGroup(t.id)){var m=d?TS.templates.builders.atLabel("here"):TS.templates.builders.atLabel("channel");if(TS.permissions.members.canNonAdminsAtChannelOrGroupBySettings(t.id)){i="<p>"+TS.interop.i18n.t("Usage of <b>{key_word}</b> is restricted to Workspace Admins in this large channel.","channels")({key_word:m})+"</p>";TS.telemeter.count("stopped_loud_channel_mention")}else i="<p>"+TS.interop.i18n.t("A Workspace Owner has restricted the use of <b>{key_word}</b> messages.","channels")({key_word:m})+"</p>";s(i);return false}if(!u&&TS.ui.needToShowAtChannelWarning(t.id,r)){TS.ui.at_channel_warning_dialog.startInMessagePane(t.id,r);return false}return true},legacyOnSendMsg:function e(t,r){var n=false;var i=_.get(r,"SENT_MSG.channel");var a=TS.interop.channels.getPublicChannelById(i,n);if(!a){TS.error("unknown channel? "+i);return}TS.shared.legacyOnSendMsg(t,r,a,TS.channels)},legacyDisplayChannel:function e(t){var r=_.defaults({},t,{from_history:false,replace_history_state:false});var n=r.id;if(!n){TS.error("no channel id supplied");return}var a=r.and_send_txt;var s=r.replace_history_state;var o=r.last_active_primary_view;TS.telemeter.mark("start_channel_change_"+n);TS.redux.dispatch(TS.interop.redux.models.channelsMeta.prqMetrics.updateChannelLastFocus({lastFocus:TS.interop.redux.models.window.getWindowLastFocusEvent(TS.redux.getState()),objId:n}));var l=false;var u=TS.interop.channels.getPublicChannelById(n,l);if(!u){TS.error('channel "'+n+'" unknown');return}TS.utility.msgs.maybeClearPrevLastRead();TS.utility.msgs.maybeClearPrevLastRead(u);var d=o||TS.model.active_channel_id;if(n===d&&!s){TS.warn('channel "'+n+'" already displayed');a&&TS.shared.legacySendMsg(n,_.trim(a));return}TS.has_pri[i]&&TS.log(i,"legacyDisplayChannel: "+u.id);if(!u.is_member&&a){TS.model.requested_channel_joins[n]={and_send_txt:a};TS.redux.dispatch(TS.interop.channels.joinConversationApi({channelId:n})).catch(_.noop);return}TS.console.info("TS.channels.legacyDisplayChannel",n);a&&TS.shared.legacySendMsg(n,_.trim(a))},legacyMarkMostRecentReadMsg:function e(t,r){if(!t){TS.error("channel unknown");return}TS.interop.channels.markMostRecentMsgRead({channelId:t.id,reason:r})},markReadMsg:function e(t,r,n){TS.redux.dispatch(TS.interop.actions.markLastRead({id:t,ts:r,reason:n}))},legacyOnJoin:function e(t,r,n){if(!t){if("name_taken"===r.error);else if("is_archived"===r.error)TS.channels.legacyDisplayChannel({id:TS.redux.channels.getPublicChannelByName(n.name).id});else if("restricted_action"===r.error)TS.generic_dialog.alert(TS.interop.i18n.t("<p>You don\u2019t have permission to create new channels.</p><p>Talk to your Workspace Owner.</p>","channels")());else{TS.error("failed to join channel");TS.generic_dialog.alert(TS.interop.i18n.t("Oops, something went wrong.","client")())}return}var i;var a;if(r.channel){a=TS.interop.channels.upsertChannel(r.channel);i=r.channel.id}if(!i){TS.error("no channel_id?!!");return}TS.model.requested_channel_joins[i]&&delete TS.model.requested_channel_joins[i];if(!a){TS.error("no channel?!!");return}if(n._in_background)return;TS.interop.channels.getNeedsCreatedMessageState(a.name)||a.never_needs_joined_msg||(a.needs_joined_message=true)},leave:function n(i){var a=false;var s=TS.interop.channels.getPublicChannelById(i,a)||TS.interop.channels.getGroupById(i,a);if(!s)return t({channel:s,reason:"no_channel"});return TS.interop.rules.channels.getLeaveAction(TS.redux.dispatch,TS.redux.getState,s).then(function(n){var a=TS.interop.rules.channels.LEAVE_ACTIONS;switch(n){case a.CONFIRM_AND_LEAVE:return r(s).then(function(t){if(t)return e(s)});case a.CONFIRM_LEAVE_AND_ARCHIVE:var o=true;return Promise.resolve(TS.channels.ui.showArchiveGroupDialog(s,o));case a.CLOSE:return Promise.resolve(TS.shared.legacyCloseArchivedChannel(s.id));case a.LEAVE:return e(s);case a.NONE:return t({channel:s,reason:"restricted_action"});default:TS.error("Failed to leave channel "+i+'. No case for a leave action "'+n+'" is defined.')}})},legacyAlertSetPurposeError:function e(t){var r=_.get(t,"data.error");var n=TS.interop.i18n.t("Oooops!","channels")();var i=TS.interop.channels.getChannelPurposeError(r);TS.generic_dialog.alert(i,n)},legacyAlertSetTopicError:function e(t){var r=_.get(t,"data.error");var n=TS.interop.i18n.t("Oooops!","channels")();var i=TS.interop.channels.getChannelTopicError(r);TS.generic_dialog.alert(i,n)},legacyUpdateTopicFromAPI:function e(t){var r=_.get(t,"channel.id");var n=_.get(t,"channel.topic");if(!r||!n)return;TS.interop.channels.setChannelTopic({id:r,topic:n})},legacyUpdatePurposeFromAPI:function e(t){var r=_.get(t,"channel.id");var n=_.get(t,"channel.purpose");if(!r||!n)return;TS.interop.channels.setChannelPurpose({id:r,purpose:n})},legacyGetHasDraft:function e(t){if(!t)return false;var r=false;var n=TS.interop.channels.getChannelById(t,r);return!!(n&&n.has_draft)},closeArchivedChannel:function e(t){TS.shared.legacyCloseArchivedChannel(t)},fetchList:function e(t,r){var i={exclude_members:1};t&&(i.cursor=t);i.types="public_channel";i.limit=1e3;i.include_shared=true;var a=r||[];TS.interop.api.call("conversations.list",i).then(function(e){var t=e.data,r=e.args,i=e.request_id;var s=true;a=a.concat(t.channels);if(!t.response_metadata.next_cursor){t.channels=a;n&&n(s,t,r,i);return{data:t,args:r,request_id:i}}TS.channels.fetchList(t.response_metadata.next_cursor,a)},function(e){var t=e.data,r=e.args,i=e.request_id;var a=false;n&&n(a,t,r,i);return{data:t,args:r,request_id:i}})},legacyKickMember:function e(t,r){var n=TS.redux.channels.getEntityById(t);if(TS.interop.rules.channels.isPublicChannel(n)&&!TS.permissions.members.canKickFromChannels())return;if(TS.interop.rules.channels.isPrivateChannel(n)&&!TS.permissions.members.canKickFromGroups())return;return TS.shared.legacyKickMember(n,r)},test:function e(){var t={_onListFetched:n};Object.defineProperty(t,"_confirmIntentToLeaveChannel",{get:function e(){return r},set:function e(t){r=t}});return t}});var e=function e(r){TS.channels.legacyMarkMostRecentReadMsg(r,TS.model.marked_reasons.left);return TS.redux.dispatch(TS.interop.channels.submitLeave({channelId:r.id})).then(function(){r.msgs&&(r.msgs.length=0);r.is_limited&&(r.is_limited=false)}).catch(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.message,i=e.data;var a=_.get(i,"error")||n;return t({channel:r,reason:a})})};var t=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.channel,n=t.reason;var i;switch(n){case"last_member":TS.interop.rules.channels.isExternallySharedChannel(r)?i=TS.model.user.is_admin?TS.interop.i18n.t('<h3 class="top_margin">To leave this channel, it needs to be unshared</h3><p>Since you\u2019re the last person from <strong>{team_name}</strong>, you\u2019ll need to stop sharing this channel before you can leave it.</p>',"channels")({team_name:TS.interop.i18n.safeString(_.escape(TS.interop.rules.teams.getTeamDisplayName(TS.model.team)))}):TS.interop.i18n.t('<h3 class="top_margin">To leave this channel, it needs to be unshared</h3><p>Since you\u2019re the last person from <strong>{team_name}</strong>, you\u2019ll need an admin\u2019s help to leave. It\u2019s just a couple steps:</p><ul><li>Invite an admin to this channel.</li><li>Ask them to unshare and archive the channel.</li></ul>',"channels")({team_name:TS.interop.i18n.safeString(_.escape(TS.interop.rules.teams.getTeamDisplayName(TS.model.team)))}):TS.shared.legacyCloseArchivedChannel(r.id);break;case"restricted_action":i=TS.interop.i18n.t("Sorry, you can\u2019t leave <strong>#{channel_name}</strong>!","channels")({channel_name:r.name});break;default:break}return i?TS.generic_dialog.alert(i):Promise.resolve()};var r=function e(t){return new Promise(function(e){TS.generic_dialog.start({title:TS.interop.i18n.t("Leave {group}","groups")({group:TS.model.group_prefix+t.name}),body:TS.interop.i18n.t("<p>If you leave the private channel, you will no longer be able to see any of its messages. To rejoin the private channel, you will have to be re-invited.</p><p>Are you sure you wish to leave?</p>","groups")(),go_button_text:TS.interop.i18n.t("Yes, leave the private channel","groups")(),onGo:function t(){return e(true)},onCancel:function t(){return e(false)}})})};var n=function e(t,r){if(!t){TS.error("failed to fetch channel list");return}r.channels&&r.channels.length&&TS.redux.channels.bulkAddEntities(_.compact(r.channels));TS.channels.list_fetched_sig.dispatch(r.channels)};var i=999})()},"Ysd/":function(e,t){(function(){TS.registerModule("redux.files",{onStart:function e(){Object.defineProperty(TS.model,"files",{get:function e(){return TS.redux.files.getAllFiles()},set:function e(){TS.boot_data.feature_tinyspeck&&TS.warn("TS.redux.files: Set TS.model.files");return false}})},getFileById:function e(r){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var i=t(r,n);if(!i||i.id!==r)return null;return i},getFileByProp:function e(t,r){var n=TS.redux.files.getAllFiles();return _.find(n,function(e){return e[t]===r})},getAllFiles:function t(){var i=e();if(i===r)return n;n=_.values(i);r=i;return n},addFile:function e(t){if(!t)return;TS.redux.dispatch(TS.interop.redux.models.files.addFile(t))},bulkAddFiles:function e(t){if(!_.isArray(t))return;TS.redux.dispatch(TS.interop.redux.models.files.bulkAddFiles(t))},logStats:function e(){var t=_(i).keys().union(_.keys(a)).value();var r={};_.forEach(t,function(e){r[e]={gets:i[e]||0,sets:a[e]||0}});TS.console.table(r)}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.models.files.getAllFiles");var t=TS.redux.bindSelectorToStore("TS.interop.redux.models.files.getFileById");var r;var n;var i={};var a={}})()},Zt5a:function(e,t){(function(){TS.registerModule("pins",{pins_fetched_sig:new signals.Signal,pinned_status_changed_sig:new signals.Signal,pinned_message_changed_sig:new signals.Signal,pinned_message_deleted_sig:new signals.Signal,onStart:function e(){TS.files.team_file_comment_deleted_sig.add(p);TS.files.team_file_deleted_sig.add(h);TS.redux.socket.connectedSig.add(g);TS.channels.left_sig.add(S)},fetchPins:function e(r){if(!r)return;t[r.id]=true;return TS.interop.api.call("pins.list",{channel:r.id}).then(function(e){TS.pins.onFetchPins(e,r)}).catch(function(e){TS.interop.utility.getLogger({getState:TS.redux.getState}).error("Failed to fetch pins for model ob: "+r.id,e)}).finally(function(){delete t[r.id]})},onFetchPins:function t(r,n){var i=r.data.items;TS.pins.upsertPinnedItems(i);n.pinned_items=i;n.pinned_items_count=i.length;n.has_pins=!!n.pinned_items_count;n.is_channel&&!n.is_member||(e[n.id]=true);TS.pins.pins_fetched_sig.dispatch(n,i)},arePinsCurrentlyBeingFetched:function e(r){return!!t[r.id]},havePinsBeenFetched:function t(r){return!!e[r.id]},clearHavePinsBeenFetched:function r(n){if(n&&n.id){n.pinned_items=[];delete e[n.id];delete t[n.id]}},startPinFile:function e(t,r){var n=TS.files.getFileById(t);if(!n)return;u("file",r,{file:n,type:"file"})},unPinFile:function e(t,r){var n=i(t,r);if(!n)return;var a={file:n,type:"file"};f(a,r,function(){c(r,a)})},startPinFileComment:function e(t,r,n){var i=TS.files.getFileById(r);if(!i)return;var a=TS.files.getFileCommentById(i,t);if(!a)return;u("comment",n,{file:i,comment:a,type:"file_comment"})},unPinFileComment:function e(t,r,n){var i=a(t,r,n);var s=TS.files.getFileById(r);if(!i||!s)return;var o={file:s,comment:i,type:"file_comment"};f(o,n,function(){c(n,o)})},startPinMessage:function e(t,r){t=t.toString();var n=TS.utility.msgs.findMsg(t,r.id);n&&("file_comment"===n.subtype?TS.pins.startPinFileComment(n.comment.id,n.file.id||n.file,r):n.file?TS.pins.startPinFile(n.file.id||n.file,r):u("message",r,{message:n,type:"message"}))},unPinMessage:function e(t,r){t=t.toString();var n=s(t,r);if(n)if("file_comment"===n.subtype)TS.pins.unPinFileComment(n.comment.id,n.file.id||n.file,r);else if(n.file)TS.pins.unPinFile(n.file.id||n.file,r);else{var i={message:n,type:"message"};f(i,r,function(){c(r,i)})}},isMessagePinned:function e(t,r){if("file_comment"===t.subtype){if(!t.comment)return false;return!!a(t.comment.id,t.file.id||t.file,r)}if(t.file)return!!i(t.file.id||t.file,r);return!!s(t.ts,r)},pinStatusHasChanged:function e(t,r,i,a,s,u){var d;var c;var _;var m;var f;var p;t&&u&&(p={pinnedBy:u.pinned_by,pinnedTs:u.pinned_ts});var h=r.file;h&&1===Object.keys(h).length&&(h=TS.files.getFileById(r.file.id));if("message"===i&&a){d=TS.utility.msgs.findMsg(r.message.ts,a.id);if(d){r.message=d;_=o(t,d,a)}}else if(h&&"file_comment"===i){f=TS.files.upsertFile(h,"pinStatusHasChangedComment");n(h.id,r);c=TS.files.getFileCommentById(h,r.comment.id);if(c){r.comment=c;_=o(t,c,a)}else{c=TS.files.addCommentToFile(r.comment,h);r.comment=c}_=_||"CHANGED"===f.status}else if(h&&"file"===i){h=TS.interop.rules.files.extendFileWithPinnedInfo(h,a.id,p);f=TS.files.upsertFile(h,"pinStatusHasChangedFile");n(h.id,r);_=o(t,h,a);_=_||"CHANGED"===f.status}m=l(t,r,i,a,s);(_||m)&&TS.pins.pinned_status_changed_sig.dispatch(a,r,t);if(_&&"message"===i){d=TS.interop.rules.messages.extendMessageWithPinnedInfo(d,p);TS.redux.messages.replaceMessage(d)}},upsertPinnedItems:function e(t){if(_.isEmpty(t))return;t.forEach(function(e){if("message"===e.type&&e.message&&TS.interop.messages.shouldRenderFileThread(e.message)){var t=e.message;t.files&&t.files.forEach(function(e){TS.files.upsertFile(e,"upsertPinnedItems")})}if("file"===e.type||"file_comment"===e.type){var r=e.file&&e.file.id;TS.files.upsertFile(e.file,"upsertPinnedItems");n(r,e)}if("file_comment"===e.type){var i=TS.files.getFileCommentById(e.file,e.comment.id);i||(i=TS.files.addCommentToFile(e.comment,e.file));e.comment=i}})},replaceMsg:function e(t,r){if(!r.pinned_items)return;r.pinned_items.forEach(function(e){if("message"===e.type&&e.message.ts===t.ts){e.message=t;TS.pins.pinned_message_changed_sig.dispatch(r,e)}})},legacyRemoveMsg:function e(t,r){if(!r.pinned_items)return;l(false,{message:{ts:t}},"message",r);TS.pins.pinned_message_deleted_sig.dispatch(r)},canUserPinHere:function e(){return false},updateCount:function e(t,r){if(!t)return;var n=t.pinned_items_count;t.pinned_items_count=TS.pins.havePinsBeenFetched(t)?_.get(t,"pinned_items.length"):r;if(n===t.pinned_items_count)return;t.has_pins=!!t.pinned_items_count;TS.pins.pinned_status_changed_sig.dispatch(t)},getUnreadPins:function e(t){var r;var n=[];if(!t)return n;var i=t._marked_reason;if("0000000000.000000"===t.last_read&&"back"!==i)return n;if(TS.model.ui.is_window_focused)if("back"===i){var a=TS.utility.msgs.getDisplayedMsgAfterTS(t.last_read,t.msgs);r=a?parseFloat(a.ts)-1:t.last_read}else r=!t._prev_last_read||i&&"viewed"!==i?t.last_read:t._prev_last_read;else r=t.last_read;var s=t.pinned_items;if(_.isEmpty(s))return n;_.forEach(s,function(e){var t=TS.interop.members.getMemberById(e.created_by);if(!t)return;e.created>Math.ceil(r)&&(t.is_self&&"back"===i?n.push(e):t.is_self||n.push(e))});return n},test:function t(){return{fileDeleted:h,fileCommentDeleted:p,have_pins_been_fetched:e}}});var e={};var t={};var r=false;var n=function e(t,r){if(!r||!t||!TS.files.getFileById(t))return;Object.defineProperty(r,"file",{enumerable:true,configurable:true,get:function e(){return TS.files.getFileById(t)},set:function e(){return false}})};var i=function e(t,r){var n=TS.files.getFileById(t);if(!n||!n.pinned_to)return null;var i=-1!==n.pinned_to.indexOf(r.id);return i?n:null};var a=function e(t,r,n){var i=TS.files.getFileById(r);if(!i)return null;var a=TS.files.getFileCommentById(i,t);if(!a||!a.pinned_to)return null;var s=-1!==a.pinned_to.indexOf(n.id);return s?a:null};var s=function e(t,r){if(r.pinned_items){var n;for(var s=0;s<r.pinned_items.length;s+=1){n=r.pinned_items[s];if("message"===n.type&&n.message.ts===t)return n.message}}var o=TS.utility.msgs.findMsg(t,r.id);if(!o)return null;if("file_comment"===o.subtype){if(a(o.comment.id,o.file.id||o.file,r))return o}else if(o.file){if(i(o.file.id||o.file,r))return o}else if(o.pinned_to&&-1!==o.pinned_to.indexOf(r.id))return o;return null};var o=function e(t,r,n){var i=false;r.pinned_to||(r.pinned_to=[]);if(t){if(-1===r.pinned_to.indexOf(n.id)){r.pinned_to.push(n.id);i=true}}else{var a=r.pinned_to.indexOf(n.id);if(-1!==a){r.pinned_to.splice(a,1);i=true}}return i};var l=function e(t,r,n,i,a){var s=false;i.pinned_items||(i.pinned_items=[]);var o=-1;i.pinned_items.some(function(e,t){var i=false;"message"===n&&"message"===e.type?e.message.ts===r.message.ts&&(i=true):"file"===n&&"file"===e.type?e.file.id===r.file.id&&(i=true):"file_comment"===n&&"file_comment"===e.type&&e.comment.id===r.comment.id&&(i=true);i&&(o=t);return i});if(TS.pins.havePinsBeenFetched(i))if(t||-1===o){if(t&&-1===o){i.pinned_items.unshift(r);i.pinned_items_count=i.pinned_items.length;s=true}}else{i.pinned_items.splice(o,1);i.pinned_items_count=i.pinned_items.length;s=true}else{i.pinned_items_count=i.pinned_items_count||0;var l=_.parseInt(a,10);_.isNaN(l)?t?i.pinned_items_count+=1:t||(i.pinned_items_count=Math.max(i.pinned_items_count-1,0)):i.pinned_items_count=l;s=true}i.has_pins=!!i.pinned_items_count;return s};var u=function e(t,r,n){var i="";var a="";var s="";switch(t){case"file":i=TS.interop.i18n.t("Are you sure you want to pin this file to {pin_to_label}?","pins")({type:t,pin_to_label:Handlebars.helpers.pinToLabel(r)});a=TS.interop.i18n.t("Pin file","pins")();s=TS.interop.i18n.t("Yes, pin this file","pins")();break;case"comment":i=TS.interop.i18n.t("Are you sure you want to pin this comment to {pin_to_label}?","pins")({type:t,pin_to_label:Handlebars.helpers.pinToLabel(r)});a=TS.interop.i18n.t("Pin comment","pins")();s=TS.interop.i18n.t("Yes, pin this comment","pins")();break;case"message":i=TS.interop.i18n.t("Are you sure you want to pin this message to {pin_to_label}?","pins")({type:t,pin_to_label:Handlebars.helpers.pinToLabel(r)});a=TS.interop.i18n.t("Pin message","pins")();s=TS.interop.i18n.t("Yes, pin this message","pins")();break;default:break}var o="<p>"+i+"</p>";TS.generic_dialog.start({title:a,body:o,go_button_text:s,onGo:function e(){d(r,n)}})};var d=function e(t,r){var n=m(t,r);var i=TS.interop.datetime.makeTsStamp(null,{padder:"0"});var a=function e(n,a){if(!n){if("too_many_pins"===a.error){var s="message";"file"===r.type&&(s="file");"file_comment"===r.type&&(s="comment");TS.generic_dialog.start({title:TS.interop.i18n.t("Couldn\u2019t pin {type}","pins")({type:s}),body:"<p>"+TS.interop.i18n.t("Sorry! You\u2019ve hit the limit on how many pins you can have in this channel.","pins")()+"</p>",show_cancel_button:false})}else TS.info("pins.add got a not ok rsp: "+a.error);if("already_pinned"!==a.error)return}TS.interop.redux.features.socket.isConnected(TS.redux.getState())||TS.redux.dispatch(TS.interop.actions.requestOfflineHistory({channelId:t.id}));if(!TS.pins.havePinsBeenFetched(t))return;r.created=i;r.created_by=TS.boot_data.user_id;TS.pins.pinStatusHasChanged(true,r,r.type,t)};TS.interop.api.call("pins.add",n).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;a(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;a(i,t,r,n);return{data:t,args:r,request_id:n}})};var c=function e(t,r){var n=m(t,r);var i=function e(n,i){if(!n&&"not_pinned"!==i.error)return;TS.interop.redux.features.socket.isConnected(TS.redux.getState())||TS.redux.dispatch(TS.interop.actions.requestOfflineHistory({channelId:t.id}));if(!TS.pins.havePinsBeenFetched(t))return;TS.pins.pinStatusHasChanged(false,r,r.type,t)};TS.interop.api.call("pins.remove",n).then(function(e){var t=e.data,r=e.args,n=e.request_id;var a=true;i(a,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var a=false;i(a,t,r,n);return{data:t,args:r,request_id:n}})};var m=function e(t,r){var n={channel:t.id};"message"===r.type?n.timestamp=r.message.ts:"file"===r.type?n.file=r.file.id:"file_comment"===r.type&&(n.file_comment=r.comment.id);return n};var f=function e(t,r,n){TS.generic_dialog.start({title:TS.interop.i18n.t("Remove Pinned Item","pins")(),body:"<p>"+TS.interop.i18n.t("Are you sure you want to remove this pinned item?","pins")()+"</p>",go_button_text:TS.interop.i18n.t("Yes, remove this pinned item","pins")(),onGo:n})};var p=function e(t,r,n){if(!n||!n.pinned_to)return;n.pinned_to.forEach(function(e){var t=TS.redux.channels.getEntityById(e);if(!t)return;var r=l(false,{comment:n},"file_comment",t);r&&TS.pins.pinned_status_changed_sig.dispatch(t)})};var h=function e(t){if(!t)return;t.pinned_to&&t.pinned_to.forEach(function(e){var r=TS.redux.channels.getEntityById(e);if(!r)return;var n=l(false,{file:t},"file",r);n&&TS.pins.pinned_status_changed_sig.dispatch(r)});t.comments&&t.comments.forEach(function(e){p(t,e.id,e)})};var g=function n(){if(r){e={};t={}}else r=true};var S=function r(n){var i=n||TS.shared.legacyGetActiveModelOb();if(i&&i.id){delete e[i.id];delete t[i.id]}}})()},aLMH:function(e,t,r){var n=r("cDf5");var i=r("J4zp");(function(){TS.registerModule("utility",{onStart:function e(){TS.utility.makeRefererSafeLink=_.memoize(TS.utility.makeRefererSafeLink);TS.interop.Flannel.useSocket()&&TS.redux.socket.connectedSig.add(TS.utility.resetRefererSafeLinkCache);TS.prefs&&TS.prefs.team_hide_referers_changed_sig&&TS.prefs.team_hide_referers_changed_sig.add(TS.utility.resetRefererSafeLinkCache);t=TS.interop.i18n.t("me","utility")();r=TS.interop.i18n.t("you","utility")();p=TS.utility.normalizeDevHost("https://"+document.location.hostname+"/files");h=TS.utility.normalizeDevHost("https://"+document.location.hostname+"/team")},keymap:{alt:18,ctrl:17,cmd_ff:224,cmd_other:91,cmd_right:93,esc:27,shift:16,tab:9,del:8,delete:46,enter:13,left:37,up:38,right:39,down:40,pageup:33,pagedown:34,end:35,home:36,space:32,semicolon:59,equals_sign:187,minus_sign:189,comma:188,period:190,left_square_bracket:219,right_square_bracket:221,V:86,a:65,e:69,b:66,k:75,i:73,z:90,y:89,insert:45,slash:191,f6:117,num_lock:144,insert_extended:96,caps_lock:20},email_regex:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,regexpEscape:function e(t,r){r=Math.min(r||5e5,5e5);t.length>r&&(t=t.slice(0,r));return _.escapeRegExp(t)},ensureInArray:function e(t,r){if(t.indexOf(r)>-1)return false;t.push(r);return true},makeComparableVersion:function e(t){var r=t.split("-")[0];return _.reduce(r.split("."),function(e,t){return 1e3*e+parseInt(t,10)},0)},compareSemanticVersions:function e(t,r){var n=TS.utility.makeComparableVersion(t);var i=TS.utility.makeComparableVersion(r);if(n===i)return 0;return n>i?1:-1},isAppVersionBefore:function e(t){if(!TS.model.is_our_app){if("dev"===TS.boot_data.version_ts)throw new Error("Cannot check app version because we are not in the app, silly goose.");return false}return-1===TS.utility.compareSemanticVersions(TS.model.desktop_app_version.major+"."+TS.model.desktop_app_version.minor+"."+TS.model.desktop_app_version.patch,t)},doRectsOverlap:function e(t,r){return!(r.left>t.right||r.right<t.left||r.top>t.bottom||r.bottom<t.top)},doesRectContainRect:function e(t,r,n,i){n=n||0;if(r.top<t.top-n)return false;if(r.bottom>t.bottom+n)return false;if(i)return true;if(r.left<t.left-n)return false;if(r.right>t.right+n)return false;return true},shouldLinksHaveTargets:function e(){return false},parseJSONOrElse:function e(t,r){if(""===t)return r;try{return JSON.parse(t)}catch(e){return r}},stringifyJSONOrElse:function e(t,r,n,i){try{return JSON.stringify(t,r,n)}catch(e){if("function"===typeof i)return i(e);return i}},ordinalNumber:function e(t){return TS.interop.i18n.t("{number_str, selectordinal, one{#st}two{#nd}few{#rd}other{#th}}","utilities")({number_str:t.toString()})},getTeamUrl:function e(){return h},getHistoryRetryDelay:function e(t,r){t=_.isInteger(t)?t:1;var n=2500;var i=5e3;var a=_.random(n,i);if("fatal_error"===r){var s=1.3;a*=Math.pow(s,t)}return a},getChannelNameFromUrl:function e(t){var r=TS.utility.getPathFromSlackUrl(t);if(!r)return"";var n="messages"==r[0]||"archives"==r[0];if(!n)return"";return decodeURIComponent(r[1])},removeUrlParam:function e(t,r){var n=r.split("?")[0];var i=-1!==r.indexOf("?")?r.split("?")[1]:"";var a=[];var s;if(""!==i){a=i.split("&");for(var o=a.length-1;o>=0;o-=1){s=a[o].split("=")[0];s===t&&a.splice(o,1)}n=a.length?n+"?"+a.join("&"):n}return n},isUnreadViewPath:function e(t){return 0===t.indexOf("/unreads")},isThreadsViewPath:function e(t){return 0===t.indexOf("/threads")},isAppSpaceViewPath:function e(t){return 0===t.indexOf("/app-space")},isSearchViewPath:function e(t){return 0===t.indexOf("/search")},isPageViewPath:function e(t){return 0===t.indexOf("/page")},isSlackUrl:function e(t){return c.test(t)},getPathFromSlackUrl:function e(t){var r=t.match(c);var n=r&&r[2];if(!n)return;var i=t.split(n);var a=i[1].split("?")[0];return(n+a).split("/")},getTeamFromSlackUrl:function e(t){var r=t.match(c);var n=r&&r[1];return n},refashionUrl:function e(t,r,n,a){var s=document.createElement("a");s.href=t;var o=s.pathname.slice(1).split("/").slice(0,2),l=i(o,2),u=l[0],d=l[1];s.pathname=_.compact([r||"/"+u+"/"+d,n,a]).join("/");"/"!==s.pathname[s.pathname.length-1]&&(s.pathname+="/");return s.toString()},dataURItoBlob:function e(t){return TS.utility.base64StrtoBlob(TS.utility.base64StrFromDataURI(t))},base64StrFromDataURI:function e(t){return t.split(",")[1]},base64StrtoBlob:function e(t){var r=atob(t);var n=new ArrayBuffer(r.length);var i=new Uint8Array(n);for(var a=0;a<r.length;a+=1)i[a]=r.charCodeAt(a);var s=new DataView(n);var o=new Blob([s]);return o},ellipsize:function e(t,r){if(!t)return t;r&&parseInt(r,10)||(r=50);if(t.length>r){var n=t.substr(0,r/2);var i=t.substr(-r/2,t.length);t=n+"..."+i}return t},makeSafeForDomId:function e(t){return String(t).replace(/\./g,"_")},makeSafeForDomClass:function e(t){return t.replace(/\s/g,"_")},getImageIconClass:function e(t,r){var n=r;var i=80;var a=80;t&&(t.thumb_360_w<i||t.thumb_360_h<a)&&(n=t.thumb_360_w>t.thumb_360_h?"landscape":t.thumb_360_w<t.thumb_360_h?"portrait":"square");return n},getAppliedClasses:function e(t){return _.reduce(t,function(e,t,r){t&&e.push(r);return e},[]).join(" ")},numberWithK:function e(t){if(t>999){t=Math.round(t/1e3*10)/10;return(TS.interop.i18n.number(t)||"")+"K"}return TS.interop.i18n.number(t)||""},openInNewTab:function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.dontEncodeHash,a=void 0!==i&&i;if(0===t.indexOf("/")&&TS.boot_data.team_url){var s=TS.boot_data.team_url;s=s.substr(0,s.length-1);t=s+t}var o=t;var l="";var u=o.indexOf("?");var d=TS.interop.utility.urlNeedsRefererHiding(t);if(-1!==u){d&&(t=_.escape(t.substring(0,u)));var c=o.substring(u+1,o.length);o=o.substring(0,u);if(c.length){var m=TS.interop.url.queryStringParse(c);var f=TS.interop.url.parseUrl(t);var p=false;f&&"accounts.google.com"==f.hostname&&"/o/oauth2/auth"==f.pathname&&(p=true);_.forEach(m,function(e,r){if(d){t=TS.interop.url.setUrlQueryStringValue(t,r,e||"",p);a&&(t=t.replace("%23","#"))}else l+='<input type="hidden" name="'+_.escape(r)+'" value="'+_.escape(e||"")+'">'})}}if(d){l='<input type="hidden" name="url" value="'+_.escape(t)+'">';o="https://"+TS.boot_data.redir_domain+"/link"}$("<form>"+l+"</form>").attr({method:"GET",action:o,target:r}).appendTo("body").submit().remove()},isScalar:function e(t){return/boolean|number|string/.test(n(t))},sanitizeHTML:function t(r,n,i,a){var s=function e(t){var r=t.tagName.toLowerCase();if(n.indexOf(r)<0)return null;Array.prototype.slice.apply(t.attributes).forEach(function(e){i.indexOf(e.name)<0&&t.attributes.removeNamedItem(e.name)});Array.prototype.slice.apply(t.children).forEach(function(r){var n=e(r);n||t.removeChild(r)});return t};e=e||new DOMParser;var o=e.parseFromString(r,"text/html")||e.parseFromString(r,"text/xml");var l=o.body;if(1!=l.children.length)return"";var u=s(l.children[0]);l=null;o=null;if(u)return a?u:u.outerHTML;return""},getChildTextNodes:function e(t){var r=[];if(!t)return r;if(t instanceof Text){r.push(t);return r}var n=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,false);var i=n.nextNode();while(i){r.push(i);i=n.nextNode()}return r},getAttributesFromHTMLString:function t(r){e=e||new DOMParser;var n=e.parseFromString(r,"text/html")||e.parseFromString(r,"text/xml");var i=n.body;if(1!=i.children.length)return{};var a={};[].slice.apply(i.children[0].attributes).forEach(function(e){a[e.name]=e.value});i=null;n=null;return a},linkify:function e(t,r,n,i){if(!t)return t;t=t.replace(TS.interop.url.URL_REGEXP,function(e){var t;if(0===e.toLowerCase().indexOf("www.")){if(!n)return e;t="http://"+e}else t=e;if(i)return"<"+t+"|"+e+">";return"<a "+TS.utility.makeRefererSafeLink(t)+' target="'+(r||"")+'">'+e+"</a>"});return t},linkifyInternal:function e(t,r){return TS.utility.linkify(t,"",r,true)},preg_quote:function e(t){return(""+t).replace(/([\\.+*?[^\]$(){}=!<>|:])/g,"\\$1")},getActiveElementProp:function e(t){if(!document.activeElement)return"";if("NODENAME"===t){if(!document.activeElement.nodeName)return"";return document.activeElement.nodeName.toUpperCase()}return document.activeElement[t]},isTabCompleteShowing:function e(){if($("#chat_input_tab_ui").length)return true;return false},isFocusOnInput:function e(){return TS.interop.utility.isInputElement(document.activeElement)},unformatTopicOrPurpose:function e(t){return TS.format.unFormatMsg(t)},formatTopicOrPurpose:function e(t,r){t=TS.format.formatWithOptions(t,{},{no_preformatted:!!r});t=t.replace(/(<br[^>]*>)/,'<span class="hidden br_ellipsis">\u2026</span>$1');return t},removeLinksFromTabFlow:function e(t){return t.replace(m,'$1 tabindex="-1"$2')},populateInput:function e(t,r,n){r||(r="");var i=$(t);TS.utility.contenteditable.value(i,r);_.isNumber(n)&&TS.utility.contenteditable.cursorPosition(i,n)},populateThreadInputs:function e(t,r,n){TS.interop.threads.populateReplyInput(t,r,n)},referer_safe_url_map:{},makeRefererSafeLink:function e(t){if("string"!==typeof t){TS.error("Expected url to be a string, got: "+n(t));return}t=TS.format.replaceHighlightMarkers(t);d(t);var r=t.replace(/&amp;/g,"&");r.match(/javascript(:|&colon;)/gi)&&(r="#");var i=true;var a=TS.utility.sanitizeHTML('<a href="'+r+'"></a>',["a"],["href"],i)||null;a&&(r=a.href);r=_.escape(r).replace(/&amp;/g,"&").replace(/(%27|&#39;)/g,"'");t&&t.lastIndexOf("/")!==t.length-1&&r&&r.lastIndexOf("/")===r.length-1&&(r=r.slice(0,-1));r=r||"#";var s='href="'+r+'"';var o="onclick";var l=TS.interop.utility.getRefererPolicy();TS.model&&TS.model.is_our_app||l&&l.rewrite_on_right_click&&(o="onmousedown");if(!TS.interop.utility.urlNeedsRefererHiding(t))return s;if(TS.utility.externalURLsNeedRedirecting()){var u=encodeURIComponent(r);var c="https://"+TS.boot_data.redir_domain+"/link?url="+u+(l&&l.redirect_type?"&v="+l.redirect_type:"");var m="url-"+Math.random()+"-"+performance.now();TS.utility.referer_safe_url_map[m]=r;s+=' data-referer-safe="1" '+o+'="this.href=&quot;'+c+'&quot;" onmouseover="this.href=TS.utility.referer_safe_url_map[&quot;'+m+'&quot;]" data-referer-original-href="'+r+'" rel="noreferrer"'}else s+=' rel="noreferrer"';return s},resetRefererSafeLinkCache:function e(){TS.utility.makeRefererSafeLink&&TS.utility.makeRefererSafeLink.cache&&TS.utility.makeRefererSafeLink.cache.clear()},makeSureAllExternalLinksAreRefererSafe:function e(t){var r=Date.now();var n=[];if(TS.utility.externalURLsNeedRedirecting()){t.find("a[href]:not([data-referer-safe])").each(function(){var e=$(this);var t=e.attr("href");if(!TS.interop.utility.urlNeedsRefererHiding(t))return;n.push(this.outerHTML);e.removeAttr("href");var r=this.outerHTML.replace("<a",function(){return"<a "+TS.utility.makeRefererSafeLink(t)+" "});e.replaceWith(r);n[n.length-1]+="\n->\n"+r});if(TS.model&&TS.model.team&&TS.has_pri[f]&&TS.boot_data.feature_tinyspeck)if(n.length){TS.log(f,"#"+t.attr("id")+" had "+n.length+" LINKS WITH EXT HREFS BUT NOT data-referer-safe! to fix it took "+(Date.now()-r)+"ms");TS.dir(f,n)}else TS.log(f,"#"+t.attr("id")+" had "+n.length+" LINKS WITH EXT HREFS BUT NOT data-referer-safe! to check it took "+(Date.now()-r)+"ms")}else{t.find("a[href]:not([rel])").each(function(){var e=$(this);var t=e.attr("href");if(0===t.indexOf("mailto")||0===t.indexOf("skype"))return;if(t&&"#"!==t){if(TS.interop.utility.urlNeedsRefererHiding(t)){n.push(this.outerHTML);e.attr("rel","noreferrer");n[n.length-1]+="\n->\n"+this.outerHTML}}else e.removeAttr("href")});if(TS.model&&TS.model.team&&TS.has_pri[f]&&TS.boot_data.feature_tinyspeck)if(n.length){TS.log(f,"#"+t.attr("id")+" had "+n.length+' LINKS WITH EXT HREFS BUT WITHOUT rel="noreferrer"! to add rel it took '+(Date.now()-r)+"ms");TS.dir(f,n)}else TS.log(f,"#"+t.attr("id")+" had "+n.length+' LINKS WITH EXT HREFS BUT WITHOUT rel="noreferrer"! to check it took '+(Date.now()-r)+"ms")}},makeSureAllLinksHaveTargets:function e(t){var r=Date.now();var n=[];t.find("a[href]:not([target])").each(function(){var e=$(this);var t=e.attr("href");if(0===t.indexOf("mailto")||0===t.indexOf("skype"))return;if(t&&"#"!==t){n.push(this.outerHTML);e.attr("target",t);n[n.length-1]+="\n->\n"+this.outerHTML}else e.removeAttr("href")});if(TS.model&&TS.model.team&&TS.has_pri[f]&&TS.boot_data.feature_tinyspeck)if(n.length){TS.log(f,"#"+t.attr("id")+" had "+n.length+" LINKS WITH HREFS BUT WITHOUT TARGETS! to add targets it took "+(Date.now()-r)+"ms");TS.dir(f,n)}else TS.log(f,"#"+t.attr("id")+" had "+n.length+" LINKS WITH HREFS BUT WITHOUT TARGETS! to check it took "+(Date.now()-r)+"ms");TS.utility.makeSureAllExternalLinksAreRefererSafe(t)},sortTable:function e(t,r,n,i,a){n="desc"===n?"desc":"asc";a="desc"===a?"desc":"asc";function s(e){return function(t,r){var s=o(t,e);var l=o(r,e);if($.isNumeric(s)&&$.isNumeric(l)){if(s==l&&i){s=o(t,i);l=o(r,i);if($.isNumeric(s)&&$.isNumeric(l)){if(a!=n)return l-s;return s-l}if(a!=n)return TS.interop.i18n.sorter(l,s);return TS.interop.i18n.sorter(s,l)}return s-l}return TS.interop.i18n.sorter(s,l)}}function o(e,t){return $(e).children("td").eq(t).attr("data-sort-val")}var l=t.find("tr:gt(0)").toArray().sort(s(r));"desc"===n&&(l=l.reverse());for(var u=0;u<l.length;u+=1)t.append(l[u])},getPercSmartly:function e(t,r){if(!t||!r)return"0%";var n=t/r*100;if(100!=n&&100==Math.round(n))return"99%";if(n<.7)return"<1%";return Math.round(n)+"%"},isCursorWithinTBTs:function e(t){var r=TS.utility.contenteditable.cursorPosition(t);var n=TS.utility.contenteditable.value(t);var i=n.substr(0,r.end);var a=i.match(/```/g);if(!a)return false;var s=a.length;if(s%2)return true;return false},hex2rgb:function e(t){var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return r?{r:parseInt(r[1],16),g:parseInt(r[2],16),b:parseInt(r[3],16)}:void 0},rgb2hex:function e(t){if(/^#[0-9A-F]{6}$/i.test(t))return t;var r=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);r||(r=t.match(/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d*\.?\d+)\)$/));if(!r)return;function n(e){return("0"+parseInt(e,10).toString(16)).slice(-2)}return"#"+n(r[1])+n(r[2])+n(r[3])},setImmediate:function e(t){s(t)},immediateDebounce:function e(t){var r=false;return function(){if(r)return;var e=this;var n=arguments;r=true;s(function(){r=false;t.apply(e,n)})}},debounce:function e(t,r){var n;return function(){var e=this;var i=arguments;clearTimeout(n);n=setTimeout(function(){t.apply(e,i)},r)}},debounceWithPromise:function e(t,r){var n;return function(){var e=this;var i=arguments;n&&n.cancel();n=new Promise(function(e){setTimeout(e,r)}).then(function(){return t.apply(e,i)});return n}},throttleFunc:function e(t,r,n){var i={};var a=function e(){var n=Array.prototype.slice.apply(arguments);var a=_.some(n,_.isObject);a&&TS.error("You're passing non-scalar arguments to a function throttled with TS.utility.throttleFunc; it will likely not work as you want");var s="f-"+n.join("-");if(i[s]&&i[s].context!==this)throw new Error("Cannot use this function with different `this` contexts across different calls "+this+" "+i[s].context);i[s]=i[s]||{requested:Date.now(),timeout:0,context:this};i[s].timeout||e.always_wait?i[s].requested=Date.now():t.apply(i[s].context,n);if(i[s].timeout)return;i[s].timeout=setTimeout(function e(){var a=Date.now()-i[s].requested;if(a>=r){t.apply(i[s].context,n);delete i[s]}else i[s].timeout=setTimeout(e,r-a)},r)};a.always_wait=!!n;return a},looksLikeKeyboardShortcut:function e(t){var r=t.ctrlKey||t.altKey||t.metaKey;if(!r)return false;if(t.keyCode===TS.utility.keymap.alt||t.keyCode===TS.utility.keymap.ctrl||t.keyCode===TS.utility.keymap.cmd_ff||t.keyCode===TS.utility.keymap.cmd_other||t.keyCode===TS.utility.keymap.cmd_right)return false;var n=String.fromCharCode(t.keyCode);if(/^(\w|[$-/:-?{-~!"^_`[\]])$/i.test(n))return true;return true},isForwardDeleteKey:function e(t){if(t.keyCode===TS.utility.keymap.delete)return true;if(TS.model.is_mac&&t.ctrlKey&&"d"===t.key)return true;return false},throttle:function(){var e;var t;e={delay:200,timer_group:"generic"};t={timers:{},queues:{}};function r(e){var r;var n;if(t.timers[e]){if(t.queues[e])for(r=0,n=t.queues[e].length;r<n;r+=1)t.queues[e][r]&&t.queues[e][r]();t.queues[e]=null;t.timers[e]=null}}function n(n,i,a){if(!n)return false;i=i||e.timer_group;if(!t.timers[i]){a=a||e.delay;t.timers[i]=window.setTimeout(function(){r(i)},a)}t.queues[i]||(t.queues[i]=[]);t.queues[i].indexOf?-1===t.queues[i].indexOf(n)&&t.queues[i].push(n):t.queues[i].push(n)}return{method:n}}(),getImgProxyURL:function e(t,r,n){return TS.utility.getImgProxyURLWithOptions(t,{width:r,height:n})},getImgProxyURLWithOptions:function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)return t;return TS.interop.utility.getImgProxyUrl({url:t,height:r.height,width:r.width,rotate:r.rotate,renderSvg:r.render_svg,stopAnimations:r.stop_animations,emoji:r.emoji,convertIco:r.convert_ico})},rAF:function(){var e=["ms","moz","webkit","o"];var t=window.requestAnimationFrame;var r;for(r=0;r<e.length&&!t;r+=1)t=window[e[r]+"RequestAnimationFrame"];if(!t){var n=0;return function(e){var t=Date.now();var r=Math.max(0,16-(t-n));var i=window.setTimeout(function(){e(t+r)},r);n=t+r;return i}}return function(e){return t.call(window,e)}}(),cancelRAF:function(){var e=["ms","moz","webkit","o"];var t=window.cancelAnimationFrame;var r;for(r=0;r<e.length&&!t;r+=1)t=window[e[r]+"CancelAnimationFrame"]||window[e[r]+"CancelRequestAnimationFrame"];if(!t)return function(e){clearTimeout(e)};return function(e){t.call(window,e)}}(),startAnimation:function e(t){return u.subscribe(t)},getLocationHashString:function e(t){t=t||document;var r=t.location.hash;if(r&&r.length)return r.substr(1);return r},getYoutubeIdFromURL:function e(t){var r="";t=t.replace(/(>|<)/gi,"").split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/);if(void 0!==t[2]){r=t[2].split(/[^0-9a-z_-]/i);r=r[0]}else r=t;return r},loadUrlInWindowIfOnline:function e(t,r){r=r||document;var n=function e(n){if(n){$("body").addClass("hidden");r.location=t}else TS.generic_dialog.alert(TS.interop.i18n.t("You can\u2019t perform that action because you are not online :(","utility")())};return TS.interop.api.call("api.test",{}).then(function(e){var t=e.data,r=e.args,i=e.request_id;var a=true;n(a,t,r,i);return{data:t,args:r,request_id:i}}).catch(function(e){var t=e.data,r=e.args,i=e.request_id;var a=false;n(a,t,r,i);return{data:t,args:r,request_id:i}})},externalURLsNeedRedirecting:function e(){if(TS.model.team&&TS.prefs.getTeamPref("hide_referers")&&!TS.model.is_our_app)return true;return false},swapInRedirUrlForIframe:function e(t,r){r=r||TS.interop.utility.getRefererPolicy();if(!r)return t;if(!r.iframe_redirect_type)return t;var n=$(t);var i=n.attr("src");if(!i)return t;"1"==TS.qs_args.test_iframe_referers&&(i="https://"+document.location.host+"/referertester.html?"+Date.now());i="https://"+TS.boot_data.redir_domain+"/link?v="+r.iframe_redirect_type+"&url="+encodeURIComponent(i);n.attr("src",i);t=n[0].outerHTML;"1"==TS.qs_args.test_iframe_referers&&TS.info("html with redir:"+t);return t},setCssFromHeightAndWidthAttrs:function e(t){if(!t)return;var r=$(t);r.css({height:r.attr("height"),width:r.attr("width")});return r[0].outerHTML},isArrowKey:function e(t){var r=TS.utility.keymap;if(t==r.down)return true;if(t==r.up)return true;if(t==r.right)return true;if(t==r.left)return true;return false},isPageKey:function e(t){var r=TS.utility.keymap;if(t==r.pageup)return true;if(t==r.pagedown)return true;if(t==r.home)return true;if(t==r.end)return true;return false},isNumericKey:function e(t){if(t>=48&&t<=57)return true;return false},getFileIDFromURL:function e(t){return TS.interop.url.getFileIdFromUrlWithState(TS.redux.getState(),t)},getMemberIdFromURL:function e(t){if(!t)return null;t=TS.utility.normalizeDevHost(String(t));var r;if(0===t.indexOf("/team/"))r=t.split("/team/");else{r=TS.utility.getPathFromSlackUrl(t);if(!r||r.length<2||"team"!==r[0])return null}var n=r[1];if(!n)return null;var i=TS.interop.members.getMemberById(n)||!TS.boot_data.feature_deprecate_get_member_by_name&&TS.interop.members.getMemberByName(n);if(i)return i.id;return null},normalizeDevHost:function e(t){return t.replace(/\.dev[0-9]*.slack.com/i,".dev.slack.com").replace(/\.staging.slack.com/i,".slack.com").replace(/\.staging-master.slack.com/i,".slack.com").replace(/\.staging-release.slack.com/i,".slack.com")},platformSupportsHtmlNotifications:function e(){if(window.desktop&&window.desktop.app){if(window.desktop.app.canShowHtmlNotifications)return window.desktop.app.canShowHtmlNotifications();return false!==window.desktop.app.willUseHwAcceleration}return false},findAllTeamEmojiInStr:function e(t,r){t=$.trim(t);var n=[];if(!t)return n;n=t.match(TS.emoji.legacyGetColonsRx())||n;var i=[];n=n.filter(function(e){if(TS.emoji.isValidName(e))return true;e.split("::").forEach(function(e){var t=TS.emoji.isValidName(e);if(!t)return;i.push(":"+t+":")});return false});n=n.concat(i);r&&(n=_.uniq(n));TS.dir(248,n);return n},areSimpleObjectsEqual:function e(t,r){if(t===r)return true;if(void 0===t&&r)return false;if(void 0===r&&t)return false;if(n(t)!==n(r))return false;if(null===t&&r)return false;if(null===r&&t)return false;if(t.length!==r.length)return false;var i;for(i in r){if("undefined"===typeof t[i]&&"undefined"!==typeof r[i])return false;if(r[i])switch(n(r[i])){case"object":if(!e(t[i],r[i]))return false;break;case"function":if(String(r[i])!=String(t[i]))return false;break;default:if(r[i]!==t[i])return false}else if(t[i])return false}for(i in t)if("undefined"===typeof r[i]&&"undefined"!==typeof t[i])return false;return true},deepDiffObjects:function e(t,r){if(_.isEmpty(t))return{};if(_.isEmpty(r))return t;var i={};_.each(t,function(e,t){var a=r[t];if(a===e)return;if(n(e)!==n(a))i[t]=e;else if(_.isArray(e))i[t]=_.difference(e,a);else if(_.isPlainObject(e)){var s=TS.utility.deepDiffObjects(e,a);_.isEmpty(s)||(i[t]=s)}else i[t]=e});return i},appendLogToUrlWithLimit:function e(t,r){if(!t)return t;t+=-1==t.indexOf("?")?"?":"&";if(!r)return t;var n=2e3-t.length;return t+r.substr(0,n)},makeWebWorker:function e(t,r){var n=URL.createObjectURL(new Blob(["(",t,")()"],{type:"application/javascript"}));var i=new Worker(n);URL.revokeObjectURL(n);i.onmessage=r;return i},strGetWordCount:function e(t){return t.trim().split(/\s+/).length},truncateToNearestWordBoundary:function e(t,r){t.string&&(t=t.string);if(t.length<=r)return t;var n="\u2026";var i=t.substring(0,r);var a=i.lastIndexOf(" ");if(a>0&&a>r-15)return i.substring(0,a)+n;return i.substring(0,i.length-1)+n},truncateAndEscape:function e(t,r){if(t.length<=r)return _.escape(t);return _.escape(t.substring(0,r-1))+"&hellip;"},truncateHTML:function(){var e;try{if(window.DOMParser){e=new DOMParser;e.parseFromString("","text/html")||(e=null)}}catch(t){e=null}function t(e,r,n){var i=_.toArray(r.childNodes);_.forEach(i,function(i){if(e>=n){r.removeChild(i);return}if(i.nodeType===Node.TEXT_NODE){var a=i.textContent;if(e+a.length>n){i.textContent=a.substring(0,n-e);e+=n-e}else e+=i.textContent.length}else e=t(e,i,n)});return e}return function(r,n){try{var i;if(e){var a=e.parseFromString(r,"text/html");i=a.body}else{var s=jQuery.parseHTML("<div>"+r+"</div>");i=s[0]}var o=t(0,i,n);if(o>=n){var l=document.createTextNode("\u2026");i.appendChild(l)}return i.innerHTML}catch(e){TS.error(e);return r}}}(),isPostClickEventSafe:function e(t,r){if(t.target){var n=$(t.target).closest("[href]");if(!n[0])return true;if(!n.closest(".post_body").length)return true;var i=n[0].protocol;if(i&&false===/^https?:$/.test(i)){TS.warn("not following bad link from a post preview");t.preventDefault();return false}if(n.data("original-href")){TS.warn("not following possibly spoofed link from a post preview");t.preventDefault();var s=n.data("referer-original-href")||n.attr("href");r||a(n.data("original-href"),n.attr("href"),s);return false}}return true},getCachedScript:function e(t,r){r=$.extend(r||{},{dataType:"script",cache:true,url:t});return jQuery.ajax(r)},disableElement:function e(t,r){t=$(t);t.attr("disabled",r);t.attr("aria-disabled",r)},enableFeatureForUser:function e(t){if(t<0||t>100){TS.warn("TS.utility.enableFeatureForUser() expects a number between 0 and 100");return false}return _.random(0,100)<t},roundToThree:function e(t){return+(Math.round(t+"e+3")+"e-3")},convertBytesToMegabytes:function e(t){return t/1024/1024},convertKilobytesToMegabytes:function e(t){return t/1024},queryIsMaybeSelf:function e(n){n=_.toLower(n);if("me"===n||"you"===n||n===t||n===r)return true;return false},openAuthenticatedInBrowser:function e(t){if(TS.interop.desktop.isDesktop){var r=TS.boot_data.team_url+"web/open"+t;TS.interop.desktop.openAuthenticatedInBrowser(r)}else window.open(t)},getFontDescriptorForElement:function e(t){var r=t instanceof jQuery?t:$(t);return[r.css("font-style"),r.css("font-weight"),r.css("font-size"),r.css("font-family")].join(" ")},measureTextWidth:function e(t,r){if(!t)return 0;this._measure_text_width_canvas=this._measure_text_width_canvas||document.createElement("canvas");var n=this._measure_text_width_canvas.getContext("2d");n.font=r;return n.measureText(t).width},exampleEmailAddress:function e(t){if("you"===t)return TS.interop.i18n.t("you@{example_com}","utility")({example_com:"example.com"});return TS.interop.i18n.t("name@{example_com}","utility")({example_com:"example.com"})},exampleWebAddress:function e(){return"example.com"},test:function e(){var t={};Object.defineProperty(t,"_files_url",{get:function e(){return p},set:function e(t){p=t}});Object.defineProperty(t,"_team_url",{get:function e(){return h},set:function e(t){h=t}});return t}});var e;var t;var r;var a=function e(t,r,n){var i="";var a="";i+='<ts-icon class="ts_icon_warning yolk_orange small_right_margin"></ts-icon> ';i+=TS.interop.i18n.t("Caution: Tricky Link","utility")();a+="<p>";a+='  <span class="inline_block">'+TS.interop.i18n.t("The link you clicked (<strong>{url}</strong>) is tricky.","utility")({url:TS.interop.i18n.safeString(_.escape(n))})+"</span>";a+='  <span class="inline_block">'+TS.interop.i18n.t("It has been formatted to look like another web address (<strong>{url}</strong>).","utility")({url:TS.interop.i18n.safeString(_.escape(t))})+"</span>";a+="</p>";a+="<p>"+TS.interop.i18n.t("Are you sure you want to follow it?","utility")()+"</p>";TS.generic_dialog.start({title:i,body:a,show_cancel_button:false,show_secondary_go_button:true,secondary_go_button_text:TS.interop.i18n.t("Let\u2019s risk it","utility")(),secondary_go_button_class:"btn_outline",onSecondaryGo:function e(){window.open(r)},go_button_text:TS.interop.i18n.t("Take me back to safety","utility")(),esc_for_ok:true,enter_always_gos:true})};var s=window.setImmediate;if(!s)if(window.MutationObserver){var o=document.createElement("div");var l=[];new MutationObserver(function(){var e=l.slice();l.length=0;e.forEach(function(e){e()})}).observe(o,{attributes:true});s=function e(t){l.length||o.setAttribute("yes","no");l.push(t)}}else s=function e(t){setTimeout(t,0)};var u=function(){var e=false;var t=[];function r(){if(!e)return;t.forEach(function(e){e()});TS.utility.rAF(r)}function n(n){var i={start:function i(){t.push(n);if(!e){e=true;TS.utility.rAF(r)}},stop:function r(){t.splice(t.indexOf(n),1);t.length||(e=false)}};i.start();return i}return{subscribe:n,subscribers:t,isRunning:function t(){return e}}}();var d=function e(t){var r=TS.utility.getPathFromSlackUrl(t);if(r&&r.length>1){var n={messages:true,archives:true}[r[0]];var i=decodeURIComponent(r[1]);n&&i&&TS.interop.utility.looksLikeChannelId(i)&&!TS.interop.channels.hasChannelWithId(i)&&TS.redux.channels.getEntityById(i)}};var c=/([^.:/]+)(?:\.[^.]+)?\.slack\.com\/((?:messages|archives|unreads|threads|team|page)\/)/;var m=/(<a\b[^>]*)(>)/gi;var f=365;var p=null;var h=null})()},ae6w:function(e,t,r){var n=r("J4zp");(function(){TS.registerModule("tabcomplete.members",{type:"members",getMatch:function e(t,r,n,i){var a;var s;var o=/(^|\n|.)?((?:@|\uFF20)([^\n@\uFF20]*))$/i;t.replace(o,function(e,t,r,n,o){var l=""===TS.interop.texty.trimAllowedMatchPrefix(t)||i&&i.allowed_preceding_symbols&&-1!==i.allowed_preceding_symbols.indexOf(t);if(!l)return;if(n.length&&n.match(/^\s/))return;t&&(o+=t.length);a=r;s=o});if(!a&&r){var l=_.last(/(^|\s)([^\s\n@\uFF20]+)$/.exec(t));l=TS.interop.texty.trimAllowedMatchPrefix(l,{trimCJK:false});if(h(l,r)){a=l;s=t.length-l.length}}if(!a)return;var u=4;var d=a.split(" ").length-1;if(d>u)return null;return{match:a,index:s}},shouldDisplayResults:function e(t,r){if(!t||_.isEmpty(r))return false;return true},getResultAtIndex:function e(t,r){if(!t||!_.isNumber(r))return;TS.log(90211,"Getting result at index: "+r+"; User: "+(t[r]?t[r].id:""));return t[r]},getInsertData:function e(t){if(!t)return;TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_select",trigger:"member"}}});var r=TS.interop.texty.getDisplayTextForSearchResult(t);TS.log(90211,"Getting insert data for result: "+t.id);var n=TS.interop.texty.shouldHighlightMention(t.id,r,TS.interop.prefs.getHighlightWords());return{text:r,format:{slackmention:{id:t.id,label:r,mention:n}}}},search:function r(n,i,a){TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_typing",trigger:"member"}}});var s=S(n,i.isUserSolicited);var u=g(s);var f;i.no_model_ob||(f=i.model_ob||TS.shared.legacyGetActiveModelOb());var p=c(f,i.no_model_ob);var h=TS.interop.userGroups.getActiveUserGroups().filter(function(e){return!TS.interop.userGroups.isUserGroupFromAnotherTeam(e.id)});var v=[];f&&i.enableBroadcastKeywords&&(v=TS.interop.broadcast_keywords.getBroadcastKeywordsForUser(f.id));var y=o(f,n,{members:p,usergroups:h,broadcast_keywords:v},i.include_deleted);u(function(){a(null,y)});if(f){var w=_(p).map("id").without("USLACKBOT").value();if(w.length>e){var k=TS.boot_data.page_needs_enterprise?"W":"U";var x=TS.ui.frecency.getMostCommonWithPrefix(k,e);var C=_.map(x,"id");var M=_.intersection(w,C);var I=_.difference(w,M);w=M.concat(I.slice(0,e-M.length))}TS.log(1990,"Ensuring we have membership for "+w.length+" users in "+f.id+": "+w);TS.interop.membership.ensureChannelMembershipIsKnownForUsers(f.id,w).then(function(e){TS.log(1990,"Got membership for "+w.length+" users in "+f.id+"; any fetches required? "+e);e&&u(function(){a(null,y)})})}if(TS.model.team&&"T025LDE84"===TS.model.team.id&&n&&0===n.indexOf("@helen")){var E=y.map(function(e){return e&&e.id});if(-1===E.indexOf("U7T4Z7K8A")){var A=function e(t){if(!t.id)return"NOT FOUND";return{id:t.id,is_stranger:t.is_stranger,deleted:t.deleted,name:t.name.match(/helen/i),_display_name_lc:t._display_name_lc.match(/helen/i),_real_name_lc:t._real_name_lc.match(/helen/i)}};var P=_.find(TS.model.members,function(e){return e&&"U7T4Z7K8A"===e.id})||{};var O=_.filter(TS.model.members,function(e){return e&&(e.name.match(/helen/i)||e._display_name_lc.match(/helen/i)||e._real_name_lc.match(/helen/i))})||{};var F=_.find(TS.members.getActiveMembersWithSelfAndSlackbot(),function(e){return e&&"U7T4Z7K8A"===e.id})||{};var H=_.filter(TS.members.getActiveMembersWithSelfAndSlackbot(),function(e){return e&&(e.name.match(/helen/i)||e._display_name_lc.match(/helen/i)||e._real_name_lc.match(/helen/i))})||{};var j=_.find(p,function(e){return e&&"U7T4Z7K8A"===e.id})||{};var D=TS.shared.legacyGetActiveModelOb();TS.interop.utility.getLogger({getState:TS.redux.getState}).error({members:E.sort(),channel_id:D&&D.id,model_u7t:A(P),model_h:_.map(O,A),getter_u7t:A(F),getter_h:_.map(H,A),local_u7t:A(j)},"tabcomplete_missing_member TS.tabcomplete.members.search local_results",{subtype:"T025LDE84"})}}if(d(n,p,i)){var $={include_deleted:i.include_deleted,limit:t};var L=l(f,n,$);L.then(function(e){var t=e.members;h=_.unionBy(h,e.usergroups,"id");var r=_(p).concat(t).compact().uniqBy("id").value();TS.boot_data.page_needs_enterprise&&(r=m(r));var s=o(f,n,{members:r,usergroups:h,broadcast_keywords:v},i.include_deleted);var l=[];if(f){var d=_.filter(s,"is_usergroup");l=_.reduce(d,function(e,t){var r=b(t.id,f.id);r.isResolved()||e.push(r);return e},[]);TS.interop.membership.ensureChannelMembershipIsKnownForUsers(f.id,_.map(s,"id"))}l.length?Promise.all(l).then(function(){u(function(){a(null,s)})}):T(y,s)||u(function(){a(null,s)});return null})}},render:function e(t,r,n){"@"!==t[0]&&"\uff20"!==t[0]&&(t="@"+t);var i=TS.templates.tabcomplete_member_header({text:t});var a;n.no_model_ob||(a=n.model_ob||TS.shared.legacyGetActiveModelOb());var s=r.map(function(e){if(e.is_broadcast_keyword)return e;if(e.is_usergroup||e.is_subteam)return p(a,e);return f(a,e,t)});var o=TS.templates.tabcomplete_member_results({results:s,is_client:false});return TS.tabcomplete.renderMenu(i,o)},onSelect:function e(t,r){if(!t)return;r||(r="");r=r.replace(/^@/,"");TS.ui.frecency.record(t,r)},onSelectedIndexChange:function e(t){TS.log(90211,"Selected index changed to: "+t);TS.tabcomplete.onSelectedIndexChange(t)},test:function e(){var t={IGNORED_SEARCH_TERMS:r,MIN_UNPREFIXED_MATCH_LENGTH:i,getAsyncResults:l};Object.defineProperty(t,"IGNORED_SEARCH_TERMS",{get:function e(){return r},set:function e(t){r=t}});Object.defineProperty(t,"_cached_fetch_remote_user_groups",{get:function e(){return s},set:function e(t){s=t}});Object.defineProperty(t,"_shouldDoAsyncSearch",{get:function e(){return d},set:function e(t){d=t}});Object.defineProperty(t,"_getLocalMembers",{get:function e(){return c},set:function e(t){c=t}});Object.defineProperty(t,"_sortResults",{get:function e(){return o},set:function e(t){o=t}});Object.defineProperty(t,"SEARCH_DELAY_MS",{get:function e(){return a},set:function e(t){a=t}});Object.defineProperty(t,"_ensureUserGroupMembersInModelObNumIsKnown",{get:function e(){return b},set:function e(t){b=t}});Object.defineProperty(t,"_getUserGroupMembersNotInModelObCount",{get:function e(){return y},set:function e(t){y=t}});Object.defineProperty(t,"_fetchUserGroups",{get:function e(){return u},set:function e(t){u=t}});return t}});var e=100;var t=25;var r=["the","and"];var i=3;var a=500;var s;var o=function e(r,n,i,a){var s={allow_empty_query:true,frecency:true,limit:t,prefer_exact_match:true};var o=r&&!r.is_im;if(o){s.model_ob=r;s.prefer_channel_members=o}var l=n.replace(/^@/,"");var u=_.trimEnd(l);var d=TS.sorter.search(u,i,s);var c=_.map(d,"model_ob");var m=c;a&&(m=_.sortBy(m,function(e){return e.deleted}));if(i&&i.broadcast_keywords){var f=_.findIndex(m,function(e){return e.is_broadcast_keyword&&e.name===u});if(f>0){var p=m[f];m.splice(f,1);m.unshift(p)}}return m};var l=function e(t,r,i){var a={query:r.replace(/^@/,""),max_api_results:i.limit,include_deleted:i.include_deleted,include_org:true,include_slackbot:true,include_self:true,full_profile_filter:false};i.include_deleted||(a.limit_by_model_relevancy=t);t&&!t.is_im&&(a.determine_membership_for_channel=t.id);var s=[u(r),TS.members.promiseToSearchMembers(a).then(function(e){if(!e||!e.items||!e.items.length)return[];return e.items})];return Promise.all(s).then(function(e){var t=n(e,2),r=t[0],i=t[1];return{usergroups:r||[],members:i}})};function u(e){if(TS.model.user.is_restricted)return Promise.resolve([]);var t=e.replace(/^(@|@)/,"");return TS.searcher.search(t,{usergroups:{include_deleted:false,include_from_another_team:false},tiered:true,sort:{prefer_exact_match:true,frecency:true,allow_empty_query:true},limit:25}).then(function(e){return _.map(e,"model_ob")||[]})}var d=function e(t,n,a){if(0!==t.indexOf("@")){if(-1!==r.indexOf(t))return false;if(t.length<i)return false;if(a.member_prefix_required)return false;return false}if(n&&n.length&&1===n.length&&"@"+n[0].name===t)return false;return true};var c=function e(t,r){var n=TS.members.getActiveMembersWithSelfAndSlackbot();TS.boot_data.page_needs_enterprise&&(n=m(n));r||(n=n.filter(function(e){return TS.utility.members.isMemberRelevantToModel(e,t)}));return n};var m=function e(t){return t.filter(function(e){if(!e.enterprise_user||!e.enterprise_user.teams)return true;return e.enterprise_user.teams.length})};var f=function e(t,r){var n=[];var i=[];var a;var s;a=TS.interop.members.getPrefCompliantMemberName(r,false,false);s=TS.interop.members.getMemberSecondaryName(r);n.push("primary_name");i.push("secondary_name");var o=t&&(!t.is_im||r.is_app_user);var l;var u;var d;if(o){d=TS.interop.membership.getCachedChannelMembershipInfoForUser(t.id,r.id);u=d.is_known;u&&(l=!d.is_member)}var c;if(TS.interop.members.isExternal(r)){var _=TS.teams.getTeamById(r.team_id);_&&(c=TS.interop.rules.teams.getTeamDisplayName(_))}return{is_member:true,member:r,primary_name_classes:n.join(" "),secondary_name_classes:i.join(" "),show_channel_membership:o,member_does_not_belong_to_channel:l,secondary_name:s,primary_name:a,membership_status_is_known:u,team_name:c}};var p=function e(t,r){var n=0;t&&(n=y(r.id,t.id));return{description:r.description||r.name,is_usergroup:true,members_not_in_channel:n,usergroup:r}};var h=function e(t,n){if(!t)return false;if(n)return true;if(t.length<i)return false;if(_.includes(r,t.toLowerCase()))return false;return true};var g=function e(t){var r=Date.now()+t;return function(e){var t=Date.now();var n=Math.max(0,r-t);setTimeout(e,n)}};var S=function e(t,r){if(0===t.indexOf("@"))return 0;if(r)return 0;return a};var T=function e(t,r){if(!r&&!t)return true;if(!r||!t)return false;if(t.length!==r.length)return false;return _.isEqualWith(t,r,function(e,t){return e.id===t.id})};var v={};var b=function e(t,r){var n=TS.interop.userGroups.getUserGroupById(t);var i=false;var a=TS.interop.channels.getPublicChannelById(r,i)||TS.interop.channels.getGroupById(r,i);if(!n||TS.interop.rules.user_groups.isUnknownOrNonExistent(n)||!a)return Promise.resolve();if(_.isUndefined(n.users)){if(!v[t]){v[t]=TS.interop.userGroups.promiseToGetUserGroupMembers(t).then(function(e){if(e&&e.users)return TS.interop.membership.ensureChannelMembershipIsKnownForUsers(a.id,e.users)}).finally(function(){delete v[t]});return v[t]}return v[t]}return TS.interop.membership.ensureChannelMembershipIsKnownForUsers(a.id,n.users)};var y=function e(t,r){var n=TS.interop.userGroups.getUserGroupById(t);var i=_.get(n,"users.length");var a=false;var s=TS.interop.channels.getPublicChannelById(r,a)||TS.interop.channels.getGroupById(r,a);if(!n||TS.interop.rules.user_groups.isUnknownOrNonExistent(n)||!s)return 0;if(_.isUndefined(n.users))return 0;var o=n.users.some(function(e){return!TS.interop.redux.models.membership.isMembershipKnownForUser(TS.redux.getState(),s.id,e)});if(o)return 0;var l=n.users.filter(function(e){var t=TS.interop.membership.getCachedChannelMembershipInfoForUser(s.id,e);return t.is_known&&t.is_member});return i-l.length}})()},b1eP:function(e,t,r){var n=r("lSNA");function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}));r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),true).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}(function(){TS.registerModule("tabcomplete.commands",{type:"commands",getMatch:function e(t,r,n){if(!_.isString(t))return;if(_.isNumber(n)&&0!==n)return;t.startsWith("\uff0f")&&(t="/"+t.substring(1));"/"===t&&TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autcomplete_start",trigger:"slash_command"}}});var i;var a;TS.interop.i18n.deburr(t).replace(/^(\/\S*)$/i,function(e,r,n){a=n;i=t.substr(a,r.length)});if(!i)return;return{match:i,index:a}},getResultAtIndex:function e(t,r){if(!t||!_.isNumber(r))return;var n=_.flatMap(t,"cmds");return _.find(n,{index:r})},getInsertData:function e(t){if(!t)return;TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autcomplete_select",trigger:"slash_command"}}});if("last"===t.type)return TS.interop.texty.convertContentsStringToContents(t.cmd,{highlightWords:TS.interop.prefs.getHighlightWords(),shouldRenderEmojiAsText:TS.interop.rules.emoji.shouldRenderEmojiAsText(),emojiNames:TS.emoji.legacyGetEmojiNames(),useSonicEmoji:TS.boot_data.feature_sonic_emoji,locale:TS.interop.i18n.locale});return{text:t.name}},getNumResults:function e(t){return _.reduce(t,function(e,t){return e+t.cmds.length},0)},search:function t(r,n,i){i(null,e(r,n));var a=TS.cmd_handlers.getCmdAppUserIds();a.length&&TS.interop.membership.ensureChannelMembershipIsKnownForUsers(TS.model.active_cid,a).then(function(t){t&&i(null,e(r,n))})},render:function e(t,r){TS.interop.rules.channels.isExternallySharedChannel(TS.shared.legacyGetActiveModelOb())&&r[0]&&r[0].cmds&&(r[0].cmds=r[0].cmds.map(function(e){switch(e.name){case"/topic":return a({},e,{desc:TS.interop.i18n.t("Set the channel topic for your workspace","cmd_handlers")()});case"/rename":return a({},e,{desc:TS.interop.i18n.t("Rename this channel for your workspace","cmd_handlers")()});default:return e}}));var n=TS.templates.tabcomplete_command_header({text:t});var i=TS.templates.tabcomplete_command_results({results:r});return TS.tabcomplete.renderMenu(n,i)},onSelectedIndexChange:function e(t){TS.tabcomplete.onSelectedIndexChange(t)},onSelect:function e(t,r){"client"===t.type&&TS.interop.clog.track("BUILTIN_CHAT_COMMAND_AUTOCOMPLETE",{locale:TS.interop.i18n.locale,search_term:r,slash_command_canonical_name:t.canonical_name||t.name,slash_command_name:t.name})}});function e(e,n){var i=r(n);var a=TS.interop.i18n.deburr(e.toLowerCase());a=TS.tabcomplete.trimTrailingCharacterModifier(a);a&&(i=i.filter(function(e){if(0===(e.normalized||e.name).indexOf(a))return true;if(e.canonical_name&&0===e.canonical_name.indexOf(a))return true;var t=e.localized_aliases||e.aliases;if(t)return t.some(function(e){var t=TS.interop.i18n.deburr(e);return 0===t.indexOf(a)});return false}));var s=_.map(i,"name");var o=TS.cmd_handlers.sortNames(s);var l;if("/"===a&&TS.chat_history.getCommands().length){var u=TS.chat_history.getCommands()[0].trim();var d=u.split(" ")[0];var c=TS.cmd_handlers.getAvailableUserCmds()[d]&&!n.in_thread;l=o.map(function(e){return _.assign({name:e},TS.cmd_handlers[e])});var m=u;m=TS.interop.texty.convertContentsStringToDisplayString(u,TS.interop.prefs.getHighlightWords());if(c){var f={name:m,cmd:u,type:"last"};l.unshift(f);var p=TS.cmd_handlers.groupCmdsByType(l);var h=TS.interop.i18n.t("Last Used","command_tab_complete")();p.unshift({name:h,id:"last",cmds:[f]});t(p);return p}}else l=o.map(function(e){return _.assign({name:e},TS.cmd_handlers[e])});var g=TS.cmd_handlers.groupCmdsByType(l);t(g);return g}function t(e){var t=0;e.forEach(function(e){e.cmds=e.cmds.map(function(e){var r=_.assign({index:t},e);t+=1;return r})})}function r(e){var t=TS.cmd_handlers.getAvailableUserCmds(e);var r=_.map(t,function(e,t){return _.assign({name:t},e)});return r}})()},bFS3:function(e,t){(function(){TS.registerModule("inline_attachments",{no_scrolling:false,expand_sig:new signals.Signal,collapse_sig:new signals.Signal,shouldExpand:function e(t,r){if(TS.model.expandable_state["attach_"+t+r.from_url])return true;if(false===TS.model.expandable_state["attach_"+t+r.from_url])return false;return true},legacyShouldShow:function e(t,r){if(t.is_share)return true;if(r&&"reply_broadcast"===r.subtype)return true;if("twitter"===t.service_name&&"bot_message"===r.subtype)return true;if(!t.from_url)return true;if(r.standalone_attachment)return true;if(r&&r.text&&-1==r.text.indexOf(t.from_url)){if(!TS.model.ampersands_are_inconsistent_in_from_urls)return true;if(-1==r.text.indexOf(t.from_url.replace(/&/g,"&amp;")))return true}if(TS.prefs.getPref("expand_inline_imgs")){if(t.audio_html)return true;if(t.other_html)return true;if(t.video_html)return true;if(t.image_url)return true;if(t.service_name&&"twitter"===t.service_name.toString().toLowerCase())return true}return!!TS.prefs.getPref("expand_non_media_attachments")},expandAllInCurrent:function e(){TS.inline_attachments.no_scrolling=true;$(".msg_inline_attachment_expander").trigger("click");TS.inline_attachments.no_scrolling=false},collapseAllInCurrent:function e(){$(".msg_inline_attachment_collapser").trigger("click")},expand:function e(t,r){TS.model.expandable_state["attach_"+t+r]=true;TS.storage.storeExpandableState(TS.model.expandable_state);var n="#"+TS.utility.makeSafeForDomId(t);var i=$(n);if(!i.length)return;var a=function e(){return $(this).data("real-src")==r};var s=i.find(".inline_attachment").filter(a);s.removeClass("hidden");i.find(".msg_inline_attachment_expander").filter(a).addClass("hidden");i.find(".msg_inline_attachment_collapser").filter(a).removeClass("hidden");s.css("opacity",0).stop().animate({opacity:1},300);TS.inline_attachments.no_scrolling||s.scrollintoview({duration:200,offset:"bottom",px_offset:-10,direction:"y"});TS.inline_attachments.expand_sig.dispatch(t)},collapse:function e(t,r){TS.model.expandable_state["attach_"+t+r]=false;TS.storage.storeExpandableState(TS.model.expandable_state);var n="#"+TS.utility.makeSafeForDomId(t);var i=$(n);if(!i.length)return;var a=function e(){return $(this).data("real-src")==r};var s=i.find(".inline_attachment").filter(a);s.length||(s=i.find(".msg_inline_attachment_holder").filter(a));s.css("visibility","hidden");i.find(".msg_inline_attachment_expander").filter(a).removeClass("hidden");i.find(".msg_inline_attachment_collapser").filter(a).addClass("hidden");TS.inline_attachments.collapse_sig.dispatch(t);setTimeout(function(){s.addClass("hidden");s.css("visibility","visible")},200)},checkForInlineAttachmentClick:function e(t){if(!t.target)return;var r=$(t.target);var n;var i;var a=r.closest(".message");i=a.data("ts");n=a.attr("id");var s=r.closest(".msg_inline_attachment_expander");if(s.length){t.preventDefault();if(!n)return;TS.inline_attachments.expand(n,s.data("real-src"))}var o=r.closest(".msg_inline_attachment_collapser");if(o.length){t.preventDefault();if(!n)return;TS.inline_attachments.collapse(n,o.data("real-src"))}var l=r.closest(".rest_text_expander");if(l.length){t.preventDefault();var u=l.parent().find(".short_text");var d;var c=l.parent().find(".more_text");if(l.data("show-text")){if(c.length){c.addClass("hidden");d=l.find("a span");l.data("hide-text",d.text());d.text(l.data("show-text"));l.data("show-text","");l.find("a .ts_icon").removeClass("ts_icon_caret_down").addClass("ts_icon_caret_right")}}else{var _=u.attr("data-all-text");if(_){u.html(_);u.data("all-text","")}c.length&&c.removeClass("hidden");if(c.length&&l.data("hide-text")){d=l.find("a span");l.data("show-text",d.text());d.text(l.data("hide-text"));l.data("hide-text","");l.find("a .ts_icon").removeClass("ts_icon_caret_right").addClass("ts_icon_caret_down")}else l.css("display","none")}u.css("opacity",0).transition({opacity:1},300);TS.inline_attachments.rest_texts_expanded[l.attr("id")]=true}var m=r.closest(".delete_attachment_link");if(m.length){t.preventDefault();var f=m.data("attachment-id").toString();var p=a.attr("data-model-ob-id");TS.inline_attachments.promptForDeletingAttachment(p,i,f)}},promptForDeletingAttachment:function e(t,r,n){var i=TS.redux.channels.getEntityById(t);if(!i){TS.warn("missing model_ob");return}if(!n){TS.warn("missing attachment-id");return}var a=i.id;var s=TS.utility.msgs.findMsg(r,t);if(!s){TS.error("Attachment removing failed: msg not found anywhere!");var o=TS.interop.i18n.t("Attachment removing failed!","inline_attachments")();TS.generic_dialog.alert(o);return}var l="";if(TS.model.user.is_admin){var u=_.find(s.attachments,{id:n});if(u&&u.from_url){var d=TS.inline_attachments.makeBlackListSelect(u.from_url);var c=TS.interop.i18n.t("Disable future attachments from this website?","inline_attachments")();l='<p class="large_left_margin '+(d&&"no_bottom_margin")+'">';l+='<label class="checkbox normal" style="font-size: 16px;">';l+='<input id="attachment_blacklist_cb" type="checkbox" class="small_right_margin" />';l+=c;l+="</label>";d&&(l+=d);l+="</p>"}}var m=TS.interop.i18n.t("Are you sure you wish to remove this attachment from the message?","inline_attachments")();var f='<p class="'+(l?"small_bottom_margin":"")+'">'+m+"</p>"+l;TS.generic_dialog.start({title:TS.interop.i18n.t("Remove attachment","inline_attachments")(),body:f,go_button_text:TS.interop.i18n.t("Yes, remove","inline_attachments")(),onShow:function e(){$("#attachment_blacklist_cb").bind("change",function(){var e=!!$("#attachment_blacklist_cb").prop("checked");e?$("#attachment_blacklist_select").prop("disabled",false):$("#attachment_blacklist_select").prop("disabled",true)})},onGo:function e(){if(s.is_ephemeral){s.attachments=TS.inline_attachments.removeAttachmentById(s.attachments,n);TS.utility.msgs.replaceMsg(i,s,false,true)}else{var t=!!$("#attachment_blacklist_cb").prop("checked");var o=t?$("#attachment_blacklist_select").val():"none";var l=t?$("#attachment_blacklist_select").find(":selected").data("url"):"";var u={channel:a,ts:r,attachment:n,blacklist_type:o,blacklist_url:l};TS.dir(0,u);var d=function e(t){if(t){if(TS.web){s.attachments=TS.inline_attachments.removeAttachmentById(s.attachments,n);TS.utility.msgs.replaceMsg(i,s)}}else{var r={title:TS.interop.i18n.t("Couldn't remove attachment","inline_attachments")(),body:TS.interop.i18n.t("Only Org Admins can remove attachments from a shared channel.","inline_attachments")(),cancel_button_text:TS.interop.i18n.t("Close","inline_attachments")(),go_button_text:TS.interop.i18n.t("View {orgName} admins","inline_attachments")({orgName:TS.model.team.name}),onGo:function e(){}};TS.generic_dialog.start(r)}};TS.interop.api.call("chat.deleteAttachment",u).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;d(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;d(i,t,r,n);return{data:t,args:r,request_id:n}})}}})},makeBlackListSelect:function e(t){if(!t)return"";t=_.escape(t).replace("https://","").replace("http://","");var r="";var n=t.split("/");var i=n[0];var a=n[n.length-1];var s=TS.interop.i18n.t("All links from {host}","inline_attachments")({host:i});var o=TS.interop.i18n.t("Just the link {url}","inline_attachments")({url:t});r+='<label class="select small full_width">\r';r+='<select id="attachment_blacklist_select" disabled="disabled" class="small" style="margin-bottom: 4px;">\r';r+='<option value="all" data-url="'+i+'">'+s+"</option>\r";r+='<option value="just" data-url="'+t+'">'+o+"</option>\r";if(a!=i){TS.info(a);var l=n.concat();l.length-=1;var u=l.join("/");if(u!=i){u+="/";var d=TS.interop.i18n.t("All links under {host_path}","inline_attachments")({host_path:u});r+='<option value="under" data-url="'+u+'">'+d+"</option>\r"}}r+="</select>\r";r+="</label>\r";return r},rest_texts_expanded:{},shouldExpandText:function e(t){return!!TS.inline_attachments.rest_texts_expanded[t]},renderStandaloneAttachment:function e(t){TS.inline_attachments.massageAttachment(t,0);if(t.image_url&&!TS.model.inline_imgs[t.from_url]){t.from_url||(t.from_url=t.image_url);TS.inline_imgs.makeInternalInlineImg(t.from_url,{link_url:t.from_url,bytes:t.image_bytes,src:t.image_url,width:isNaN(t.image_width)?null:t.image_width,height:isNaN(t.image_height)?null:t.image_height,should_expand:true})}t.video_html&&!TS.model.inline_videos[t.from_url]&&TS.inline_videos.makeInternalInlineVideo(t.from_url,{src:t.thumb_url,html:t.video_html,proxied_src:t.proxied_thumb_url,title:t.title,display_h:t.video_html_height,display_w:t.video_html_width,thumbnail:{link_url:t.from_url,url:t.thumb_url,height:t.thumb_height,width:t.thumb_width}});var r=TS.interop.datetime.makeTsStamp();var n=TS.templates.builders.buildAttachmentHTML({attachment:t,msg:{enable_slack_action_links:false,text:t.from_url,ts:r,url:t.from_url,standalone_attachment:t.standalone_attachment||false},can_delete:false,maybe_show_file_viewer:false,has_content:TS.utility.attachments.hasContent(t),from_post:true,model_ob:TS.redux.channels.getEntityById(t.channel_id)});var i=TS.templates.makeMsgDomId(r);return'<div class="message standalone-attachment" id="'+i+'" data-ts="'+r+'">'+n+"</div>"},massageAttachment:function e(t,r){t._index=r;"id"in t&&(t.id=t.id.toString());t.text&&(t._short_text=TS.inline_attachments.legacyTruncateAttachmentText(t.text));t._floated_thumb_display_height=75;t._floated_thumb_display_width=75;t.thumb_height&&t.thumb_width&&(t.thumb_height>t.thumb_width?t._floated_thumb_display_width=parseInt(t.thumb_width*(t._floated_thumb_display_height/t.thumb_height),10):t._floated_thumb_display_height=parseInt(t.thumb_height*(t._floated_thumb_display_width/t.thumb_width),10));var n=TS.utility.getImgProxyURL(t.thumb_url,t._floated_thumb_display_width,t._floated_thumb_display_height);n!=t.thumb_url?t.proxied_thumb_url=n:delete t.proxied_thumb_url},legacyTruncateAttachmentText:function e(t){var r=500;var n=3;var i="";var a=0;var s="";var o="";var l="";var u;var d=0;var c=false;for(var _=0;_<t.length;_+=1){u=t.charAt(_);if(o||"<"===u){o+=u;(l||"|"===u)&&(l+=u);if(">"===u){i+=o;a+=l.length-2;a>r&&(c=true);o="";l=""}}else{"\n"===u&&(d+=1);if(d>n+1){s=t.replace(i,"");break}i+=u;a+=1;a>r&&(c=true);if(c&&" "===u){s=t.replace(i,"");break}}}var m=i.trim()==t.trim()?"":i;var f=i.match(/```/g);var p=s.match(/```/g);f&&p&&(m+="```");return m},getAttachmentByFromUrl:function e(t,r){if(!t)return null;for(var n=0;n<t.length;n+=1){if(!t[n]){TS.info(r);TS.dir(0,t);continue}if(!t[n].from_url)continue;if(t[n].from_url==r)return t[n];if(TS.model.ampersands_are_inconsistent_in_from_urls&&t[n].from_url.replace(/&/g,"&amp;")==r)return t[n]}return null},getAttachmentBySlackFileId:function e(t,r){if(!t)return null;if(!r)return null;for(var n=0;n<t.length;n+=1){if(!t[n])continue;if(t[n].slack_file_id==r)return t[n]}return null},removeAttachmentById:function e(t,r){if(!t)return null;var n=[];for(var i=0;i<t.length;i+=1)t[i].id!=r&&n.push(t[i]);return n}})})()},"bdn/":function(e,t){(function(){TS.registerModule("sorter",{onStart:function e(){},search:function e(t,r,n){return c(t,r,n)},printTest:function e(t,r){var n=TS.members.getActiveMembersWithSelfAndSlackbot();var i=_.partition(TS.interop.channels.getUnarchivedPublicAndPrivateChannels(),"is_group");var a=i[0];var s=i[1];var o=TS.redux.channels.dangerouslyGetMpims().filter(TS.interop.rules.channels.isVisibleMpim);var l=_.values(TS.boot_data.other_accounts);var u=TS.interop.userGroups.getActiveUserGroups();var d=TS.model.emoji_map;var c=TS.utility.members.getBroadcastKeywordsForUser();var m=TS.model.NAMED_VIEWS;var f={members:n,channels:s,groups:a,mpims:o,teams:l,usergroups:u,emoji:d,broadcast_keywords:c,views:m};TS.sorter.search(t,f,_.extend({print:true},r))},scoreEmoji:function e(t,r){return s(t,r)},test:function t(){var n={sortFuzzy:h,frecencyBonusPoints:S,getFilteredMatchesForFrecency:m,scoreMember:l,_scoreUserGroup:u,getSubQueryMatchers:o,_scoreEmoji:s,_makeFuzzySearcher:e,_getMetaFieldForId:i,search:c,getNameForComparison:p};Object.defineProperty(n,"_meta_fields",{get:function e(){return r},set:function e(t){r=t}});return n}});var e=function e(t,r){r=r||{};var i=null!=r.fuzzy_limit?r.fuzzy_limit:10;t=TS.interop.i18n.deburr(t.toLocaleLowerCase());var a=t;var c="@"===t.charAt(0);var m="#"===t.charAt(0);var f=":"===t.charAt(0);(c||m||f)&&(t=t.substring(1));var p={fuzzy_limit:i};var h={fuzzy_limit:i,search_forward_only:true};var g=TS.fuzzy.makeFuzzyMatcher(t,p);var S=TS.fuzzy.makeFuzzyMatcher(a,p);var T=TS.fuzzy.makeFuzzyMatcher(t,h);var v=o(t,h);return{query:t,full_query:a,only_channels:m,only_members:c,only_emoji:f,matchesChannel:function e(a){if(TS.interop.rules.channels.isUnknownOrNonExistent(a))return false;if(c||f)return false;if((r.allow_empty_query||m)&&!t){n(a.id,"jumper_score",0);return true}var s=g.score(a.name_normalized||a.name);n(a.id,"jumper_score",s);if(s>i&&r.search_previous_channel_names&&a.previous_names&&a.previous_names.length){var o=_.map(a.previous_names,function(e){return{score:g.score(e),name:e}});n(a.id,"jumper_previous_name_scores",o);var l=_.some(o,function(e){return e.score<=i});var u=l&&s>i;if(u){var d=_.minBy(o,"score");a._jumper_previous_name_match=d&&d.name}else a._jumper_previous_name_match=null;return s<=i||l}a._jumper_previous_name_match&&(a._jumper_previous_name_match=null);return s<=i},matchesGroup:function e(a){if(m||c||f)return false;if(r.allow_empty_query&&!t){n(a.id,"jumper_score",0);return true}var s=g.score(a.name_normalized||a.name);n(a.id,"jumper_score",s);return s<=i},matchesMember:function e(a){if(a.is_non_existent||a.isNonExistent||a.is_unknown||a.isUnknown)return false;if(m||f)return false;if((r.allow_empty_query||c)&&!t){n(a.id,"jumper_score",0);return true}var s=l(a,T,t);n(a.id,"jumper_score",s);return s<=i},matchesMpim:function e(a){if(m||c||f)return false;if(r.allow_empty_query&&!t){n(a.id,"jumper_score",0);return true}var s=TS.mpims.legacyGetMembersInDisplayOrder(a);s=_.chain(s).reject(function(e){return!e||e.is_non_existent||e.isNonExistent||e.is_unknown||e.isUnknown}).value();var o=v.map(function(e){var t=s.map(function(t){return l(t,e)});return _.min(t)});var u=_.sum(o);n(a.id,"jumper_score",u);return u<=i},matchesTeam:function e(t){if(TS.interop.rules.teams.isUnknownOrNonExistent(t))return false;var r=t.team_name||t.name||"";var a=S.score(r.toLocaleLowerCase());n(t.id,"jumper_score",a);return a<=i},matchesUserGroup:function e(a){if(m||f)return false;if((r.allow_empty_query||c)&&!t){n(a.id,"jumper_score",0);return true}var s=u(a,g);n(a.id,"jumper_score",s);return s<=i},matchesEmoji:function e(i){if(m||c)return false;if(r.allow_empty_query&&!t){n(i.id,"emoji_score",0);return true}var a=TS.interop.i18n.deburr(i.display_name||i.name);var o;var l;o=s(a,t);if(i.display_name&&i.display_name!==i.name){l=s(i.name,t);if(Infinity!==l&&l<o){o=l;a=i.name}}if(Infinity!==o){n(i.id,"emoji_score",o);return true}return false},matchesBroadcastKeyword:function e(a){if(m||f)return false;if((r.allow_empty_query||c)&&!t){n(a.id,"jumper_score",0);return true}var s=d(a,g);n(a.id,"jumper_score",s);return s<=i},matchesView:function e(t){if(m||f)return false;var r=g.score(t.name.toLocaleLowerCase());Infinity===r&&t.alt_names&&(r=_.reduce(t.alt_names,function(e,t){return Math.min(e,g.score(t.toLocaleLowerCase()))},r));n(t.id,"jumper_score",r);return r<=i}}};var t=/\s+/g;var a=/[-]+/g;var s=function e(r,n){var i=2;var s=6;if(n.length<3){i=0;s=0}else if(3===n.length){i=1;s=1}else if(4===n.length){i=1;s=5}else s=5;if("ok_hand"===r&&"ok"===n)return 0;var o=TS.interop.searcher.emojiSkiplist;if(o[n]&&-1!==o[n].indexOf(r))return Infinity;var l=Infinity;var u=r.indexOf(n);-1===u&&(u=r.indexOf(n[0]));if(-1!==u){n=n.replace(t,"").replace(a,"_");r=r.replace(a,"_");var d=n.split("");var c=0;var _=0;var m=0;var f=true;for(var p=u;p<r.length;p++){if(r[p]===d[0]){f=true;d.shift();m>_&&(_=m);m=0;if(0===d.length)break}else{f&&(c+=1);f=false;m+=1}if(c>i)return l;if(m>s)return l}if(d.length>0)return l;l=1-n.length/r.length;c>0&&(l+=c)}return l};var o=function e(t,r){var n=t.split(/[,| ]/).filter(function(e){return!!e});return n.map(function(e){e="@"===e.charAt("0")?e.substring(1):e;return TS.fuzzy.makeFuzzyMatcher(e,r)})};var l=function e(t,r,n){var i;if(TS.utility.queryIsMaybeSelf(n)&&t.is_self)return 0;var a=Infinity;var s=Infinity;var o=Infinity;var l=Infinity;a=r.score(t._real_name_lc);t._real_name_lc!==t._real_name_normalized_lc&&(s=r.score(t._real_name_normalized_lc));if(t._display_name_lc){o=r.score(t._display_name_lc);t._display_name_lc!==t._display_name_normalized_lc&&(l=r.score(t._display_name_normalized_lc))}i=Math.min(a,s,o,l);return i};var u=function e(t,r){var n=Infinity;var i=Infinity;n=r.score(t.name);i=r.score(t.handle);var a=Math.min(n,i);return a};var d=function e(t,r){var n=Infinity;var i=Infinity;n=r.score(t.name);t.ms_name!==t.name&&(i=r.score(t.ms_name));if(!t.alias)return Math.min(n,i);var a=Infinity;a=r.score(t.alias);var s=Math.min(n,i,a);return s};var c=function t(r,a,o){var l=e(r,o||{});var u=[];var d=[];var c=[];var f=[];var p=[];var T=[];var v=[];var b=[];var y=[];var w=[];var k=[];var x=[];var C=[];var M=o.match_emoji_keywords?TS.emoji.findByKeyword(r):[];var I=[];a.members=a.members||[];a.channels=a.channels||[];a.groups=a.groups||[];a.mpims=a.mpims||[];a.teams=a.teams||[];a.usergroups=a.usergroups||[];a.emoji=a.emoji||[];a.broadcast_keywords=a.broadcast_keywords||[];a.views=a.views||[];a.enterprise_channels=a.enterprise_channels||[];a.enterprise_groups=a.enterprise_groups||[];a.app_actions=a.app_actions||[];TS.telemeter.mark("ts-sorter-matching-mark");if(!l.only_channels&&!l.only_emoji&&!l.only_app_actions){d=a.members.filter(function(e){if(e.is_non_existent||e.isNonExistent||e.is_unknown||e.isUnknown)return false;_.isString(TS.interop.members.getMemberProfileFieldDisplayName(e))||TS.interop.utility.getLogger({getState:TS.redux.getState}).error(e.id+": memberProfileFieldDisplayName is not a string.");_.isString(TS.interop.members.getMemberRealName(e))||TS.interop.utility.getLogger({getState:TS.redux.getState}).error(e.id+": memberRealName is not a string");if(o.prefer_exact_match&&l.query&&(TS.interop.members.getMemberProfileFieldDisplayName(e)&&_.isString(TS.interop.members.getMemberProfileFieldDisplayName(e))&&TS.interop.members.getMemberProfileFieldDisplayName(e).toLocaleLowerCase()===l.query||TS.interop.members.getMemberRealName(e)&&_.isString(TS.interop.members.getMemberRealName(e))&&TS.interop.members.getMemberRealName(e).toLocaleLowerCase()===l.query)){n(e.id,"jumper_exact_match",true);u.push(e);return false}n(e.id,"jumper_exact_match",false);return l.matchesMember(e)});w=a.usergroups.filter(function(e){if(o.prefer_exact_match&&e.handle===l.query||e.name_lc===l.query){u.push(e);return false}return l.matchesUserGroup(e)});x=a.broadcast_keywords.filter(function(e){if(o.prefer_exact_match&&e.name===l.query){u.push(e);return false}return l.matchesBroadcastKeyword(e)})}if(!l.only_members&&!l.only_emoji&&!l.only_app_actions){var E=function e(t){if(TS.interop.rules.channels.isUnknownOrNonExistent(t))return;if(o.prefer_exact_match&&t.name===l.query){n(t.id,"jumper_exact_match",true);u.push(t);return}n(t.id,"jumper_exact_match",false);var r=l.matchesChannel(t);if(!r)return;t.is_member?c.push(t):TS.interop.rules.channels.isArchived(t)?p.push(t):f.push(t)};a.channels.forEach(E);a.enterprise_channels.forEach(E)}if(!l.only_channels&&!l.only_members&&!l.only_emoji&&!l.only_app_actions){var A=function e(t){if(o.prefer_exact_match&&t.name===l.query){n(t.id,"jumper_exact_match",true);u.push(t);return}n(t.id,"jumper_exact_match",false);var r=l.matchesGroup(t);if(!r)return;TS.interop.rules.channels.isArchived(t)?v.push(t):T.push(t)};a.groups.forEach(A);a.enterprise_groups.forEach(A);b=a.mpims.filter(function(e){return l.matchesMpim(e)})}y=a.teams.filter(function(e){if(TS.interop.rules.teams.isUnknownOrNonExistent(e))return false;if(!_.isObject(e))return false;var t=e.team_name||e.name||"";if(o.prefer_exact_match&&t.toLocaleLowerCase()===l.full_query){n(e.id,"jumper_exact_match",true);u.push(e);return false}n(e.id,"jumper_exact_match",false);var r=l.matchesTeam(e);return r});l.only_channels||l.only_members||l.only_app_actions||(k=a.emoji.filter(function(e){if(o.prefer_exact_match&&((e.display_name||e.name)===l.query||"ok_hand"===e.name&&"ok"===l.query)){n(e.id,"jumper_exact_match",true);n(e.id,"emoji_exact_match",true);u.push(e);return false}n(e.id,"jumper_exact_match",false);if(o.match_emoji_keywords&&M.length){var t=TS.emoji.nameToBaseName(e.display_name||e.name);if(-1!==M.indexOf(t)){n(e.id,"emoji_score",s(t,r));return true}}return l.matchesEmoji(e)}));l.only_channels||l.only_emoji||l.only_members||(I=a.app_actions.filter(function(e){if(!_.isObject(e))return false;var t=e.name;if(o.prefer_exact_match&&t.toLocaleLowerCase()===l.full_query){n(e.id,"jumper_exact_match",true);u.push(e);return false}n(e.id,"jumper_exact_match",false);return false}));TS.telemeter.measureAndClear("ts-sorter-matching-mark","ts-sorter-matching");TS.telemeter.mark("ts-sorter-sorting-mark");var P;var O;var F;P=d.concat(c,T,b,k,w,x,C,I);o.flat||P.sort(_.partial(h,true));O=f.concat(y);o.flat||O.sort(_.partial(h,true));F=v.concat(p);o.flat||F.sort(_.partial(h,true));var H=P.concat(O,F);o.flat&&H.sort(_.partial(h,true));var j=H;if(o.prefer_exact_match&&u.length>0){var D;u.sort(_.partial(g,true));(D=j).unshift.apply(D,u)}if(o.frecency){o.normalize=true;TS.telemeter.mark("ts-sorter-frecency-sort-mark");j=TS.ui.frecency.query(j,r,S,o)}o.limit&&(j=_.take(j,o.limit));if(o.frecency){j=m(j);TS.telemeter.measureAndClear("ts-sorter-frecency-sort-mark","ts-sorter-frecency-sort")}if(o.print){var $="\n";_.forEach(j,function(e){var t=o.frecency?e.model_ob:e;o.frecency&&($+="["+e.score+"] ");null!=i(t.id,"jumper_score")&&($+="["+i(t.id,"jumper_score")+"] ");t.is_mpim?$+=TS.mpims.legacyGetDisplayName(t):t.is_channel?$+="#"+t.name:t.is_group?$+=t.name:t.team_name?$+=t.team_name:t.is_usergroup?$+="@"+t.name:t.presence?$+="@"+t.name:$+=e.model_ob?e.model_ob.name:e.name;$+="\n"});TS.info($)}TS.telemeter.measureAndClear("ts-sorter-sorting-mark","ts-sorter-sorting");return j};var m=function e(t){var r=[];TS.boot_data.page_needs_enterprise&&(t=_.uniqBy(t,function(e){return e.id}));_.forEach(t,function(e){var t;if(TS.interop.utility.looksLikeMemberId(e.id)){var n=TS.interop.members.getMemberById(e.id);n&&r.push({model_ob:n,score:e.score});return}var i=0===e.id.indexOf("BK");var a=0===e.id.indexOf("V");t=i?TS.model.getBroadcastKeywordById(e.id):a?TS.model.getViewById(e.id):f(e.id);t&&r.push({model_ob:t,score:e.score})});return r};var f=function e(t){if("E"===t[0])return TS.emoji.getEmojiById(t);if("S"===t[0])return TS.interop.userGroups.getUserGroupById(t);if("T"===t[0])return TS.redux.teams.getTeamById(t);return TS.redux.channels.getEntityById(t)};var p=function e(t){var r;r=t.is_mpim?_.toLower(TS.mpims.legacyGetDisplayName(t)):t.is_usergroup?t.handle||t.name:TS.interop.members.isMember(t)?TS.interop.members.getPrefCompliantMemberName(t):t._name_lc?t._name_lc:t.team_name?t.team_name.toLocaleLowerCase():t.name;return r};var h=function e(t,r,n){if(r.is_mpim&&!n.is_mpim)return 1;if(n.is_mpim&&!r.is_mpim)return-1;if(!r.is_mpim&&!n.is_mpim){var a=i(r.id,"jumper_score")-i(n.id,"jumper_score");if(0!==a)return a}if(r.is_mpim&&n.is_mpim){var s=i(r.id,"jumper_score")-i(n.id,"jumper_score");if(0!==s)return s;var o=TS.mpims.getMemberCount(r)-TS.mpims.getMemberCount(n);if(0!==o)return o}return g(t,r,n)};var g=function e(t,r,n){var i=p(r);var a=p(n);if(t)return TS.interop.i18n.sorter(i,a);if(i>a)return 1;if(a>i)return-1;return 0};var S=function e(t,r){if(t.is_mpim){if(r.prefer_mpims_with_active_members){var n=TS.mpims.legacyGetMembersInDisplayOrder(t);if(_.some(n,function(e){return e.deleted||e.is_suspended}))return TS.ui.frecency.bonus_points.mpim_with_deactivated_member;return 0}return 0}var a=0;if(i(t.id,"jumper_exact_match")){a+=TS.ui.frecency.bonus_points.exact_match;i(t.id,"emoji_exact_match")&&(a+=TS.ui.frecency.bonus_points.exact_match)}else i(t.id,"emoji_score")?a+=T(t,"emoji_score",TS.ui.frecency.bonus_points.emoji_match):TS.interop.rules.channels.isArchived(t)||TS.interop.rules.members.isDeleted(t)||TS.interop.rules.members.isSuspended(t)||(a+=T(t,"jumper_score",TS.ui.frecency.bonus_points.fuzzy_match));i(t.id,"jumper_previous_name_scores")&&(a+=TS.ui.frecency.bonus_points.matches_previous_name);r.prefer_channel_members&&t.presence&&r.model_ob&&v(t.id,r.model_ob)&&(a+=TS.ui.frecency.bonus_points.member_of_this_channel);t.is_starred&&(a+=TS.ui.frecency.bonus_points.starred_channel);if(TS.interop.members.isMember(t)){var s=TS.redux.channels.getImByMemberId(t.id);s&&s.is_starred&&(a+=TS.ui.frecency.bonus_points.starred_channel)}t.is_emoji&&("thumbsup"!==t.name&&"point_up"!==t.name||(a+=1));r.self_first&&t.is_self&&(a=Infinity);if(t.is_channel||t.is_group){TS.interop.rules.channels.isArchived(t)&&(a+=TS.ui.frecency.bonus_points.archived_channel_or_group);t.is_channel&&r.prefer_channels_user_belongs_to&&(TS.interop.rules.channels.isArchived(t)||v(TS.model.user.id,f(t.id))||(a+=TS.ui.frecency.bonus_points.not_in_channel));TS.interop.rules.channels.isFromAnotherTeam(t)&&(a+=TS.ui.frecency.bonus_points.foreign_channel_or_group)}TS.interop.members.isMember(t)&&(TS.interop.rules.members.isDeleted(t)||TS.interop.rules.members.isSuspended(t))&&(a+=TS.ui.frecency.bonus_points.deactivated_member);(t.is_usergroup||t.is_broadcast_keyword)&&(a+=TS.ui.frecency.bonus_points.usergroup_or_keyword);return a};var T=function e(t,r,n){var a=i(t.id,r);if(!_.isFinite(a))return 0;var s=Math.pow(.5,a);return Math.round(n*s)};var v=function e(t,r){if(r.is_channel&&t===TS.model.user.id)return r.is_member;var n=TS.interop.membership.getCachedChannelMembershipInfoForUser(r.id,t);return n.is_known&&n.is_member}})();var r={};var n=function e(t,n,i){if(!t||!n)return;r[t]||(r[t]={});r[t][n]=i};var i=function e(t,n){if(!t||!n)return;if(!t||!r[t])return;return r[t][n]}},cDf5:function(e,t){function r(e){r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function e(t){return typeof t}:function e(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};return r(e)}function n(t){"function"===typeof Symbol&&"symbol"===r(Symbol.iterator)?e.exports=n=function e(t){return r(t)}:e.exports=n=function e(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":r(t)};return n(t)}e.exports=n},e9QI:function(e,t){(function(){TS.registerModule("menu.file",{onStart:function e(){},reported_no_file_reader:false,startWithNewFileOptions:function e(t,r,n){TS.ui.react_file_menu.showFileMenu(t,r,n)},onOneDriveDocumentTypeItemClick:function e(t){TS.log(9999,"boop");TS.log(9999,t)},onGDriveCreateComplete:function r(){e.find(".ts_icon").remove();e.toggleClass("active",false).append(t)},startWithFileFilter:function e(t,r){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.file.clean();var n="all";TS.model.file_list_types&&(n=TS.model.file_list_types[0]);var i=TS.model.team.plan;TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_file_filter_items({active_type:n,show_email_item:i}));r?TS.menu.$menu_items.on("click.menu","li",TS.menu.file.onSearchFileFilterItemClick):TS.menu.$menu_items.on("click.menu","li",TS.menu.file.onFileFilterItemClick);TS.menu.start(t);r?TS.menu.positionAt($("#search_file_list_heading"),0,20):TS.menu.positionAt($("#file_list_container"),8,44)},onFileFilterItemClick:function e(t){t.preventDefault();TS.menu.file.end()},onSearchFileFilterItemClick:function e(t){t.preventDefault();TS.search.setFiletypeFilter($(this).data("filetype"));TS.menu.file.end()},startWithFileMemberPromiseFilter:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.file.clean();TS.menu.$menu.append(TS.templates.menu_file_member_filter());TS.menu.$menu.addClass("member_file_filter_menu");TS.menu.start(t);TS.menu.positionAt($("#file_list_toggle_user"),0,35);var r=new TS.SearchableMemberList({$container:$(".member_file_filter_menu .searchable_member_list"),id:"member_file_filter_menu",show_filter_bar:false,compact_results:true,prevent_member_click_handler:true,suppress_presence:true});r.showInitial();r.member_clicked_sig.add(function(){TS.menu.file.end()})},onFileMemberFilterItemClick:function e(t){t.preventDefault();TS.menu.file.end()},onSearchFileMemberFilterItemClick:function e(t){t.preventDefault();var r=$(t.currentTarget).data("member-id");TS.search.setMember(r);TS.menu.file.end()},file_list_menu_up:false,startWithFileActions:function e(t,r){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.file.clean();var n=TS.files.getFileById(r);if(!n)return;var i=TS.files.getFileActions(n);if(TS.boot_data.feature_file_threads){i.comment=false;i.rxn_file=false;i.pin_file=false;i.unpin_file=false}var a=$(t.target);var s=a.closest(".file_actions");i.comment&&s.data("exclude-comment")&&(i.comment=false);i.download&&s.data("exclude-download")&&(i.download=false);i.open_original&&s.data("exclude-original")&&(i.open_original=false);i.rxn_file&&s.data("exclude-rxn")&&(i.rxn_file=false);i.pin_file&&(s.data("exclude-pin")||s.data("exclude-pin-file"))&&(i.pin_file=false);i.unpin_file&&(s.data("exclude-pin")||s.data("exclude-unpin-file"))&&(i.unpin_file=false);i.edit&&s.data("exclude-edit")&&(i.edit=false);i.edit_title&&s.data("exclude-edit-title")&&(i.edit_title=false);i.print&&s.data("exclude-print")&&(i.print=false);i.create_public_link&&s.data("exclude-create-public-link")&&(i.create_public_link=false);i.revoke_public_link&&s.data("exclude-revoke-public-link")&&(i.revoke_public_link=false);i.star=true;i.open_in_flexpane=true;s.data("include-open-file-page")&&(i.open_file_page=true);s.data("include-view-public-link")&&(i.view_public_link=true);var o=a.closest(".file_list_item").length>0;if(o){"details"!==TS.model.ui_state.flex_name&&(i.share=false);TS.menu.file.file_list_menu_up=true}var l=a.closest(".inline_file_preview_container, .file_container");if(l.length>0){l.addClass("file_menu_open");i.new_window=false}TS.menu.$menu_header.addClass("hidden").empty();var u=false;(i.edit||i.create_public_link||i.revoke_public_link||i.print||i.save_to_dropbox||i.refresh)&&(u=true);var d={file:n,actions:i,is_refreshing:TS.files.waiting_for_refresh[n.id],model_ob:TS.shared.legacyGetActiveModelOb(),show_workflow_divider:u,external_file_author:TS.files.isFileAuthorExternal(n)};if(TS.model.unread_view_is_showing){d.source_model_ob_id=a.closest(".unread_group").data("modelId");d.source_model_ob_id&&(d.model_ob=TS.redux.channels.getEntityById(d.source_model_ob_id))}TS.menu.$menu_items.html(TS.templates.menu_file_action_items(d));TS.boot_data.feature_fix_files&&TS.menu.$menu.addClass("no_icons");TS.web&&TS.menu.$menu_items.on("click.menu","li",TS.menu.file.onFileActionClickWeb);TS.menu.start(t);a.closest(".file_list_item").addClass("active");TS.menu.positionAt(a,-(TS.menu.$menu.width()+6),0);TS.menu.keepInBounds()},onFileActionClickClient:function e(t){var n=$(this).attr("id");var i=$(this).data("rxn-key");var a=TS.files.getFileById($(this).data("file-id"));var s=TS.shared.legacyGetActiveModelOb();var o=$(this).data("sourceModelId");TS.model.unread_view_is_showing&&o&&(s=TS.redux.channels.getEntityById(o));if(!a){TS.error("no file id:"+$(this).data("file-id"));return}if("edit_file_snippet"===n){if(!a.is_truncated){t.preventDefault();TS.ui.snippet_dialog.startEdit(a.id)}}else if("edit_file_post"===n);else if("edit_file_arugula"===n);else if("edit_file_title"===n){t.preventDefault();TS.boot_data.feature_file_threads?TS.redux.dispatch(TS.interop.redux.actions.openRenameFileDialog({file:a})):TS.files.editFileTitle(a.id)}else if("create_public_link"===n){t.preventDefault();if(TS.prefs.getTeamPref("disallow_public_file_urls")){var l=TS.interop.i18n.t("An administator has disabled public file URL creation. You will not be able to create a public URL for this file.","menu_file")();TS.generic_dialog.alert(l);return}TS.files.createPublicURL(a,function(e,t){if(e){TS.model.previewed_file_id&&$("#file_preview_scroller").find(".file_actions_link").scrollintoview({duration:500,offset:"top",px_offset:-50});$(".file_public_link_"+a.id).highlightText();TS.ui.file_share.fileShowPublicUrlDialog(t.file)}})}else if("revoke_public_link"===n){t.preventDefault();TS.ui.file_share.fileRevokePublicLink(a.id)}else if("view_public_link"===n){t.preventDefault();TS.ui.file_share.fileShowPublicUrlDialog(a)}else{if("refresh_file"===n){t.preventDefault();TS.files.refreshFile(a.id);TS.menu.$menu.find("#refresh_file .item_label").text(TS.interop.i18n.t("Refreshing...","menu_file")()).end();return}if("download_file"===n);else if("open_original_file"===n);else if("comment_file"===n){t.preventDefault();TS.model.previewed_file_id==a.id&&TS.utility.contenteditable.focus($("#file_comment"))}else{if("save_to_dropbox"===n){var u=function e(t,r){t&&Dropbox.save(r.url,a.name)};return TS.interop.api.callExpedited("files.getTempURL",{file:a.id}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;u(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;u(i,t,r,n);return{data:t,args:r,request_id:n}})}if("rxn_file"===n){t.preventDefault();TS.ui.react_emoji_menu.start({e:t,rxn_key:i})}else if("share_private_file"===n){t.preventDefault();r();TS.ui.share_dialog.start(a.id)}else if("pin_file"===n&&s){t.preventDefault();TS.pins.startPinFile(a.id,s)}else if("unpin_file"===n&&s){t.preventDefault();TS.pins.unPinFile(a.id,s)}else if("copy_file_link"===n){t.preventDefault();TS.clipboard.writeText(a.permalink);var d=TS.interop.members.getMemberById(a.user);var c={};if(d&&d.is_bot){var _=d.profile.bot_id;var m=TS.interop.bots.getBotById(_);c.app_id=m?m.app_id:"";c.bot_id=_}TS.interop.clog.track("MSG_LINK_COPY",c)}else{if("star_file"!==n){t.preventDefault();TS.warn("not sure what to do with clicked element id:"+n);return}t.preventDefault();TS.stars.checkForStarClick(t)}}}TS.menu.file.end()},onFileActionClickWeb:function e(t){var r=$(this).attr("id");var n=$(this).data("rxn-key");var i=TS.files.getFileById($(this).data("file-id"));var a=TS.shared.legacyGetActiveModelOb();if(!i){TS.error("no file id:"+$(this).data("file-id"));return}if("share_file"===r){t.preventDefault();TS.ui.share_dialog.start(i.id)}else if("share_private_file"===r){t.preventDefault();TS.ui.share_dialog.start(i.id)}else if("edit_file_snippet"===r);else if("edit_file_post"===r);else if("edit_file_space"===r||"open_new_window"===r);else if("edit_file_title"===r);else if("delete_file"===r){t.preventDefault();TS.web.file.deleteFile(i.id)}else if("create_public_link"===r){t.preventDefault();if(!TS.prefs.getTeamPref("disallow_public_file_urls")){var s=function e(t,r){if(t){var n=$(".file_public_link_shared");n.slideToggle(100);TS.files.upsertAndSignal({id:i.id,public_url_shared:true},"createPublicLink");0===n.length&&TS.ui.file_share.fileShowPublicUrlDialog(i)}else if(r.error&&"not_allowed"===r.error){TS.prefs.setTeamPrefLocal("disallow_public_file_urls",true);var a=TS.interop.i18n.t("An administator has disabled public file URL creation. You will not be able to create a public URL for this file.","menu_file")();TS.generic_dialog.alert(a)}};TS.interop.api.callExpedited("files.sharedPublicURL",{file:i.id}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;s(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;s(i,t,r,n);return{data:t,args:r,request_id:n}})}}else if("revoke_public_link"===r){t.preventDefault();TS.web.file?TS.web.file.revokePublicURL(i):TS.ui.file_share.fileRevokePublicLink(i.id)}else if("view_public_link"===r){t.preventDefault();TS.ui.file_share.fileShowPublicUrlDialog(i)}else{if("refresh_file"===r){t.preventDefault();TS.files.refreshFile(i.id);TS.menu.$menu.find("#refresh_file .item_label").text("Refreshing...").end();return}if("download_file"===r);else if("print_file"===r){window.print();t.preventDefault()}else if("open_original_file"===r);else if("comment_file"===r){t.preventDefault();TS.utility.contenteditable.focus($("#file_comment"))}else{if("save_to_dropbox"===r){var o=function e(t,r){t&&Dropbox.save(r.url,i.name)};return TS.interop.api.callExpedited("files.getTempURL",{file:i.id}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;o(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;o(i,t,r,n);return{data:t,args:r,request_id:n}})}if("rxn_file"===r){t.preventDefault();TS.ui.react_emoji_menu.start({e:t,rxn_key:n})}else if("pin_file"===r&&a){t.preventDefault();TS.pins.startPinFile(i.id,a)}else if("unpin_file"===r&&a){t.preventDefault();TS.pins.unPinFile(i.id,a)}else if("copy_file_link"===r){t.preventDefault();TS.clipboard.writeText(i.permalink);var l=TS.interop.members.getMemberById(i.user);var u={};if(l&&l.is_bot){var d=l.profile.bot_id;var c=TS.interop.bots.getBotById(d);u.app_id=c?c.app_id:"";u.bot_id=d}TS.interop.clog.track("MSG_LINK_COPY",u)}else if("open_file_page"!==r){t.preventDefault();TS.warn("not sure what to do with clicked element id:"+r);return}}}TS.menu.file.end()},clean:function e(){TS.menu.clean()},end:function e(){TS.menu.end()}});var e=$('[data-js="primary_file_button"]');var t=e.find(".ts_icon_plus_thick");var r=function e(){if(!TS.ui.fs_modal.isShowing())return;var t=true;TS.ui.fs_modal.close(t)}})()},fK9Z:function(e,t){(function(){TS.registerModule("membership",{membership_counts_need_refetch_sig:new signals.Signal,onStart:function t(){var r=Infinity;TS.members.changed_deleted_sig.add(e,this,r)}});var e=function e(){TS.interop.memberCounts.markAllMemberCountsAsStale()}})()},ftdm:function(e,t){(function(){TS.registerModule("redux.all_unreads",{updateHasUnreads:function e(t){if("boolean"!==typeof t)return;TS.redux.dispatch(TS.interop.redux.features.allUnreads.updateHasUnreads(t))},updateHasUnreadThreads:function e(t){if("boolean"!==typeof t)return;TS.redux.dispatch(TS.interop.redux.features.allUnreads.updateHasUnreadThreads(t))},updateThreadsMentionCount:function e(t){if(!_.isInteger(t))return;TS.redux.dispatch(TS.interop.redux.features.allUnreads.updateThreadsMentionCount(t))}})})()},g247:function(e,t,r){var n=r("lSNA");function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}));r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),true).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}(function(){TS.registerModule("utility.calls_state_logging",{logState:function t(r,n){switch(r){case"idle":TS.utility.calls_state_logging.transition("CALLS_IDLE");break;case"start_call":TS.utility.calls_state_logging.transition("CALLS_START_CALL");break;case"get_regions":TS.utility.calls_state_logging.transition("CALLS_GET_REGIONS");break;case"get_server":TS.utility.calls_state_logging.transition("CALLS_GET_SERVER");break;case"initialize_janus":TS.utility.calls_state_logging.transition("CALLS_INITIALIZE_JANUS");break;case"join_room":TS.utility.calls_state_logging.transition("CALLS_JOIN_ROOM");break;case"in_room":TS.utility.calls_state_logging.transition("CALLS_IN_ROOM");break;case"publisher_connected":TS.utility.calls_state_logging.transition("CALLS_PUBLISHER_CONNECTED");break;case"disconnect_janus":TS.utility.calls_state_logging.transition("CALLS_DISCONNECT_JANUS");break;case"disconnect_for_reconnect_janus":TS.utility.calls_state_logging.transition("CALLS_DISCONNECT_FOR_RECONNECT_JANUS");break;case"reconnect":e+=1;TS.utility.calls_state_logging.transition("CALLS_RECONNECT");break;case"terminal":TS.utility.calls_state_logging.transition("CALLS_TERMINAL",{terminal_type:n.terminal_type});break;default:break}},transition:function n(i,s){s=s||{};TS.utility.calls_log.logEventInfo({event:"StateTransition",value:a({state:i,reconnect_attempt:e,prev_state:t,reachability:window.navigator.onLine},s)});TS.interop.clog.track(i,a({},r(),{},s));t=i},error:function n(i,s){s=s||{};TS.utility.calls_log.logEventWarn({event:"StateError",value:a({state:i,reconnect_attempt:e,prev_state:t,reachability:window.navigator.onLine},s)});TS.interop.clog.track(i,a({},r(),{},s));t=i},event:function n(i,s){s=s||{};TS.utility.calls_log.logEventInfo({event:"StateEvent",value:a({state:i,reconnect_attempt:e,current_state:t,reachability:window.navigator.onLine},s)});TS.interop.clog.track(i,a({},r(),{},s))}});var e=0;var t="";var r=function r(){return{reconnect_attempt:e,prev_state:t,room_id:TS.calls?TS.calls.getCallState().room_id:"",num_participants:TS.calls?TS.calls.participants.getAllParticipants().length:0,reachability:window.navigator.onLine}}})()},gYX6:function(e,t){(function(){TS.registerModule("redux.channels",{onStart:function n(){e=true;r=TS.interop.rules.channels.isIm||t;Object.defineProperty(TS.model,"channels",{get:function e(){return g("channels")}});Object.defineProperty(TS.model,"groups",{get:function e(){return g("groups")}});Object.defineProperty(TS.model,"mpims",{get:function e(){return g("mpims")}});Object.defineProperty(TS.model,"ims",{get:function e(){return g("ims")}})},clearAllShowInListEvenThoughUnreadsFlags:function e(){TS.interop.channels.clearAllShowInListEvenThoughUnreadsFlags()},dangerouslyGetEntityById:function e(t){return a(t)},dangerouslyGetPublicChannels:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.includeFromAnotherTeam,n=void 0!==r&&r;return TS.interop.channels.getPublicChannels({includeFromAnotherTeam:n})},dangerouslyGetPrivateChannels:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.includeFromAnotherTeam,n=void 0!==r&&r;return TS.interop.channels.getPrivateChannels({includeFromAnotherTeam:n})},dangerouslyGetMpims:function e(){return TS.interop.channels.getMpims()},dangerouslyGetIms:function e(){return TS.interop.channels.getIms()},setMarkingState:function e(t,r){TS.redux.dispatch(TS.interop.redux.models.channelsMeta.needsApiMarking.setMarkingState({id:t,needsApiMarking:r}))},clearAllMarkingFlags:function e(){TS.redux.dispatch(TS.interop.redux.models.channelsMeta.needsApiMarking.clearAllMarkingFlags())},clearMarkingFlagsForIds:function e(t){TS.redux.dispatch(TS.interop.redux.models.channelsMeta.needsApiMarking.clearMarkingFlagsForIds(t))},getAllIdsNeedingMarking:function e(){return l()},getAllUnmutedIdsNeedingMarking:function e(){return d()},getAllMutedIdsNeedingMarking:function e(){return u()},bulkAddEntities:function e(t){TS.interop.channels.bulkAddChannels({channels:t})},bulkUpdateEntities:function e(t){TS.interop.channels.bulkUpdateChannels({channels:t})},addEntity:function e(t){if(!t)return;if(t._is_interop_channel_object){var r="Attempting to add a channel interop object, not a channel. Only raw channel objects can be added. Take this to #dhtml.";if(h())throw new Error(r);TS.error(r);return}TS.interop.channels.addChannel({channel:t})},removeEntity:function e(t){if(!t||!t.id)return;TS.interop.channels.removeChannels({ids:[t.id]})},replaceEntity:function e(t){if(!t)return;if(t._is_interop_channel_object){var r="Attempting to replace a channel object with a channel interop object. If you are trying to update a property for this channel you should change the property directly. Take this to #dhtml.";if(h())throw new Error(r);TS.error(r);return}TS.redux.channels.addEntity(t)},updateMutedChannels:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];var r=_.reduce(t,function(e,t){e[t]=true;return e},{});TS.redux.dispatch(TS.interop.redux.models.channelsMeta.mutedChannels.setMutedChannels(r))},getMutedChannelsAsArray:function e(){return _.reduce(c(),function(e,t,r){e.push(r);return e},[])},setMutedChannelById:function e(t,r){if(!t||_.isUndefined(r))return;var n={id:t,muted:r};TS.redux.dispatch(TS.interop.redux.models.channelsMeta.mutedChannels.setMutedChannel(n))},isChannelMutedById:function e(t){if(!t)return false;return n(t)},getEntityById:function e(t,r){return TS.interop.channels.getEntityById(t,r)},getPublicChannelByName:function e(t){var r=s(t);if(TS.interop.rules.channels.isPublicChannel(r))return r},getPublicOrPrivateChannelByName:function e(t){var r=s(t);if(TS.interop.rules.channels.isPublicChannel(r)||TS.interop.rules.channels.isPrivateChannel(r))return r},getChannelByName:function e(t){return s(t)},getImByMemberId:function e(t){var n=o(t);var i=TS.redux.channels.getEntityById(n);if(r(i))return i;return null},test:function e(){var t={};return t}});var e=false;function t(){TS.interop.utility.getLogger({getState:TS.redux.getState}).error("missing-isIm: onStartDidRun="+e+", i("+_.has(window,"TS.interop")+"), i.r("+_.has(window,"TS.interop.rules")+"), i.r.c("+_.has(window,"TS.interop.rules.channels")+"), i.r.c.i("+_.has(window,"TS.interop.rules.channels.isIm")+")");var t=Date.now()-(window.localStorage.isImBugLastEncountered||0);localStorage.isImBugLastEncountered=Date.now();t>6e4&&TS.reload(null,"isIM bug detected");throw new Error("TS.interop.rules.channels.isIm not present on page, not sure how to proceed")}var r=t;var n=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.mutedChannels.isChannelMutedById");var i=TS.interop.channels.getAllChannels;var a=TS.interop.channels.getChannelById;var s=TS.interop.channels.getChannelByName;var o=TS.interop.channels.getImIdByMemberId;var l=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.needsApiMarking.getAllIdsNeedingMarking");var u=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.needsApiMarking.getAllMutedIdsNeedingMarking");var d=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.needsApiMarking.getAllUnmutedIdsNeedingMarking");var c=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.mutedChannels.getMutedChannels");var m;var f={};var p={channels:void 0,groups:void 0,mpims:void 0,ims:void 0};var h=function e(){return TS.boot_data&&("dev"===TS.boot_data.version_ts||"local_js"===TS.boot_data.version_ts)};var g=function e(t){var n=i();var a;switch(t){case"channels":a=function e(t){return t.is_channel&&!t.fromAnotherTeam};break;case"groups":a=function e(t){return t.is_group&&!t.is_mpim&&!t.fromAnotherTeam};break;case"ims":a=r;break;case"mpims":a=function e(t){return t.is_group&&t.is_mpim};break;default:}if(n===m&&f[t])return f[t];if(n!==m){m=n;f={}}f[t]=_.filter(n,a);f[t]=_.map(f[t],TS.redux.channels.interop.maybeWrapEntity);p[t]||(p[t]=_.defer(function(){delete f[t];delete p[t];m=null}));return f[t]}})()},gj8S:function(e,t){(function(){TS.registerModule("ui.admin_user_groups",{user_groups_fetched:new signals.Signal,onStart:function e(){$("body").on("click",'[data-action="admin_user_groups_modal"]',function(){s()});$("body").on("click",'[data-action="admin_user_groups_modal_new"]',function(){TS.ui.admin_user_groups.add()})},start:function e(){s()},add:function e(){s();i=true;v()},editInfo:function e(t){s();i=true;v(t)},editMembers:function e(t){s();i=true;C(t,false)},disable:function e(t){s();i=true;S(t,"disable_user_group")},enable:function e(t){s();i=true;S(t,"enable_user_group")},remove:function e(t){s();i=true;S(t,"delete_user_group")},interopFunctions:function e(t){var r=t.action,n=t.userGroup;switch(r){case"add":v();break;case"delete":S(n,"delete_user_group");break;case"enable":S(n,"enable_user_group");break;case"disable":S(n,"disable_user_group");break;case"editInfo":v(n);break;case"editMembers":C(n,false);break;default:}},test:function e(){var t={_isFullLocalMember:O};Object.defineProperty(t,"_isFullLocalMember",{get:function e(){return O},set:function e(t){O=t}});return t}});var e;var t;var r;var n=[];var i=false;var a=false;var s=function e(){var t=TS.templates.user_group_modal({show_info_pane:!TS.prefs.getPref("hide_user_group_info_pane"),show_user_groups_add:TS.permissions.members.canCreateAndDeleteUserGroups()});var r={body_template_html:t,onShow:o,onCancel:l};r.full_height_contents=true;r.modal_contents_container_class="overflow_hidden";j="";TS.interop.userGroups.setSearchQuery(j);TS.ui.fs_modal.start(r)};var o=function n(){e=$("#all_user_groups");t=$("#user_groups_form_div");r=$("#user_groups_toggle_div");h();$("#user_groups_create_btn").on("click",function(){v()})};var l=function a(){e=null;t=null;r=null;i=false;D=null;$(window).off("resize",p);TS.ui.admin_user_groups.user_groups_fetched.dispatch(n);F(TS.model.user_groups);H()};var u=function e(t){t&&t.preventDefault();i?TS.ui.fs_modal.close():h();F(TS.model.user_groups)};var d=function e(){i?TS.ui.fs_modal.close():h();TS.ui.admin_user_groups.user_groups_fetched.dispatch(n);F(TS.model.user_groups)};var c=function e(){if(!i){TS.ui.fs_modal.bindBackButton(h);TS.ui.fs_modal.showBackButton()}};var m=function e(t){if(!n||!t)return false;for(var r=0,i=n.length;r<i;r+=1)if(n[r].auto_type===t)return n[r];return false};var f=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t){var n=$("#user_group_name_input").val()||"";var i=$("#user_group_handle_input").val()||"";r.group_name=n;r.group_handle=i;if(r.error&&("forbidden_handle"===r.error||"forbidden_name"===r.error)){var a=n+i;if(a){var s=m("owner");var o=m("admin");var l=!!a.match(/admins/i);var u=!!a.match(/owners/i);r.suggest_auto_group=true;r.can_create_auto_owners=u&&TS.model.user.is_admin&&!s;r.can_enable_auto_owners=u&&s&&s.date_delete;r.can_create_auto_admins=l&&TS.model.user.is_admin&&!o;r.can_enable_auto_admins=l&&o&&o.date_delete}}$("#user_group_alerts").html(TS.templates.user_group_alerts(r));return true}return false};var p=function e(){var t=$("#user_groups_header");if(!t.length)return;var r=$("#user_groups_list_scroller");if(!r.length)return;var n=t[0].offsetHeight;var i=$(window).height();var a=250;var s=.15*i;var o=Math.max(a,i-n-s);r.css("height",o)};var h=function n(){var i=$("#user_groups_list_div");if(i&&!a){TS.interop.mountUserGroupsList(TS.boot_data.team_id,i[0],{isLegacy:true,isUserGroupBrowser:true,includeDeactivated:true,onClearSearch:function e(){return P()}});i.addClass("ug_modern_list");a=true}e.removeClass("hidden");t.addClass("hidden");r.addClass("hidden");g();TS.ui.fs_modal.hideBackButton()};var g=function r(){$(window).on("resize",p);p();$("#user_group_modal_search").on("keydown keyup change",A);D=$("#user_groups_header .user_groups_search .icon_close");D.off("click").on("click",P);e.off("click");var n=function e(t,r){if(t){i=false;h(r.subteam&&r.subteam.id?r.subteam.id:null)}};var a={owners:{create:function e(){TS.interop.api.call("subteams.createAuto",{type:"owner"}).then(function(e){var t=e.data,r=e.args,i=e.request_id;var a=true;n&&n(a,t,r,i);return{data:t,args:r,request_id:i}}).catch(function(e){var t=e.data,r=e.args,i=e.request_id;var a=false;n&&n(a,t,r,i);return{data:t,args:r,request_id:i}})},enable:function e(){var t=m("owner");if(!t)return;TS.redux.dispatch(TS.interop.userGroups.enableUserGroup({subteam:t.id})).then(function(e){n(true,e)})}},admins:{create:function e(){TS.interop.api.call("subteams.createAuto",{type:"admin"}).then(function(e){var t=e.data,r=e.args,i=e.request_id;var a=true;n&&n(a,t,r,i);return{data:t,args:r,request_id:i}}).catch(function(e){var t=e.data,r=e.args,i=e.request_id;var a=false;n&&n(a,t,r,i);return{data:t,args:r,request_id:i}})},enable:function e(){var t=m("admin");if(!t)return;TS.redux.dispatch(TS.interop.userGroups.enableUserGroup({subteam:t.id})).then(function(e){n(true,e)})}}};t.off("click").on("click","a.user_group_auto_action",function(e){var t=$(e.target);var r=t.data("auto-type");var n=t.data("auto-action");if(a[r]&&a[r][n]){a[r][n]();e.preventDefault();return false}})};var S=function t(n,i){if(!n){TS.warn("Cannot switch toggle view to undefined User Group");return}H();r.html(TS.templates.user_group_toggle({action:i,user_group:n}));r.find('[data-action="cancel"]').on("click",u);r.find(".user_group_toggle_btn").on("click",function(){var e=$(this).data("action");if(!_.includes(["enableUserGroup","disableUserGroup","deleteUserGroup"],e))return;TS.redux.dispatch(TS.interop.userGroups[e]({subteam:n.id})).then(function(){"enableUserGroup"===e&&T(n);d()}).catch(function(e){var t=e.data;return f(false,t)})});r.find('[data-action="switch_delete_user_group"]').on("click",function(e){e.preventDefault();t(n,"delete_user_group")});e.addClass("hidden");r.removeClass("hidden");c()};var T=function e(t){var r=TS.interop.userGroups.getUserGroupById(t.id);r&&!TS.interop.rules.user_groups.isUnknownOrNonExistent(r)||TS.interop.userGroups.upsertUserGroup(t);TS.interop.userGroups.searchLocalUserGroups()};var v=function r(n){H();t.html(TS.templates.user_group_settings_form(n));$("#user_group_default_channels").lazyFilterSelect(k(n));x(n);e.addClass("hidden");t.removeClass("hidden");c()};var b=function e(t,r){if(!t||!r)return false;var n=t&&t.id;var i=r.prefs.channels.concat(r.prefs.groups);return _.includes(i,n)};var y=function e(t,r){var n=_.get(r,"prefs.channels",[]);var i=n.length?TS.shared.ensureModelObsArePresent(n):Promise.resolve();var a={prefer_exact_match:false,frecency:false,allow_empty_query:true,prefer_channels_user_belongs_to:false,flat:true};var s={channels:{include_archived:false},groups:{include_archived:false},sort:!!t&&a};return i.then(function(){return TS.searcher.search(t,s)}).then(function(e){return t?e:TS.sorter.search(t,e,a)})};var w=function e(t){return function(e){return y(e,t).then(function(e){var r=_.map(e,function(e){var r=e.id;var n=b(e,t);return{model_ob:e,lfs_id:r,preselected:n}});return{replace_all_items:true,all_items_fetched:true,items:r}})}};var k=function e(t){return{data_promise:w(t),template:function e(t){var r=t.model_ob;var e="";e+=TS.interop.rules.channels.isPublicChannel(r)?"#":'<ts-icon class="ts_icon_lock ts_icon_inherit"></ts-icon>';e+=_.escape(r.name);TS.interop.rules.channels.isOrgShared(r)?e+=' <ts-icon class="ts_icon_shared_channel ts_icon_inherit"></ts-icon>':TS.interop.utility.isModelObjectExternal(r)&&(e+=TS.templates.shared_channels_icon({model_ob:r,tooltip:true,connectedTeamIds:TS.interop.rules.channels.getConnectedTeamIds(TS.redux.getState(),r),inherit:true}));return new Handlebars.SafeString(e)},placeholder_text:""}};var x=function e(r){var n;var i;var a;if(r){n=TS.interop.userGroups.updateUserGroup;i=false;a=r.id}else{n=TS.interop.userGroups.createUserGroup;i=true}var s=$("#user_group_handle_input");s.on("input",function(){$(this).closest(".handle_input").toggleClass("empty",!this.value.length)});t.find(".user_group_settings_form").on("submit",function(e){e.preventDefault();var t=$('input[name="name"]').val();var r=$('input[name="handle"]').val();var s=$('input[name="description"]').val();var o=$("#user_group_default_channels").lazyFilterSelect("value");o=_.map(o,"model_ob.id");var l={name:t,handle:r,description:s,channels:o};a&&(l.subteam=a);TS.redux.dispatch(n(l)).then(function(e){T(e.subteam);i?C(e.subteam,i):d();TS.user_groups.updated_info_sig.dispatch(e.subteam.id)}).catch(function(e){var t=e.data;return f(false,t)})});t.find(".user_group_settings_form").on("reset",u);var o=$("#save_user_group");var l=$("#user_group_name_input");function c(){var e=l.val();var t=s.val();_.isEmpty(e)||_.isEmpty(t)?o.attr("disabled",true):o.removeAttr("disabled")}if(o.length&&l.length&&s.length){l.on("change",c);l.on("keyup",c);s.on("change",c);s.on("keyup",c);c()}};var C=function r(n,i){var a=!!n.is_external||!!n.auto_type;var s=function e(){t.html(TS.templates.user_group_members_form({is_new:i,is_locked:a,user_group:n}))};var o=function r(){var a=$("#member_count");var s=n.user_count||0;var o=function e(){var t=$(i?"#create_group":"#save_group");t.length&&(s<1?t.prop("disabled",true):t.prop("disabled",false))};var l={approx_item_height:36,template:function e(t){var r=TS.templates.user_group_invite_member_small(t);return new Handlebars.SafeString(r)},onItemAdded:function e(){s+=1;a.html(s);o()},onItemRemoved:function e(){s-=1;a.html(s);o()},filter:function e(t,r){var n=t.member;"@"===r.charAt(0)&&(r=r.substr(1));var i=new RegExp("^"+TS.utility.regexpEscape(r),"i");var a=new RegExp("(-|_|\\+|\\s|\\.|@)"+TS.utility.regexpEscape(r),"i");return TS.utility.members.checkMemberMatch(n,i)||TS.utility.members.checkMemberMatch(n,a)},disabled:!!n.is_external||!!n.auto_type,data_promise:M(n)};$("#user_group_members_select").lazyFilterSelect(l);E(n);e.addClass("hidden");t.removeClass("hidden");H();o()};if(i){s();TS.ui.fs_modal.hideBackButton();o()}else{var l=function e(){s();c();o()};if(!TS.user_groups.legacyNeedsToFetchMembership(n)){var u=_.get(n,"users",[]);return TS.interop.members.ensureMembersArePresent(u).then(l)}TS.interop.userGroups.getUserGroupMembers(n.id,function(e){if(e&&e.users){n=e;var t=_.get(n,"users",[]);return TS.interop.members.ensureMembersArePresent(t).then(l)}})}};var M=function e(t){var r=true;return function(e,n){"@"===e.charAt(0)&&(e=e.substring(1));var i=false;if(r){r=false;_.get(t,"users.length")&&(i=true)}if(i){var a=t.users.map(function(e){return TS.interop.members.getMemberById(e)});a.sort(TS.interop.members.memberSorterByName);var s=a.map(function(e){if(!e)return{};return{member:e,lfs_id:String(e.id),preselected:true}});return Promise.resolve(s)}if(n>0)return Promise.resolve([]);var o={query:e,include_org:false,include_slackbot:false,include_self:true,full_profile_filter:false,include_bots:true};var l=I(o);return l}};var I=function e(t){return Promise.resolve().then(function(){return TS.members.promiseToSearchMembers(t).then(function(e){var t=[];t=""===e.query?TS.utility.teams.getMembersForTeam(TS.model.team):e.items;e.items=t.filter(O).map(function(e){return{member:e,lfs_id:String(e.id)}});return e})})};var E=function e(r){t.find(".user_group_members_form").on("submit",function(e){e.preventDefault();var t=$("#user_group_members_select").lazyFilterSelect("value");t=t.map(function(e){return e.member.id});TS.redux.dispatch(TS.interop.userGroups.updateMembersOfUserGroup({subteam:r.id,users:t})).then(function(e){d();TS.user_groups.updated_info_sig.dispatch(e.subteam.id)}).catch(function(e){var t=e.data;f(false,t)})});t.find(".user_group_members_form").on("reset",function(e){e.preventDefault();u(e)})};var A=function e(t){var r=$(t.target);var n=r.val();if(n!==j){j=n;D.toggleClass("hidden",""===n);TS.interop.userGroups.setSearchQuery(j)}};var P=function e(){var t=$("#user_group_modal_search");j="";t.val("");setTimeout(function(){t.focus()},0);D.addClass("hidden");TS.interop.userGroups.setSearchQuery(j)};var O=function e(t){if(!t)return false;if(TS.interop.rules.members.isMemberOnTeam(t,TS.model.team.id)&&!t.deleted&&!t.is_ultra_restricted&&!t.is_restricted&&!(t.is_bot||TS.interop.rules.members.isSlackbot(t)))return true;return false};var F=function e(t){var r=$("#user_groups_tab .count");r.html(t.length)};var H=function e(){a=false;var t=$("#user_groups_list_div");TS.interop.unmountUserGroupsList(t[0])};var j;var D})()},gm7A:function(e,t){(function(){TS.registerModule("ims",{switched_sig:new signals.Signal,message_received_sig:new signals.Signal,message_removed_sig:new signals.Signal,message_changed_sig:new signals.Signal,marked_sig:new signals.Signal,closed_sig:new signals.Signal,unread_changed_sig:new signals.Signal,unread_highlight_changed_sig:new signals.Signal,opened_sig:new signals.Signal,msg_not_sent_sig:new signals.Signal,onStart:function e(){TS.prefs.display_real_names_override_changed_sig.add(r);TS.prefs.team_display_real_names_changed_sig.add(r);TS.members.changed_profile_sig.add(t)},legacyAddMsg:function e(t,r){var n=false;var i=TS.interop.channels.getImById(t,n);if(!i){TS.error('unknown im "'+t+'"');return}if(!TS.redux.messages.addMessage(r,true))return;if(TS.interop.messages.isReply(r)&&!TS.shared.legacyAddMsg(i,r))return;TS.ims.message_received_sig.dispatch(i,r);if(!i.is_open){var a={return_im:true,reason:"TS.ims.legacyAddMsg"};a.channel=i.id;TS.interop.api.call("conversations.open",a).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;TS.ims.legacyOnOpened&&TS.ims.legacyOnOpened(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;TS.ims.legacyOnOpened&&TS.ims.legacyOnOpened(i,t,r,n);return{data:t,args:r,request_id:n}})}},legacyRemoveMsg:function e(t,r){var n=false;var i=TS.interop.channels.getImById(t,n);if(!i){TS.error('unknown im "'+t+'"');return}TS.redux.messages.removeMessage(r);if(TS.interop.messages.isReply(r)){i._archive_msgs&&TS.utility.msgs.spliceMsg(i._archive_msgs,r);var a=i.msgs;TS.utility.msgs.spliceMsg(a,r)}TS.ims.message_removed_sig.dispatch(i,r)},legacyOnSendMsg:function e(t,r){var n=false;var i=TS.interop.channels.getImById(r.SENT_MSG.channel,n);if(!i){TS.error("unknown im? "+r.SENT_MSG.channel);return}TS.shared.legacyOnSendMsg(t,r,i,TS.ims)},legacyStartImById:function e(t,r,n,i){var a=TS.shared.legacyGetActiveModelOb();a&&TS.redux.dispatch(TS.interop.redux.features.messageEdit.stopEditingMessagesInChannel());var s=false;var o=TS.interop.channels.getImById(t,s);if(!o){TS.error(t+" not an im");return}var l="";TS.ims.legacyDisplayIm(o.id,r,l,i);if(o.is_open){n&&TS.shared.legacySendMsg(o.id,$.trim(n));return Promise.resolve()}TS.redux.dispatch(TS.interop.redux.features.pendingOpenChannel.addPendingOpenChannel({memberId:o.user,msgText:n}));return TS.interop.channels.openConversationBetweenMembers({channel:o.id,reason:"TS.ims.legacyStartImById"}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;if(TS.ims.legacyOnOpened){TS.ims.legacyOnOpened(i,t,r,n);r.return_im&&TS.interop.channels.setConversationOpen(o.id,o.user)}return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;TS.ims.legacyOnOpened&&TS.ims.legacyOnOpened(i,t,r,n);return{data:t,args:r,request_id:n}})},legacyStartImByMemberId:function e(t,r,n,i){TS.console.info("TS.ims.legacyStartImByMemberId",t);var a=TS.shared.legacyGetActiveModelOb();a&&TS.redux.dispatch(TS.interop.redux.features.messageEdit.stopEditingMessagesInChannel());var s=TS.interop.members.getMemberById(t);var o=TS.interop.rules.members.isUnavailable(TS.redux.getState(),s);if(o){TS.redux.dispatch(TS.interop.redux.actions.showUnavailableMemberToast({teamId:s.team_id}));return Promise.resolve(false)}var l=TS.redux.channels.getImByMemberId(t);TS.ui.fs_modal.is_showing&&TS.ui.fs_modal.close();if(l){var u="";TS.ims.legacyDisplayIm(l.id,r,u,i);if(l.is_open){n&&TS.shared.legacySendMsg(l.id,$.trim(n));return Promise.resolve()}}TS.redux.dispatch(TS.interop.redux.features.pendingOpenChannel.addPendingOpenChannel({memberId:t,msgText:n}));return TS.interop.channels.openConversationBetweenMembers({memberIds:[t],reason:"TS.ims.legacyStartImByMemberId"}).then(function(e){var r=e.data,n=e.args,i=e.request_id;var a=true;if(TS.ims.legacyOnOpened){TS.ims.legacyOnOpened(a,r,n,i);if(n.return_im&&TS.redux.channels.getImByMemberId(t)){var s=TS.redux.channels.getImByMemberId(t);TS.interop.channels.setConversationOpen(s.id,t)}}return{data:r,args:n,request_id:i}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;TS.ims.legacyOnOpened&&TS.ims.legacyOnOpened(i,t,r,n);return{data:t,args:r,request_id:n}})},promiseToStartImByMemberId:function e(t){var r;r=TS.redux.dispatch(TS.interop.actions.displayModelOrViewById({id:t})).catch(function(e){e&&"editing-message"===e.message&&TS.ui.fs_modal.close();throw e});var n=function e(){var r=TS.shared.legacyGetActiveModelOb();return r&&r.is_im&&r.user===t};if(n())return Promise.resolve();return r.then(function(){if(n())return Promise.resolve();var e;return new Promise(function(t){e=function e(){if(n())return t()};TS.ims.switched_sig.add(e)}).timeout(3e4).finally(function(){TS.redux.dispatch(TS.interop.redux.features.pendingOpenChannel.clearPendingOpenChannel({memberId:t}));TS.ims.switched_sig.remove(e)})}).catch(_.noop)},legacyOnOpened:function e(t,r,n){if(!t)return;n.return_im&&r.channel&&TS.interop.channels.upsertChannel(r.channel)},legacyDisplayIm:function e(t,r,n,a){TS.console.info("TS.ims.legacyDisplayIm",t);TS.telemeter.mark("start_channel_change_"+t);TS.redux.dispatch(TS.interop.redux.models.channelsMeta.prqMetrics.updateChannelLastFocus({lastFocus:TS.interop.redux.models.window.getWindowLastFocusEvent(TS.redux.getState()),objId:t}));var s=false;var o=TS.interop.channels.getImById(t,s);if(!o){TS.error('im "'+t+'" unknown');return}TS.utility.msgs.maybeClearPrevLastRead();TS.utility.msgs.maybeClearPrevLastRead(o);var l=a||TS.model.active_im_id;if(t==l){n&&TS.shared.legacySendMsg(o.id,$.trim(n));TS.console.info("TS.ims.legacyDisplayIm: im_id == TS.model.active_im_id",t,TS.model.active_im_id);return}TS.has_pri[i]&&TS.log(i,"legacyDisplayChannel (im): "+t);n&&TS.shared.legacySendMsg(o.id,$.trim(n))},legacyMarkMostRecentReadMsg:function e(t,r){if(!t){TS.error("im unknown");return}TS.interop.channels.markMostRecentMsgRead({channelId:t.id,reason:r})},markReadMsg:function e(t,r,n){TS.redux.dispatch(TS.interop.actions.markLastRead({id:t,ts:r,reason:n}))},getDisplayNameOfUserForIm:function t(r){return e(r)},getDisplayNameOfUserForImLowerCase:function e(t){return TS.interop.members.getPrefCompliantMemberNameLowerCase(TS.interop.members.getMemberById(t.user))},getImByUsername:function e(t){if(TS.boot_data.feature_deprecate_get_member_by_name){TS.interop.utility.getLogger({getState:TS.redux.getState}).error("Tried to get IM by username","get_member_by_name",{subtype:"getImByUsername"});return}var r=TS.interop.members.getMemberByName(t);if(!r)return null;return TS.redux.channels.getImByMemberId(r.id)},getFirstOpenIm:function e(){var t=TS.model.ims;var r;if(!t)return null;for(var n=0;n<t.length;n+=1){r=t[n];if(r.is_open)return r}return null}});var e=function e(t){if(t._display_name)return t._display_name;var r=TS.interop.members.getMemberById(t.user);if(!r)return t.name;var n=TS.interop.members.getPrefCompliantMemberName(r);if(n===t.user||n===r.id)return t.name;t._display_name=n;return t._display_name};var t=function e(t){var r=_.find(TS.model.ims,{user:t.id});r&&n(r)};var r=function e(){TS.model.ims.forEach(n)};var n=function e(t){t._display_name=void 0};var i=999})()},j9dp:function(e,t,r){var n=r("cDf5");(function(){TS.registerModule("templates.builders",{debug_items:{},debug_items_index:0,buildStarComponents:function e(r,n,i,a){return t(r,n,i,a)},fileHTML:function e(t,r){r=r||{};var n=TS.utility.members.getEntityFromFile(t);var i=TS.files.getFileActions(t);var a;var s="hosted"===t.mode||"external"===t.mode;var o={member:n,file:t,for_search:r.for_search,is_enterprise:r.is_enterprise,for_files_list:!r.for_share_dialog,show_channel_name:r.show_channel_name,icon_class:TS.utility.getImageIconClass(t,"thumb_80"),is_email:"email"===t.mode,is_space:"space"===t.mode,is_post:"post"===t.mode,is_docs:"docs"===t.mode,is_snippet:"snippet"===t.mode,is_hosted_or_external:s,has_image:s&&t.thumb_80&&!t.has_rich_preview,can_share:!!i.share&&"docs"!==t.mode,feature_file_threads:TS.boot_data.feature_file_threads};TS.interop.files.isHiddenByStorageLimit(t)&&_.assign(o,TS.files.getHiddenFileTemplateArgs(r.viewContext));o.supports_line_clamp=TS.environment.supports_line_clamp;"external"===t.mode&&(o.external_filetype_html=TS.templates.builders.makeExternalFiletypeHTML(t));if("email"===t.mode){o.to_more_count=t.to.length-1;o.cc_more_count=t.cc.length-1}a=TS.templates.file_list_item(o);return a},buildReplyBarHTML:function e(t,r){var n={msg:t,model_ob:r,conversation_permalink:TS.utility.msgs.constructConversationPermalink(r,t.thread_ts)};var i=t.replies;if(t.reply_users){n.num_replies=t.reply_count;n.first_repliers=_.chain(t.reply_users).take(5).map(function(e){var t=TS.interop.utility.looksLikeBotId(e);if(t)return TS.interop.bots.getBotById(e);return TS.redux.members.getPotentiallyUnknownMemberById(e)}).compact().value();n.additional_reply_count=t.reply_users_count-n.first_repliers.length}else if(i&&i.length){n.num_replies=i.length;var a=_.chain(i).uniqBy("user").map(function(e){var t=TS.interop.utility.looksLikeBotId(e.user);if(t)return TS.interop.bots.getBotById(e.user);return TS.redux.members.getPotentiallyUnknownMemberById(e.user)}).compact().value();n.first_repliers=_.take(a,5);n.additional_reply_count=a.length-n.first_repliers.length}if(n.num_replies){var s=t.latest_reply?t.latest_reply:i&&i.length&&_.last(i).ts;var o=TS.interop.datetime.toDateObject(s);TS.interop.datetime.isSameDay(o,new Date)?1===n.num_replies?n.last_reply_at=TS.interop.i18n.t("Today at {time}","threads")({time:TS.interop.datetime.toTime(s,{do24hrTime:TS.utility.date.do24hrTime()})}):n.last_reply_at=TS.interop.i18n.t("Last reply today at {time}","threads")({time:TS.interop.datetime.toTime(s,{do24hrTime:TS.utility.date.do24hrTime()})}):1===n.num_replies?n.last_reply_at=TS.interop.datetime.toTimeAgo(s):n.last_reply_at=TS.interop.i18n.t("Last reply {time_ago}","threads")({time_ago:TS.interop.datetime.toTimeAgo(s)})}return TS.templates.message_reply_bar(n)},formatSoundUrl:function e(t,r){return""},buildAttachmentActions:function e(t,r,n){var i=t.actions.map(function(e){switch(e.type){case"button":return TS.templates.builders.buildAttachmentActionButtonHTML(e,n);case"select":return TS.templates.builders.buildAttachmentActionSelectHTML(e,n,r,t.id);default:break}return});var a=i.join("");return a},buildAttachmentHTML:function e(t){var r=t.msg_dom_id||TS.templates.makeMsgDomId(t.msg.ts);var n=t.attachment;var i=t.model_ob||TS.shared.legacyGetActiveModelOb();if(TS.templates.builders.shouldDoSimpleAttachment(n,t.msg)){if(n.video_html)return TS.templates.builders.buildInlineVideoTogglerAndDiv(n.from_url,r);if(n.image_url)return TS.templates.builders.buildInlineImgTogglerAndDiv(n.from_url,r,t);if(n.audio_url)return" "+TS.templates.builders.formatSoundUrl(n,t.msg)}if(n.color){"number"===typeof n.color&&(n.color=n.color.toString());if(n.color.indexOf)n.color=n.color.replace(/#/g,"");else{TS.warn("msg "+t.msg.ts+" has an invalid (non string) color:"+n.color+" (removed in client)");delete n.color}}var a=[];var s=[];if(n.fields){var o;var l;var u;for(var d=0;d<n.fields.length;d+=1){l=true;o=n.fields[d];u&&o.short&&u.short&&u._new_row&&(l=false);o._new_row=l;u=o;o.short?a.push(o):s.push(o)}}var c=!n._always_expand&&n._short_text&&!TS.inline_attachments.shouldExpandText(TS.templates.makeMsgAttachmentTextExpanderDomId(t.msg.ts,n._index));var m=!!n.more;var f=n.from_url||n.ts_link||n.title_link||n.author_link;var p="reply_broadcast"===_.get(t.msg,"subtype");var h=n.thumb_link||f;var g=false;i?false!==t.can_delete&&(g=(n.id||0===n.id)&&(n.from_url||t.msg.text)&&(TS.model.user.is_admin&&!i.is_im||TS.model.user.id==t.msg.user)&&"pinned_item"!==t.msg.subtype&&!p):TS.warn("need to get model_ob passed in here somehow! for expanding messages in activity feed");var S=n.thumb_url&&!n.image_url&&!n.video_html&&!n.audio_html;var T=S?n.proxied_thumb_url||n.thumb_url:null;var v=false;var b="";if(n.is_msg_unfurl){var y=TS.utility.msgs.getMsg(n.ts,i.msgs);if(y&&y.pinned_to&&y.pinned_to.length>0){v=_.some(y.pinned_to,function(e){return e===i.id});v&&!p&&(b=TS.templates.builders.buildPinInfoHtml(y))}}var w=false;p&&(w=n.ts?TS.interop.datetime.toTime(n.ts,{do24hrTime:TS.utility.date.do24hrTime()}):TS.interop.datetime.toTime(t.msg.ts,{do24hrTime:TS.utility.date.do24hrTime()}));var k=n.from_url&&t.has_container;p&&(k=true);var x={is_text_collapsed:c,has_more:m,attachment:n,attachment_meta:w,pin_html:b,short_fields:a,long_fields:s,msg:t.msg,msg_dom_id:r,real_src:TS.utility.attachments.getMediaSource(n),is_standalone:!t.msg.text||t.msg.ignore_if_attachments_supported||!n.pretext,show_fields_table:"0"!=TS.qs_args.show_fields_table,can_delete:g,thumb_link:h,small_thumb_url:T,show_fallback:TS.model.show_attachment_fallback,enable_slack_action_links:true===t.enable_slack_action_links,render_file_threads:n.is_msg_unfurl&&TS.interop.messages.shouldRenderFileThread(n)};if(!t.from_post){var C="web"===TS.boot_data.app||true!==t.enable_slack_action_links;var M;C&&(M="web"===TS.boot_data.app?"ARCHIVES":TS.shared.legacyGetActiveModelOb()&&TS.shared.legacyGetActiveModelOb().is_channel&&!TS.shared.legacyGetActiveModelOb().is_member?"CHANNEL_PREVIEW":"OTHER");x=_.assign(x,{attachment:n,has_actions:!!(!_.isEmpty(n.actions)||!_.isEmpty(n.legacy_actions)),has_source:_.some(n._source),has_border:t.has_border,has_indent:n.indent,has_container:t.has_container,has_media:t.show_media_caret,has_text_content:!!(n.text||n.title),has_thumb:!!S,has_footer:!!(n.footer||n.footer_icon||n.ts||n._attribution)&&!p,disable_actions:C,disable_actions_reason:M,border_color:n.color&&"#"+n.color||null,break_border:t.break_border,caret_location:TS.utility.attachments.getMediaCaretLocation(n)});x.applied_classes=TS.utility.getAppliedClasses({inline_attachment:true,standalone:x.is_standalone,has_thumb:x.has_thumb,can_delete:x.can_delete,clickable:k,message_unfurl:n._unfurl_type_message,reply_broadcast:p,is_pinned:v});if(x.has_footer&&x.attachment.is_msg_unfurl){var I=TS.utility.attachments.getSlackMessageFooterText(x.attachment,x.msg);I&&(x.attachment.footer=I)}return TS.templates.message_attachment(x)}var E=true;var A="";if(t.show_initial_caret||t.show_media_caret){var P=TS.utility.attachments.getMediaType(n);switch(P){case"video":var O=TS.model.inline_videos[n.from_url||n.thumb_url];if(O){var F=true;A=TS.templates.builders.buildInlineVideoToggler(n.from_url||n.thumb_url,r,F);E=TS.inline_videos.shouldExpand(r,O)}break;case"audio":var H=TS.model.inline_audios[n.audio_html||n.audio_url];if(H){A=TS.templates.builders.buildInlineAudioToggler(n.audio_html||n.audio_url,r);E=TS.inline_audios.shouldExpand(r,H)}break;case"other":var j=TS.model.inline_others[n.other_html];if(j){A=TS.templates.builders.buildInlineOtherToggler(n.other_html,r);E=TS.inline_others.shouldExpand(r,j)}break;case"image":var D=TS.model.inline_imgs[n.from_url||n.image_url];if(D){var $=!t.show_media_caret;A=TS.templates.builders.buildInlineImgToggler(n.from_url||n.image_url,r,$);E=TS.inline_imgs.shouldExpand(r,D)}break;default:var L=TS.model.inline_attachments[n.from_url];if(L){A=TS.templates.builders.buildInlineAttachmentToggler(n.from_url,r);E=TS.inline_attachments.shouldExpand(r,L)}else TS.warn("no inline_attachment for "+n.from_url);break}}_.assign(x,{initial_caret_html:t.show_initial_caret?new Handlebars.SafeString(A):"",media_caret_html:t.show_media_caret?new Handlebars.SafeString(A):"",expand_media:!t.show_media_caret||E,expand_it:!t.show_initial_caret||E,bg_color:n.color||"e3e4e6",thumb_at_top:true,ts_link:f,small_thumb:S,max_width_class:S?"right_thumb_max_w":"",show_action_links:true===t.enable_slack_action_links,has_content:t.has_content});return TS.templates.spaces_attachment(x)},buildAttachmentActionButtonHTML:function e(t,r){r=true===r;var n={_disabled:r,_loading:false,id:"",name:"",style:"default",text:"",value:""};var i={default:"",primary:"btn_primary",danger:"btn_danger"};var a=t.clicked&&t.clicked_text?t.clicked_text:t.text;var s=TS.emoji.graphicReplace(a);var o=_.merge({},n,t,{btn_class:i[t.style],current_text:a,formatted_text:new Handlebars.SafeString(s)});t.url&&(o.url=TS.interop.url.simpleIsUrl(t.url)?t.url:"#");o.data_qa_value="button-"+o.name.replace("_","-");return TS.templates.attachment_actions_button(o)},buildAttachmentActionSelectHTML:function e(t,r,n,i){var a=TS.attachment_actions.select.getActionModel(t,r);if(a._disabled){var s='ts-message[data-ts="'+n+'"]';var o='[data-attachment-id="'+i+'"]';var l='[data-action-id="'+t.id+'"]';var u=[s,o,l].join(" ");var d=$(u).next(".lazy_filter_select");if(!d.length)return"";var c=d.clone().addClass("disabled");return c[0].outerHTML}return TS.templates.attachment_actions_select(a)},shouldDoSimpleAttachment:function e(t,r){var n=false;if(r.standalone_attachment)return false;if((t.image_url||t.audio_url)&&t.from_url){if(r&&r.text){-1!=r.text.indexOf(t.from_url)&&(n=true);TS.model.ampersands_are_inconsistent_in_from_urls&&-1!=r.text.indexOf(t.from_url.replace(/&/g,"&amp;"))&&(n=true)}(t.service_name||t.title)&&(n=false)}return n},formatAttachments:function e(t,r,n,i){if(!t.attachments)return"";var a="";var s;var o=[];var l;var u=t.attachments.length;var d=20;if(t.attachments.length>=d){t._shown_attachments||(t._shown_attachments=d);u=t._shown_attachments}for(s=0;s<u;s+=1){l=t.attachments[s];(l.pretext||0===s)&&o.push([]);_.last(o).push(l)}for(s=0;s<o.length;s+=1)a+=TS.templates.builders.formatAttachmentGroup(o[s],t,n,i,r);t._shown_attachments<t.attachments.length&&(a+=TS.templates.builders.getShowMoreAttachmentHTML(t));return a},formatAttachmentGroup:function e(t,r,n,i,a){n=true===n;var s="";var o=false;t=t.map(function(e){return TS.utility.attachments.getDecoratedAttachment(e,r)});var l=r&&"reply_broadcast"===r.subtype;l&&(o=true);var u=o&&_.some(t,TS.utility.attachments.getMediaType);var d=!o||_.some(t,"color");var c=_.some(t,"from_url");var m=_.some(t,"indent");var f=false;if(l){var p=r.channel_id||_.get(t[1],"channel_id");var h=r.broadcast_thread_ts;if((!p||!/\d+\.\d+/.test(h))&&t[1]&&t[1].from_url){var g=t[1].from_url;var S=TS.interop.url.urlQueryStringParse(g);S.cid&&(p=S.cid);S.thread_ts&&(h=S.thread_ts)}a=TS.redux.channels.getEntityById(p);if(a&&h){h.indexOf(".")<0&&(h=h.substr(0,10)+"."+h.substr(10));var T={thread_ts:h,model_ob_id:a.id,convo_href:TS.utility.msgs.constructConversationPermalink(a,h)};f=TS.templates.reply_broadcast_preamble(T);f=new Handlebars.SafeString(f)}}var v;for(var b=0;b<t.length;b+=1){v=t[b];if(!v){TS.info("formatAttachments bad attach");TS.dir(0,r);continue}if(v.from_url&&(TS.boot_data.feature_attachments_inline||TS.templates.builders.shouldDoSimpleAttachment(v,r))){s+="";continue}v.ts&&(v.ts_link=TS.utility.msgs.constructMsgPermalink(a,v.ts.toString()));if(!TS.inline_attachments.legacyShouldShow(v,r)){s+="";continue}if(v.actions&&v.actions.length){var y=["button","select"];var w;var k=[];var x=[];for(var C=0;C<v.actions.length;C+=1){w=v.actions[C];_.includes(y,w.type)?x.push(w):k.push(w)}k.length&&(v.legacy_actions=k);x.length&&(v.actions=x)}var M=TS.utility.attachments.hasContent(v,["pretext"]);if(M){var I=t[b+1];s+=TS.templates.builders.buildAttachmentHTML({model_ob:a,attachment:v,has_border:d,has_indent:m,has_container:o,break_border:d&&I&&v.color!=I.color,url:null,msg:r,msg_dom_id:i,show_initial_caret:TS.templates.builders.shouldDoSimpleAttachment(v,r),show_media_caret:v.video_html||v.image_url||v.audio_html||v.audio_url||v.other_html,enable_slack_action_links:n,has_content:M})}l&&0===b&&(s+=TS.templates.reply_broadcast_count(v))}if(s||v.pretext)return TS.templates.attachment_group({model_ob:a,first_attachment:t[0],preamble:f,msg:r,has_border:d,has_indent:m,has_container:o,has_link:c,use_shrink_wrap:u,attachments_html:s&&new Handlebars.SafeString(s),enable_slack_action_links:n});return s},getShowMoreAttachmentHTML:function e(t){var r=t.attachments.length-t._shown_attachments;var n="";var i=t.ts;var a=false;n=TS.interop.i18n.t("{count, plural, =1 {# more attachment} other {# more attachments}}","attachments")({count:r});return TS.templates.show_more_attachment({ts:i,btn_text:n,clickable_show_more_link:a})},formatMessageAsAttachment:function e(t,r){var n;var i;var a;t.user?i=t.user:"file_comment"===t.subtype&&t.comment&&t.comment.user?i=t.comment.user:t.bot_id&&(a=t.bot_id);if(!t.text&&t.attachments&&t.attachments.length>=1&&t.attachments[0].is_share)n={author_name:t.attachments[0].author_name,author_subname:t.attachments[0].author_subname,author_icon:t.attachments[0].author_icon,author_link:t.attachments[0].author_link};else if(i){var s=TS.interop.members.getMemberById(i);n={};n.author_name=TS.interop.members.getPrefCompliantMemberName(s);s.profile&&(n.author_icon=s.profile.image_24);n.author_link="/team/"+i}else if(a){var o=TS.redux.bots.getBotByMsg(t);n={author_subname:t.username||o.name,author_icon:o&&o.icons&&o.icons.image_48,author_link:"/services/"+a};t.icons&&t.icons.emoji&&t.icons.image_64&&(n.author_icon=t.icons.image_64)}if(!n){TS.error("no author for msg "+t.ts);return""}var l=_.extend({},n,{is_msg_unfurl:true,id:1,ts:t.ts,from_url:TS.utility.msgs.constructAbsoluteMsgPermalink(r,t.ts),msg_subtype:t.subtype});if(t.text){l.text=t.text;l.mrkdwn_in_hash={text:true}}else if(t.attachments&&t.attachments.length>=1){var u=t.attachments[0];l.text=u.text||u.pretext}if(TS.interop.messages.shouldRenderFileThread(t)){var d=TS.utility.msgs.getFileOnMsg(t);var c=_.isString(d)?TS.files.getFileById(d):d;l.files=[c]}TS.inline_attachments.massageAttachment(l,0);l=TS.utility.attachments.getDecoratedAttachment(l,t);var m=TS.templates.builders.buildAttachmentHTML({attachment:l,msg:t,can_delete:false,has_content:true,has_border:true});m=TS.templates.attachment_group({msg:t,attachments_html:new Handlebars.SafeString(m)});return m},getMemberCurrentStatusForDisplay:function e(t,r){var n=TS.interop.members.getMemberCurrentStatus(TS.redux.getState(),t&&t.id);var i="";n.text&&(i+='<span class="prevent_copy_paste" aria-label=" "></span>'+TS.format.formatCurrentStatus(n.text,void 0,r));var a=TS.format.formatCurrentStatus(n.emoji,void 0,_.assign({transform_missing_emoji:true},r));return a+i},buildBotStr:function e(t,r){var n;n=TS.interop.utility.isModelObjectExternal(r)||TS.interop.rules.channels.isOrgShared(r)?t.bot_link?TS.interop.bots.getBotNameByBotLink(t.bot_link):TS.interop.bots.getBotNameByBotLink(t.text):TS.interop.bots.getBotNameById(t.bot_id);var i=_.escape(n);var a=TS.interop.i18n.safeString("<"+TS.boot_data.team_url+"services/"+t.bot_id+"/|"+i+">");switch(t.subtype){case"bot_add":return TS.interop.i18n.t("added an integration to this channel: {bot_url}","templates_builders")({bot_url:a});case"bot_enable":return TS.interop.i18n.t("enabled an integration in this channel: {bot_url}","templates_builders")({bot_url:a});case"bot_disable":return TS.interop.i18n.t("disabled an integration in this channel: {bot_url}","templates_builders")({bot_url:a});case"bot_remove":return TS.interop.i18n.t("removed an integration from this channel: {bot_url}","templates_builders")({bot_url:a});default:return TS.interop.i18n.t("updated an integration in this channel: {bot_url}","templates_builders")({bot_url:a})}},formatMessageByType:function e(t,r,n,i){var a="";var s;if(t.ignore_if_attachments_supported)return a;r=true===r;n=true===n;var o;var l;var u;var d;var c;var m;var f;var p;var h;if(t._jl_rollup_hash&&t.user in t._jl_rollup_hash.users){var g=false;var S=true;var T=function e(t){t=t.map(function(e){return e.id});var r=_.remove(t,function(e){return!TS.redux.members.hasMemberWithId(e)});if(0===t.length)return[];var n;var i=100;if(t.length>i+1){var a=t.length-i+r.length;t=t.splice(0,i);n=TS.interop.i18n.t("{count, plural, =1 {# other} other {# others}}","joined_left")({count:a})}else r.length&&(n=TS.interop.i18n.t("{count, plural, =1 {# other} other {# others}}","joined_left")({count:r.length}));t=t.map(function(e){return TS.interop.members.getPrefCompliantMemberNameById(e,false,g)});n&&t.push(n);return t};var v=function e(t){var r=TS.interop.members.getPrefCompliantMemberNameById(t,S,g);return TS.interop.i18n.safeString('<button type="button" class="btn_unstyle internal_member_link member_preview_link" data-member-id="'+t+'">'+r+"</button>")};var b;var y;var w;var k;var x;var C={joined:[],joined_left:[],left:[],left_rejoined:[]};for(var M in t._jl_rollup_hash.users)if(M!==t.user){k=t._jl_rollup_hash.users[M];var I={id:M,inviter:k.inviter};k.is_in?k.left&&k.joined?C.left_rejoined.push(I):C.joined.push(I):k.joined&&k.left?C.joined_left.push(I):C.left.push(I)}u=i.is_group||i.is_private?TS.model.group_prefix+i.name:i?"#"+i.name:"no_name";k=t._jl_rollup_hash.users[t.user];if(k.is_in)if(k.left&&k.joined)if(k.inviter){var E=C.left_rejoined.filter(function(e){return e.inviter===k.inviter});C.left_rejoined=C.left_rejoined.filter(function(e){return e.inviter===k.inviter});b=E.length?E[0].id:null;x=T(E);a=TS.interop.i18n.t('left and rejoined {channel_name, select, no_name {the channel} other {{channel_name}}} by invitation from {inviter}{count, plural, =0 {} =1 {, along with {user}} other {, along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:E.length,user:v(b),channel_name:u,inviter:v(k.inviter),others:TS.interop.i18n.listify(x).join(""),classes:x.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}else{b=C.left_rejoined.length?C.left_rejoined[0].id:null;x=T(C.left_rejoined);a=TS.interop.i18n.t('left and rejoined {channel_name, select, no_name {the channel} other {{channel_name}}}{count, plural, =0 {} =1 { along with {user}} other { along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:C.left_rejoined.length,user:v(b),channel_name:u,others:TS.interop.i18n.listify(x).join(""),classes:x.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""});C.joined_left=[]}else if(k.inviter){var A=C.joined.filter(function(e){return e.inviter===k.inviter});C.joined=C.joined.filter(function(e){return e.inviter!==k.inviter});b=A.length?A[0].id:null;x=T(A);var P={count:A.length,user:v(b),channel_name:u,inviter:v(k.inviter),others:TS.interop.i18n.listify(x).join(""),classes:x.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""};a=TS.interop.i18n.t('was added to {channel_name, select, no_name {the channel} other {{channel_name}}} by {inviter}{count, plural, =0 {} =1 {, along with {user}} other {, along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left","1da8514b4122b0754451ae7944a56a7ca86af5a7")(P)}else{b=C.joined.length?C.joined[0].id:null;x=T(C.joined);a=TS.interop.i18n.t('joined {channel_name, select, no_name {the channel} other {{channel_name}}}{count, plural, =0 {} =1 { along with {user}} other { along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:C.joined.length,user:v(b),channel_name:u,others:TS.interop.i18n.listify(x).join(""),classes:x.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""});C.joined=[]}else if(k.joined&&k.left){b=C.joined_left.length?C.joined_left[0].id:null;x=T(C.joined_left);a=TS.interop.i18n.t('joined and left {channel_name, select, no_name {the channel} other {{channel_name}}}{count, plural, =0 {} =1 { along with {user}} other { along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:C.joined_left.length,user:v(b),channel_name:u,others:TS.interop.i18n.listify(x).join(""),classes:x.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""});C.joined_left=[]}else{b=C.left.length?C.left[0].id:null;x=T(C.left);a=TS.interop.i18n.t('left {channel_name, select, no_name {the channel} other {{channel_name}}}{count, plural, =0 {} =1 { along with {user}} other { along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:C.left.length,user:v(b),channel_name:u,others:TS.interop.i18n.listify(x).join(""),classes:x.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""});C.left=[]}var O=true;if(C.left_rejoined.length){y=C.left_rejoined.shift().id;w=C.left_rejoined.length?C.left_rejoined[0].id:null;var F=O?TS.interop.i18n.t('Also, {userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} left and rejoined.',"joined_left"):TS.interop.i18n.t('{userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} left and rejoined.',"joined_left");O=false;x=T(C.left_rejoined);a+=" ";a+=F({count:C.left_rejoined.length,userA:v(y),userB:v(w),others:TS.interop.i18n.listify(x).join(""),classes:x.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}if(C.joined.length){y=C.joined.shift().id;w=C.joined.length?C.joined[0].id:null;var H=O?TS.interop.i18n.t('Also, {userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} joined.',"joined_left"):TS.interop.i18n.t('{userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} joined.',"joined_left");O=false;x=T(C.joined);a+=" ";a+=H({count:C.joined.length,userA:v(y),userB:v(w),others:TS.interop.i18n.listify(x).join(""),classes:x.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}if(C.joined_left.length){y=C.joined_left.shift().id;w=C.joined_left.length?C.joined_left[0].id:null;var j=O?TS.interop.i18n.t('Also, {userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} joined and left.',"joined_left"):TS.interop.i18n.t('{userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} joined and left.',"joined_left");O=false;x=T(C.joined_left);a+=" ";a+=j({count:C.joined_left.length,userA:v(y),userB:v(w),others:TS.interop.i18n.listify(x).join(""),classes:x.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}if(C.left.length){y=C.left.shift().id;w=C.left.length?C.left[0].id:null;var D=O?TS.interop.i18n.t('Also, {userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} left.',"joined_left"):TS.interop.i18n.t('{userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} left.',"joined_left");O=false;x=T(C.left);a+=" ";a+=D({count:C.left.length,userA:v(y),userB:v(w),others:TS.interop.i18n.listify(x).join(""),classes:x.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}}else if("channel_join"===t.subtype||"app_conversation_join"===t.subtype){l=TS.interop.members.getMemberById(t.inviter);b=TS.interop.members.getMemberById(t.user);u=i.is_private?TS.model.group_prefix+i.name:i?"#"+i.name:TS.interop.i18n.t("the channel","templates_builders")();if(l){d=TS.interop.i18n.safeString("<@"+l.id+"|"+l.name+">");s=b&&b.is_app_user?TS.interop.i18n.t("was added to this conversation by {inviter}.","templates_builders")({inviter:d}):TS.interop.i18n.t("joined {channel_name} from an invitation by {inviter}","templates_builders")({channel_name:u,inviter:d});a=TS.format.formatNoHighlightsNoSpecials(s,t)}else a=TS.interop.i18n.t("joined {channel_name}","templates_builders")({channel_name:u})}else if("channel_leave"===t.subtype||"app_conversation_leave"===t.subtype){l=TS.interop.members.getMemberById(t.inviter);b=TS.interop.members.getMemberById(t.user);u=i.is_private?TS.model.group_prefix+i.name:i?"#"+i.name:TS.interop.i18n.t("the channel","templates_builders")();if(l&&b&&b.is_app_user){d=TS.interop.i18n.safeString("<@"+l.id+"|"+l.name+">");s=TS.interop.i18n.t("was removed from this conversation by {inviter}.","templates_builders")({inviter:d});a=TS.format.formatNoHighlightsNoSpecials(s,t)}else a=TS.interop.i18n.t("left {channel_name}","templates_builders")({channel_name:u})}else if("channel_name"===t.subtype)a=TS.interop.i18n.t('renamed the channel from "{old_name}" to "{new_name}"',"templates_builders")({old_name:t.old_name,new_name:t.name});else if("channel_topic"===t.subtype)if(t.topic){m=TS.format.formatWithOptions(t.topic,t,{no_highlights:true});a=TS.interop.i18n.t('set the channel topic: <span class="topic no_jumbomoji">{topic}</span>',"templates_builders")({topic:TS.interop.i18n.safeString(m)})}else a=TS.interop.i18n.t("cleared the channel topic","templates_builders")();else if("channel_purpose"===t.subtype)if(t.purpose){f=TS.format.formatWithOptions(t.purpose,t,{no_highlights:true});a=TS.interop.i18n.t('set the channel purpose: <span class="purpose no_jumbomoji">{purpose}</span>',"templates_builders")({purpose:TS.interop.i18n.safeString(f)})}else a=TS.interop.i18n.t("cleared the channel purpose","templates_builders")();else if("group_join"===t.subtype){o=i;c=o?TS.model.group_prefix+o.name:TS.interop.i18n.t("the private channel","templates_builders")();l=TS.interop.members.getMemberById(t.inviter);if(l){d=TS.interop.i18n.safeString("<@"+l.id+"|"+l.name+">");s=TS.interop.i18n.t("joined {group_name} from an invitation by {inviter}","templates_builders")({group_name:c,inviter:d});a=TS.format.formatNoHighlightsNoSpecials(s,t)}else a=TS.interop.i18n.t("joined {group_name}","templates_builders")({group_name:c})}else if("group_leave"===t.subtype){o=i;c=o?TS.model.group_prefix+o.name:TS.interop.i18n.t("the private channel","templates_builders")();a=TS.interop.i18n.t("left {group_name}","templates_builders")({group_name:c})}else if("group_name"===t.subtype)a=TS.interop.i18n.t('renamed the private channel from "{old_name}" to "{new_name}"',"templates_builders")({old_name:t.old_name,new_name:t.name});else if("group_topic"===t.subtype)if(t.topic){m=TS.format.formatWithOptions(t.topic,t,{no_highlights:true});a=TS.interop.i18n.t('set the channel topic: <span class="no_jumbomoji">{topic}</span>',"templates_builders")({topic:TS.interop.i18n.safeString(m)})}else a=TS.interop.i18n.t("cleared the channel topic","templates_builders")();else if("group_purpose"===t.subtype)if(t.purpose){f=TS.format.formatWithOptions(t.purpose,t,{no_highlights:true});a=TS.interop.i18n.t('set the channel purpose: <span class="no_jumbomoji">{purpose}</span>',"templates_builders")({purpose:TS.interop.i18n.safeString(f)})}else a=TS.interop.i18n.t("cleared the channel purpose","templates_builders")();else if("group_archive"===t.subtype){o=i;c=o?TS.model.group_prefix+o.name:TS.interop.i18n.t("the private channel","templates_builders")();p=TS.interop.i18n.safeString(_.escape(TS.redux.teams.getSelfEnterpriseOrgName()));1==o.is_moved?a=TS.interop.i18n.t("moved {group_name} to another {enterprise_name} workspace","templates_builders")({group_name:c,enterprise_name:p}):0==o.is_moved&&(a=TS.interop.i18n.t("archived {group_name}","templates_builders")({group_name:c}))}else if("group_unarchive"===t.subtype){o=i;c=o?TS.model.group_prefix+o.name:TS.interop.i18n.t("the private channel","templates_builders")();a=TS.interop.i18n.t("un-archived {group_name}","templates_builders")({group_name:c})}else if("channel_archive"===t.subtype){u=i.is_private?TS.model.group_prefix+i.name:i?"#"+i.name:TS.interop.i18n.t("the channel","templates_builders")();p=TS.interop.i18n.safeString(_.escape(TS.redux.teams.getSelfEnterpriseOrgName()));i&&1==i.is_moved&&(a=TS.interop.i18n.t("moved {channel_name} to another {enterprise_name} workspace","templates_builders")({channel_name:u,enterprise_name:p}))}else if("channel_unarchive"===t.subtype){u=i.is_private?TS.model.group_prefix+i.name:i?"#"+i.name:TS.interop.i18n.t("the channel","templates_builders")();a=TS.interop.i18n.t("un-archived {channel_name}","templates_builders")({channel_name:u})}else if("me_message"===t.subtype)a="<i>"+TS.format.formatWithOptions(t.text,t,{do_inline_imgs:r})+"</i>";else if("play_sound"===t.subtype)a=TS.interop.i18n.t('played "{msg_sound}"',"templates_builders")({msg_sound:t.sound});else if("bot_add"===t.subtype||"bot_enable"===t.subtype||"bot_updated"===t.subtype||"bot_disable"===t.subtype||"bot_remove"===t.subtype){h=TS.templates.builders.buildBotStr(t,i);a=TS.format.formatWithOptions(h,t,{do_inline_imgs:r,enable_slack_action_links:n,no_highlights:true})}else a="reminder_add"===t.subtype||"reminder_delete"===t.subtype?TS.format.formatWithOptions(t.text,t,{do_inline_imgs:r,enable_slack_action_links:n,no_highlights:true}):TS.format.formatWithOptions(t.text,t,{do_inline_imgs:r,enable_slack_action_links:n});if(!a&&""!==a){TS.warn("no html msg.subtype:"+t.subtype);return""}a=TS.utility.msgs.handleSearchHighlights(a);return a},search_ellipsis:'<span class="extract_ellipsis">&hellip;</span>',buildStar:function e(r,n,i){var a=t(r,n,i);if(!_.isObject(a))return{};return TS.templates.star(a)},buildStarWithTip:function e(r,n,i){var a=t(r,n,i);if(!_.isObject(a))return{};return TS.templates.star_with_tip(a)},buildPinInfoHtml:function e(t){var r={};var n=TS.interop.channels.getChannelPinnedItemByMessage({message:t,channel:TS.shared.legacyGetActiveModelOb()});var i={};if(n.createdBy&&n.createdTs){i=TS.redux.members.getPotentiallyUnknownMemberById(n.createdBy);r.user=i;r.ts=n.createdTs;r.complete_data=r.user&&r.ts}else r.complete_data=false;r.unknown_member_token=new Handlebars.SafeString(TS.templates.unknown_member({id:i.id}));var a=TS.templates.pinned_message_info(r);return new Handlebars.SafeString(a)},buildInlineImgTogglerAndDiv:function e(t,r,n){var i=TS.model.inline_imgs[t];if(!i)return"";return TS.templates.builders.buildInlineImgToggler(t,r)+" "+TS.templates.builders.buildInlineImgDiv(t,r,n)},buildInlineImgToggler:function e(t,r,n,i){var a=TS.model.inline_imgs[t];if(!a){TS.warn(8675309,"buildInlineImgToggler did not find anything in TS.model.inline_imgs for key:"+t);return""}var s=TS.inline_imgs.shouldExpand(r,a,i);var o=a.link_url||t;var l=a.bytes&&a.bytes>TS.model.inline_img_byte_limit;var u=a.width&&a.height&&a.width*a.height>TS.model.inline_img_pixel_limit;var d=!u;var c="";var m="";if(!s&&(!TS.prefs.getPref("obey_inline_img_limit")||l)||u){var f=!a.internal_file_id&&TS.prefs.getPref("expand_inline_imgs")&&false!==TS.model.expandable_state["img_"+r+a.src];if(f&&u){d=false;m=TS.interop.i18n.t("(Not automatically expanded because {img_width}x{img_height} is too large to display inline.)","templates_builders")({img_width:a.width,img_height:a.height});c='<span class="too_large_for_auto_expand"> '+m+"</span>"}else if(f&&l){var p=TS.interop.i18n.t("Open original in new tab","templates_builders")();var h="<a "+TS.utility.makeRefererSafeLink(o)+' target="_blank" title="'+p+'">';if(TS.model.show_inline_img_size_pref_reminder&&!TS.model.shown_inline_img_size_pref_reminder_once){m=TS.interop.i18n.t('(Not automatically expanded because {file_size} is too large. \t\t\t\t\t\tYou can <a class="cursor_pointer too_large_but_expand_anyway" data-real-src="{real_src}">expand it anyway</a> or {referer_link_a_tag}open it in a new window</a>.)',"templates_builders","75620bd59d53a9caaec56a62eb8b3b42e3fc98e5")({file_size:TS.interop.utility.convertFilesize(a.bytes),real_src:TS.interop.i18n.safeString(_.escape(a.src)),referer_link_a_tag:TS.interop.i18n.safeString(h)});TS.model.shown_inline_img_size_pref_reminder_once=true}else m=TS.interop.i18n.t('(Not automatically expanded because {file_size} is too large. \t\t\t\t\t\tYou can <a class="cursor_pointer too_large_but_expand_anyway" data-real-src="{real_src}">expand it anyway</a> or {referer_link_a_tag}open it in a new window</a>.)',"templates_builders")({file_size:TS.interop.utility.convertFilesize(a.bytes),real_src:TS.interop.i18n.safeString(_.escape(a.src)),referer_link_a_tag:TS.interop.i18n.safeString(h)});c='<span class="too_large_for_auto_expand"> '+m+"</span>"}}var g=a.bytes&&true!==n?'<span class="inline_img_bytes '+(c?"hidden":"")+'"> ('+TS.interop.utility.convertFilesize(a.bytes)+")</span>":"";var S={collapser_class:"msg_inline_img_collapser",expander_class:"msg_inline_img_expander",real_src:a.src,expand_it:s};var T=TS.templates.inline_attachment_toggler({inline_attachment:S});return g+c+(d?T:"")},buildInlineImgDiv:function e(t,r,n){n=n||{};var i=TS.model.inline_imgs[t];if(!i)return"";var a=TS.inline_imgs.shouldExpand(r,i,n);var s=i.link_url||t;var o=!n.flush_with_attachment&&i.width>0&&i.height>0;var l;i.internal_file_id&&(l=TS.files.getFileById(i.internal_file_id));var u="";var d="clear_both msg_inline_img_holder msg_inline_holder";a||(d+=" hidden");var c=i.height<50;var m=i.width<200;var f=m||c;if(f){d+=" overflow_preview_actions";m&&(d+=" overflow_preview_actions_width")}l&&(d+=" file_container");d+=" msg_inline_holder_rounded";o||(d+=" file_container_fixed_dimensions");u+='<div data-real-src="'+_.escape(i.src)+'" class="'+d+'" ';i.internal_file_id&&(u+='data-file-id="'+i.internal_file_id+'" ');o&&(u+='style="width:'+i.width+'px;" ');u+=">";var p="ctrl";TS.model.is_mac&&(p="cmd");var h=TS.interop.i18n.t("{cmd_key}+click to open original in new tab","templates_builders")({cmd_key:p});var g=!n||!n.hasOwnProperty("maybe_show_file_viewer")||n.maybe_show_file_viewer;var S;if(i.internal_file_id)if(l&&0===l.mimetype.indexOf("image/")){S=g;if("dropbox"===l.external_type||"gdrive"===l.external_type||"box"===l.external_type||"onedrive"===l.external_type){var T=l.thumb_720?l.thumb_720:l.thumb_360;u+="<a "+TS.utility.makeRefererSafeLink(s)+' target="_blank" title="'+h+'" class="file_viewer_external_link" data-src="'+_.escape(T)+'"data-link-url="'+_.escape(s)+'">'}else u+=S?'<a href="'+s+'" target="_blank" class="file_viewer_channel_link file_viewer_link" data-file-id="'+i.internal_file_id+'">':'<a href="'+s+'" target="_blank" title="'+h+'" class="file_preview_link thumbnail_link" data-file-id="'+i.internal_file_id+'">'}else u+="<a "+TS.utility.makeRefererSafeLink(s)+' target="_blank" class="'+l.filetype+'">';else{var v="";var b="";g?v="file_viewer_external_link":b=TS.interop.i18n.t("Click to open original in new tab","templates_builders")();u+="<a "+TS.utility.makeRefererSafeLink(s)+' target="_blank" title="'+b+'" class="'+v+'" data-src="'+_.escape(i.src)+'" data-link-url="'+_.escape(i.link_url)+'"';i.width&&(u+=' data-width="'+_.escape(i.width)+'"');i.height&&(u+=' data-height="'+_.escape(i.height)+'"');i.rotation&&(u+=' data-rotation="'+_.escape(i.rotation)+'"');i.content_type&&(u+=' data-content-type="'+_.escape(i.content_type)+'"');u+=">"}o&&(u=u.replace("<a ",'<a style="width:'+i.width+'px;" '));u+='<div class="msg_inline_img_container">';u+='<div class="file_preview_preserve_aspect_ratio" ';if(o)if(l&&f)u+='style="padding-top: '+i.height+'px;" ';else{var y="calc("+i.height+" / "+i.width+" * 100% )";u+='style="padding-top: -moz-'+y+"; padding-top: -webkit-"+y+"; padding-top: "+y+';" '}else{var w=574;var k=300;var x=w/k;var C=i.display_w||i.width;var M=i.display_h||i.height;var I=C/M;var E;var A;if(C<=w&&M<=k){E=C;A=M}else if(x>I){E=C*k/M;A=k}else{E=w;A=M*w/C}u+='style="width: '+Math.round(E)+"px; height: "+Math.round(A)+'px;"'}u+=">";i.proxied_src=TS.utility.getImgProxyURLWithOptions(i.src,{rotate:true});var P=_.escape(i.proxied_src||i.src);var O="msg_inline_img msg_inline_child";var F="style=\"background-image:url('"+P+"');\"";var H='src="'+P+'"';u+='<figure class="'+O+'" '+F+">";u+="<img "+H+" />";u+="</figure>";u+="</div>";u+="</div>";u+="</a>";l&&(u+=TS.templates.message_file_preview_actions({file:l,download:"hosted"===l.mode,new_window:true,external_file_author:TS.files.isFileAuthorExternal(l)}));u+="</div>";return u},buildInlineEmailDiv:function e(t,r){var n=TS.files.getFileById(t);if(!n)return"";var i={file:n,is_message:true,to_more_count:n.to.length-1,cc_more_count:n.cc.length-1,msg_dom_id:r};return TS.templates.file_email(i)},buildInlineAttachmentToggler:function e(t,r){var n=TS.model.inline_attachments[t];if(!n)return"";var i=TS.inline_attachments.shouldExpand(r,n);var a={real_src:n.from_url,expand_it:i};var s=TS.templates.inline_attachment_toggler({inline_attachment:a});return s},buildInlineAudioToggler:function e(t,r){var n=TS.model.inline_audios[t];if(!n)return"";return TS.templates.attachment_inline_media_toggler({is_expanded:TS.inline_audios.shouldExpand(r,n),src:n.src,media_type:"audio"})},buildInlineAudioDiv:function e(t,r,n){var i=TS.model.inline_audios[t];if(!i)return"";var a=TS.inline_audios.shouldExpand(r,i);var s={src:i.src,expand_it:a,content:n};var o=TS.templates.attachment_inline_audio_div({inline_audio:s});return o},buildInlineOtherToggler:function e(t,r){var n=TS.model.inline_others[t];if(!n)return"";return TS.templates.attachment_inline_media_toggler({is_expanded:TS.inline_others.shouldExpand(r,n),src:n.src,media_type:"other"})},buildInlineOtherDiv:function e(t,r,n){var i=TS.model.inline_others[t];if(!i)return"";var a=TS.inline_others.shouldExpand(r,i);return'<div data-real-src="'+_.escape(i.src)+'" class="clear_both msg_inline_other_holder msg_inline_holder '+(a?"":"hidden")+'">'+n+"</div>"},buildInlineVideoTogglerAndDiv:function e(t,r){var n=TS.model.inline_videos[t];if(!n)return"";return TS.templates.builders.buildInlineVideoToggler(t,r)+" "+TS.templates.builders.buildInlineVideoDiv(t,r)},buildInlineVideoToggler:function e(t,r,n){var i=TS.model.inline_videos[t];if(!i)return"";return TS.templates.attachment_inline_media_toggler({is_expanded:TS.inline_videos.shouldExpand(r,i),src:i.src,title:n?"":i.title,media_type:"video",is_keyboard_navigable:true})},buildInlineVideoDiv:function e(t,r){var n=TS.model.inline_videos[t];if(!n)return"";var i=TS.inline_videos.shouldExpand(r,n);var a=n.link_url||t;var s=true;n.html||(s=false);var o={real_src:n.src,data_url:t,referrer_safe_url_attributes:TS.utility.makeRefererSafeLink(a),show_play:s,proxied_src_or_src:n.proxied_src||n.src,display_w:n.display_w,display_h:n.display_h,expand_it:i};var l=TS.templates.message_inline_video({inline_video:o});return l},buildComments:function e(t){var r;var n=t.comments;var i="";for(var a=0;a<n.length;a+=1){r=TS.redux.members.getPotentiallyUnknownMemberById(n[a].user);i+=TS.templates.builders.buildCommentHTML({file:t,comment:n[a],show_comment_actions:true,member:r})}return i},buildCommentHTML:function e(t){return TS.templates.comment(t)},buildCommentStandalone:function e(t,r){var n=TS.utility.members.getEntityFromFile(r);var i;"snippet"===r.mode?i="snippet":"post"===r.mode?i="post":"space"===r.mode?i="space":"hosted"!==r.mode&&"external"!==r.mode||(i="file");return TS.templates.comment_standalone({comment:t,file:r,file_type:i,entity:n,current_user_id:TS.model.user.id})},makeChannelPrefix:function e(t){if(!t)return"";if(t.is_mpim||t.is_im)return"";if(t.is_group||t.is_private)return'<ts-icon class="ts_icon_lock"></ts-icon>';if(t.is_channel)return"#";return""},makeModelObNameForDisplay:function e(t,r){if(!t)return"ERROR: MISSING CHANNEL";r=r||{};var n=_.trim(TS.templates.builders.maybeMakeSharedIcon(t,r.show_tooltip,r.tooltip_position,r.inherit_font_size));var i=TS.templates.builders.makeChannelPrefix(t);var a;a=t.is_im?TS.interop.members.getPrefCompliantMemberNameById(t.user):t.is_mpim?TS.mpims.legacyGetDisplayName(t):t.name;a=_.escape(a);var s="";!r.allow_wrap&&r.overflow_ellipsis?s+='<span class="no_wrap overflow_hidden">':r.allow_wrap?r.allow_wrap&&(s+='<span class="break_word">'):s+='<span class="no_wrap">';r.overflow_ellipsis&&(s+='<span class="overflow_ellipsis">');s+=r.omit_prefix?"":i;s+=a;r.overflow_ellipsis&&(s+="</span>");s+="</span>"+n;return s},makeChannelLink:function e(t,r){if(!t)return"ERROR: MISSING CHANNEL";r=r||{};var n=t.id;var i=TS.utility.shouldLinksHaveTargets()?'target="/archives/'+n+'"':"";var a=TS.templates.builders.makeModelObNameForDisplay(t,r);if(r.overflow_ellipsis)return'<a href="/archives/'+n+'" '+i+' class="channel_link display_flex flex_wrap_none" data-channel-id="'+t.id+'">'+a+"</a>";return'<a href="/archives/'+n+'" '+i+' class="channel_link" data-channel-id="'+t.id+'">'+a+"</a>"},maybeMakeSharedIcon:function e(t,r,n,i){var a="";if(TS.boot_data.feature_remove_double_rings||!TS.interop.rules.channels.isOrgShared(t)||t.is_mpim||t.is_im){if(!TS.boot_data.feature_remove_double_diamonds&&TS.interop.rules.channels.isExternallySharedChannel(t)&&!t.is_mpim&&!t.is_im){var s=TS.interop.rules.channels.getConnectedTeamIds(TS.redux.getState(),t);0===s.length&&(s=void 0);a=TS.templates.shared_channels_icon({model_ob:t,tooltip:_.isUndefined(r)||r,tooltip_position:n,connectedTeamIds:s,inherit:i})}}else a=TS.templates.shared_channel_icon();return new Handlebars.SafeString(a)},makeChannelPath:function e(t){return"/messages/"+t.id},makeChannelLinkAriaLabelSafe:function t(r){r||TS.warn("No valid channel to make channel link aria label");var n=_.escape(r.name);var i=TS.model.active_channel_id===r.id?TS.interop.i18n.t("active channel","templates_builders")():TS.interop.i18n.t("channel","templates_builders")();var a=e(r);var s=null;TS.templates.builders.legacyShowDraftIcon(r)&&(s=TS.interop.i18n.t("draft","messages")());var o=n+", "+i+(a?", "+a:"")+(s?", "+s:"");return new Handlebars.SafeString(o)},makeGroupLink:function e(t,r){if(!t)return"ERROR: MISSING GROUP";r=r||{};var n=TS.utility.shouldLinksHaveTargets()?'target="/archives/'+t.id+'"':"";var i=TS.templates.builders.makeModelObNameForDisplay(t,r);if(r.overflow_ellipsis)return'<a href="/archives/'+t.id+'" '+n+' class="group_link display_flex flex_wrap_none" data-group-id="'+t.id+'">'+i+"</a>";return'<a href="/archives/'+t.id+'" '+n+' class="group_link" data-group-id="'+t.id+'">'+i+"</a>"},makeGroupLinkAriaLabelSafe:function t(r){r||TS.warn("No valid group to make private channel link aria label");var n=_.escape(r.name);var i=TS.model.active_group_id===r.id?TS.interop.i18n.t("active channel","templates_builders")():TS.interop.i18n.t("channel","templates_builders")();var a=e(r);var s=null;TS.templates.builders.legacyShowDraftIcon(r)&&(s=TS.interop.i18n.t("draft","messages")());var o=n+", "+i+(a?", "+a:"")+(s?", "+s:"");return new Handlebars.SafeString(o)},makeMpimLink:function e(t,r){if(!t)return"ERROR: MISSING MPIM";var n;var i;var a="/archives/"+t.id;TS.utility.shouldLinksHaveTargets()&&(n="/archives/"+t.id);if(r){var s=TS.mpims.legacyGetMembersInDisplayOrder(t);var o=s.map(function(e){if(e.profile.real_name)return e.profile.real_name;return e.name});var l=o.join(", ");i=l===TS.mpims.legacyGetDisplayName(t)?"":l}return TS.templates.mpim_link({target:n,href:a,title:i,mpim:t})},makeMemberPreviewLink:function e(t,r){if(!t)return"";true!==r&&(r=false);var n=TS.templates.builders.makeMemberColorClass(t);var i;var a;if(t.is_service){a=TS.utility.shouldLinksHaveTargets()?'target="/services/'+t.id+'"':"";n+=" app_preview_link";i='<a href="/services/'+t.id+'" '+a+' data-bot-id="'+t.id+'" class="message_sender service_link '+n+'">'}else{a=TS.utility.shouldLinksHaveTargets()?'target="/team/'+t.id+'"':"";n+=t.is_bot?" app_preview_link":" member member_preview_link";n+=" "+TS.templates.builders.makeMemberTypeBadgeClass(t);i='<a href="/team/'+t.id+'" '+a+' class="message_sender '+n+'" data-member-id="'+t.id+'">'}r&&t.id==TS.model.user.id?i+=TS.interop.i18n.t("You","templates_builders")():i+=TS.interop.members.getPrefCompliantMemberName(t,true);i+=TS.templates.builders.makeMemberTypeBadgeCompact(t,false);i+="</a>";(t.is_bot||t.is_service)&&(i+='<span class="c-app_label">'+TS.interop.i18n.t("APP","templates_builders")()+"</span>");t.is_unknown&&(i=TS.templates.unknown_member({id:t.id}));return i},legacyShowDraftIcon:function e(t){if(!_.isObject(t))return false;if(TS.interop.utility.looksLikeMemberId(t.id)){var r=TS.redux.channels.getImByMemberId(t.id);if(!r)return false}var n=r||t;var i=n.last_msg_input;var a=n.id;var s=TS.shared.legacyGetActiveModelOb();if(s){var o=s.id;o&&o==a&&(i=null)}n.is_channel&&(!TS.interop.rules.channels.isArchived(n)&&n.is_member||(i=null));n.is_group&&!n.is_mpim&&TS.interop.rules.channels.isArchived(n)&&(i=null);TS.permissions.members.canPostInChannel(n)||(i=null);if(_.trim(i))return true;return false},makeProfileImage:function e(t,r){if(_.isString(t)){var n=TS.interop.members.getMemberById(t);t=n||TS.interop.bots.getBotById(t)}if(!t)return false;var i=r.hash.is_lazy||false;var a=t.profile||t.icons||{};var s=r.hash.title||false;var o;o=a.emoji?"64":"48";var l=r.hash.size||o;var u=Object.keys(TS.constants.avatar_size_map).reduce(function(e,t){if(t===l&&m(a,t))return t;return e},o);var d={entity:t,size:l,css_classes:f(t,l),image:c(t,m(a,u)),is_lazy:i,is_targettable:TS.utility.shouldLinksHaveTargets(),title:s};function c(e,t){var r=[];r.push("url('"+t+"')");return r.join(",")}function m(e,t){var r="image_"+t;if(e.hasOwnProperty(r)){if(TS.environment.is_retina)return e[TS.constants.avatar_size_map[t].retina]||e[TS.constants.avatar_size_map[t].standard];return e[TS.constants.avatar_size_map[t].standard]}return false}function f(e,t){var r=[];r.push("thumb_"+t);if(e.is_bot){r.push("is_bot");r.push("app_preview_link")}else r.push("member_preview_link");return r.join(" ")}return new Handlebars.SafeString(TS.templates.member_profile_image(d))},makeMemberPreviewLinkImage:function e(t,r,i,a,s,o,l){var u;u="object"===n(t)?t:TS.redux.members.getPotentiallyUnknownMemberById(t);if(!u||!u.profile)return"";i=true===i;a=true===a||TS.utility.members.isMemberEKMRevoked(u);s=true===s;o=true===o;l="string"===typeof l&&l;"USLACKBOT"===t&&l&&(u=TS.utility.slackbot.getWithFeels(l));var d=TS.templates.builders.getImageStyleForMemberPreviewImage(u,r,i);var c={omit_link:a,omit_badge:s,lazy:i,member:u,size:r,include_restricted_overlay:!o||true,bg_img_style:d};return TS.templates.member_preview_link_image(c)},getImageStyleForMemberPreviewImage:function e(t,r,n){var i;var a;var s;a="background-image: ";s=[];switch(r){case 20:i=TS.environment.is_retina?t.profile.image_48:t.profile.image_24;break;case 24:i=TS.environment.is_retina?t.profile.image_48:t.profile.image_24;break;case 32:i=TS.environment.is_retina?t.profile.image_72:t.profile.image_32;break;case 36:i=TS.environment.is_retina?t.profile.image_72:t.profile.image_48;break;case 48:i=TS.environment.is_retina?t.profile.image_72:t.profile.image_48;break;case 72:i=TS.environment.is_retina?t.profile.image_192:t.profile.image_72;break;case 192:i=TS.environment.is_retina&&t.profile.image_512||t.profile.image_192;break;case 512:i=TS.environment.is_retina?t.profile.image_1024||t.profile.image_512||t.profile.image_192:t.profile.image_512||t.profile.image_192;break;default:i=TS.environment.is_retina?t.profile.image_72:t.profile.image_48;break}s.push("url('"+i+"')");if(512===r){var o=TS.environment.is_retina?t.profile.image_72:t.profile.image_48;s.push("url('"+o+"')")}a=n?s.length?s.join(", "):"":s.length?a+s.join(", "):"";return a},makePendingUserImage:function e(t,r){if(!t||!r)return"";var n=48;36===r&&(n=72);var i="/img/new_channel_modal/airplane_"+n.toString()+".png";var a="url('"+vvv(i)+"')";var s={restricted:t.invite_prefs&&"restricted"===t.invite_prefs.type,img_url:a,size:r};return TS.templates.pending_user_image(s)},newWindowName:function e(){if("web"===TS.boot_data.app||"calls"===TS.boot_data.app)return"_self";return"new_"+r.toString()},getBotIdentifier:function e(t){if(!t.bot_id&&!t.username)return null;var r=TS.redux.bots.getBotByMsg(t);var n=!t.username&&r&&r.name?r.name:t.username;var i=r?r.id:"NOBOTID";return i+"_"+n},getBotName:function e(t){var r=t.username;if(!r){var n=TS.redux.bots.getBotByMsg(t);n&&n.name&&(r=n.name)}return r},getBotNameWithLink:function e(t){var r=t.username;var n=TS.redux.bots.getBotByMsg(t);var i=TS.templates.builders.makeBotLink(n);r||(n&&n.name?r=n.name:t.bot_profile&&t.bot_profile.name&&(r=t.bot_profile.name));return new Handlebars.SafeString(i.start_a+_.escape(r)+i.end_a)},makeBotLink:function e(t,r){var n="";var i="";var a=r||{};if(t&&!t.deleted){n='<a class="app_preview_link '+(a.classes?a.classes:" ")+'" target="/services/'+t.id+'" style="'+(a.style?a.style:" ")+'" href="/services/'+t.id+'">';i=(a.external_badge?a.external_badge:" ")+"</a>"}else{n='<a class="app_preview_link">';i="</a>"}return{start_a:n,end_a:i}},makeFiletypeHTML:function e(t){if(t.external_type)return TS.templates.builders.makeExternalFiletypeHTML(t);var r="";"docs"===t.filetype&&(t.pretty_type=TS.interop.i18n.t("Post","menu_file")());r+='<a href="'+t.url_private_download+'" ';r+='target="'+t.url_private_download+'" ';r+='title="'+TS.interop.i18n.t("Download this file","templates_builders")()+'" ';r+='data-file-id="'+t.id+'" ';r+='class="subtle_silver file_ssb_download_link">';r+=TS.interop.utility.convertFilesize(t.size)+" ";r+="<span>"+t.pretty_type+"</span>";"snippet"===t.mode&&(r+=" "+TS.interop.i18n.t("snippet","templates_builders")());r+="</a>";return r},makeExternalFiletypeHTML:function e(t){if(!t.is_external)return;var r="";switch(t.external_type){case"gdrive":switch(t.filetype){case"gsheet":r=TS.interop.i18n.t("Spreadsheet from Google Drive","templates_builders")();break;case"gdoc":r=TS.interop.i18n.t("Document from Google Drive","templates_builders")();break;case"gpres":r=TS.interop.i18n.t("Presentation from Google Drive","templates_builders")();break;case"gdraw":r=TS.interop.i18n.t("Drawing from Google Drive","templates_builders")();break;default:r=TS.interop.i18n.t("<span>{file_type}</span> from Google Drive","templates_builders")({file_type:t.pretty_type})}break;case"dropbox":r=TS.interop.i18n.t("<span>{file_type}</span> from Dropbox","templates_builders")({file_type:t.pretty_type});break;case"box":r=TS.interop.i18n.t("<span>{file_type}</span> from Box","templates_builders")({file_type:t.pretty_type});break;case"onedrive":r=TS.interop.i18n.t("<span>{file_type}</span> from OneDrive","templates_builders")({file_type:t.pretty_type});break;default:r=TS.interop.i18n.t("File","templates_builders")()}return r},makeUnshareLink:function e(t,r){var n=(t.is_channel?"#":"")+t.name;var i=TS.interop.i18n.t("Unshare from {channel}","templates_builders")({channel:n});return'<a class="unshare_link ts_tip ts_tip_top ts_tip_float ts_tip_unshare_link ts_tip_multiline" onclick="TS.files.promptForFileUnshare(\''+r.id+"', '"+t.id+'\')"><span class="ts_tip_tip"><span class="ts_tip_multiline_inner">'+i+'</span></span><i class="ts_icon ts_icon_minus_circle_small"></i></a>'},updateFileShareLabels:function e(t){var r=$('.file_share_label[data-file-id="'+t.id+'"]');r.each(function(){$(this).replaceWith(TS.templates.builders.makeFileShareLabel(t))});if(t.is_shared){$('.file_share_shared_label[data-file-id="'+t.id+'"]').removeClass("hidden");$('.file_share_unshared_label[data-file-id="'+t.id+'"]').addClass("hidden")}else{$('.file_share_shared_label[data-file-id="'+t.id+'"]').addClass("hidden");$('.file_share_unshared_label[data-file-id="'+t.id+'"]').removeClass("hidden")}if(t.is_public){$('.file_share_private_label[data-file-id="'+t.id+'"]').addClass("hidden");$('.file_share_public_label[data-file-id="'+t.id+'"]').removeClass("hidden")}else{$('.file_share_private_label[data-file-id="'+t.id+'"]').removeClass("hidden");$('.file_share_public_label[data-file-id="'+t.id+'"]').addClass("hidden")}},makeFileShareLabel:function e(t){var r='<span class="file_share_label" data-file-id="'+t.id+'">';var n=TS.templates.builders.makeFileGroupChannelList(t);n.length?r+=TS.interop.i18n.t("in {share_list}","templates_builders")({share_list:TS.interop.i18n.safeString(n)}):t.is_public||t.user===TS.model.user.id||(r+=TS.interop.i18n.t("shared with you","templates_builders")());r+="</span>";return r},makeFileGroupChannelList:function e(t){var r=[];var n;var i;var a;var s=_.get(t,"channels.length",0);for(a=0;a<s;a+=1){i=TS.interop.channels.getPublicChannelById(t.channels[a]);if(!i)continue;if(i.is_mpim)continue;n='<span class="no_wrap">';n+=TS.templates.builders.makeChannelLink(i,{inherit_font_size:true});n+="&nbsp;"+TS.templates.builders.makeUnshareLink(i,t);n+="</span>";r.push(n)}var o;var l=_.get(t,"groups.length",0);for(a=0;a<l;a+=1){o=TS.interop.channels.getGroupById(t.groups[a]);if(!o)continue;n='<span class="no_wrap">';n+=TS.templates.builders.makeGroupLink(o,{inherit_font_size:true});n+="&nbsp;"+TS.templates.builders.makeUnshareLink(o,t);n+="</span>";r.push(n)}if(!r.length)return"";return r.join(", ")},makeFileCommentHelpHTML:function e(t){if(t&&t.is_public&&(t.channels&&t.channels.length||t.groups&&t.groups.length)){var r=[];t.channels&&t.channels.length&&(r=r.concat(t.channels));t.groups&&t.groups.length&&(r=r.concat(t.groups));r=_.chain(r).map(function(e){return TS.redux.channels.getEntityById(e)}).filter(function(e){return e&&!e.is_im&&!e.is_mpim&&!TS.interop.rules.channels.isExternallySharedChannel(e)}).value();if(r.length<1)return"";return TS.interop.i18n.t("Commenting in {channel_names}","templates_builders")({channel_names:TS.interop.i18n.safeString(TS.templates.builders.makeLinksFromModelObs(r))})}return""},makeLinksFromModelObs:function e(t,r){r=r||{};t=TS.utility.parseJSONOrElse(t,t);t=_.isArray(t)?t:[t];var n=0;t=_.chain(t).map(function(e){if(_.isString(e))return TS.redux.channels.getEntityById(e);return e}).filter(function(e){e||(n+=1);return e&&!e.is_im&&!e.is_mpim}).value();var i=TS.sorter.search("",{groups:t},{allow_empty_query:true});var a=i.sort().map(function(e){var t=r.new_lines?'<span class="block">':"";t+=e.is_channel?TS.templates.builders.makeChannelLink(e,{overflow_ellipsis:r.overflow_ellipsis,inherit_font_size:r.inherit_font_size}):TS.templates.builders.makeGroupLink(e,{overflow_ellipsis:r.overflow_ellipsis,inherit_font_size:r.inherit_font_size});t+=r.new_lines?"</span>":"";return t});if(n){var s=TS.interop.i18n.t("{private_channel_or_group_count, plural, =1{# private channel}other{# private channels}}","templates_builders")({private_channel_or_group_count:n});a.push('<span class="no_wrap'+(r.new_lines?" block":"")+'">'+s+"</span>")}if(r.new_lines)return a.join("");return TS.interop.i18n.listify(a,{noEscape:true}).join("")},makeMessageShareLabelSafe:function e(t){var r='<span class="message_share_label">';var n="";if(t.is_channel)n=TS.templates.builders.makeChannelLink(t,{inherit_font_size:true});else{if(!t.is_group)return"";n=TS.templates.builders.makeGroupLink(t,{inherit_font_size:true})}r+=TS.interop.i18n.t("in {channel}","templates_builders")({channel:TS.interop.i18n.safeString(n)});r+="</span>";return new Handlebars.SafeString(r)},makeMessageLinkLabelSafe:function e(t){var r=TS.interop.i18n.t("From URL:","templates_builders")()+" <a "+TS.utility.makeRefererSafeLink(t)+' class="external_link"title="'+_.escape(t)+'"target="_blank">'+_.escape(t)+"</a>";return new Handlebars.SafeString(r)},buildFileSharingControls:function e(t,r,n,i,a){var s=[];var o=[];var l=[];n=n||"";$("#file_sharing_div").remove();var u=false;var d=false;if(t){if(t.user===TS.model.user.id)u=true;else if(t.user){var c=TS.interop.members.getMemberById(t.user);c&&c.isExternal&&(d=TS.teams.getTeamNameByMember(c))}}else u=true;if(t&&t.id&&TS.files.isFilePrivate(t)&&!u&&!t.bot_id)var m=new Handlebars.SafeString(TS.interop.i18n.t("This file was sent to you privately. You may want to check with <strong>{user_names}</strong> before sharing it.","files")({user_names:TS.interop.i18n.safeString(_.escape(TS.interop.members.getPrefCompliantMemberNameById(t.user))),file_owners_count:1,file_count:1,file_title:t.title?TS.format.formatNoSpecials(t.title||"Untitled"):""}));if(t&&t&&t.mimetype&&-1!=t.mimetype.indexOf("application/vnd.google-apps")){var f=t.pretty_type?t.pretty_type.replace(/GDocs /,""):null;if(f){var p={teamFileSpreadsheet:TS.interop.i18n.t("Anyone at {team_name} with the link will be able to edit this Google Spreadsheet","templates_builders"),teamFilePresentation:TS.interop.i18n.t("Anyone at {team_name} with the link will be able to edit this Google Presentation","templates_builders"),teamFileDocument:TS.interop.i18n.t("Anyone at {team_name} with the link will be able to edit this Google Document","templates_builders"),fileSpreadsheet:TS.interop.i18n.t("Anyone with the link will be able to edit this Google Spreadsheet","templates_builders"),filePresentation:TS.interop.i18n.t("Anyone with the link will be able to edit this Google Presentation","templates_builders"),fileDocument:TS.interop.i18n.t("Anyone with the link will be able to edit this Google Document","templates_builders"),fallback:TS.interop.i18n.t("Anyone at {team_name} with the link will be able to edit this Google file","templates_builders")};var h;TS.model.team.name?f&&"Document"===f?h=p.teamFileDocument({team_name:TS.interop.rules.teams.getTeamDisplayName(TS.model.team)}):f&&"Spreadsheet"===f?h=p.teamFileSpreadsheet({team_name:TS.interop.rules.teams.getTeamDisplayName(TS.model.team)}):f&&"Presentation"===f&&(h=p.teamFilePresentation({team_name:TS.interop.rules.teams.getTeamDisplayName(TS.model.team)})):TS.model.team.name?h=p.fallback():f&&"Document"===f?h=p.fileDocument():f&&"Spreadsheet"===f?h=p.fileSpreadsheet():f&&"Presentation"===f&&(h=p.filePresentation())}}return TS.templates.file_sharing({channels:s,groups:o,members:l,file:t,file_sharing_notice:h,is_owner:u,owner_team:d,reshare_private_file:m,has_title:i,hide_checkbox:r,comment:n,selection:a,show_channel_join_note:false,disable_file_sharing_dialog_comment:d})},buildNonDefaultNotificationBlock:function e(t){t=t||"";var r="";var n;var i=TS.notifs.getCorGsNotUsingGlobalNotificationSetting();if(i.everything.length){r+='<div class="'+t+'">'+TS.interop.i18n.t("Set to notify for <strong>all activity</strong>:","templates_builders")();for(n=0;n<i.everything.length;n+=1)r+=" "+("C"===i.everything[n].id.charAt(0)?"#":"")+i.everything[n].name+(n!=i.everything.length-1?",":"");r+="</div>"}if(i.mentions.length){r+='<div class="'+t+'">'+TS.interop.i18n.t("Set to notify only for <strong>Highlight Words</strong>:","templates_builders")();for(n=0;n<i.mentions.length;n+=1)r+=" "+("C"===i.mentions[n].id.charAt(0)?"#":"")+i.mentions[n].name+(n!=i.mentions.length-1?",":"");r+="</div>"}if(i.nothing.length){r+='<div class="'+t+'">'+TS.interop.i18n.t("Set to <strong>never notify</strong>:","templates_builders")();for(n=0;n<i.nothing.length;n+=1)r+=" "+("C"===i.nothing[n].id.charAt(0)?"#":"")+i.nothing[n].name+(n!=i.nothing.length-1?",":"");r+="</div>"}return r},strBuilder:function e(t,r){return t.replace(/\${([a-z_]+)}/g,function(e,t){if(t.indexOf("_html")>-1)return r[t];return _.escape(r[t])})},buildRxnTitle:function e(t,r){if(!r&&!TS.web)return;var n;var i=":"+t.name+":";TS.interop.i18n.locale!==TS.interop.i18n.DEFAULT_LOCALE&&(i=TS.emoji.maybeGetLocalizedEmojiString(i));if(t.is_handy||t.is_poll&&!t.count){n=_.escape(i||t.name);return TS.interop.i18n.t("Add reaction {emoji}","rxn")({emoji:TS.interop.i18n.safeString(n)})}var a=false;var s=false;var o=true;n=_.escape(i||t.name);TS.emoji.isValidName(t.name)||t.url||(n+=" "+TS.interop.i18n.t("(emoji has been removed)","rxn")());if(1===t.count){if(t.user_reacted)return TS.interop.i18n.t('You (click to remove) <span class="subtle_silver">reacted with {emoji}</span>',"rxn")({emoji:n});return TS.interop.i18n.t('{user} <span class="subtle_silver">reacted with {emoji}</span>',"rxn")({user:TS.interop.i18n.safeString(_.escape(TS.interop.members.getPrefCompliantMemberNameById(t.member_ids[0],a,s,o))),emoji:TS.interop.i18n.safeString(n)})}var l=false;var u=t.member_ids.length!=t.count;var d=t.member_ids.map(function(e,t){var r;if(TS.model.user.id===e){l=true;r=0===t?TS.interop.i18n.t("You","rxn")():TS.interop.i18n.t("you","rxn")()}else r=TS.interop.members.getPrefCompliantMemberNameById(e,a,s,o);return r});u&&d.push(TS.interop.i18n.t("others","rxn")());if(l)return TS.interop.i18n.t('{users_and_you} <span class="subtle_silver">reacted with {emoji}</span>',"rxn")({users_and_you:TS.interop.i18n.safeString(_.escape(TS.interop.i18n.listify(d,{noEscape:true}).join(""))),emoji:TS.interop.i18n.safeString(n)});return TS.interop.i18n.t('{users} <span class="subtle_silver">reacted with {emoji}</span>',"rxn")({users:TS.interop.i18n.safeString(_.escape(TS.interop.i18n.listify(d,{noEscape:true}).join(""))),emoji:TS.interop.i18n.safeString(n)})},buildRxnHtml:function e(t){var r;var n=TS.emoji.isValidName(t.name);if(t.url)r='<span class="emoji-outer emoji-sizer emoji-bg-contain" style="background-image: url('+t.url+');"></span>';else if(n){var i=t.is_handy&&TS.emoji.isNameSkinToneModifiable(t.name)?TS.emoji.getChosenSkinToneModifier():"";r=TS.emoji.graphicReplace(":"+t.name+":"+i,{no_skin_tone_squares:t.is_handy,obey_emoji_mode_pref:true})}else r=TS.emoji.MISSING_EMOJI_HTML;var a=TS.templates.builders.buildRxnTitle(t);var s=[];t.user_reacted&&s.push("user_reacted");t.is_handy&&s.push("is_handy");t.is_hidden&&s.push("hidden");"as_text"===TS.prefs.getPref("emoji_mode")&&s.push("plain_text");return TS.templates.rxns_rxn({name:t.name,url:t.url,css_classes:s.join(" "),emoji_html:new Handlebars.SafeString(r),title:new Handlebars.SafeString(a||""),count:t.count,is_handy:!!t.is_handy,is_web:!!TS.web})},updateRxnHtml:function e(t,r){var n=t.children('.rxn[data-emoji="'+r.name+'"]');if(n.length){n.find(".emoji_rxn_count").attr("aria-label",r.count);n.toggleClass("user_reacted",r.user_reacted);var i=true;var a=TS.templates.builders.buildRxnTitle(r,i);var s;var o=n.find(".ts_tip_tip_inner");o.length||(o=n.find(".ts_tip_multiline_inner"));if(o.length){s=o.html();s!=a&&TS.tips.updateTipTitle(n,a)}else{s=n.prop("title");s!=a&&TS.tips.updateTipTitle(n,a)}r.animate_it_dramatically?setTimeout(r.animate_callback,0):r.animate_it&&setTimeout(r.animate_callback,0)}else{t.children(".rxn_hover_container").before($(TS.templates.builders.buildRxnHtml(r)));n=t.children('.rxn[data-emoji="'+r.name+'"]');r.animate_it_dramatically?n.css("opacity",0).transition({opacity:1},300,r.animate_callback):r.animate_it&&n.css("opacity",0).transition({opacity:1},300,r.animate_callback)}},updateRxnPanels:function e(t,r,n){var i=TS.rxns.getExistingRxnsByKey(t);var a=$("."+TS.templates.makeRxnKeyDomClass(t));var s=function e(a){var s;var o;i&&i.forEach(function(e){s=e.name==r;o=s&&n==TS.model.user.id;TS.templates.builders.updateRxnHtml(a,{animate_it:s,animate_it_dramatically:o,name:e.name,url:e.url,count:e.count,user_reacted:TS.rxns.doesRxnsHaveRxnFromUser(i,e.name),member_ids:e.users,rxn_key:t})});var l=a.children(".rxn");l.each(function(e,t){var r=$(t);var n=String(r.data("emoji"));if(!TS.rxns.doesRxnsHaveRxn(i,n)){r.addClass("going_away");r.transition({opacity:0},300,function(){r.remove()})}});TS.ui.messages.maybeUpdateMessageHoverContainer(a.closest("ts-message"));var u=a.children(".rxn_hover_container").find(".rxn.is_handy");u.each(function(e,t){var r=$(t);var n=String(r.data("emoji"));r.toggleClass("hidden",TS.rxns.doesRxnsHaveSkinlessRxn(i,n))})};a.each(function(e,r){var n=$(r);if(!i){n.empty();TS.ui.messages.maybeUpdateMessageHoverContainer(n.closest("ts-message"));return}n.children().length||(n=$(TS.templates.builders.rxnPanel(t)).replaceAll(n));s(n)})},rxnPanel:function e(t){if(!t)return;var r=[];var n={};var i="";var a=TS.rxns.getExistingRxnsByKey(t);var s="";var o=function e(){if(a){a=_.sortBy(a,function(e){return TS.emoji.isValidName(e.name)?0:1});a.forEach(function(e){s+=TS.templates.builders.buildRxnHtml({name:e.name,url:e.url,count:e.count,user_reacted:TS.rxns.doesRxnsHaveRxnFromUser(a,e.name),member_ids:e.users,rxn_key:t})})}_.each(_.keys(n.items),function(e){i+=TS.templates.builders.buildRxnHtml({name:e,is_handy:true,is_hidden:TS.rxns.doesRxnsHaveSkinlessRxn(a,e),rxn_key:t})})};o();return TS.templates.rxns_panel({css_classes:r.join(" "),rxn_key:t,rxns_html:new Handlebars.SafeString(s),handy_rxns_html:new Handlebars.SafeString(i),id_class:TS.templates.makeRxnKeyDomClass(t),has_hovers:!n.is_poll})},filePreviewBackIcon:function e(){return'<i class="ts_icon ts_icon_chevron_medium_left back_icon"></i>'},buildQuickSwitcherBtnHtml:function e(){var t=TS.interop.i18n.t("Quick Switcher","templates_builders")();(TS.model.is_our_app||TS.prefs.getPref("k_key_omnibox"))&&(t+=[" ",'<span class="subtle_silver">(',TS.model.is_mac?"&#8984K":"Ctrl+K",")</span>"].join(""));return'<i class="ts_icon ts_icon_filter"></i><span id="quick_switcher_label" class="ts_tip_tip">'+t+"</span>"},atLabel:function e(t){"group"===t&&(t="channel");var r=(_.keyBy(TS.interop.broadcast_keywords.getAllBroadcastKeywords(),"ms_name")[t]||{}).name||"channel";return"@"+r},makeMemberTypeBadgeClass:function e(t){if(!TS.boot_data.page_needs_enterprise)return"";if(!t.is_restricted)return"";return"has_member_type_badge"},makeMemberColorClass:function e(t){var r="color_";r+=t?t.id+" color_"+t.color:"unknown";return r},makeMemberTypeBadgeCompact:function e(t,r){if(!TS.boot_data.page_needs_enterprise)return"";"boolean"!==typeof r&&(r=false);var n={icon_class:"",with_tooltip:r,tooltip:{member_type:"",type_description:""}};var i=TS.boot_data.page_needs_enterprise?TS.interop.i18n.t("organization directory","templates_builders")():TS.interop.i18n.t("workspace directory","templates_builders")();if(t.isExternal)return"";if(t.is_ultra_restricted){n.icon_class="ts_icon_single_channel_guest";n.tooltip.member_type=TS.interop.i18n.t("Single-Channel Guests","templates_builders")();n.tooltip.type_description=TS.interop.i18n.t("see a partial {directory_name} and can only access messages and files from the channel they belong to.","templates_builders")({directory_name:i});return TS.templates.member_type_icon(n)}if(t.is_restricted){n.icon_class="ts_icon_restricted_user";n.tooltip.member_type=TS.interop.i18n.t("Multi-Channel Guests","templates_builders")();n.tooltip.type_description=TS.interop.i18n.t("see only a partial {directory_name} and can only access messages and files from selected channels.","templates_builders")({directory_name:i});return TS.templates.member_type_icon(n)}return""},getMemberTypeClass:function e(t){if(t.is_restricted)return" ra";return""},makeTeamlabel:function e(t){if(!t)return"ERROR: MISSING TEAM ID";var r="";var n=TS.teams.getTeamById(t);if(!n)return"ERROR: UNABLE TO GET TEAM INFO";r='<span class="org_team_tag_name">'+_.escape(n.name)+"</span>";return r},loadingHTML:function e(){return TS.templates.infinite_spinner({color:"white",size:"medium"})},buildThreadMsgHTML:function e(t,r,n,i){var a=!!_.get(i,"inline");var s=a?TS.templates.makeMsgDomId(t.ts):TS.templates.makeMsgDomIdInThreadsView(t.ts);return TS.templates.builders.msgs.buildHTML({msg_dom_id:s,model_ob:r,msg:t,is_threads_view:true,is_new_reply:TS.interop.messages.isReply(t)&&n&&t.ts>n.initial_last_read,relative_ts:true,enable_slack_action_links:true})},buildThreadParticipantListHTML:function e(t){var r;if(t.reply_users)r=t.reply_users;else{r=_.map(t.replies,"user");var n=_.map(t.replies,"bot_id");r=r.concat(n)}var i="UREVOKEDU";var a=_.includes(r,i);r=_.without(r,"U00",void 0,i);"tombstone"!==t.subtype&&t.user&&t.user!==i&&r.unshift(t.user);r=_.uniq(r);if(_.includes(r,TS.model.user.id)){r=_.without(r,TS.model.user.id);r.push(TS.model.user.id)}var s=_.map(r,function(e){var t;t="B"===e.charAt(0)?TS.interop.bots.getBotNameById(e):e===TS.model.user.id?TS.interop.i18n.t("you","threads")():TS.interop.members.getPrefCompliantMemberNameById(e);return t});if(0===r.length)return"";if(1===r.length){if(r[0]===TS.model.user.id)return TS.interop.i18n.t("Just you","threads")();return _.escape(s[0])}if(2===r.length){if(r[1]===TS.model.user.id)return TS.interop.i18n.t("{user_name} and you","threads")({user_name:TS.interop.i18n.safeString(_.escape(s[0]))});return TS.interop.i18n.t("{user_name1} and {user_name2}","threads")({user_name1:TS.interop.i18n.safeString(_.escape(s[0])),user_name2:TS.interop.i18n.safeString(_.escape(s[1]))})}if(3===r.length){if(r[2]===TS.model.user.id)return TS.interop.i18n.t("{user_name1}, {user_name2}, and you","threads")({user_name1:TS.interop.i18n.safeString(_.escape(s[0])),user_name2:TS.interop.i18n.safeString(_.escape(s[1]))});return TS.interop.i18n.t("{user_name1}, {user_name2}, and {user_name3}","threads")({user_name1:TS.interop.i18n.safeString(_.escape(s[0])),user_name2:TS.interop.i18n.safeString(_.escape(s[1])),user_name3:TS.interop.i18n.safeString(_.escape(s[2]))})}if(r.length>3){var o;if(t.reply_users_count){o=t.reply_users_count;a&&(o-=1)}else o=r.length;var l=o-2;var u=_.drop(s,2);if(t.reply_users_count&&u.length<l)u.push(TS.interop.i18n.t("others","threads")());else{var d=25;if(u.length>d){u=_.take(u,d);u.push(TS.interop.i18n.t("others","threads")())}}var c=TS.interop.i18n.listify(u,{noEscape:true}).join("");return TS.templates.thread_participants_with_overflow({num_others:l,user_name1:s[0],user_name2:s[1],other_names:c})}},buildBroadcastRepliersSummaryHTML:function e(t){var r=t.reply_count;var n;var i;if(t.reply_users){n=t.reply_users;i=t.reply_users_count}else{var a=t.replies;if(!a||!a.length)return"";n=_.map(a,"user");n=_.uniq(n);i=n.length}var s=_.map(n,function(e){if("U00"===e)return null;var t=e.charAt(0);var r;r="B"===t?TS.interop.bots.getBotById(e):TS.redux.members.getPotentiallyUnknownMemberById(e);return r});s=_.compact(s);if(!r||!s.length)return"";if(1===r)return TS.interop.i18n.t("1 reply","threads")();var o=!!_.find(s,{is_self:true});if(o){s=_.reject(s,{is_self:true});s.push(TS.model.user)}var l=_.map(s,function(e){if(e.is_bot)return e.name;if(e.is_self)return TS.interop.i18n.t("you","threads")();return TS.interop.members.getPrefCompliantMemberName(e)});if(1===s.length){if(o)return TS.interop.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from you","threads")({reply_count:r});return TS.interop.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name}","threads")({reply_count:r,user_name:TS.interop.i18n.safeString(_.escape(l[0]))})}if(2===s.length){if(o)return TS.interop.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name} and you","threads")({reply_count:r,user_name:TS.interop.i18n.safeString(_.escape(l[0]))});return TS.interop.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name1} and {user_name2}","threads")({reply_count:r,user_name1:TS.interop.i18n.safeString(_.escape(l[0])),user_name2:TS.interop.i18n.safeString(_.escape(l[1]))})}if(3===s.length){if(o)return TS.interop.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name1}, {user_name2}, and you","threads")({reply_count:r,user_name1:TS.interop.i18n.safeString(_.escape(l[0])),user_name2:TS.interop.i18n.safeString(_.escape(l[1]))});return TS.interop.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name1}, {user_name2}, and {user_name3}","threads")({reply_count:r,user_name1:TS.interop.i18n.safeString(_.escape(l[0])),user_name2:TS.interop.i18n.safeString(_.escape(l[1])),user_name3:TS.interop.i18n.safeString(_.escape(l[2]))})}if(s.length>3){var u=_.drop(l,2);u.length<i-2&&u.push(TS.interop.i18n.t("others","threads")());var d=TS.interop.i18n.listify(u,{noEscape:true}).join("");return TS.templates.thread_broadcast_repliers_with_overflow({reply_count:r,num_others:i-2,user_name1:l[0],user_name2:l[1],other_names:d})}return""},buildMemberCustomStatusExpiration:function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n=TS.interop.members.getMemberCurrentStatus(TS.redux.getState(),t.id);if(n&&n.expiration){var i=TS.interop.datetime.formatDate(n.expiration,"{status_expiration}",{do24hrTime:TS.prefs.getPref("time24")});var a=TS.interop.i18n.t("Until {expirationDate}","current_status")({expirationDate:i});var s=r.inline?"span":"p";var o=r.inline?"no_wrap":"no_bottom_margin";return"<"+s+' class="sk_foreground_max current_status_expiration '+o+'" data-member-id="'+t.id+'">'+a+"</"+s+">"}return""},replaceEmojiForPosts:function e(t){if(t.childNodes)for(var r=0;r<t.childNodes.length;r+=1)TS.templates.builders.replaceEmojiForPosts(t.childNodes[r]);if(t.nodeType==Node.TEXT_NODE){var n=_.escape(t.textContent);var i=TS.emoji.graphicReplace(TS.emoji.legacyReplaceEmoticons(n),{include_title:true,include_text:false});if(i!==n){var a=$("<span>").html(i)[0];[].slice.apply(a.childNodes).forEach(function(e){t.parentNode.insertBefore(e,t)});t.parentNode.removeChild(t)}}},formatPostsForModern:function e(t){var r=$("<div>").html(t);TS.templates.builders.replaceEmojiForPosts(r[0]);TS.utility.makeSureAllLinksHaveTargets(r);return r.html()},proxyImgUrlsForEmails:function e(t){t.find("img").each(function(){var e=$(this).attr("src");var t=$(this).attr("width");var r=$(this).attr("height");var n;n=t&&r?TS.utility.getImgProxyURL(e,t,r):TS.utility.getImgProxyURL(e);$(this).attr("src",n)})},formatEmailsForModern:function e(t){var r=$("<div>").html(t);TS.templates.builders.proxyImgUrlsForEmails(r);TS.utility.makeSureAllLinksHaveTargets(r);return r.html()},formatFileTitle:function e(t){if(!t||!t.title)return"";var r=t.title;r=_.unescape(r);r=_.escape(r);return TS.format.formatWithOptions(r,null,{no_specials:true})},test:function e(){var r={};Object.defineProperty(r,"_buildStarComponents",{get:function e(){return t},set:function e(r){t=r}});return r}});function e(e){var t="";var r=e.unread_highlight_cnt;var n=e.unread_cnt;r&&!e.is_im?t+=r+" "+TS.interop.i18n.t("unread highlight","templates_builders")()+" ":n&&(t+=n+" "+TS.interop.i18n.t("unread","templates_builders")()+" ");n&&(t+=TS.interop.i18n.t("{count, plural, =1 {message} other {messages}}","templates_builders")({count:n}));return t}function t(e,t,r,n){if(!e)return{};!t||"string"!==typeof t||"channel"!==e&&"group"!==e&&"mpim"!==e&&"im"!==e||(t=TS.redux.channels.getEntityById(t));if(!t)return{};if("message"===e&&r&&"string"===typeof r){var i=r;r=TS.interop.channels.getPublicChannelById(i);r||(r=TS.interop.channels.getImById(i));r||(r=TS.interop.channels.getGroupById(i))}var a={};var s=[];var o=[];o=["star","ts_icon","ts_icon_star_o","ts_icon_inherit"];var l="ts_tip_top";var u=t.id||t.ts;var d=r?r.id:null;if("message"===e){if(!d)return{};a["data-msg-id"]=u;a["data-c-id"]=d;TS.interop.rules.messages.isTempMsg(t)&&o.push("invisible")}else if("file"===e)a["data-file-id"]=u;else if("file_comment"===e){a["data-comment-id"]=u;a["data-file-id"]=d;o.push("star_comment")}else if("channel"===e){l="ts_tip_bottom";a["data-channel-id"]=u}else if("group"===e){l="ts_tip_bottom";a["data-group-id"]=u}else if("im"===e){l="ts_tip_bottom";a["data-im-id"]=u}else{if("mpim"!==e){TS.error("buildStar needs to handle star item type:"+e);return{}}l="ts_tip_bottom";a["data-mpim-id"]=u}o=_.concat(o,l);if(t.is_starred){o.push("starred","ts_icon_star");o.splice(o.indexOf("ts_icon_star_o"),1)}o.push("star_"+e);$.each(a,function(e,t){s.push(e+'="'+t+'"')});var c={message:TS.interop.i18n.t("message","templates_builders")(),file:TS.interop.i18n.t("file","templates_builders")(),file_comment:TS.interop.i18n.t("file comment","templates_builders")(),channel:TS.interop.i18n.t("channel","templates_builders")(),group:TS.interop.i18n.t("channel","templates_builders")(),im:TS.interop.i18n.t("direct message","templates_builders")(),app:TS.interop.i18n.t("app","templates_builders")(),mpim:TS.interop.i18n.t("direct message","templates_builders")()};var m;var f;switch(e){case"message":if(n){m=TS.interop.i18n.t("Star message","templates_builders","34b1d30c4ba28fdac168af2100272fd9aeac1ad5")();f=TS.interop.i18n.t("Unstar message","templates_builders","1e8aec29618ad627c4756e1922c40c8fcb3aea86")()}else{m=TS.interop.i18n.t("Star this message","templates_builders")();f=TS.interop.i18n.t("Unstar this message","templates_builders")()}break;case"file":if(n){m=TS.interop.i18n.t("Star file","templates_builders","42dd9b61d10f324bfe3bb8f2a5e7dc13ae2d8fea")();f=TS.interop.i18n.t("Unstar file","templates_builders","92e7358e95824d6d7d58ad708dbb20e47656ad6d")()}else{m=TS.interop.i18n.t("Star this file","templates_builders")();f=TS.interop.i18n.t("Unstar this file","templates_builders")()}break;case"file_comment":if(n){m=TS.interop.i18n.t("Star file comment","templates_builders","23db127e219e9451f6f2cc9adbc4cc57ba9f8b07")();f=TS.interop.i18n.t("Unstar file comment","templates_builders","6981fc4436ea029ab4dd573937de729fc0f7a50b")()}else{m=TS.interop.i18n.t("Star this file comment","templates_builders")();f=TS.interop.i18n.t("Unstar this file comment","templates_builders")()}break;case"channel":case"group":if(n){m=TS.interop.i18n.t("Star channel","templates_builders","f314f33a825d5dc3ac1683638acc464b2aae62fc")();f=TS.interop.i18n.t("Unstar channel","templates_builders","1f6e79ac454ab33de1d19b242a90c340317ae97e")()}else{m=TS.interop.i18n.t("Star this channel","templates_builders")();f=TS.interop.i18n.t("Unstar this channel","templates_builders")()}break;case"im":case"mpim":if(n){m=TS.interop.i18n.t("Star direct message","templates_builders","a04b360e228e052a9853fbe7203ab22697daade3")();f=TS.interop.i18n.t("Unstar direct message","templates_builders","d7d5187810a018277ffe3561a0e29edcc5b3528d")()}else{m=TS.interop.i18n.t("Star this direct message","templates_builders")();f=TS.interop.i18n.t("Unstar this direct message","templates_builders")()}break;case"app":if(n){m=TS.interop.i18n.t("Star app","templates_builders","74f6a6535ed4abed0178d1f93f41429ea6a3ed6a")();f=TS.interop.i18n.t("Unstar app","templates_builders","fc640532bd4741f719542e97c41e2a68db1b3b52")()}else{m=TS.interop.i18n.t("Star this app","templates_builders")();f=TS.interop.i18n.t("Unstar this app","templates_builders")()}break;default:m=TS.interop.i18n.t("Star","templates_builders")();f=TS.interop.i18n.t("Unstar","templates_builders")();break}return{attributes:s,class_names:o,html_attrs:a,readable_type:c[e],type:e,is_starred:t.is_starred,star_str:m,unstar_str:f}}var r=Date.now()})()},jAhp:function(e,t){(function(){TS.registerModule("search",{search_dispatched_sig:new signals.Signal,quick_search_results_fetched_sig:new signals.Signal,all_search_results_fetched_sig:new signals.Signal,message_search_results_fetched_sig:new signals.Signal,file_search_results_fetched_sig:new signals.Signal,autosuggest_search_results_fetched_sig:new signals.Signal,search_filter_set_sig:new signals.Signal,search_filetype_filter_set_sig:new signals.Signal,search_sort_set_sig:new signals.Signal,search_channel_set_sig:new signals.Signal,search_group_set_sig:new signals.Signal,search_member_set_sig:new signals.Signal,message_search_more_results_fetched_sig:new signals.Signal,query:"",query_string:"",query_string_for_display:"",last_search_query:"",previous_query:"",sort:"timestamp",filter:"all",filetype:"all",results:{},submit_tim:0,delay:500,suggestions:[],input:"",from_regex:/from:[@*\-.\w]+/gi,member:null,from:null,in_regex:/in:[#*\-.\w]+/gi,channel:null,group:null,im:null,per_page:-1,keyword_modifiers:["after","before","bot","during","from","to","has","in","on"],keyword_modifier_pair_regex:null,keyword_modifier_extract_regex:null,search_query_max_length:250,skip_next_search:false,refinement_version:1,onStart:function e(){TS.search.keyword_modifier_pair_regex=new RegExp("^("+TS.search.keyword_modifiers.join("|")+"):\\S+$");TS.search.keyword_modifier_extract_regex=new RegExp("^("+TS.search.keyword_modifiers.join("|")+"):\\w*");TS.search.per_page=parseInt(TS.qs_args.search_count,10)||20;TS.web&&TS.web.login_sig.add(TS.search.loggedIn,TS.search);TS.search.search_channel_set_sig.add(TS.search.searchAll,TS.search);TS.search.search_group_set_sig.add(TS.search.searchAll,TS.search);TS.search.search_member_set_sig.add(TS.search.searchAll,TS.search);TS.prefs.search_only_my_channels_changed_sig.add(TS.search.searchAll,TS.search);TS.prefs.search_only_current_team_changed_sig.add(TS.search.searchAll,TS.search);TS.prefs.search_exclude_bots_changed_sig.add(TS.search.searchAll,TS.search);TS.files.team_file_changed_sig.add(m);TS.qs_args.delay&&(TS.search.delay=TS.qs_args.delay);"treatment"==TS.interop.experiments.getGroupForUser("sli_all_tab")&&(TS.search.filter="messages");TS.search.input=$("#search_terms");var t=[];TS.search.autocomplete||(t=["members"]);TS.utility.contenteditable.create(TS.search.input,{modules:{slacksearch:true,tabcomplete:{completers:t,positionMenu:function e(t){var r=$(TS.search.input);var n=r.offset();var i=355;var a=31;var s=i-r.outerWidth();var o=n.left-s+a;var l=12;var u=n.top+r.height()+l;t.style.width=i+"px";t.style.top=u+"px";t.style.left=o+"px"},render:function e(t,r,n){var i=_.filter(n,function(e){if(e.is_usergroup)return false;return true});var a=_.remove(i,function(e){return e.deleted});var s={menu_type:"user",noResults:!i&&!a,users:i,users_deleted:a,show_ja_modifier_subtitle:"ja-JP"==TS.interop.i18n.locale};return TS.templates.search_menu(s)},onRender:function e(){TS.tips.texty.hide();TS.utility.rAF(function(){$("#chat_input_tab_ui").addClass("search_menu");f()})}}},singleLineInput:true,placeholder:TS.interop.i18n.t("Search","page_client")(),ariaLabel:TS.interop.i18n.t("Search","page_client")(),onFocus:function e(){$("#client-ui").addClass("search_focused");TS.utility.contenteditable.setCursorAtEnd(TS.search.input);if(TS.interop.searchUi.getVisible())return;TS.search.autocomplete.setUpMenu();TS.search.autocomplete.triggerInputEvent("focus")},onBlur:function e(){$("#client-ui").removeClass("search_focused");TS.search.autocomplete.maybeLogSearchInputBlur();TS.search.autocomplete.triggerInputEvent("blur")},onEnter:function e(){TS.search.autocomplete.triggerInputEvent("on-enter");TS.search.skip_next_search||TS.search.submitSearch();TS.search.skip_next_search=false;return true},onTextChange:function e(){var t=TS.utility.contenteditable.isEmpty(TS.search.input);$("#header_search_form").toggleClass("active",!t)},onEscape:function e(){$(".search_menu").is(":visible")||TS.utility.contenteditable.blur(TS.search.input);TS.search.autocomplete.triggerInputEvent("on-escape")},onTab:function e(){TS.search.autocomplete.triggerInputEvent("on-tab");return true}})},loggedIn:function e(){"recency"===TS.interop.experiments.getGroupForUser("sli_default_sorting")?TS.search.sort="timestamp":"relevance"===TS.interop.experiments.getGroupForUser("sli_default_sorting")?TS.search.sort="score":TS.search.sort="timestamp"},startSearchTimer:function e(t,r,n,i,a){clearTimeout(TS.search.submit_tim);TS.search.submit_tim=setTimeout(TS.search.dispatchSearch,TS.search.delay,t,r,n,i,null,a);TS.search.search_dispatched_sig.dispatch()},getNextPageOfSearchResults:function e(t,r,n){TS.search.dispatchSearch(t,r,TS.search.per_page,TS.search.onSearchAll,n,null)},getNextPageOfMessageResults:function e(t,r,n){l("search.messages",t,r,TS.search.per_page,n,u,null)},getNextPageOfFileResults:function e(t,r,n){l("search.files",t,r,TS.search.per_page,n,d,null)},extractNonModifierSearchTxt:function e(t){var r="";var n=t.split(" ");n.forEach(function(e){if(e.match(TS.search.keyword_modifier_extract_regex))return;r+=" "+e});r=$.trim(r);return r},dispatchSearch:function e(t,r,n,i,a,s){TS.interop.console.info("SEARCH","Entering dispatchSearch");TS.interop.console.info("SEARCH","In dispatchSearch after boot is complete");if(!a||1===a){var o=TS.search.extractNonModifierSearchTxt(t);o&&TS.interop.desktop.writeFindString(o)}TS.search.updateSessionsUponSearch();if(TS.search.separateMessagesAndFiles()){a&&1!==a||(TS.search.results[t]=null);var u=c();l("search.messages",t,r,n,a,u.msgs,s);l("search.files",t,r,n,a,u.files,s)}else l("search.all",t,r,n,a,i,s)},setFilter:function e(t){TS.search.filter=t;TS.search.search_filter_set_sig.dispatch()},setFiletypeFilter:function e(t){TS.search.filetype=t;TS.search.search_filetype_filter_set_sig.dispatch()},getModuleSort:function e(){if("files"==TS.search.filter)return"auto";if("messages"==TS.search.filter)return TS.search.sort;return null},getLastRequestId:function e(){if("files"==TS.search.filter)return TS.search.last_files_request_id;if("messages"==TS.search.filter||"all"==TS.search.filter)return TS.search.last_request_id;return null},hasCachedRelevantResults:function e(){return("messages"===TS.search.filter||"all"===TS.search.filter)&&_.has(TS.search.results[TS.search.query].messages,"modules.score")},hasCachedRecentResults:function e(){return("messages"===TS.search.filter||"all"===TS.search.filter)&&_.has(TS.search.results[TS.search.query].messages,"timestamp_messages")},topResultsFeedback:function e(t,r){var n=[":bow:"];if("top_results_useful"===r){var i=Math.floor(5*Math.random())+2;n=[":tada:",":raised_hands::skin-tone-"+i+":"]}var a=n[Math.floor(Math.random()*n.length)];$(t).closest(".top_results_feedback").html("Thanks for your feedback! "+TS.emoji.graphicReplace(a));TS.interop.clog.track("SEARCH_FEEDBACK",{search_feedback_value:r,request_id:TS.search.last_request_id,search_session_id:TS.search.getSearchSessionId()})},setSort:function e(t,r){if(TS.search.sort===t)return;$(".search_toggle").toggleClass("active");TS.search.sort=t;TS.search.search_sort_set_sig.dispatch();"score"!==t&&"model"!==t&&(t="timestamp");TS.prefs.setPrefByAPI({name:"search_sort",value:t});"timestamp"===t&&TS.search.hasCachedRecentResults()?TS.search.switchToRecent():"score"===t&&TS.search.hasCachedRelevantResults()?TS.search.switchToRelevant():r||TS.search.searchAll()},setChannel:function e(t){var r=TS.interop.channels.getPublicChannelById(t);if(r){TS.search.channel=r;TS.search.group=null;TS.search.im=null}else TS.search.channel=null;TS.search.search_channel_set_sig.dispatch()},setGroup:function e(t){var r=TS.interop.channels.getGroupById(t);if(r){TS.search.group=r;TS.search.channel=null;TS.search.im=null}else TS.search.group=null;TS.search.search_group_set_sig.dispatch()},setMember:function e(t){var r=TS.interop.members.getMemberById(t);if(r)TS.search.member=r;else{TS.search.member=null;TS.search.from=null;var n=TS.utility.contenteditable.value(TS.search.input).trim();var i=n.match(TS.search.from_regex);if(i){$.each(i,function(e,t){n=$.trim(n.replace(t,""))});TS.utility.contenteditable.value(TS.search.input,n)}}TS.search.search_member_set_sig.dispatch()},searchAll:function e(t,r){TS.interop.console.info("SEARCH","Entering searchAll");if(window.desktop&&desktop.teams&&desktop.teams.getCurrentTeam&&TS.boot_data.page_needs_enterprise&&desktop.teams.getCurrentTeam().team_id&&desktop.teams.getCurrentTeam().team_id!=TS.model.team.id){TS.interop.console.info("SEARCH","In searchAll current team id "+desktop.teams.getCurrentTeam().team_id+" and "+TS.model.team.id+" differ");return}clearTimeout(TS.search.widget.key_tim);TS.search.previous_query=TS.search.query;TS.search.query_string=t?_.trim(t):_.trim(TS.utility.contenteditable.value(TS.search.input));TS.search.query=TS.interop.texty.convertContentsStringForEncodedMembers(TS.search.query_string,{highlightWords:TS.interop.prefs.getHighlightWords(),shouldRenderEmojiAsText:TS.interop.rules.emoji.shouldRenderEmojiAsText(),emojiNames:TS.emoji.legacyGetEmojiNames(),useSonicEmoji:TS.boot_data.feature_sonic_emoji,locale:TS.interop.i18n.locale});TS.search.query_string_for_display=TS.interop.texty.convertContentsStringToDisplayString(TS.search.query_string,TS.interop.prefs.getHighlightWords());if(TS.search.query_string){TS.interop.console.info("SEARCH","In searchAll startSearchTimer for TS.search.onSearchAll");TS.search.startSearchTimer(TS.search.query,TS.search.query_string,TS.search.per_page,TS.search.onSearchAll,r)}else{TS.interop.console.info("SEARCH","In searchAll with empty query");TS.search.widget.stopSpinner()}},onSearchAll:function e(t,r,n){TS.interop.console.info("SEARCH","Entering onSearchAll");if("1"===TS.qs_args.force_search_fail){window.failed_once=true;t=false;r={ok:false,error:"solr_failed"}}if(!t){var i=r&&r.error?r.error:"unknown_error";r||(r={ok:false,error:i});TS.interop.console.error("SEARCH","In onSearchAll search failed with "+i);r.query=r.query||n.query;r.messages=r.messages||{total:0,paging:{count:TS.search.per_page,total:0,page:1,pages:0},matches:[]};r.files=r.files||{total:0,paging:{count:TS.search.per_page,total:0,page:1,pages:0},matches:[]}}if(n.query!==TS.search.query&&(!TS.search.results[n.query]||!TS.search.results[n.query].error)){TS.interop.console.info("SEARCH","In onSearchAll returning from same last query");return}TS.search.last_search_query=n.query;TS.search.expandChannelsAndCheckForMsgsInModel(r);if(1===n.page){TS.search.results[n.query]=r;TS.search.results[n.query]._time_of_search=Date.now();TS.search.all_search_results_fetched_sig.dispatch(r,n);TS.search.getNextPageOfSearchResults(n.query,n.query_string,2)}else{var a=TS.search.results[n.query];a.messages.matches&&(r.messages.matches=a.messages.matches.concat(r.messages.matches));a.files.matches&&(r.files.matches=a.files.matches.concat(r.files.matches));TS.search.results[n.query]=r;TS.search.all_search_results_fetched_sig.dispatch(r,n)}},searchSuggest:function e(t){var r=TS.search.getQuerySessionId();var n=(new Date).getTime();TS.interop.api.call("search.autocomplete",{query:t,client_request_id:r,search_session_id:TS.search.getSearchSessionId()}).then(function(e){var t=e.data,i=e.args,a=e.request_id;var s=true;TS.search.onSearchSuggest&&TS.search.onSearchSuggest(s,t,i,a);TS.interop.clog.track("SEARCH_AUTOCOMPLETE",{client_request_id:r,search_session_id:TS.search.getSearchSessionId(),request_duration_ms:(new Date).getTime()-n});return{data:t,args:i,request_id:a}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;TS.search.onSearchSuggest&&TS.search.onSearchSuggest(i,t,r,n);return{data:t,args:r,request_id:n}})},onSearchSuggest:function e(t,r,n,i){if(TS.search.widget.suppress_suggestions){TS.search.widget.suppress_suggestions=false;return}if(!t)return;TS.search.suggestions=[];if(r.suggestions[0]===TS.search.query&&1===r.suggestions.length)TS.search.suggestions=[];else{var a=/<@([^>]+)>/gi;var s=[];r.suggestions.forEach(function(e){e.replace(a,function(e,t){s.push(t)})});s=_.uniq(s);TS.interop.members.ensureMembersArePresent(s).then(function(){for(var e=0;e<r.suggestions.length;e+=1){var t=r.suggestions[e];t=t.replace(a,function(e,t){var r=TS.interop.members.getMemberById(t);if(r)return TS.interop.texty.getMemberAsContentsString(r);return e});TS.search.suggestions[e]={value:t,highlighted:TS.search.highlightSuggestion(_.escape(t))};r.suggestions[e]=t}TS.search.autosuggest_search_results_fetched_sig.dispatch(r,n,i)})}},highlightSuggestion:function e(t){var r=TS.utility.contenteditable.value(TS.search.input);var n=new RegExp("("+TS.utility.preg_quote(r)+")","gi");var i=t.replace(n,"<b>$1</b>");return i},expandChannelsAndCheckForMsgsInMatch:function e(t){var r;var n=t.channel.id;var i;o(t,n);s.forEach(function(e){if(!t[e])return;o(t[e],n)});i=TS.rxns.getExistingRxnsByKey(t._rxn_key);i&&!t.reactions?TS.warn("msg:"+t.ts+" has reactions in local model, but we got an object in search results that does NOT have reactions, which seems suspicious"):TS.rxns.upsertRxnsFromDataAndUpdateUI(t._rxn_key,t.reactions);r=TS.redux.channels.getEntityById(n);if(r){"im"!==t.type||TS.interop.channels.isImWithDeletedMember(r)||(t.im_exists=true);r.msgs&&(t.is_loaded=!!TS.utility.msgs.getMsg(t.ts,r.msgs));t.channel=r;t.permalink||(t.permalink=TS.utility.msgs.constructMsgPermalink(r,t.ts))}},expandChannelsAndCheckForMsgsInModel:function e(t){var r;var n;if(!t.messages||!t.messages.matches)return;for(n=0;n<t.messages.matches.length;n+=1){r=t.messages.matches[n];if(!r)continue;TS.search.expandChannelsAndCheckForMsgsInMatch(r)}if(t.messages.modules&&t.messages.modules.score){for(n=0;n<t.messages.modules.score.matches.length;n+=1){r=t.messages.modules.score.matches[n];if(!r)continue;TS.search.expandChannelsAndCheckForMsgsInMatch(r)}if(t.messages.modules.score.top_results)for(n=0;n<t.messages.modules.score.top_results.length;n+=1){r=t.messages.modules.score.top_results[n];if(!r)continue;TS.search.expandChannelsAndCheckForMsgsInMatch(r)}}},upsertFiles:function e(t){if(!t.files||!t.files.matches)return;for(var r=0;r<t.files.matches.length;r+=1){if(t.files.matches[r].preview){t.files.matches[r].preview_search=t.files.matches[r].preview;delete t.files.matches[r].preview}var n=null;if(t.files.matches[r].title){n=t.files.matches[r].title;t.files.matches[r].title=t.files.matches[r].title.replace(/[\ue000\ue001]/g,"")}var i=null;if(t.files.matches[r].name){i=t.files.matches[r].name;t.files.matches[r].name=t.files.matches[r].name.replace(/[\ue000\ue001]/g,"")}t.files.matches[r]=$.extend({},TS.files.upsertFile(t.files.matches[r],"upsertFilesSearch").file,{title:n||t.files.matches[r].title,name:i||t.files.matches[r].name})}},getResultsByQuery:function e(t){return TS.search.results[t]},getMatchByQueryAndTs:function e(t,r){return TS.search.getMatchByQueryByThings(t,r)},getMatchByQueryAndChannelAndTs:function e(t,r,n){return TS.search.getMatchByQueryByThings(t,n,r)},getMatchByQueryAndChannelAndTsAndModule:function e(t,r,n,i,a){var s=TS.search.getResultsByQuery(r);if(!s){TS.error("WTF no results?");return null}if(!s.messages.modules){TS.error("WTF no results.messages.modules?");return null}s.messages.modules[a]||TS.error("WTF no results.messages.modules."+a+"?");var o;for(var l=0;l<s.messages.modules[a].top_results.length;l+=1){o=s.messages.modules[a].top_results[l];if(!o){TS.error("WTF no match?");continue}if((!n||o.channel.id===n)&&o.ts===i){if(t)return{match:o,index:l};return o}}return null},getMatchByQueryByThings:function e(t,r,n){var i=TS.search.getResultsByQuery(t);if(!i){TS.error("WTF no results?");return null}return TS.search.getMatchFromResultsByThings(true,i,r,n)},getMatchFromResultsByThings:function e(t,r,n,i){if(!r){TS.error("WTF no results?");return null}if(!r.messages){TS.error("WTF no results.messages?");return null}if(!r.messages.matches){TS.error("WTF no results.messages.matches?");return null}var a;for(var s=0;s<r.messages.matches.length;s+=1){a=r.messages.matches[s];if(!a){TS.error("WTF no match?");continue}if((!i||a.channel.id===i)&&a.ts===n){if(t)return{match:a,index:s};return a}}return null},truncateQuery:function e(t){if(t.length>TS.search.search_query_max_length)return t.substring(0,TS.search.search_query_max_length);return t},resetSearchOptions:function e(){TS.search.channel=null;TS.search.group=null;TS.search.im=null;TS.search.member=null;TS.search.from=null;TS.search.searchAll()},saveSearch:function e(t,r){if(!t.terms)return;t.terms=$.trim(t.terms);if(TS.search.keyword_modifier_pair_regex.test(t.terms))return;TS.interop.api.call("search.save",t).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;r&&r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r&&r(a,t,n,i);return{data:t,args:n,request_id:i}})},separateMessagesAndFiles:function e(){return false},setInputVal:function e(t){TS.utility.contenteditable.value(TS.search.input,t);TS.utility.contenteditable.focus(TS.search.input)},submitSearch:function e(){TS.search.input.closest("form").trigger("submit")},searchSessionExpired:function r(){var n=e;e=new Date;return!n||Date.now()-n>t},querySessionExpired:function e(){return TS.search.searchSessionExpired()},getSearchSessionId:function e(){(TS.search.searchSessionExpired()||null==r)&&(r=TS.interop.utility.uuidv4());return r},maybeSetQuerySessionId:function e(){if(null==i||TS.search.querySessionExpired()){i=TS.interop.utility.uuidv4();TS.interop.clog.track("SEARCH_QUERY_SESSION",{request_id:TS.search.last_request_id,search_session_id:TS.search.getSearchSessionId(),client_request_id:i})}},getQuerySessionId:function e(){TS.search.maybeSetQuerySessionId();return i},getSearchSessionIdForResults:function t(){TS.search.getSearchSessionId()==n&&(e=new Date);return n},getQuerySessionIdForResults:function e(){return a},querySessionEnd:function e(){i=null},searchSessionEnd:function e(){r=null;TS.search.querySessionEnd()},updateSessionsUponSearch:function e(){a=TS.search.getQuerySessionId();n=TS.search.getSearchSessionId();TS.search.querySessionEnd()},debugQuery:function e(t,r){var n="/mc/search_eval_query.php?team_id="+t+"&user_id="+r+"&query="+encodeURIComponent(TS.search.query);window.open(n)},debugFileQuery:function e(t,r){var n="/mc/search_eval_file_query.php?team_id="+t+"&user_id="+r+"&active_cid="+TS.model.active_cid+"&query="+encodeURIComponent(TS.search.query);window.open(n)},getSort:function e(t){return"search.files"===t?"auto":TS.search.sort},shouldGetTopResults:function e(t){if("recency"===TS.interop.experiments.getGroupForUser("sli_default_sorting"))return false;if("relevance"===TS.interop.experiments.getGroupForUser("sli_default_sorting"))return false;return 1==t?1:0}});var e;var t=3e5;var r=null;var n=null;var i=null;var a=null;var s=["next","next_2","previous","previous_2"];var o=function e(t,r){t._rxn_key=TS.rxns.getRxnKey("message",t.ts,r);TS.utility.msgs.processAttachments(t.attachments);t.extracts&&t.extracts.length&&t.extracts.forEach(function(e){e._rxn_key=t._rxn_key})};var l=function e(t,r,n,i,a,s,o){TS.interop.console.info("SEARCH","Entering _callSearchPerSe "+t);var l=t.replace(".","_");var u="start_dispatch_"+l;TS.telemeter.mark(u);var d=a||1;var c={query:TS.emoji.maybeGetCanonicalEmojiString(r),query_string:n,highlight:true,count:i,types:[TS.search.filetype],sort:TS.search.getSort(t),page:d,extracts:1,extra_message_data:1,max_extract_len:150,highlight_attachments:1,active_cid:TS.model.active_cid,top_results:TS.search.shouldGetTopResults(d),experts:1==d?1:0,locale:TS.interop.i18n.isPseudoLocale()?"pseudo":TS.interop.i18n.locale,search_tab_open:"search"==TS.model.ui.active_tab_id,search_tab_filter:TS.search.filter,search_tab_sort:TS.search.getModuleSort(TS.search.filter),client_req_id:TS.search.getQuerySessionIdForResults(),search_session_id:TS.search.getSearchSessionIdForResults(),no_user_profile:true};"search.all"===t&&(c.no_posts=1);"search.files"!==t&&(c.more_matches=true);if("search.messages"===t){c.refinement_version=TS.search.refinement_version;if(o){o.refinement_client_request_id&&(c.refinement_client_request_id=o.refinement_client_request_id);o.refinement_iid&&(c.refinement_iid=o.refinement_iid);o.refinement_session_id&&(c.refinement_session_id=o.refinement_session_id);o.refinement_request_id&&(c.refinement_request_id=o.refinement_request_id);o.suppress_refinements&&(c.suppress_refinements=1)}}if(TS.boot_data.page_needs_enterprise&&TS.boot_data.enterprise_api_token){c.enterprise_token=TS.boot_data.enterprise_api_token;"search.messages"===t&&(c.team=TS.model.team.id)}TS.interop.api.call(t,c).then(function(e){var t=e.data,r=e.args,n=e.request_id;TS.telemeter.measure(u,l+"_response");var i=true;s&&s(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;TS.interop.console.error("SEARCH","_callSearchPerSe failed");var i=false;s&&s(i,t,r,n);return{data:t,args:r,request_id:n}})};var u=function e(t,r,n,i){if(!t||!r.messages){var a=r&&r.error?r.error:"unknown_error";r||(r={ok:false,error:a});r.query=r.query||n.query;r.messages=r.messages||{total:0,paging:{count:TS.search.per_page,total:0,page:1,pages:0},matches:[]}}if(n.query!==TS.search.query&&(!TS.search.results[n.query]||!TS.search.results[n.query].error))return;TS.search.last_search_query!==n.query&&delete TS.search.results[TS.search.last_search_query];TS.search.last_search_query=n.query;TS.search.last_request_id=i;TS.search.expandChannelsAndCheckForMsgsInModel(r);var s=TS.search.results[n.query];if(1==n.page){if(s)$.extend(s,r);else{TS.search.results[n.query]=r;s=r}s.initial_messages_total=r.messages.total;s.messages.pages=[{start:0,count:_.get(r.messages,"matches.length",0)}];_.has(s,"messages.modules.score.matches")&&(s.messages.modules.score.pages=[{start:0,count:_.get(s.messages.modules.score,"matches.length",0)}]);s._time_of_search=Date.now();TS.search.message_search_results_fetched_sig.dispatch(s,n)}else{if(s.messages&&s.messages.matches){r.messages.matches=s.messages.matches.concat(r.messages.matches);r.messages.pages=s.messages.pages.concat([{start:s.messages.matches.length,count:_.get(r.messages,"matches.length",0)}])}$.extend(s,r);TS.search.message_search_results_fetched_sig.dispatch(s,n)}};var d=function e(t,r,n,i){if(!t||!r.files){var a=r&&r.error?r.error:"unknown_error";r||(r={ok:false,error:a});r.query=r.query||n.query;r.files=r.files||{total:0,paging:{count:TS.search.per_page,total:0,page:1,pages:0},matches:[]}}r.query=TS.emoji.maybeGetLocalizedEmojiString(r.query);n.query=TS.emoji.maybeGetLocalizedEmojiString(n.query);if(n.query!==TS.search.query&&(!TS.search.results[n.query]||!TS.search.results[n.query].error))return;TS.search.last_search_query!==n.query&&delete TS.search.results[TS.search.last_search_query];TS.search.last_search_query=n.query;TS.search.last_files_request_id=i;var s=TS.search.results[n.query];if(1===n.page){if(s)$.extend(s,r);else{TS.search.results[n.query]=r;s=r}s.initial_files_total=r.files.total;s._time_of_search=Date.now();TS.search.file_search_results_fetched_sig.dispatch(s,n)}else{s.files&&s.files.matches&&(r.files.matches=s.files.matches.concat(r.files.matches));$.extend(s,r);TS.search.file_search_results_fetched_sig.dispatch(s,n)}};var c=function e(){var t=false;var r=false;var n=function e(){t&&r&&TS.search.all_search_results_fetched_sig.dispatch()};return{msgs:function e(){t=true;u.apply(this,arguments);n()},files:function e(){r=true;d.apply(this,arguments);n()}}};var m=function e(t){var r=$("#search_results_items");var n=TS.files.containerHasFileListItem(t,r);var i=!TS.interop.files.isObjectFresh(t.id);if(i&&n){TS.files.getFileById(t.id);return}n&&TS.files.updateFileListItem(t,r)};var f=function e(){var t=$(".reveal_hidden_items");t.one("click enter",function(e){var r=$(".results .deleted");if(r){e.stopPropagation();r.removeClass("deleted");t.remove()}})}})()},kyJk:function(e,t){(function(){TS.registerModule("attachment_actions.select",{onStart:_.noop,decorateNewElements:function e(t){var r=t.find(".attachment_actions_interactions select:not(.hidden)");r.each(function(){var e=$(this);var t={};var r={adjustAvailableSpaceAbove:l,adjustAvailableSpaceBelow:o,allow_list_position_above:true,classes:"select_attachment",data_promise:d(t),disabled:e.attr("disabled"),errorTemplate:i,filter:a,input_debounce_wait_time:p(t),min_query_length:_.get(t,"action.min_query_length",0),no_default_selection:true,onListShown:s(t),placeholder_text:g(t),filter_placeholder_text:S(t),should_graphic_replace_emoji:true,style:TS.ui.lazy_filter_select.STYLES.filter_in_list,template:h(t)};e.lazyFilterSelect(r).addClass("hidden");v(t,e)})},getActionModel:function e(t,n){var i=r[t.data_source]||r.default;return _.merge({},t,{_disabled:t._disabled||!!n,data_source:i,options:k(t.options),option_groups:w(t.option_groups),text:t.text||T(i)})}});var e={channels:TS.interop.i18n.t("Choose a channel\u2026","attachment_actions")(),conversations:TS.interop.i18n.t("Choose a conversation\u2026","attachment_actions")(),default:TS.interop.i18n.t("Choose an option\u2026","attachment_actions")(),external:TS.interop.i18n.t("Choose an option\u2026","attachment_actions")(),users:TS.interop.i18n.t("Choose a person\u2026","attachment_actions")()};var t={channels:TS.interop.i18n.t("Search channels","attachment_actions")(),conversations:TS.interop.i18n.t("Search conversations","attachment_actions")(),default:TS.interop.i18n.t("Filter options","attachment_actions")(),external:TS.interop.i18n.t("Search options","attachment_actions")(),users:TS.interop.i18n.t("Search people","attachment_actions")()};var r={channels:"channels",conversations:"conversations",default:"default",external:"external",users:"users"};var n=250;function i(e){if(!e)return TS.interop.i18n.t("No results.","lazy_filter_select")();return TS.interop.i18n.t("Couldn\u2019t load results.","lazy_filter_select")()}function a(e,t){return _.isEmpty(t)||TS.fuzzy.score(e.text.toLowerCase(),t.toLowerCase())<Infinity}function s(e){var t=_.get(e,"action.data_source");var r=I(e);return function e(){M(t,r)}}function o(e){var t=$("#footer").height()||0;return e-t}function l(e){var t=$("#client_header").height()||0;return e-t}function u(e){var t=_.get(e,"action.data_source");return r[t]||r.default}function d(e){switch(u(e)){case r.channels:return c({channels:{include_archived:false}},{default_query:"#"});case r.conversations:return m();case r.external:return f(e);case r.users:return c({members:{include_self:true}},{default_query:"@"});default:break}}function c(e,t){e=_.defaults(e,{limit:100,sort:{frecency:true}});t=_.defaults(t,{default_query:""});return function(r){r=r||t.default_query;return new Promise(function(t,n){TS.searcher.search(r,e).then(function(e){t({all_items_fetched:true,items:e,replace_all_items:true})},n)})}}function m(){return function(e){return new Promise(function(t,r){TS.ui.file_share.promiseToGetFileShareSelectOptions(e).then(function(e){t({all_items_fetched:true,items:e,replace_all_items:true})},r)})}}function f(e){return function(t){return new Promise(function(r,n){var i=_.get(e.message,"bot_profile.team_id",false);var a={name:e.action.name,value:t,attachment_id:e.attachment.id,callback_id:e.attachment.callback_id,channel_id:e.channel_id,is_ephemeral:true,message_ts:e.message.ts};i&&(a.team_id=i);TS.interop.api.call("chat.attachmentSuggestion",{service_id:I(e),payload:JSON.stringify(a)}).then(function(e){r({all_items_fetched:true,items:x(e),replace_all_items:true})}).catch(function(e){n(e)})})}}function p(e){if(u(e)!==r.default)return n}function h(e){var t=u(e);if("users"===t)return y;if(_.includes([r.channels,r.conversations],t))return b}function g(e){return _.get(e,"action.text")||T(e)}function S(e){return _.get(t,u(e),t.default)}function T(t){return _.get(e,u(t),e.default)}function v(e,t){if(!$.contains(document,t[0]))return;var n=u(e);var i=_.get(e,"action.selected_options[0]");if(i){var a=_.includes([r.channels,r.conversations,r.users],n);if(a){var s;s=n===r.users?TS.interop.members.getMemberById(i.value):TS.redux.channels.getEntityById(i.value);if(!s)return;i={model_ob:s}}else{i.text=_.unescape(i.text);i.description=_.unescape(i.description);i=C(i)}t.lazyFilterSelect("forceSelectItem",i)}}function b(e){var t=TS.templates.attachment_actions_select_channel_or_conversation_option(e.model_ob);return new Handlebars.SafeString(t)}function y(e){var t=TS.templates.attachment_actions_select_user_option(e.model_ob);return new Handlebars.SafeString(t)}function w(e){if(!e)return;return e.map(function(e){return _.merge({},e,{options:k(e.options),text:e.text&&new Handlebars.SafeString(e.text)})})}function k(e){if(!e)return;return e.map(function(e){return _.merge({},e,{description:e.description&&new Handlebars.SafeString(e.description),text:e.text&&new Handlebars.SafeString(e.text)})})}function x(e){var t=_.get(e,"data.option_groups");if(_.isArray(t))return t.map(function(e){var t=_.get(e,"options",[]).map(function(e){return C(e,{is_group_item:true})});return{lfs_group:true,label:e.text,children:t}});return _.get(e,"data.options",[]).map(C)}function C(e,t){e=_.merge({},e,{is_group_item:_.get(t,"is_group_item")});var r=TS.templates.attachment_actions_select_option(e);var n=$("<div>").html(r);return n.children()[0]}function M(e,t){TS.interop.clog.track("MSG_MENU_OPEN",{data_source:e,service_id:t})}function I(e){if(_.get(e,"attachment.is_app_unfurl"))return e.attachment.bot_id;return _.get(e,"message.bot_id")}})()},lSNA:function(e,t){function r(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true}):e[t]=r;return e}e.exports=r},laYx:function(e,t){(function(){TS.registerModule("tips",{onStart:function t(){e.delegate(".ts_tip_lazy, .ts_tip_float","mouseenter",o);e.delegate(".ts_tip_float","mouseleave",l);e.on("click",".ts_tip",function(){c($(this))})},hideAll:function e(){$(".ts_tip").addClass("ts_tip_hide")},unhideAll:function e(){$(".ts_tip").removeClass("ts_tip_hide")},updateTipTitle:function e(t,n){var a=m(t);a.length?a.html(n):t.attr("title",n);if(r&&r[0]==t[0])if(n){i.html(n);d()}else u()},updateFloater:function e(t){i&&t.title&&i.text(t.title);n&&t.classes_to_add&&n.addClass(t.classes_to_add.join(" "))},manuallyToggleTipTitle:function e(t){c(t)}});var e=$("BODY");var t=null;var r=null;var n=null;var i=null;var a=10;var s=0;var o=function o(l){r=$(l.currentTarget);var c=r.hasClass("ts_tip_multiline");r.addClass("ts_tip_hidden");0==r.children(".ts_tip_tip").length&&p(r,c);r.removeAttr("title");r.removeClass("ts_tip_lazy");$("#ts_tip_float_floater").remove();if(r.hasClass("ts_tip_float")){var _=r.attr("class").split(/\s+/).filter(function(e){if("ts_tip_float"===e)return false;if("ts_tip_lazy"===e)return false;return 0===e.indexOf("ts_tip")});var m=TS.templates.builders.strBuilder('<div id="ts_tip_float_floater" style="width:${w}px; height:${h}px;" class="${classes}">${tip_html}</div>',{w:r.outerWidth(),h:r.outerHeight(),classes:_.join(" "),tip_html:r.find(".ts_tip_tip").clone()[0].outerHTML});n=$(m);e.append(n);s=setTimeout(function(){n.removeClass("ts_tip_hidden");d()},a);t=r.closest(":scrollable(vertical)");t.on("scroll.ts_tip_removal",u);r.on("destroyed.ts_tip_removal",u);r.hasClass("ts_tip_hide_on_click")&&r.on("click.ts_tip_removal",u);if(c)i=n.find(".ts_tip_multiline_inner");else{i=n.find(".ts_tip_tip_inner");i.length||(i=n.find(".ts_tip_tip"))}}else setTimeout(function(){r.removeClass("ts_tip_hidden")},a)};var l=function e(){u()};var u=function e(){clearTimeout(s);n&&n.addClass("ts_tip_hidden");if(r&&r.length){r.off("click.ts_tip_removal");r.off("destroyed.ts_tip_removal")}t&&t.off("scroll.ts_tip_removal");t=null;r=null;n=null;i=null};var d=function e(){var t=r.offset();var i=2;var a=window.innerWidth-i;var s=window.innerHeight-i;var o=n.hasClass("ts_tip_multiline");var l=function e(){if(o)return n.find(".ts_tip_multiline_inner").dimensions_rect();return n.find(".ts_tip_tip").dimensions_rect()};var u=function e(t){n.removeClass("\t\t\tts_tip_right \t\t\tts_tip_rightish \t\t\tts_tip_left \t\t\tts_tip_leftish \t\t\tts_tip_multiline_top_leftish \t\t\tts_tip_multiline_top_left \t\t\tts_tip_multiline_top_right \t\t\tts_tip_multiline_top_rightish \t\t").addClass(t)};n.css("left",t.left).css("top",t.top);var d=l();d.bottom>s?n.removeClass("ts_tip_bottom").addClass("ts_tip_top"):d.top<i&&n.removeClass("ts_tip_top").addClass("ts_tip_bottom");if(o){d.right>a?u("ts_tip_multiline_top_rightish"):d.left<i&&u("ts_tip_multiline_top_leftish");d=l();d.right>a?u("ts_tip_multiline_top_right"):d.left<i&&u("ts_tip_multiline_top_left")}else{d.right>a?u("ts_tip_rightish"):d.left<i&&u("ts_tip_leftish");d=l();d.right>a?u("ts_tip_right"):d.left<i&&u("ts_tip_left")}};var c=function e(t){var r=m(t);var n="tip-toggle-auto";var i;t.data(n)?i=t:r.data(n)&&(i=r);if(!(i&&i.length))return;var a=r.html();var s=i.data(n);if(!s)return TS.warn("No toggle state text defined on tipped element. Please add text to data-tip-toggle-text or data-tip-toggle-auto attribute");TS.tips.updateTipTitle(t,s);i.data(n,a)};var m=function e(t){var r=t.find(".ts_tip_multiline_inner");r.length||(r=t.find(".ts_tip_tip_inner"));r.length||(r=t.find(".ts_tip_tip"));return r};var f=function e(t){if(t.text().trim().length)return;if(t.attr("aria-label"))return;return _.uniqueId("ts_tip_tip_")};var p=function e(t,r){var n="";if(t.data("tip-member"))n=TS.templates["c-unified_member"]({member:TS.interop.members.getMemberById(t.data("tip-member")),size:"small",avatar:true,no_tip:true,dark:true,omit_status:true,forced_primary:"real_name"});else{var i=_.escape(t.prop("title"));var a=f(t);var s=a?' id="'+a+'"':"";n=r?'<span class="ts_tip_multiline_inner">'+i+"</span>":i}var o=["<span",s,' class="ts_tip_tip"',">",n,"</span>"];t.append(o.join(""));t.attr("aria-labelledby",a)}})()},m0LI:function(e,t){function r(e,t){var r=[];var n=true;var i=false;var a=void 0;try{for(var s=e[Symbol.iterator](),o;!(n=(o=s.next()).done);n=true){r.push(o.value);if(t&&r.length===t)break}}catch(e){i=true;a=e}finally{try{n||null==s["return"]||s["return"]()}finally{if(i)throw a}}return r}e.exports=r},m7EJ:function(e,t,r){var n=r("cDf5");var i=r("lSNA");function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}));r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),true).forEach(function(t){i(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}(function(){TS.registerModule("utility.contenteditable",{create:function e(t,n){n||(n={});t=i(t);if(!t)return;if(a(t))return;if(l(t))return;var o={modules:{tabcomplete:{searchOptions:{},appendMenu:function e(t){$("body").prepend(t)},render:TS.tabcomplete.render,shouldCompleteOnTab:function e(){return!TS.i18n.sendButtonEnabled()},onRender:function e(){TS.tips.texty.hide()},tooltipIsShowing:function e(){return TS.tips.texty.isShowing()},tooltipShow:function e(t){TS.tips.texty.show(t)},tooltipHide:function e(){TS.tips.texty.isShowing()&&TS.tips.texty.hide()}},textsubstitutions:{getTextPreferences:function e(){if($("#chat_input_tab_ui").length)return null;return TS.interop.utility.getSystemTextPreferences()}},clipboard:{onPaste:function e(r){return TS.utility.contenteditable.paste(t,r)}},keyboard:{featureReactMessages:TS.boot_data.feature_react_messages,featureFileThreads:TS.boot_data.feature_file_threads,shouldInsertNewline:function e(r){return TS.interop.texty.shouldInsertNewline(s({},r,{useSendButton:TS.i18n.sendButtonEnabled(),usePreNewlines:TS.prefs.getPref("enter_is_special_in_tbt"),isCursorInPreBlock:TS.utility.contenteditable.isCursorInPreBlock(t)}))}},slackmention:true},onEnter:function e(){if(TS.boot_data.feature_file_threads)return false;return true},onEscape:function e(){if(TS.boot_data.feature_file_threads)return false;return true},onTab:function e(){return true},onMentionReplace:function e(n){var i=n.replacements,a=n.isLastReplacement;if(a&&1===i.length&&"UNVERIFIED"!==i[0].id){var s=t.querySelectorAll("ts-mention[data-id="+i[0].id+"]");if(1===s.length&&s[0].offsetTop>=t.offsetTop){TS.tips.texty.show(s[0]);r=setTimeout(function(){TS.tips.texty.hide();r=null},1500)}}},singleLineInput:false,inlineEmojiIsEnabled:TS.utility.contenteditable.inlineEmojiIsEnabled,convertEmoticonsIsEnabled:function e(){return TS.prefs.getPref("convert_emoticons")},isJumbomojiEnabled:false,onTextChange:_.noop,useSonicEmoji:TS.boot_data.feature_sonic_emoji,getLocale:function e(){return TS.interop.i18n.locale},getTeamId:function e(){return TS.model.team.id},enableBroadcastKeywords:true,isAutocompleteOpen:function e(){return!!$("#chat_input_tab_ui").length},getBroadcastKeywords:function e(){return _.curry(TS.interop.broadcast_keywords.getBroadcastKeywordsForUser)(TS.model.active_cid)},getUserHighlightWords:TS.interop.prefs.getHighlightWords,promiseToSearchMembers:c,tabIndex:0,showTextyTooltips:true,getEmojiNames:TS.emoji.legacyGetEmojiNames,logger:TS.interop.utility.getLogger({teamId:TS.model.team.id})};_.defaultsDeep(n,o);if(n.modules&&n.modules.tabcomplete){n.modules.tabcomplete.completers||(n.modules.tabcomplete.completers=["channels","commands","emoji","members"]);n.modules.tabcomplete.completers=_.compact(n.modules.tabcomplete.completers.map(function(e){if("channels"===e)return TS.tabcomplete.channels;if("commands"===e)return TS.tabcomplete.commands;if("emoji"===e)return TS.tabcomplete.emoji;if("members"===e)return TS.tabcomplete.members;TS.error("TEXTY","Invalid completer passed to texty");return null}))}if(!n.singleLineInput){var d=n.onTextChange;n.onTextChange=function(e){r||TS.tips.texty.hide();d(e)}}var m=new TS.interop.texty.TextyClass(t,n);u(t,m);return m},inlineEmojiIsEnabled:function e(){if(!TS.prefs.prefs_loaded)return"as_text"!==TS.boot_data.pref_emoji_mode;return!TS.interop.rules.emoji.shouldRenderEmojiAsText()},isJumbomojiEnabled:function e(){if(!TS.prefs.prefs_loaded)return TS.utility.contenteditable.inlineEmojiIsEnabled()&&!!TS.boot_data.pref_jumbomoji&&"dense"!==TS.boot_data.pref_messages_theme;return TS.utility.contenteditable.inlineEmojiIsEnabled()&&TS.prefs.getPref("jumbomoji")&&"dense"!==TS.prefs.getPref("theme")},refreshJumbomoji:function e(t){t=i(t);if(!t)return;if(!o(t))return;var r=l(t);r&&r.refreshJumbomoji()},refreshContents:function e(t){t=i(t);if(!t)return;if(!o(t))return;var r=l(t);if(r){var n=TS.utility.contenteditable.value(t);var a=TS.interop.texty.convertContentsStringToContents(n,{highlightWords:TS.interop.prefs.getHighlightWords(),shouldRenderEmojiAsText:TS.interop.rules.emoji.shouldRenderEmojiAsText(),emojiNames:TS.emoji.legacyGetEmojiNames(),useSonicEmoji:TS.boot_data.feature_sonic_emoji,locale:TS.interop.i18n.locale});r.refreshContents(a)}},unload:function e(t){t=i(t);if(!t)return;if(!o(t))return;var r=l(t);if(r){r.unload();d(t)}},isActiveElement:function e(t){t=i(t);if(!t)return false;if(a(t))return document.activeElement===t;if(o(t)){var r=l(t);if(r.hasFocus())return true;return document.activeElement&&-1!=document.activeElement.className.indexOf("ql-clipboard")&&document.activeElement.parentNode===t}return false},focus:function e(t){t=i(t);if(!t)return;if(a(t))t.focus();else if(o(t)){var r=l(t);r.focus()}},hasFocus:function e(t){t=i(t);if(!t)return;if(a(t))return $(t).is(":focus");if(o(t)){var r=l(t);return r.hasFocus()}},blur:function e(t){t=i(t);if(!t)return;if(a(t))t.blur();else if(o(t)){var r=l(t);r.blur()}},disable:function e(t){t=i(t);if(!t)return;if(a(t))t.disabled=true;else if(o(t)){var r=l(t);r.disable()}},isDisabled:function e(t){t=i(t);if(!t)return;if(a(t))return true===t.disabled;if(o(t)){var r=l(t);return!r.isEnabled()}return false},enable:function e(t){t=i(t);if(!t)return;if(a(t))t.disabled=false;else if(o(t)){var r=l(t);r.enable();TS.utility.contenteditable.updateSpellCheck(t)}},isEnabled:function e(t){t=i(t);if(!t)return false;if(a(t))return true!==t.disabled;if(o(t)){var r=l(t);return r.isEnabled()}return false},value:function e(t,r){t=i(t);if(!t)return"";if(a(t)){_.isString(r)&&(t.value=r);return t.value}if(o(t)){var n=l(t);if(_.isString(r)){var s=TS.interop.texty.convertContentsStringToContents(r,{highlightWords:TS.interop.prefs.getHighlightWords(),shouldRenderEmojiAsText:TS.interop.rules.emoji.shouldRenderEmojiAsText(),emojiNames:TS.emoji.legacyGetEmojiNames(),useSonicEmoji:TS.boot_data.feature_sonic_emoji,locale:TS.interop.i18n.locale});n.setContents(s)}else _.isObject(r)&&n.setContents(r);return TS.interop.texty.convertContentsToString(n.getContents())}return""},displayValue:function e(t){t=i(t);if(!t)return"";if(a(t))return t.value;if(o(t))return TS.interop.texty.convertContentsStringToDisplayString(TS.utility.contenteditable.value(t),TS.interop.prefs.getHighlightWords());return""},getContentsForRange:function e(t,r,n){t=i(t);if(!o(t))return;var a=l(t);return a.getContentsForRange({index:r,length:n})},getLength:function e(t){t=i(t);if(!t)return 0;if(a(t))return t.value.length;if(o(t)){var r=l(t);return r.getLength()}return 0},getDisplayValueLength:function e(t){return TS.utility.contenteditable.displayValue(t).length},getTextForRange:function e(t,r,n){t=i(t);if(!t)return"";if(a(t)){var s=TS.utility.contenteditable.value(t);return s.substr(r,n)}if(o(t)){var u=l(t);return u.getTextForRange(r,n)}return""},getDisplayTextForRange:function e(t,r,n){t=i(t);if(!t)return"";if(a(t)){var s=TS.utility.contenteditable.value(t);return s.substr(r,n)}if(o(t)){var u=l(t);return TS.interop.texty.convertContentsToStringForDisplay({contents:u.getContentsForRange(r,n).ops})}return""},insertTextAtCursor:function e(t,r,n){t=i(t);if(!t)return;var s;if(a(t)){if(!_.isString(r))return t.value;s=TS.utility.contenteditable.cursorPosition(t);var u=TS.utility.contenteditable.value(t);var d=u.substr(0,s.start)+r+u.substr(s.start);t.value=d;if(n){TS.utility.contenteditable.focus(t);TS.utility.contenteditable.cursorPosition(t,s.start+r.length,0)}}else if(o(t)){var c=l(t);_.isString(r)&&c.insertTextAtCursor(r,n)}},insertContentsAtCursor:function e(t,r,n){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"api";t=i(t);if(!t)return;if(a(t))TS.utility.contenteditable.insertTextAtCursor(t,TS.interop.texty.convertContentsToString(r),n);else if(o(t)){var u=l(t);u.insertContentsAtCursor(r,n,s)}},updateContents:function e(t,r){t=i(t);if(!t)return;if(a(t))TS.warn("updateContents called on form element");else if(o(t)){var n=l(t);n.updateContents(r)}},paste:function t(r,n){r=i(r);if(!r)return false;if(a(r))return false;if(!o(r))return false;var s;var l=n&&n.clipboardData&&n.clipboardData.types;var u;if(!l||!l.length){u=window.clipboardData&&window.clipboardData.getData("Text");if(!u){TS.interop.console.info("CONTENTEDITABLE","no MIME types in clipboard");return false}}if(u){TS.interop.console.info("CONTENTEDITABLE","Using alternate clipboard");s={contents:[{insert:u}]}}else{l=Array.prototype.slice.call(l);TS.interop.console.info("CONTENTEDITABLE",'MIME types in clipboard: "'+l.join(', "')+'"');s=TS.interop.texty.getContentsFromClipboard(n)}if(!s){TS.interop.console.info("CONTENTEDITABLE","nothing usable in clipboard");return false}n.preventDefault();var d=TS.interop.texty.detachInvalidMentionsFromContents(s,function(e){return m(e.id)});var c=TS.interop.texty.convertContentsToStringForDisplay(d);if(c.length>e){n.stopPropagation();TS.interop.console.info("CONTENTEDITABLE","paste contents exceeded limit");return true}TS.utility.contenteditable.insertContentsAtCursor(r,d,true,"user");TS.interop.console.info("CONTENTEDITABLE",'pasted into "'+r.id+'"');return true},getFormats:function e(t,r){t=i(t);if(!t)return{};if(o(t)){var n=l(t);return n.getFormats(r)}return{}},isEmpty:function e(t,r){var n=TS.utility.contenteditable.value(t);n&&r&&(n=n.trim());return 0===n.length},clear:function e(t,r){t=i(t);if(!t)return;if(a(t))t.value="";else if(o(t)){var n=l(t);n.clear({is_silent:!!r})}},placeholder:function e(t,r){t=i(t);if(!t)return"";var n;if(a(t)){_.isString(r)&&(""===r?t.removeAttribute("placeholder"):t.setAttribute("placeholder",r));n=t.getAttribute("placeholder")}else if(o(t)){var s=l(t);s.setPlaceholder(r);n=s.getPlaceholder()}return n||""},ariaLabel:function e(t,r){t=i(t);if(!t)return;if(o(t)){var n=l(t);n.setAriaLabel(r)}},cursorPosition:function e(t,r,n){_.isString(t)&&(t=$(t));var s;var u={start:0,end:0,length:0};t=i(t);if(!t)return u;if(_.isNumber(r)){n||(n=0);u.start=r;u.end=r+n;u.length=n;if(a(t))TS.selection.selectCharacters(t,u.start,u.end);else if(o(t)){s=l(t);s.setSelection(u.start,u.length)}}else{if(!TS.utility.contenteditable.isActiveElement(t)){var d=$(t).data("utility-contenteditable-cursor-position");if(_.isObject(d))return d}if(a(t)){t.focus();u.start=t.selectionStart;u.end=t.selectionEnd;u.length=Math.abs(t.selectionEnd-t.selectionStart)}else if(o(t)){s=l(t);var c=s.getSelection();if(c){u.start=c.index;u.length=c.length;u.end=u.start+u.length}}}return u},setCursorAtEnd:function e(r){var n=TS.utility.contenteditable.getLength(r);TS.utility.contenteditable.cursorPosition(r,n);r=i(r);if(!o(r))return;$(r).find(".ql-editor").get(0).scrollLeft=t},selectAll:function e(t){var r=TS.utility.contenteditable.getLength(t);TS.utility.contenteditable.cursorPosition(t,0,r)},isTextSelected:function e(t){t=i(t);if(!t)return;if(a(t))return!!(window.getSelection&&window.getSelection().toString());if(o(t)){var r=l(t);return r.getSelection().length>0}},deserialize:function e(t,r){if(TS.boot_data.feature_sonic_inputs)return;if(!r)return;t=i(t);if(!t)return;if(a(t))t.value=r;else if(o(t)){if("object"===n(r)&&r.hasOwnProperty("contents")){TS.utility.contenteditable.value(t,r);return}if("string"!==typeof r)return;try{var s=JSON.parse(r);if(null!==s&&"object"===n(s)){TS.utility.contenteditable.value(t,s);return}}catch(e){}TS.utility.contenteditable.value(t,r)}},isCursorInPreBlock:function e(t){t=i(t);if(!t)return false;if(o(t)){var r=l(t);return r.isCursorInPreBlock()}return false},isIndexInCode:function e(t,r){t=i(t);if(!t)return false;if(o(t)){var n=l(t);return n.isIndexInCode(r)}return false},deleteSelection:function e(t){t=i(t);if(!t)return false;if(o(t)){var r=l(t);return r.deleteSelection()}window.getSelection().deleteFromDocument()},deleteText:function e(t,r,n){t=i(t);if(!t)return;if(o(t)){var a=l(t);a.deleteText(r,n)}},clearHistory:function e(t){t=i(t);if(!t)return false;var r=l(t);if(!r)return;r.clearHistory()},updateSpellCheck:function e(t){t=i(t);if(!t)return false;var r=l(t);if(!r)return;$(t).find("[contenteditable=true]").attr("spellcheck",false)},legacySynchronouslyReplacePotentialMentions:function e(t){return t},legacyShowPasteLimitError:function e(t){return f(t)},legacyGetIsValidMention:function e(t){return m(t)},test:function e(){var e={_normalizeInput:i,_isFormElement:a};return e}});var e=5e4;var t=1e4;var r=null;var i=function e(t){if(!t)return false;t instanceof jQuery&&t[0]&&(t=t[0]);if(t.nodeType!==Node.ELEMENT_NODE)return false;if("textarea"===t.tagName.toLowerCase())return t;if("input"===t.tagName.toLowerCase())return t;if($(t).hasClass("ql-editor"))return t.parentNode;if(t.hasAttribute("contenteditable"))return t;if("DIV"===t.tagName)return t;return false};var a=function e(t){if(!t||!t.tagName)return false;if("textarea"===t.tagName.toLowerCase())return true;if("input"===t.tagName.toLowerCase())return true;return false};var o=function e(t){if(!t)return false;var r=l(t);if(r)return true;return false};var l=function e(t){return $(t).data("__ts_quill")};var u=function e(t,r){$(t).data("__ts_quill",r);$(t).attr("data-contenteditable-override","true")};var d=function e(t){$(t).removeData("__ts_quill")};var c=function e(t,r){var n;r.no_model_ob||(n=r.model_ob||TS.shared.legacyGetActiveModelOb());var i={query:t.replace(/^[@\uff20]/,""),max_api_results:20,include_org:true,include_slackbot:true,include_self:true,full_profile_filter:false,limit_by_model_relevancy:n};return TS.members.promiseToSearchMembers(i).then(function(e){var r={usergroups:TS.interop.userGroups.getActiveUserGroups(),members:e&&e.items?e.items:[]};var n={allow_empty_query:false,frecency:false,limit:20,prefer_exact_match:true};return TS.sorter.search(t,r,n).map(function(e){return{item:e}})})};var m=function e(t){if(TS.interop.members.getMemberById(t))return true;var r=TS.interop.userGroups.getUserGroupById(t);if(r&&!TS.interop.rules.user_groups.isUnknownOrNonExistent(r))return true;var n=TS.utility.members.getBroadcastKeywordsForUser();var i=_.map(n,"id");if(_.includes(i,t))return true;return false};var f=function e(t){var r=TS.interop.i18n.t("That\u2019s a bit too long to paste","msg_input")();var n=TS.interop.i18n.t("To keep things running smoothly, there\u2019s a limit on the number of characters you can paste into Slack. If you\u2019d like you could <b>create a snippet</b> instead.","msg_input")();n='<p class="no_bottom_margin">'+n+"</p>";TS.generic_dialog.start({title:r||"",body:n,show_cancel_button:false,esc_for_ok:true,fullscreen:false,go_button_text:TS.interop.i18n.t("OK","msg_input")(),show_secondary_go_button:t,secondary_go_button_text:TS.interop.i18n.t("Create a snippet","msg_input")(),secondary_go_button_class:"btn_outline",onSecondaryGo:function e(){TS.ui.snippet_dialog.startCreate()}})}})()},mGpN:function(e,t){(function(){TS.registerModule("templates",{onStart:function t(){r();TS.members&&TS.members.user_color_changed_sig.add(TS.templates.memberUserColorChanged,TS.templates);TS.prefs&&TS.prefs.sidebar_behavior_changed_sig.add(TS.templates.sidebarBehaviorPrefChanged,TS.templates);TS.environment.retina_changed_sig.add(e)},makeUnreadMessagesDomId:function e(t){return TS.utility.makeSafeForDomId("activity_unread_messages_"+t.id)},makeRxnKeyDomClass:function e(t){return TS.utility.makeSafeForDomId("rxns_key_"+t)},makeUnreadGroupMessagesDomId:function e(t){return TS.utility.makeSafeForDomId("activity_unread_group_messages_"+t.id)},makeUnreadDmsDomId:function e(t){return TS.utility.makeSafeForDomId("activity_unread_dms_"+t.id)},makeSentMessagesDomId:function e(t){return TS.utility.makeSafeForDomId("activity_sent_messages_"+t.id)},makeSentGroupMessagesDomId:function e(t){return TS.utility.makeSafeForDomId("activity_sent_group_messages_"+t.id)},makeIssueListDomId:function e(t){return"issue_list_"+t},makeSentDmsDomId:function e(t){return TS.utility.makeSafeForDomId("activity_sent_dms_"+t.id)},makeMsgDomId:function e(t){return TS.utility.makeSafeForDomId("msg_"+t)},makeMsgLabelDomId:function e(t){return TS.utility.makeSafeForDomId("msg_"+t+"_label")},makeMsgAttachmentTextExpanderDomId:function e(t,r){return TS.utility.makeSafeForDomId("msg_rest_text_expander_"+t+"_"+r)},makeMSRDomId:function e(t){return TS.utility.makeSafeForDomId("MSR_"+t.channel.id+"_"+t.ts)},makeMSRDomIdWithModule:function e(t,r){return TS.utility.makeSafeForDomId("MSR_"+t.channel.id+"_"+t.ts+"_"+r)},makeChannelDomId:function e(t){return"channel_"+t.id},makeChannelDragData:function e(t){return JSON.stringify({id:t.id,name:t.name,is_channel:t.is_channel||false,is_group:t.is_group||false,is_im:t.is_im||false,is_mpim:t.is_mpim||false,is_self_im:TS.interop.rules.channels.isYou(t)||false,is_slackbot_im:TS.interop.rules.channels.isSlackbot(t)||false,purpose:t.purpose?t.purpose.value:"",topic:t.topic?t.topic.value:""})},makeFileDragData:function e(t){return JSON.stringify({id:t.id,name:t.name,title:t.title,mimetype:t.mimetype,filetype:t.filetype,size:t.size})},makeDayDividerDomId:function e(t){return TS.utility.makeSafeForDomId("day_divider_"+t)},makeGroupDomId:function e(t){return"group_"+t.id},makePriorityIconDomId:function e(t){return"priority_"+t.id},makeStarredIconDomId:function e(t){return"starred_"+t.id},makeMutedIconDomId:function e(t){return"muted_"+t.id},makeMemberDomId:function e(t){if(!t)return;return TS.templates.makeMemberDomIdById(t.id)},makeMemberDomIdById:function e(t){if(!t)return;return"member_"+t},makeMpimDomId:function e(t){return"mpim_"+t.id},makeChannelListDomId:function e(t){return"channel_"+t.id+"_member_list"},makeFileDomId:function e(t){return"file_"+t.id},makeFileCommentsDomId:function e(t){return"file_comments_"+t.id},makeFileContentsDomId:function e(t){return"file_contents_"+t.id},makeUnreadMsgsDomId:function e(t){return"unread_msg_"+t.id},makeUnreadHighlightDomId:function e(t){if(!t)return;return"unread_highlight_"+t.id},makeMemberPresenceDomClass:function e(t){return"member_presence_"+t},makeMemberPresenceStateClass:function e(t){var r=TS.redux.presence.getPresenceByMemberId(t.id);return r},makeMemberPresenceStateAriaLabel:function e(t){var r=TS.redux.presence.getPresenceByMemberId(t.id);var n="";"active"===r?n+="active":"away"===r&&(n+="away");return n},makeMemberPresenceIcon:function e(t){if(t.deleted)return"";var r=TS.templates.makeMemberPresenceDomClass(t.id);var n="ts_icon_presence";var i=TS.redux.presence.getPresenceByMemberId(t.id);var a="active"===i?TS.interop.i18n.t("active","templates_helpers")():TS.interop.i18n.t("away","templates_helpers")();if(t.is_ultra_restricted){r+=" ura";n="ts_icon_presence_ura"}else if(t.is_restricted){r+=" ra";n="ts_icon_presence_ra"}else if(TS.interop.members.isExternal(t)){r+=" external";n="ts_icon_presence_external"}else t.is_slackbot&&(n="ts_icon_heart");var s='<i aria-hidden="true" class="ts_icon '+n+' presence_icon"></i>';var o=TS.templates.makeMemberPresenceStateClass(t);var l='<span data-member-presence="'+t.id+'" class="presence '+o+" "+r+'" title="'+a+'">'+s+"</span>";return l},makeMemberStatusDomClass:function e(t){return"member_status_"+t},memberUserColorChanged:function e(t){var r="color_"+t.id;if(t.color==t.member_color){var n="color_rule_"+r;var i=$("#"+n);i.remove();return}TS.templates.makeUserColorRule(t)},makeUserColorRule:function e(t){var r="color_"+t.id;var n="#"+_.escape(t.member_color);var i;i="            ."+r+":not(.nuc) {                color:"+n+";            }        ";var a="color_rule_"+r;var s=$("#"+a);s.length?s.text(i):$('<style type="text/css" id="'+a+'">'+i+"</style>").appendTo("body")},sidebarBehaviorPrefChanged:function e(){TS.templates.makeSidebarBehaviorRule()},makeSidebarBehaviorRule:function e(){var t;var r="sidebar_behavior";var n=$("#"+r);"hide_read_channels"===TS.prefs.getPref("sidebar_behavior")?t="\t\t\t\t.channels_list_holder ul li:not(.unread):not(.active):not(.show_in_list_even_though_no_unreads) {\t\t\t\t\tdisplay: none;\t\t\t}":"hide_read_channels_unless_starred"===TS.prefs.getPref("sidebar_behavior")&&(t="\t\t\t\t.channels_list_holder div:not(#starred_div)>ul li:not(.unread):not(.active):not(.is_starred):not(.show_in_list_even_though_no_unreads) {\t\t\t\t\tdisplay: none;\t\t\t}");t?n.length?n.text(t):$('<style type="text/css" id="'+r+'">'+t+"</style>").appendTo("head"):$("#"+r).remove()},makeMsgDomIdInConversation:function e(t){return TS.templates.makeMsgDomId(t)+"_conversation"},makeMsgDomIdInSearch:function e(t,r){return TS.templates.makeMsgDomId(t)+"_"+TS.templates.makeMSRDomId(r)},makeMsgDomIdInSearchTopResults:function e(t,r,n){return TS.templates.makeMsgDomId(t)+"_"+TS.templates.makeMSRDomId(r)+"_"+n},makeMsgDomIdInUnreadView:function e(t){return TS.templates.makeMsgDomId(t)+"_unread_view"},makeMsgDomIdInThreadsView:function e(t){return TS.templates.makeMsgDomId(t)+"_threads_view"},promiseToRenderAsync:function e(t,r){if(!t)return Promise.reject(new Error("No template to render"));return Promise.resolve(r).then(function(e){return t(e)})}});var e=function e(){var t;var r;var n;var i;$(".member_image").each(function(){i=$(this);t=i.data("member-id");r=i.data("thumb-size");n=!i.is("a");t&&r&&$(this).replaceWith(TS.templates.builders.makeMemberPreviewLinkImage(t,r,false,n))});i=null};var t=/{{\s*i18n_ns\s*('|")[a-zA-Z0-9]+('|")\s*}}/;var r=function e(){Object.keys(TS.raw_templates).forEach(function(e){TS.templates[e]=n(e,TS.raw_templates[e]);if(!TS.raw_template_paths){TS.raw_template_paths={};TS.interop.utility.getLogger({getState:TS.redux.getState}).error("MISSING_RAW_TEMPLATE_PATHS")}TS.templates[e+"_path"]=TS.raw_template_paths[e];Handlebars.registerPartial(e,TS.templates[e])});delete TS.raw_templates};var n=function e(r,n){if(!n){TS.warn(r+" was passed no html");return null}t.test(n)&&(n+=" {{_i18n_ns_end}}");var i=Handlebars.compile(n);return function(e){e=e||{};var t=false;var n=false;var a=TS.interop.experiments.getGroupForUser("jira_newxp_2040");if("variant"===a){var s=Math.floor(1e5*Math.random());t=1==s;if(TS.templates_to_audit&&TS.templates_to_audit.includes(r)){t=true;n=true}}if(t)try{var o={contexts:{ui_context:{action:"impression",ui_properties:{element_name:r+".hbs"}}}};TS.interop.environment.isDev||TS.interop.environment.isQa||TS.interop.clog.track("HANDLEBARS_TEMPLATE_LOGS",o);var l=/\/[A-Z0-9-.]*\//g;var u=window.location.pathname.replace(l,"/#####/");var d=new Error;d.fileName=TS.templates[r+"_path"];d.message=u+" "+window.location.hash;d.stack="";var c="HANDLEBARS_TEMPLATE_LOGS";n&&(c="HANDLEBARS_TEMPLATE_LOGS_AUDIT");TS.interop.utility.getLogger({getState:TS.redux.getState}).error(d,c,{subtype:r})}catch(e){}return i(e)}}})()},mmJJ:function(e,t){(function(){var e={};TS.registerModule("utility.members",{checkMemberMatch:function e(t,r,n){return!n&&t.profile&&t.profile.email&&t.profile.email.match(r)||t.profile&&t.profile.real_name_normalized&&t.profile.real_name_normalized.match(r)||t.profile&&t.profile.real_name&&t.profile.real_name.match(r)||t.profile&&t.profile.display_name_normalized&&t.profile.display_name_normalized.match(r)||t.profile&&t.profile.display_name&&t.profile.display_name.match(r)},filterMembersByQuery:function e(t,r){r=_.toString(r).trim().toLowerCase().replace(/^@/,"");if(!r)return t;var n=new RegExp(TS.utility.regexpEscape(r),"i");return t.filter(function(e){return TS.utility.members.checkMemberMatch(e,n)})},getBroadcastKeywordsForUser:function t(){var r=TS.shared.legacyGetActiveModelOb();if(!r)return[];var n=TS.interop.broadcast_keywords.getBroadcastKeywordsForUser(r.id);var i=n.filter(function(e){return"BKchannel"===e.id||"BKhere"===e.id});var a=TS.boot_data.page_needs_enterprise&&TS.interop.rules.channels.isRequired(r)&&TS.interop.rules.channels.isOrgShared(r);if(!i.length&&TS.model.user.is_admin&&(r.is_channel||r.is_group)&&!e[r.id]){e[r.id]=true;TS.interop.utility.getLogger({getState:TS.redux.getState}).error({model_ob:r.id,is_channel:r.is_channel,is_group:r.is_group,is_general:r.is_general,is_enterprise_required_channel:a,who_can_at_channel:TS.prefs.getTeamPref("who_can_at_channel"),canAtChannelOrGroup:TS.permissions.members.canAtChannelOrGroup(r.id),canAtMentionEveryone:TS.permissions.members.canAtMentionEveryone(r.id)},"getBroadcastKeywordsForUser no channel_keywords for admin",{subtype:"getBroadcastKeywordsForUser_empty_v2"})}return n},isMemberRelevantToModel:function e(t,r){_.isObject(t)||(t=TS.interop.members.getMemberById(t));if(!t)return false;if(TS.interop.rules.members.isSlackbot(t))return true;if(t.deleted)return false;_.isObject(r)||(r=TS.redux.channels.getEntityById(r)||TS.shared.legacyGetActiveModelOb());return true},isMemberElement:function e(t){if(t.hasAttribute("data-member-id"))return true;if(t.classList.contains("internal_member_link"))return true;return false},isMemberNonBotNonDeletedNonSelf:function e(t){var r=t&&!t.deleted&&!t.is_bot&&!TS.interop.rules.members.isSlackbot(t);return r&&!t.is_self},isMemberEKMRevoked:function e(t){return t&&"UREVOKEDU"===t.id},getEntityFromMessage:function e(t){if(!t)return false;var r;var n=TS.utility.msgs.getFilesOnMsg(t);var i=_.first(n);r="USLACKBOT"===t.user&&i&&i.bot_id?TS.utility.members.getEntityFromFile(i):t.comment?TS.redux.members.getPotentiallyUnknownMemberById(t.comment.user):TS.redux.members.getPotentiallyUnknownMemberById(t.user);return r},getUsernamesMentionedInString:function e(t){var r=_.toLower(t).match(/\B@\w+/g);if(!r)return[];return _(r).map(function(e){return e.replace(/^@/,"")}).uniq().compact().value()},getEntityFromFile:function e(t){if(!t)return false;var r;if("USLACKBOT"===t.user&&t.bot_id){r=TS.interop.bots.getBotById(t.bot_id);r||(r={});r.is_bot=true;r.is_service=true}else r=TS.redux.members.getPotentiallyUnknownMemberById(t.user);return r}})})()},"nH+9":function(e,t){(function(){TS.registerModule("ui.new_channel_modal",{start:function e(){if(!TS.permissions.members.canCreateChannels()&&!TS.permissions.members.canCreateGroups())return;return TS.interop.mountChannelCreateModal(TS.boot_data.team_id)},startInContainer:function i(a,s,o,l){if(!TS.permissions.members.canCreateChannels()&&!TS.permissions.members.canCreateGroups())return;e=a;r=false!==o;TS.permissions.members.canCreateChannels()||(r=false);TS.permissions.members.canCreateGroups()||(r=true);var u=TS.permissions.members.canCreateChannels()&&TS.permissions.members.canCreateGroups();s=TS.interop.utility.cleanChannelName(s||"");l=l||[];var d=TS.templates.channel_new_modal;e.html(d({title:s,is_public:r,can_toggle_private:u,compliance_exports_enabled_for_team:!!TS.prefs.getTeamPref("compliance_export_start"),is_ra:TS.model.user.is_restricted,can_create_shared_channel:TS.interop.rules.user.canUserRequestSharedChannel()}));t=Ladda.create(e.find(".new_channel_go")[0]);c(l);setTimeout(function(){S()},500);return new Promise(function(e,t){n={resolve:e,reject:t}})},go:function n(){var i=e.find(".title_input").val();var a=$("#invite_members_container").lazyFilterSelect("value");var s=[];var o=[];a&&a.forEach(function(e){e.member?s.push(e.member.id):o.push(e)});var l=_.trim(TS.utility.contenteditable.value(e.find("#channel_purpose_input")));t&&t.start();r?f(i,l,s,o):p(i,l,s,o)},end:function e(){v()},test:function e(){return{createPublicChannel:f,createPrivateChannel:p,maybeSwapped:i}}});var e;var t;var r;var n;var i;var a=function t(){var r=e.find("#invite_members_container").find("input")[0];var n=e.find("#channel_purpose_input");e.on("keydown",function(e){if(e.which!==TS.utility.keymap.enter||document.activeElement==r||TS.utility.contenteditable.hasFocus(n)){if(e.which===TS.utility.keymap.esc){TS.ui.fs_modal.close();e.preventDefault()}}else{TS.ui.new_channel_modal.go();e.preventDefault()}})};var s=function t(){var n=$("#channel_public_private_toggle");n.togglify();n.bind("change",function(){r=n.is(":checked");if(n.is(":checked")){e.find(".private_channel_item").addClass("hidden");e.find(".public_channel_item").removeClass("hidden")}else{e.find(".public_channel_item").addClass("hidden");e.find(".private_channel_item").removeClass("hidden")}})};var o=function e(){return new Promise(function(e){TS.model.user.is_admin?TS.interop.api.call("users.admin.invited").then(function(t){var r=TS.pending_users.filterOutURAs(t.data.pending);if(r.length){r.forEach(function(e){TS.pending_users.sanitizeNameFields(e)});e(r)}else e([])}):e([])})};var l=function e(t){var r=true;var n=o();return function(e,i){"@"===e.charAt(0)&&(e=e.substring(1));var a;var s=false;if(r){r=false;_.get(t,"length")&&(s=true)}if(s){var o=_.compact(t.map(function(e){return TS.interop.members.getMemberById(e)}));var l=o.map(function(e){return{member:e,lfs_id:String(e.id),preselected:true}});return Promise.resolve({items:l})}if(i>0)return Promise.resolve({items:[]});a=u(e);return Promise.all([a,n]).then(function(t){var r=t[0];var n=t[1];if(_.isUndefined(n)||0===n.length)return r;var i=new RegExp("^"+TS.utility.regexpEscape(e),"i");var a=new RegExp("(-|_|\\+|\\s|\\.|@)"+TS.utility.regexpEscape(e),"i");n=n.filter(function(e){return TS.pending_users.checkUserMatch(e,i)||TS.pending_users.checkUserMatch(e,a)});r=r.concat(n).sort(function(e,t){return TS.pending_users.usersSorterByName(e,t)});return r})}};var u=function e(t){var r={query:t,filter:"people"};return TS.members.fetchAndUpsertMembersWithQuery(r).then(function(e){var r=[];var n=TS.members.getMembersWithOptions({include_bots:false});var i=n.map(function(e){return e.id});r=""===t?n:e.objects;r=_.filter(r,function(e){if(e.is_self)return false;if(TS.interop.rules.members.isSlackbot(e))return false;if(-1===_.indexOf(i,e.id))return false;return true});r=_.filter(r,function(e){return!(e.is_ultra_restricted||e.deleted||!TS.interop.rules.members.isMemberOnTeam(e,TS.model.team.id)||e.is_app_user)}).map(function(e){return{member:e,lfs_id:String(e.id)}});return r})};var d=function e(t){var r;var n;var i;var a={append:true,per_page:50,max_selected_items:1e3,approx_item_height:36,placeholder_text:TS.interop.i18n.t("Search by name","new_channel")(),template:function e(t){var r;r=t.member?TS.templates.channel_invite_member_small({member:t.member}):TS.templates.channel_invite_pending_user_small({invitee:t});return new Handlebars.SafeString(r)},tokenTemplate:function e(t){var r;r=t.member?TS.templates.channel_invite_member_token({member:t.member}):TS.templates.channel_invite_pending_user_token({invitee:t});return new Handlebars.SafeString(r)},tokenClass:function e(t){if(t.member)return TS.templates.builders.getMemberTypeClass(t.member);return"lfs_token_pending_user"},filter:function e(t,a){var s=t.member;if(r!==a){n=new RegExp("^"+TS.utility.regexpEscape(a),"i");i=new RegExp("(-|_|\\+|\\s|\\.|@)"+TS.utility.regexpEscape(a),"i");r=a}var o=true;if(s)return TS.utility.members.checkMemberMatch(s,n,o)||TS.utility.members.checkMemberMatch(s,i,o);return TS.pending_users.checkUserMatch(t,n)||TS.pending_users.checkUserMatch(t,i)},noResultsTemplate:function e(t){if(!t)return TS.interop.i18n.t("No one found","new_channel")();return TS.interop.i18n.t("No one found matching <strong>{query}</strong>","new_channel")({query:TS.interop.i18n.safeString(TS.utility.truncateAndEscape(t,50))})}};a.data_promise=l(t);$("#invite_members_container").lazyFilterSelect(a)};var c=function t(r){d(r);e.find(".lfs_input").attr("id","invite_members_input");e.find(".new_channel_go").click(TS.ui.new_channel_modal.go);e.find(".create_share_channel").click(function(){TS.ui.new_channel_modal.end()});a();s();e.find(".title_input").keydown(function(){e&&e.find(".modal_input_note.mustard_yellow").each(function(){$(this).addClass("hidden")})});$("#channel_create_title").focus();e.find(".new_channel_cancel_btn").on("click",function(){var e=n&&n.reject;e&&e();TS.ui.fs_modal.close()});var i=$("#save_channel");var o=$("#channel_create_title");function l(){var e=o.val();e&&e.length?TS.utility.disableElement(i,false):TS.utility.disableElement(i,true)}if(i.length&&o.length){o.on("input",l);l()}var u=e.find("#channel_purpose_input");TS.utility.contenteditable.create(u,{ariaLabel:TS.interop.i18n.t("Channel purpose","new_channel")(),singleLineInput:true,modules:{tabcomplete:{positionMenu:function e(t){t.style.width=u.outerWidth()+"px";TS.tabcomplete.positionUIRelativeToInput(t,u)},completers:["channels","emoji","members"]}},enableBroadcastKeywords:false,onTab:function e(){return true},onEnter:function e(){return false},onEscape:function e(){TS.ui.fs_modal.close()}});TS.utility.contenteditable.enable(u)};var m=function e(t){var r=n&&n.resolve;r&&r(t)};var f=function r(n,i,a,s){TS.redux.dispatch(TS.interop.channels.createChannel({name:n})).then(function(e){h(e.id,a);i&&TS.redux.dispatch(TS.interop.channels.submitChannelPurpose({channelId:e.id,purpose:i})).catch(TS.channels.legacyAlertSetPurposeError);g(e.id,s);m(e);TS.ui.fs_modal.close()}).catch(function(r){var i=new RegExp(n,"g");var a=(_.get(r,"data.error")||r.message).toString().replace(i,"CHANNEL_NAME_REDACTED");var s=_.get(r,"stack","").replace(i,"CHANNEL_NAME_REDACTED");TS.interop.utility.getLogger({getState:TS.redux.getState}).error({message:a,stack:s,public:true},a,{subtype:"channel_create_error"});t&&t.stop();var o=TS.ui.validation.getErrorMessage(_.get(r,"data.error")||r.message,{name:n});TS.ui.validation.showWarning(e.find(".title_input"),o,{custom_for:"channel_create_title"})})};var p=function r(n,i,a,s){TS.redux.dispatch(TS.interop.channels.createChannel({name:n,isPrivate:true})).then(function(e){h(e.id,a);i&&TS.redux.dispatch(TS.interop.channels.submitChannelPurpose({channelId:e.id,purpose:i})).catch(TS.channels.legacyAlertSetPurposeError);g(e.id,s);m(e);TS.ui.fs_modal.close()}).catch(function(r){var i=new RegExp(n,"g");var a=(_.get(r,"data.error")||r.message).toString().replace(i,"CHANNEL_NAME_REDACTED");var s=_.get(r,"stack","").replace(i,"CHANNEL_NAME_REDACTED");TS.interop.utility.getLogger({getState:TS.redux.getState}).error({message:a,stack:s,public:false},a,{subtype:"channel_create_error"});t&&t.stop();var o=TS.ui.validation.getErrorMessage(_.get(r,"data.error")||r.message,{name:n});TS.ui.validation.showWarning(e.find(".title_input"),o,{custom_for:"channel_create_title"})})};var h=function e(t,r){if(!t||!r||!r.length)return;_.pull(r,TS.model.user.id);r.length&&TS.interop.api.call("conversations.invite",{channel:t,users:r.join(","),just_created:true,force:true})};var g=function e(t,r){t&&r&&r.length&&TS.pending_users.invitePendingUsersToChannel(r,t)};var S=function e(){var t=new Date("March 17, 2017 10:00:00");var r=Math.floor(t.getTime()/1e3);if(TS.prefs.getPref("seen_intl_channel_names_coachmark"))return;if("en-US"===TS.boot_data.browser_lang||"en-us"===TS.boot_data.browser_lang)return;if(TS.model.user.created>r)return;TS.prefs.setPrefLocal("seen_intl_channel_names_coachmark",true);TS.prefs.setPrefByAPI({name:"seen_intl_channel_names_coachmark",value:true},function(){TS.coachmark.start(TS.coachmarks.coachmarks.intl_channel_names)})};var T=function t(){if(e){e.find(".new_channel_go").off("click");e.find("#channel_public_private_toggle").off("change");e.off("keydown")}};var v=function r(){T();e=null;t=null;n=null}})()},nOzb:function(e,t){(function(){TS.registerModule("searcher",{search:function t(r,n){n.tiered?TS.telemeter.mark("ts-searcher-search-tiered-mark"):TS.telemeter.mark("ts-searcher-search-mark");n.limit?n.limit_option={limit:n.limit}:n.limit_option={limit:e};n.members&&true===n.members&&(n.members=_.cloneDeep(i));var a=f(r,n);if(n.tiered){var o=s(r,n);o.promise=a;return Promise.resolve(o).finally(function(){TS.telemeter.measureAndClear("ts-searcher-search-tiered-mark","ts-searcher-search-tiered")})}return a.then(function(e){try{var t=["U0620EL8G","WFKHTCZ29","WKLQEGRRB"];if(_.get(TS,"model.user.id")&&e.members&&t.indexOf(TS.model.user.id)>-1){var r=_.map(e.members,function(e){return{user:e.id,is_stranger:e.is_stranger}});TS.interop.utility.getLogger({getState:TS.redux.getState}).error("guest_to_guest_visibility",{type:"flannel_search_results",member_list:r})}}catch(e){TS.interop.utility.getLogger({getState:TS.redux.getState}).error("guest_to_guest_visibility",{type:"flannel_search_results",error:e})}return e}).finally(function(){TS.telemeter.measureAndClear("ts-searcher-search-mark","ts-searcher-search")})},test:function e(){return{count:v}}});var e=24;var t={prefer_exact_match:true,frecency:true,prefer_channels_user_belongs_to:true};var r={include_archived:true,only_if_member:false};var n={include_archived:true};var i={include_self:false,include_slackbot:true,include_bots:true,only_local_team:false,only_admins:false};var a={include_deleted:false,include_from_another_team:false};var s=function e(r,n){b(n);var i={};n.members&&(i.members=o(n.members));n.channels&&(i.channels=l(n.channels));n.groups&&(i.groups=u(n.groups));n.all_mpims&&(i.all_mpims=TS.redux.channels.dangerouslyGetMpims().filter(TS.interop.rules.channels.isVisibleMpim));n.mpims&&(i.mpims=TS.redux.channels.dangerouslyGetMpims());n.teams&&(i.teams=d(n.teams));n.usergroups&&(i.usergroups=c(n.usergroups));n.views&&(i.views=m(n.views));n.filter&&(i=n.filter(i));if(false!==n.sort){var a=T(n.sort,n.limit_option,t);return TS.sorter.search(r,i,a)}return i};var o=function e(t){t=T(t,i);return TS.members.getMembersWithOptions(t)};var l=function e(t){t=T(t,r);var n;n=TS.redux.channels.dangerouslyGetPublicChannels({includeFromAnotherTeam:t.include_from_another_team});t.include_archived||(n=_.reject(n,TS.interop.rules.channels.isArchived));t.exclude_required&&(n=_.reject(n,TS.interop.rules.channels.isRequired));t.only_if_member&&(n=_.filter(n,"is_member"));t.can_post&&(n=_.filter(n,TS.permissions.members.canPostInModelOb));n=_.reject(n,{is_moved:1,is_archived:true});return n};var u=function e(t){t=T(t,n);var r=TS.redux.channels.dangerouslyGetPrivateChannels({includeFromAnotherTeam:t.include_from_another_team});t.include_archived||(r=_.reject(r,TS.interop.rules.channels.isArchived));r=_.reject(r,{is_moved:1,is_archived:true});return r};var d=function e(){var t=_.map(TS.boot_data.other_accounts,function(e){return TS.teams.getTeamById(e.team_id)});var r=[];!TS.boot_data.page_needs_enterprise||TS.model.is_our_app&&!TS.interop.environment.isSSBAndAtLeastVersion("2.8")||(r=_.values(TS.teams.getEnterpriseTeams({only_member_of:true,exclude_current_team:true})));return _.uniqBy(r.concat(t),"id")};var c=function e(t){var r=TS.interop.userGroups.getKnownUserGroups();t.include_deleted||(r=r.filter(function(e){return TS.interop.userGroups.isUserGroupActive(e)}));t.include_from_another_team||(r=r.filter(function(e){return!TS.interop.userGroups.isUserGroupFromAnotherTeam(e.id)}));return r};var m=function e(){var t=[];t.push(_.find(TS.model.NAMED_VIEWS,{id:"Vall_threads"}));t.push(_.find(TS.model.NAMED_VIEWS,{id:"Vapp_space"}));return t};var f=function e(t,r){var n=[];var i=[];if(r.members){var a=p(t,r);(r.members.runaway?i:n).push(a)}if(r.channels||r.groups){var o=h(t,r);var l=r.channels&&r.channels.runaway||r.groups&&r.groups.runaway;(l?i:n).push(o)}if(r.usergroups){var u=g(t,r);(r.usergroups.runaway?i:n).push(u)}if(TS.boot_data.page_needs_enterprise&&r.teams){var d=S(t,r);(r.teams.runaway?i:n).push(d)}return Promise.all(n).then(function(){var e=s(t,r);var n=false!==r.sort?!!e.length:_.some(_.values(e),"length");var a=i.length&&!n;if(!a)return e;return new Promise(function(e){Promise.all(i).then(e)}).then(function(){return s(t,r)})})};var p=function e(t,r){var n=t.charAt(0);if("#"===n)return Promise.resolve();"@"===n&&(t=t.slice(1));if(n&&!t)return Promise.resolve();r=T(r.members,r.limit_option,i);r.max_api_results=r.remote_limit||r.limit;r.query=t;return TS.members.promiseToSearchMembers(r).timeout(TS.interop.connectivity.getMaximumSocketWait()).catch(_.noop)};var h=function e(t,r){var n=t.charAt(0);if("@"===n)return Promise.resolve();"#"===n&&(t=t.slice(1));if(n&&!t)return Promise.resolve();var i=r.channels&&r.channels.include_from_another_team||r.groups&&r.groups.include_from_another_team;r=T(r.channels||r.groups,r.limit_option);var a=r.remote_limit||r.limit;return TS.interop.channels.fetchAndUpsertChannelsWithQuery({query:{query:t,count:a},includeFromAnotherTeam:i}).timeout(TS.interop.connectivity.getMaximumSocketWait()).catch(_.noop)};var g=function e(t,r){var n=t.charAt(0);if("#"===n)return Promise.resolve();"@"===n&&(t=t.slice(1));if(n&&!t)return Promise.resolve();r=T(r.usergroups,r.limit_option,a);var i=r.remote_limit||r.limit;return TS.interop.userGroups.fetchAndUpsertUserGroupsWithQuery({query:t,count:i}).catch(_.noop)};var S=function e(t,r){r=T(r.teams,r.limit_option);var n=r.remote_limit||r.limit;return TS.interop.teams.fetchAndUpsertTeamsWithQuery({query:t,count:n}).catch(_.noop)};var T=function e(t,r){true===t&&(t={});return _.defaultsDeep.apply(null,arguments)};var v=function e(t){return _.size(_.flatten(_.values(t)))};var b=function e(t){(t.members||t.mpims||t.all_mpims)&&TS.interop.members.pauseRefetch();(t.channels||t.groups||t.mpims||t.all_mpims)&&TS.interop.channels.pauseRefetch();t.teams&&TS.interop.teams.pauseRefetch()}})()},oTOb:function(e,t){(function(){TS.registerModule("ui.edit_member_profile",{onStart:function e(){TS.members.changed_profile_sig.add(W);$("body").on("click",'[data-action="edit_member_profile_modal"]',function(e){e.preventDefault();TS.ui.edit_member_profile.start();TS.interop.clog.track("USER_PROFILE_CLICK")})},start:function e(){u()}});var e;var t;var r;var n;var i;var a;var s=[];var o;var l="UPLOAD_PROFILE_IMAGE";var u=function e(){var t={};t.custom_username_policy=TS.prefs.getTeamPref("username_policy");var r={body_template_html:TS.templates.edit_member_profile_modal(t),onShow:d,onGo:H,onCancel:c,go_button_text:TS.interop.i18n.t("Save Changes","edit_profile")(),go_button_class:"edit_member_profile_confirm_edit_btn ladda-button",modal_class:"fs_modal_header fs_modal_footer",title:TS.interop.i18n.t("Edit your profile","edit_profile")()};TS.ui.fs_modal.start(r)};var d=function r(){e=$("#edit_member_profile_container");t=$("body");J()&&$("#fs_modal_footer").prepend(TS.templates.edit_member_profile_footer({can_edit_team_profile:true}));e.on("click",'[data-action="edit_member_profile_cancel_photo"]',M);e.on("click",'[data-action="edit_member_profile_confirm_photo_delete"]',p);e.on("click",'[data-action="edit_member_profile_confirm_photo_crop"]',h);e.on("click",'[data-action="edit_member_profile_photo_menu"]',L);e.on("click",'[data-action="edit_member_profile_upload_image"]',R);e.on("click",'[data-action="edit_member_profile_to_delete"]',N);t.on("change.photo",'[data-action="edit_member_profile_upload_photo"]',g);t.on("keydown.member_submit",m);e.on("input","input",q).on("change","select",q).on("keyup","#custom_status_input_for_edit_profile",q);e.on("input",'[data-plastic-type="date"]',Y);f().then(M).catch(TS.error)};var c=function o(){x();e=null;r=null;n=null;i=null;s=[];a=null;if(t){t.off("change.photo");t.off("keydown.member_submit");t=null}};var m=function e(t){if(t.which==TS.utility.keymap.enter){var r=$(a).find('button[type="submit"]');r.length?r.trigger("click"):H();return false}};var f=function e(){return TS.team.ensureTeamProfileFields()};var p=function e(){$("#edit_member_profile_cancel_photo_delete_btn").addClass("disabled");$("#fs_modal").addClass("stop_pointer_events");t.on("keydown.deletePhoto",function(e){e.stopPropagation()});TS.interop.api.call("users.deletePhoto").then(function(){if(TS.web)return TS.interop.api.call("users.info",{user:TS.model.user.id,_x_reason:"web_edit_member_profile"}).then(function(e){delete e.data.ok;var t=$.extend(true,TS.model.user,e.data.user);TS.members.legacyUpsertMember(t);W();M()},M);M()}).catch(function(e){TS.warn("Unable to delete profile photo");TS.error(e);return C()}).finally(function(){Ladda.stopAll();t.off("keydown.deletePhoto");$("#fs_modal").removeClass("stop_pointer_events");$("#edit_member_profile_cancel_photo_delete_btn").removeClass("disabled")})};var h=function e(){TS.interop.console.info(l,"Begin to upload photo");n&&n.disable();$("#edit_member_profile_cancel_photo_crop_btn").addClass("disabled");$("#fs_modal").addClass("stop_pointer_events");t.on("keydown.uploadPhoto",function(e){e.stopPropagation()});var r=$("#edit_member_profile_photo");var i=$("#cropbox");var a=i.data("dimensions");a.id=r.data("src_id");TS.interop.console.info(l,"Upload photo using users.setPhoto endpoint");TS.interop.api.call("users.setPhoto",a).then(function(e){TS.interop.console.info(l,"Call to users.setPhoto is ok? "+(e&&e.data&&e.data.ok));var t=_.merge(TS.model.user,{profile:e.data.profile});TS.members.legacyUpsertAndSignal(t);W();M()}).catch(function(e){TS.interop.console.warn(l,"Unable to upload cropped profile photo");TS.error(e);return C()}).finally(function(){Ladda.stopAll();t.off("keydown.uploadPhoto");$("#fs_modal").removeClass("stop_pointer_events");$("#edit_member_profile_cancel_photo_crop_btn").removeClass("disabled");i.removeData("dimensions");TS.interop.console.info(l,"Attempt to upload profile photo complete")})};var g=function t(r){var n="change"===r.type?$(this):void 0;TS.interop.console.info(l,"Begin to preprocess profile photo");if(n){if(!n.val()){TS.model.is_iOS&&TS.menu.end();return}r=n.get(0).files}if(r){TS.model.is_iOS&&TS.menu.end();if(!r.length)return;A();K(0);S(r[0]).then(T).then(v).then(b).then(y).then(w).catch(k);e.find('[data-action="edit_member_profile_upload_photo"]').val("")}else TS.interop.console.info(l,"No files found to process, returning early")};var S=function e(t){return new Promise(function(e,r){var n=new FileReader;n.onload=function(r){TS.interop.console.info(l,"Photo successfully read");e({file:t,src:r.target.result})};n.onabort=function(){TS.interop.console.info(l,"Profile photo file read aborted");r(new Error("abort"))};n.onerror=function(e){TS.interop.console.warn(l,"Unable to read profile photo file");TS.error(e);r(e)};o=function e(){try{n.abort()}catch(e){TS.error(e)}};n.readAsDataURL(t)})};var T=function e(t){if(t.file.type.match(/image\/(?:gif|png|jpeg)/i)){TS.interop.console.info(l,"Photo format valid");return Promise.resolve(t)}TS.interop.console.warn(l,"Photo format invalid");Promise.reject(new Error("format"))};var v=function e(t){return new Promise(function(e,r){i=new Image;i.onload=function(){TS.interop.console.info(l,"Photo size valid");e(t)};i.onerror=function(e){TS.interop.console.warn(l,"Unable to set profile photo file image src when validating size");TS.error(e);r(e)};i.src=t.src})};var b=function e(t){var r=TS.model.api_url+"users.preparePhoto";var n=new FormData;n.append("image",t.file);n.append("token",TS.model.api_token);TS.interop.console.info(l,"Begin preparing photo on server");return new Promise(function(e,t){var i=$.ajax({url:r,data:n,dataType:"json",cache:false,contentType:false,processData:false,type:"POST",xhr:function e(){var e=jQuery.ajaxSettings.xhr();e.upload&&e.upload.addEventListener("progress",function(e){if(e.lengthComputable)K(e.loaded/e.total);else{TS.info("Upload length not computable");K(1)}},false);return e}}).fail(function(e,r,n){o=null;TS.interop.console.warn(l,"Preparing photo on server failed");t(new Error(n))}).done(function(r){o=null;if(r.ok){TS.interop.console.info(l,"Preparing photo on server succeeded");e(r)}else{TS.interop.console.warn(l,"Preparing photo on server resolved with an error");t(new Error(r.error))}});o=i.abort})};var y=function e(t){return new Promise(function(e,r){var n=$("#edit_member_profile_photo");var a=n.get(0);TS.interop.console.info(l,"Begin setting up photo for crop");var s=function r(){i.src=t.url;$("#edit_member_profile_photo_preview").css("background","url("+t.url+")");n.css("opacity",0);E();d();TS.interop.console.info(l,"Photo set up for crop");e()};var u=function e(t){TS.interop.console.warn(l,"Unable to set crop photo file image src");TS.error(t);d();r(t)};var d=function e(){a.removeEventListener("load",s);a.removeEventListener("error",u)};o=function t(){d();e()};n.attr("src",t.url).data("src_id",t.id);a.addEventListener("load",s);a.addEventListener("error",u)})};var w=function e(){function t(e){if(!i)return;TS.interop.console.info(l,"Update photo preview");var t=o.width();var r=t*i.width/e.crop_w;var n=t*i.height/e.crop_w;var a=r*e.crop_x*-1/i.width;var s=n*e.crop_y*-1/i.height;o.css({"background-size":r+"px","background-position":a+"px "+s+"px"})}function r(e){if(!i)return;TS.interop.console.info(l,"Update photo selection");var r={crop_x:Math.round(e.x),crop_y:Math.round(e.y),crop_w:Math.min(Math.round(e.w),i.height)};s.data("dimensions",r);t(r)}function a(){n.animateTo(_,function(){var e=this.tellSelect();e.w=i.width;r(e)});n.focus();TS.interop.console.info(l,"Photo crop complete")}TS.interop.console.info(l,"Begin photo crop");var s=$("#cropbox");var o=$("#edit_member_profile_photo_preview");var u=$("#edit_member_profile_photo");var d=u.width();var c=u.height();var _;if(!i)return;var m=Math.min(i.width,i.height);t({crop_x:(i.width-m)/2,crop_y:(i.height-m)/2,crop_w:m});$("#edit_member_profile_photo").css("opacity",0);u.Jcrop({aspectRatio:1,allowSelect:false,boxWidth:d,boxHeight:c,onSelect:r,onRelease:a,bgColor:"white",trueSize:[i.width,i.height]},function(){n=this;var e=this.getBounds();var t=Math.min(e[0],e[1]);var r=(e[0]-t)/2;var i=(e[1]-t)/2;_=[r,i,t,t];a()})};var k=function e(t){TS.interop.console.warn(l,"Catching upload photo failure");switch(t&&t.message){case"abort":TS.interop.console.warn(l,"Upload photo aborted");break;case"format":case"bad_image":case"too_many_frames":TS.interop.console.warn(l,"Photo format error: "+t.message);O();break;case"too_large":TS.interop.console.warn(l,"Photo too large");F();break;default:TS.interop.console.warn(l,"Unexpected error when processing photo");TS.interop.console.error(JSON.stringify(t,null,2));return C()}};var x=function e(){if(o){o();o=null}};var C=function e(){return TS.generic_dialog.alert(TS.interop.i18n.t("Sorry! Something went wrong. Please try again.","edit_profile")()).then(M)};var M=function t(){s.length=0;s.push({back:t});V();x();i=null;var r=!e.find("#edit_member_profile_list").children().first().length;if(r){var n={member:TS.model.user,team:TS.model.team,team_member_profile_fields:TS.team.getVisibleTeamProfileFieldsForMember(TS.model.user,true)};var a=[];_.each(TS.boot_data.slack_timezones,function(e){a.push({label:e[0],val:e[1]})});n.timezone_options=a;n.member_tz=TS.model.user.tz||TS.boot_data.default_tz;n.custom_username_policy=TS.prefs.getTeamPref("username_policy");n.lock_display_name=false;"normal"!==TS.prefs.getTeamPref("auth_mode")&&false===TS.prefs.getTeamPref("sso_choose_username")&&(n.lock_display_name=true);var o=TS.templates.edit_member_profile_list(n);e.find("#edit_member_profile_list").html(o);TS.ui.validation.validate(e,{fast:true})}B("#edit_member_profile_list");TS.ui.fs_modal.showFooter();TS.ui.fs_modal.setHeaderTitle(TS.interop.i18n.t("Edit your profile","edit_profile")());Ladda.bind(".edit_member_profile_confirm_edit_btn");q();G();D();U(true)};var I=function e(){return true===TS.model.user.profile.is_custom_image};var E=function e(){s.push({back:M});B("#edit_member_profile_photo_crop");TS.ui.fs_modal.setHeaderTitle(TS.interop.i18n.t("Crop your photo","edit_profile")());Ladda.bind("#edit_member_profile_confirm_photo_crop_btn");D();U()};var A=function e(){s.push({back:M});r||z();B("#edit_member_profile_photo_upload");TS.ui.fs_modal.hideFooter();TS.ui.fs_modal.setHeaderTitle(TS.interop.i18n.t("Uploading your photo\u2026","edit_profile")());D();U()};var P=function e(){s.push({back:e});B("#edit_member_profile_photo_delete");TS.ui.fs_modal.hideFooter();TS.ui.fs_modal.setHeaderTitle(TS.interop.i18n.t("Remove profile photo","edit_profile")());Ladda.bind("#edit_member_profile_confirm_photo_delete_btn");j();U()};var O=function e(){s.push({back:M});B("#edit_member_profile_photo_format_error");TS.ui.fs_modal.setHeaderTitle(TS.interop.i18n.t("Oh cripes","edit_profile")());D();U()};var F=function e(){s.push({back:M});B("#edit_member_profile_photo_oversize_error");TS.ui.fs_modal.setHeaderTitle(TS.interop.i18n.t("Dang","edit_profile")());D();U()};var H=function t(){if(!TS.ui.validation.validate(e,{quiet:true,fast:true})){TS.ui.validation.validate(e);Ladda.stopAll();$(".edit_member_profile_confirm_edit_btn").addClass("disabled");return false}var r=["real_name","display_name","title","phone"];var n={};r.forEach(function(t){var r;var i;r=e.find('input[name="'+t+'"]');i=r.val();n[t]=i&&i.trim()});(TS.model.team.profile.fields||[]).filter(function(e){return!e.is_hidden}).forEach(function(t){var r=TS.model.user.profile.fields||{};var i=Q(r[t.id]);var a=Q(i.value);var s=Q(i.alt);var o=e.find('input[name="'+t.id+'"], select[name="'+t.id+'"]');var l=e.find('input[name="'+t.id+'_alt"]');var u=Q(o.val());var d=Q(l.val());n.fields=n.fields||{};a===u&&s===d||(n.fields[t.id]={value:u&&u.trim(),alt:d&&d.trim()});"text"===t.type&&"skype"===t.label.toLocaleLowerCase()&&(n.skype=u&&u.trim());o.val("").val(u);l.val("").val(d)});var i=[];_.each(n.fields,function(e,t){e.value&&e.value.length||i.push(t)});i.length&&TS.warn("EVALUE-1371: Calling users.profile.set with emptied fields: "+i.join(" "));var a={profile:JSON.stringify(n)};var s=e.find('[name="tz"]').val();if(s!==TS.model.user.tz){if(TS.web){TS.model.user.tz=s;TS.model.user.tz_offset=TS.boot_data.dst_offsets[s].tz_offset}TS.prefs.setPrefByAPI({name:"tz",value:s,_x_reason:"tz_edit_member_profile"})}TS.interop.api.call("users.profile.set",a).then(function(e){$(".edit_member_profile_confirm_edit_btn").addClass("disabled");TS.model.user.profile=e.data.profile;TS.web?TS.members.legacyUpsertMember(TS.model.user):TS.members.legacyUpsertAndSignal(TS.model.user);TS.ui.fs_modal.close()}).catch(function(t){$(".edit_member_profile_confirm_edit_btn").addClass("disabled");if("ratelimited"===t.data.error)return TS.generic_dialog.alert(TS.interop.i18n.t("You\u2019re changing your profile too often! You might have better luck if you try again in a few minutes.","edit_profile")());t.data.error=TS.ui.validation.maybeConvertNameErrorCode(t.data.error);var r=TS.ui.validation.getErrorMessage(t.data.error,{maxlength:80});if("real_name"===t.data.field){TS.ui.validation.showWarning(e.find('input[name="'+t.data.field+'"]'),r,{custom_for:"real_name_profile_field_warnings",should_truncate:false});return false}if("display_name"===t.data.field){TS.ui.validation.showWarning(e.find('input[name="'+t.data.field+'"]'),r,{custom_for:"display_name_profile_field_warnings",should_truncate:false});return false}TS.ui.fs_modal.close();TS.generic_dialog.alert(TS.interop.i18n.t("Sorry! Something went wrong. Please try again.","edit_profile")())}).finally(Ladda.stopAll);return false};var j=function t(){e.closest(".contents").addClass("display_flex flex_direction_column").css("height","70vh");e.css({margin:"auto 0",height:"auto","padding-top":0})};var D=function t(){e.closest(".contents").removeClass("display_flex flex_direction_column").css("height","");e.css({margin:"",height:"","padding-top":""})};var L=function t(r){r.stopPropagation();TS.interop.console.info(l,"Maybe open upload photo menu");I()&&!$(r.target).is(".btn")||TS.model.is_iOS?TS.menu.member.startWithEditMemberProfilePhotoActions(r,R):e.find('[data-action="edit_member_profile_upload_photo"]').trigger("click")};var R=function t(r){var n=$(r.target).closest("li");if(n.is('[data-action="edit_member_profile_upload_image"]')){if(!TS.model.is_iOS){r.preventDefault();TS.interop.console.info(l,"User clicked edit profile image menu option");e.find('[data-action="edit_member_profile_upload_photo"]').trigger("click");TS.menu.end()}}else if(n.is('[data-action="edit_member_profile_to_delete"]')){r.preventDefault();TS.interop.console.info(l,"User clicked delete profile image menu option");P();TS.menu.end()}};var N=function e(t){var r=$(t.target).closest("li");if(r.is('[data-action="edit_member_profile_to_delete"]')){t.preventDefault();P();TS.menu.end()}};var B=function t(r){var n=["#edit_member_profile_loading","#edit_member_profile_list","#edit_member_profile_photo_upload","#edit_member_profile_photo_crop","#edit_member_profile_photo_delete","#edit_member_profile_photo_format_error","#edit_member_profile_photo_oversize_error"].filter(function(e){return e!==r}).join(", ");e.find(n).addClass("hidden");e.find(r).removeClass("hidden");a=r};var U=function e(t){if(t){TS.ui.fs_modal.unbindBackButton();TS.ui.fs_modal.hideBackButton()}else{TS.ui.fs_modal.bindBackButton(function(){s.pop();var e=s.pop();e.back()});TS.ui.fs_modal.showBackButton()}};var q=function t(){$(".edit_member_profile_confirm_edit_btn").toggleClass("disabled",!TS.ui.validation.validate(e,{quiet:true,fast:true}))};var G=function t(){e.find(".edit_member_profile_lazy_filter_select").each(function(e,t){var r=$(t);var n=r.val().split(/\s*,\s*/);TS.ui.people_picker.make(r,{preselected_ids:n});r.on("change",function(){var e=TS.ui.people_picker.value(r).map(function(e){return e.member.id}).join(",");r.val(e);q()})})};var W=function t(){if(!e)return;$("#edit_member_profile_photo_container .member_image").replaceWith(TS.templates.builders.makeMemberPreviewLinkImage(TS.model.user.id,192,false,true))};var z=function e(){r=$("#edit_member_profile_progress_circle").circleProgress({value:0,size:64,fill:{gradient:["#50acf4","#41a6f5"]},startAngle:Math.PI/-2})};var K=function e(t){var n=parseFloat(t);isNaN(n)||r.circleProgress({value:n.toFixed(2)})};var V=function e(){if(!n)return;n.destroy();n=null;$("#edit_member_profile_photo").css({width:"auto",height:"auto",display:"block",visibility:"visible",opacity:1})};var Y=function e(t){var r=$(t.target);var n=$('input[name="'+r.attr("name")+'_alt"]');var i=r.val();i&&(i=i.trim());TS.ui.validation.validate(r,{quiet:true,fast:true})&&n.val(TS.interop.datetime.convertISOtoUTCReadableDate(i))};var J=function e(){if(!TS.model.team.plan)return false;var t=TS.model.user;if(!t)return false;if(TS.model.user.enterprise_user)return TS.model.user.enterprise_user.is_admin||TS.model.user.enterprise_user.is_owner;if("admin"===TS.prefs.getTeamPref("who_can_change_team_profile"))return t.is_admin;if("owner"===TS.prefs.getTeamPref("who_can_change_team_profile"))return t.is_owner;return true};var Q=function e(t){return _.isUndefined(t)?"":t}})()},omB7:function(e,t){(function(){TS.registerModule("tabcomplete.channels",{type:"channels",getMatch:function e(t){if(!_.isString(t))return;var r;var n=Math.max(t.lastIndexOf("\uff03"),t.lastIndexOf("#"));var i=/(^|\n|.)([#\uff03][^~`!@#\uff03$%^&*()+=[\]{}\\|;:'",.<>/?\s]*)$/i;var a=TS.interop.i18n.deburr(t);a.replace(i,function(e,i){if(TS.interop.texty.trimAllowedMatchPrefix(i))return;r=t.substr(n,t.length-n)});if(!r)return;return{match:r,index:n}},shouldDisplayResults:function e(t,r){if(!t||_.isEmpty(r))return false;var n=t.replace(/^#/,"").toLowerCase();var i=1===r.length&&r[0].name===n;return!i},getResultAtIndex:function e(t,r){if(!t||!_.isNumber(r))return;return t[r]},getInsertData:function e(t){if(!t)return;TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_select",trigger:"channel"}}});var r="#"+t.name;return{text:r,ensure_preceding_space:true}},search:function n(i,a,s){TS.interop.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_typing",trigger:"channel"}}});r(i).then(function(r){var n=_.map(r,"model_ob");s(null,n);if(!e(i,n))return;return r.promise.then(function(e){var r=_.map(e,"model_ob");t(n,r)||s(null,r)})})},render:function e(t,r){var n=TS.templates.tabcomplete_channel_header({text:t});var i=TS.templates.tabcomplete_channel_results({results:r});return TS.tabcomplete.renderMenu(n,i)},onSelect:function e(t,r){if(!t)return;r||(r="");r=r.replace(/^(#|\uff03)/,"");TS.ui.frecency.record(t,r)},onSelectedIndexChange:function e(t){TS.tabcomplete.onSelectedIndexChange(t)}});var e=function e(t,r){t=t.replace(/^(#|\uff03)/,"");if(r&&1===r.length&&""+r[0].name===t)return false;return true};var t=function e(t,r){if(!r&&!t)return true;if(!r||!t)return false;if(t.length!==r.length)return false;return _.isEqualWith(t,r,function(e,t){return e.id===t.id})};function r(e){var t=e.replace(/^(#|\uff03)/,"");return TS.searcher.search(t,{channels:{include_archived:false},tiered:true,sort:{prefer_exact_match:true,frecency:true,allow_empty_query:true,search_previous_channel_names:true,prefer_channels_user_belongs_to:false},limit:25})}})()},pW7e:function(e,t){(function(){TS.registerModule("channels.ui",{onStart:function e(){},showArchiveChannelDialog:function e(t){TS.generic_dialog.start({title:TS.interop.i18n.t("Archive #{channel_name}","channels")({channel_name:t.name}),body:TS.templates.channel_option_archive({name:t.name}),go_button_text:TS.interop.i18n.t("Yes, archive the channel","channels")(),onGo:function e(){var r=function e(t,r){if(t){if(TS.web){$("p.alert").addClass("hidden");$("#archive_success").removeClass("hidden");$("#archive_btn").addClass("hidden");$("#unarchive_btn").removeClass("hidden")}return}var n=TS.interop.i18n.t("Archiving failed with error: {error}","channels")({error:r.error});"last_ra_channel"===r.error?n=TS.model.user.is_admin?TS.interop.i18n.t("Sorry, you can\u2019t archive this channel because it is the only channel one of the guest account members belongs to. If you first disable the guest account, you will then be able to archive the channel.","channels")():TS.interop.i18n.t("Sorry, you can\u2019t archive this channel because it is the only channel one of the guest account members belongs to.","channels")():"restricted_action"===r.error?n=TS.interop.i18n.t("<p>You don\u2019t have permission to archive channels.</p><p>Talk to your Workspace Owner.</p>","channels")():"already_archived"===r.error?n=TS.interop.i18n.t("This channel was already archived.","channels")():"cant_archive_general"===r.error&&(n=TS.interop.i18n.t("This channel cannot be archived.","channels")());setTimeout(TS.generic_dialog.alert,500,n)};TS.interop.api.call("conversations.archive",{channel:t.id}).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;r(a,t,n,i);return{data:t,args:n,request_id:i}},function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r(a,t,n,i);return{data:t,args:n,request_id:i}})}})},showArchiveGroupDialog:function e(t,r){var n=TS.interop.i18n.t("{leave, select, true{Leave and archive}other{Archive}} {prefix}{name}","channels")({leave:r,prefix:TS.model.group_prefix,name:t.name});var i=TS.interop.i18n.t("{leave, select, true{Yes, leave & archive the channel}other{Yes, archive the channel}}","channel")({leave:r});TS.generic_dialog.start({title:n,body:TS.templates.channel_option_archive({name:t.name,group_prefix:TS.model.group_prefix}),go_button_text:i,onGo:function e(){var n=function e(t,n){if(t){if(TS.web){$("p.alert").addClass("hidden");$("#archive_success").removeClass("hidden");$("#archive_btn").addClass("hidden");$("#unarchive_btn").removeClass("hidden")}return}var i=TS.interop.i18n.t("Archiving failed with error: {error}","channels")({error:n.error});"last_ra_channel"===n.error?i=TS.model.user.is_admin?TS.interop.i18n.t("Sorry, you can\u2019t archive this channel because it is the only channel one of the guest account members belongs to. If you first disable the guest account, you will then be able to archive the channel.","channels")():TS.interop.i18n.t("Sorry, you can\u2019t archive this channel because it is the only channel one of the guest account members belongs to.","channels")():"already_archived"===n.error?i=TS.interop.i18n.t("This channel was already archived.","channels")():"restricted_action"===n.error?i=TS.interop.i18n.t("<p>You don\u2019t have permission to archive private channels.</p><p>Talk to your Workspace Owner.</p>","channels")():"user_is_restricted"===n.error&&(i=r?TS.interop.i18n.t('<h3 class="top_margin">Ask an admin to archive this channel</h3><p>Since you\u2019re the last one here, you\u2019ll need to invite an admin and ask them to archive the channel.</p>',"channels","1cbc791173101451030c2c2ad2d4a672ee7b86d8")():TS.interop.i18n.t("<p>You don\u2019t have permission to archive private channels.</p><p>Talk to your Workspace Owner.</p>","channels")());setTimeout(TS.generic_dialog.alert,500,i)};TS.interop.api.call("conversations.archive",{channel:t.id}).then(function(e){var t=e.data,r=e.args,i=e.request_id;var a=true;n(a,t,r,i);return{data:t,args:r,request_id:i}},function(e){var t=e.data,r=e.args,i=e.request_id;var a=false;n(a,t,r,i);return{data:t,args:r,request_id:i}})}})},channelCreateDialogShowDisallowedCharsAlert:function e(t){t.find(".modal_input_note").addClass("hidden");t.find(".invalid_chars_warning").removeClass("hidden");$("#channel_create_title").select()},channelCreateDialogShowSinglePunctuationAlert:function e(t){t.find(".modal_input_note").addClass("hidden");t.find(".single_punctuation_warning").removeClass("hidden");$("#channel_create_title").select()},channelCreateDialogCleanName:function e(t){var r=t.find(".title_input").val();var n=TS.interop.utility.cleanChannelName(r);while("#"===r.substr(0,1))r=r.substr(1);if(n!=r){t.find(".title_input").val(n);TS.channels.ui.channelCreateDialogShowDisallowedCharsAlert(t);return false}return true},channelCreateDialogValidateInput:function e(t){var r=t.find(".title_input").val();var n=TS.interop.utility.cleanChannelName(r);if(!TS.channels.ui.channelCreateDialogCleanName(t))return false;if("_"===n||"-"===n){TS.channels.ui.channelCreateDialogShowSinglePunctuationAlert(t);return false}if(!r){$("#channel_create_title").select();return false}if(TS.redux.channels.getPublicChannelByName(r)||TS.interop.memberExistsWithName(r)){TS.channels.ui.channelCreateDialogShowNameTakenAlert(t);return false}return true}})})()},pdVC:function(e,t){(function(){TS.registerModule("cmd_handlers",{server_cmds:null,onStart:function t(){var r=true;o=TS.utility.throttleFunc(o,3e3,r);TS.prefs.team_allow_calls_changed_sig.add(l);if(!_.get(window,"desktop.app.toggleDevTools")){delete TS.cmd_handlers["/slackdevtools"];delete TS.cmd_handlers["/slackgpuinfo"];delete TS.cmd_handlers["/slackmediainfo"];delete TS.cmd_handlers["/slackaccessibility"];delete TS.cmd_handlers["/slackdesktopsettings"]}_.get(window,"desktop.stats.downloadCookies")||delete TS.cmd_handlers["/slackcookies"];_.get(window,"desktop.app.openTaskManager")||delete TS.cmd_handlers["/slacktaskmanager"];_.get(window,"desktop.stats.restartWithNetlog")||delete TS.cmd_handlers["/slacknetlog"];TS.interop.i18n.locale!==TS.interop.i18n.DEFAULT_LOCALE&&e.push("/"+TS.interop.i18n.t("active","cmd_handlers")())},test:function e(){return{_maybeInviteUserToModelOb:p,_maybeInviteUserGroupToModelOb:h,_getUserIdentifier:g}},groupCmdsByType:function e(t){var r=[u(t),d(t),f(t)];var n=Array.prototype.concat.apply([],r);var i=n.filter(function(e){return e.cmds.length>0});return i},getAvailableUserCmds:function e(t){var r={};var n=TS.shared.legacyGetActiveModelOb();t=t||{};_.forOwn(TS.cmd_handlers,function(e,i){if(0!==i.indexOf("/"))return;if("function"===typeof e.autocomplete&&!e.autocomplete()||false===e.autocomplete||e.alias_of)return;if(t.in_thread&&!TS.cmd_handlers.isCmdSupportedInThreads(i))return;switch(i){case"/archive":if(!TS.permissions.channels.canSeeArchiveChannelOption(n))return;break;case"/unarchive":if(TS.boot_data.page_needs_enterprise&&!_.get(TS.model.user,"enterprise_user.is_admin",false)&&TS.interop.rules.channels.isOrgDefaultChannel(n))return;if(TS.interop.rules.channels.isRequired(n))return;if(n.is_im)return;if(n.is_mpim)return;if((n.is_group||n.is_private)&&TS.model.user.is_restricted)return;if(n.is_channel&&!TS.permissions.members.canArchiveChannels())return;if(TS.interop.rules.channels.isExternallySharedChannel(n))return;break;case"/kick":case"/remove":if(!TS.interop.rules.user.canKickFromChannel(n.id))return;break;case"/join":if(TS.model.user.is_restricted)return;break;case"/feed":if(TS.model.user.is_restricted)return;break;case"/invite":if(TS.model.user.is_ultra_restricted)return;break;case"/invite_people":if(!TS.interop.rules.invites.canUserSeeInviteModal(TS.redux.getState()))return;break;case"/topic":case"/purpose":if(n.is_im)return;if(n.is_mpim)return;if(TS.model.user.is_restricted)return;if(TS.interop.rules.channels.isRequired(n)&&!TS.permissions.members.canPostInChannel(n))return;break;case"/leave":if(n.is_group||n.is_private)return;break;case"/rename":if(!TS.permissions.channels.canSeeRenameChannelOption(n))return;break;default:break}if(("custom"===e.type||"service"===e.type)&&TS.prefs.commands_only_regular&&TS.model.user.is_restricted)return;r[i]=e});return r},parseArgs:function e(t){var r=t;var n={cmd:"",rest:"",words:[]};if(!_.isString(t))return n;var i=t.trim();if(!i)return n;n.words=i.split(/\s+/);n.cmd=n.words[0].toLowerCase().replace(/\u2019/g,"'");n.disp=n.words[0];n.rest=i.substring(n.cmd.length).trim();n.original_txt=r;return n},setUpCmds:function e(){if(TS.boot_data.feature_sonic_inputs)return;if(!TS.boot_data.page_needs_custom_cmds){l();return Promise.resolve()}i();if(s()){var t=TS.storage.fetchCmds();TS.model.did_we_load_with_cmd_cache=true;TS.cmd_handlers.mergeInServerCmds(t.data);l();m(t.data);return Promise.resolve()}var r=true;return TS.interop.api.call("commands.list",{},null,r).then(function(e){if(!e.data.commands)return;a(e.data.commands,e.data.cache_ts)}).catch(_.noop)},removeCommand:function e(t,r){delete TS.cmd_handlers.server_cmds[t];a(TS.cmd_handlers.server_cmds,r)},updateCommand:function e(t,r){TS.cmd_handlers.server_cmds[t.name]=t;a(TS.cmd_handlers.server_cmds,r)},resetUpCmds:function e(){TS.storage.storeCmds("");o()},getCmdAppUserIds:function e(){return n},sortNames:function e(t){var r=t.sort(TS.interop.i18n.sorter);function n(e,t){return e.filter(function(e){return-1!==t.indexOf(TS.cmd_handlers[e].type)})}var i=n(r,["client","core"]);var a=n(r,["custom"]);var s=n(r,["app","service"]);var o=s.filter(function(e){return!!TS.cmd_handlers.getAppNameForCmdName(e)});o.sort(function(e,t){var r=TS.cmd_handlers.getAppNameForCmdName(e);var n=TS.cmd_handlers.getAppNameForCmdName(t);return TS.interop.i18n.sorter(r,n)});var l=s.filter(function(e){return!TS.cmd_handlers.getAppNameForCmdName(e)});l.sort();var u=[].concat(i,a,o,l);return u},getAppNameForCmdName:function e(t){var r="";var n=TS.cmd_handlers[t];if(n)if(n.app){var i=TS.interop.apps.getAppById(n.app);!i||i.isUnknown||i.isNonExistent||(r=i.name)}else n.service_name&&(r=n.service_name);return r},mergeInServerCmds:function e(t){TS.cmd_handlers.server_cmds=t;var r;for(var n in TS.cmd_handlers){if(0!==n.indexOf("/"))continue;"client"===TS.cmd_handlers[n].type?delete TS.cmd_handlers[n].override:delete TS.cmd_handlers[n]}for(r in t){if(0!==r.indexOf("/"))continue;if(TS.cmd_handlers[r]&&!TS.cmd_handlers[r].can_be_overridden_by_server_cmd){TS.cmd_handlers[r].override=true;continue}TS.cmd_handlers[r]=TS.cmd_handlers.makeInternalCmdObject(t[r])}for(r in t){if(0!==r.indexOf("/"))continue;if(!TS.cmd_handlers[r].alias_of)continue;var i=TS.cmd_handlers[TS.cmd_handlers[r].alias_of];if(!i)continue;if("client"===i.type)continue;i.aliases||(i.aliases=[]);i.aliases.push(r)}},makeInternalCmdObject:function e(t){return{autocomplete:true,alias_of:t.alias_of?t.alias_of:null,aliases:null,usage:t.usage||"",desc:t.desc||"",help_text:t.help_text||"",type:t.type||"",app:t.app||"",service_name:t.service_name||"",normalized:TS.interop.i18n.deburr(t.name),canonical_name:t.canonical_name||null}},addEphemeralFeedback:function e(t,r){r=_.defaults(r,{temporary:true});var n={text:t};r.input_txt&&(r.c_id&&r.thread_ts?TS.utility.populateThreadInputs(r.input_txt,r.c_id,r.thread_ts):TS.boot_data.feature_sonic_inputs&&TS.interop.message_pane_input.value(TS.model.active_cid,r.input_txt));r.temporary||(r.c_id&&r.thread_ts?TS.utility.msgs.removeAllEphemeralMsgsByType("threads_temp_slash_cmd_feedback",r.c_id):TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",TS.model.active_cid));r.temporary&&(n.ephemeral_type="temp_slash_cmd_feedback");r.slackbot_feels&&(n.slackbot_feels=r.slackbot_feels);if(r.c_id&&r.thread_ts){n.channel=r.c_id;n.thread_ts=r.thread_ts;r.temporary&&(n.ephemeral_type="threads_temp_slash_cmd_feedback")}},runCommand:function e(t,r,n){if(!TS.cmd_handlers[t.cmd])return;if(r&&!TS.cmd_handlers.isCmdSupportedInThreads(t.cmd)){TS.cmd_handlers.sendCmdNotSupportedInThreadsMsg(t.cmd,t.original_txt,r,n);return}TS.model.last_active_cid&&TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",TS.model.last_active_cid);var i=t.cmd;TS.cmd_handlers[t.cmd].canonical_name&&(i=TS.cmd_handlers[t.cmd].canonical_name);"client"===TS.cmd_handlers[t.cmd].type&&TS.interop.clog.track("BUILTIN_CHAT_COMMAND_CALLED",{locale:TS.interop.i18n.locale,slash_command_canonical_name:i,slash_command_name:t.cmd});TS.cmd_handlers[t.cmd].func(t.cmd,t.rest,t.words,t.original_txt,r,n)},isCmdSupportedInThreads:function t(r){if("/giphy"===r&&TS.boot_data.feature_threaded_slack_owned_plugins)return true;return r&&_.includes(e,r)},sendCmdNotSupportedInThreadsMsg:function e(t,r,n,i){var a;a=TS.cmd_handlers[t]?TS.interop.i18n.t("*{cmd}* is not supported in threads. Sorry!","threads")({cmd:t}):TS.interop.i18n.t("*{cmd}* is not a valid command.","threads")({cmd:t});TS.cmd_handlers.addEphemeralFeedback(a,{input_txt:r,slackbot_feels:"sad_surprise",c_id:i.id,thread_ts:n.ts})},"/slacknetlog":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){if(!window.desktop||!TS.model.is_our_app)return;if(!window.desktop.stats||!window.desktop.stats.restartWithNetlog)return;window.desktop.stats.restartWithNetlog()}},"/slackaccessibility":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){if(!window.desktop||!TS.model.is_our_app)return;TS.utility.window.open({url:"chrome://accessibility/",try_window_open_in_ssb:true})}},"/slackcookies":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){if(!_.get(window,"desktop.stats.downloadCookies"))return;desktop.stats.downloadCookies({showItemInFolder:true})}},"/slackgpuinfo":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){if(!window.desktop||!TS.model.is_our_app)return;TS.utility.window.open({url:"chrome://gpu/",try_window_open_in_ssb:true})}},"/slackmediainfo":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){if(!window.desktop||!TS.model.is_our_app)return;TS.utility.window.open({url:"chrome://media-internals/",try_window_open_in_ssb:true})}},"/slackdevtools":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){if(!_.get(window,"desktop.app.toggleDevTools"))return;var t=false;desktop.app.toggleDevTools(t)}},"/slackdesktopsettings":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){_.get(window,"desktop.app.showSettingsEditor")?window.desktop.app.showSettingsEditor():_.get(window,"desktop.store.dispatch")&&window.desktop.store.dispatch({type:"SHOW_SETTINGS_EDITOR"})}},"/slacktaskmanager":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){if(!TS.model.is_our_app)return;if(!window.desktop.app||!window.desktop.app.openTaskManager)return;desktop.app.openTaskManager()}},"/slackdebugunreads":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){var t=TS.interop.channels.getAllChannels();if(!t||!Object.keys(t).length){var r="/slackdebugunreads: Could not get list of model objects for user. :(";TS.warn(r);TS.cmd_handlers.addEphemeralFeedback(r);return}var n=[];var i=0;var a=0;_.each(t,function(e){if(!e.unread_cnt)return;var t;t=e.is_group?"group":e.is_mpim?"mpim":e.is_im?"im":e.is_channel?"channel":"unknown";if((e.unread_cnt||e.unread_highlight_cnt)&&t){i+=1;n.push([">","`"+e.id+"`","group"===t||"mpim"===t?" ("+t+"):":":",e.unread_cnt?" unread"+(e.is_im||e.is_mpim?" (highlight)":"")+" = "+e.unread_cnt:"",e.unread_highlight_cnt?", highlight = "+e.unread_highlight_cnt:"",TS.notifs.isCorGMuted(e.id)?" (muted)":""].join(""));a+=e.unread_cnt}else{var s="/slackdebugunreads: bad type for channel id "+e.id+"? ("+t+")";TS.warn(s);TS.cmd_handlers.addEphemeralFeedback(r)}});a||n.push("No unreads found across "+t.length+" channels??");var s=TS.model.all_unread_highlights_cnt;var o=TS.model.all_unread_cnt;n=["\ud83d\udd75\ufe0f \ud83d\udcd6 *Unreads Report for user @"+TS.model.user.name+" (`"+TS.model.user.id+'`) in workspace "'+_.escape(TS.interop.rules.teams.getTeamDisplayName(TS.model.team))+'" (`'+TS.model.team.id+"`)*","> "+a+" unreads across "+i+(1===i?" channel":" channels"),"> TS.model.threads_has_unreads: "+TS.model.threads_has_unreads+" (TS.model.all_unread_cnt++ when true), TS.model.threads_mention_count: "+TS.model.threads_mention_count].concat(n);if(TS.model.is_our_app){if(TS.boot_data.page_needs_enterprise&&TS.model.team&&TS.model.team.enterprise_id&&TS.boot_data.other_accounts){if(TS.model.all_unread_highlights_cnt_to_exclude){n.push("> TS.model.all_unread_highlights_cnt_to_exclude = "+TS.model.all_unread_highlights_cnt_to_exclude);s=Math.max(0,s-TS.model.all_unread_highlights_cnt_to_exclude)}if(TS.model.all_unread_cnt_to_exclude){n.push("> TS.model.all_unread_cnt_to_exclude = "+TS.model.all_unread_cnt_to_exclude);o=Math.max(0,o-TS.model.all_unread_cnt_to_exclude)}}n.push("> SSB setBadgeCount details: all_unread_highlights_cnt = "+s+", all_unread_cnt = "+o+", bullet = "+(!window.desktop||!TS.prefs.getPref("mac_ssb_bullet")?"false":"true"))}n=n.join("\n");TS.cmd_handlers.addEphemeralFeedback(n);TS.info(n)}},"/away":{localized:"/"+TS.interop.i18n.t("away","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t('Toggle your "away" status',"cmd_handlers")(),func:function e(t,r,n,i,a,s){TS.redux.presence.toggleUserPresence().then(function(e){var t=e.args.presence||TS.redux.presence.getPresenceByMemberId(TS.model.user.id);var r;r="away"===t?":white_check_mark: "+TS.interop.i18n.t("You are now marked as *away*.","cmd_handlers")():":white_check_mark: "+TS.interop.i18n.t("You are now marked as *active*.","cmd_handlers")();s&&a?TS.cmd_handlers.addEphemeralFeedback(r,{temporary:false,c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(r,{temporary:false})}).catch(_.noop);r&&TS.members.setUserStatus(r)}},"/shortcuts":{localized:"/"+TS.interop.i18n.t("shortcuts","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/keys"],localized_aliases:["/"+TS.interop.i18n.t("keys","cmd_handlers")()],desc:TS.interop.i18n.t("Open the keyboard shortcuts dialog","cmd_handlers")(),func:function e(){TS.redux.dispatch(TS.interop.actions.toggleKeyboardShortcuts())}},"/keys":{localized:"/"+TS.interop.i18n.t("keys","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/shortcuts",aliases:null,desc:"",func:function e(){TS.cmd_handlers["/shortcuts"].func()}},"/open":{localized:"/"+TS.interop.i18n.t("open","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/join"],localized_aliases:["/"+TS.interop.i18n.t("join","cmd_handlers")()],desc:TS.interop.i18n.t("Open a channel","cmd_handlers")(),args:[{name:TS.interop.i18n.t("channel","cmd_handlers")(),optional:true}],func:function e(t,r,n,i,a,s){if(1==n.length)return;var o=_.trim(i.substr(t.length));var l=TS.interop.texty.convertContentsStringToDisplayString(o);l=TS.interop.utility.cleanChannelName(l);var u=l&&TS.redux.channels.getPublicOrPrivateChannelByName(l);var d=l&&!u?TS.interop.channels.fetchAndUpsertChannelsWithQuery({query:{query:l,count:1}}).timeout(TS.interop.connectivity.getMaximumSocketWait()).catch(_.noop):Promise.resolve();d.then(function(){u=u||l&&TS.redux.channels.getPublicOrPrivateChannelByName(l);if(u&&u.is_channel){if(u.is_member)TS.channels.legacyDisplayChannel({id:u.id});else if(!TS.model.user.is_restricted){var e=function e(t,r){if(!t){var n=TS.interop.i18n.t("There was a problem joining \u201c{channel_name}\u201d, sorry!","cmd_handlers")({channel_name:l});"is_archived"==r.error&&(n=TS.interop.i18n.t("\u201c{channel_name}\u201d has been archived, so can\u2019t be opened.","cmd_handlers")({channel_name:l}));s&&a?TS.cmd_handlers.addEphemeralFeedback(n,{temporary:false,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(n,{temporary:false,slackbot_feels:"sad_surprise"})}};TS.redux.dispatch(TS.interop.channels.joinConversationApi({channelId:u.id})).catch(function(t){e(false,{error:t.message})})}}else if(u&&u.is_group)TS.interop.rules.channels.isArchived(u)&&!u.was_archived_this_session||TS.groups.legacyDisplayGroup({id:u.id});else if(TS.permissions.members.canCreateChannels())TS.ui.new_channel_modal.start(l);else{var t=TS.interop.i18n.t("I couldn\u2019t find a channel named \u201c{channel_name}\u201d, sorry!","cmd_handlers")({channel_name:l});s&&a?TS.cmd_handlers.addEphemeralFeedback(t,{temporary:false,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(t,{temporary:false,slackbot_feels:"sad_surprise"})}})}},"/join":{localized:"/"+TS.interop.i18n.t("join","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/open",aliases:null,desc:"",func:function e(t,r,n,i,a,s){TS.cmd_handlers["/open"].func(t,r,n,i,a,s)}},"/msg":{localized:"/"+TS.interop.i18n.t("msg","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/dm"],localized_aliases:["/"+TS.interop.i18n.t("dm","cmd_handlers")()],desc:TS.interop.i18n.t("Send a DM message to another user","cmd_handlers")(),args:[{name:TS.interop.i18n.t("@user","cmd_handlers")(),optional:false},{name:TS.interop.i18n.t("your message","cmd_handlers")(),optional:true}],func:function e(t,r,n,i,a,s){var o=n.length>1?n[1]:"";var l;var u;var d=S(o);if(!d)if(o){var c=o.replace("#","");l=TS.redux.channels.getPublicOrPrivateChannelByName(c);if(!l){u=TS.interop.i18n.t("A valid member name is required.","cmd_handlers")();s&&a?TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise"});return}}else $("#direct_messages_header").trigger("click.open_dialog").scrollintoview({duration:500});var m=r.replace(o,"");m=d?_.trim(i.substr(i.indexOf(">")+1)):_.trim(i.substr(i.indexOf(o)+o.length));if(d){if(d.deleted){u=TS.interop.i18n.t("That user has been deactivated","cmd_handlers")()+" :disappointed:";s&&a?TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise"});return}TS.ims.legacyStartImByMemberId(d.id,false,m)}else if(l){if(TS.interop.rules.channels.isArchived(l)){u=TS.interop.i18n.t("That {channel} has been archived","cmd_handlers")({channel:l.is_channel?TS.interop.i18n.t("channel","cmd_handlers")():TS.interop.i18n.t("private channel","cmd_handlers")()});s&&a?TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise"});return}l.is_channel?TS.channels.legacyDisplayChannel({id:l.id,and_send_txt:m}):TS.groups.legacyDisplayGroup({id:l.id,and_send_txt:m})}}},"/invite":{localized:"/"+TS.interop.i18n.t("invite","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Invite another member to a channel","cmd_handlers")(),args:[{name:TS.interop.i18n.t("@user","cmd_handlers")(),optional:false},{name:TS.interop.i18n.t("channel","cmd_handlers")(),optional:true}],func:function e(t,r,n,i){TS.interop.clog.track("CHANNEL_CREATE_FLOW",{contexts:{family:"channel",ui_context:{step:"add_people_modal",action:"enter_text",entry_point:"invite_people_slash_command",ui_properties:{element_type:"input",element_name:"message_input"}}}});var a=n.length>1?n[1]:"";var s=S(a);var o;a&&(o=TS.interop.userGroups.getUserGroupById(a.substr(1)));if(!s&&(!o||TS.interop.rules.user_groups.isUnknownOrNonExistent(o))&&a){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("A valid member name is required.","cmd_handlers")(),{input_txt:i,slackbot_feels:"sad_surprise"});return}if(s&&s.deleted){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("That user has been deactivated.","cmd_handlers")(),{input_txt:i,slackbot_feels:"sad_surprise"});return}var l=n.length>2?n[2]:"";var u=TS.interop.texty.convertContentsStringToDisplayString(l);var d=u&&TS.redux.channels.getPublicOrPrivateChannelByName(u);var c=u&&!d?TS.interop.channels.fetchAndUpsertChannelsWithQuery({query:{query:u,count:1}}).timeout(TS.interop.connectivity.getMaximumSocketWait()).catch(_.noop):Promise.resolve();c.then(function(){d=d||u&&TS.redux.channels.getPublicOrPrivateChannelByName(u)||TS.shared.legacyGetActiveModelOb();var e=function e(){if(s&&s.is_app_user){TS.interop.addAppToChannel({appUserId:s.id,channelId:d.id,onError:function e(){},referringEventId:"BUILTIN_CHAT_COMMAND_CALLED",sendEphemeralErrorMessage:true});return}d&&!d.is_im&&(s||o||d.is_mpim)?s?p(s,d,i):o&&!d.is_mpim&&h(o,d,i):TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("A valid channel name is required.","cmd_handlers")(),{input_txt:i,slackbot_feels:"sad_surprise"})};if(!(s&&s.is_restricted)||d&&(d.is_im||d.is_mpim)){e();return}TS.interop.members.fetchMemberProfileExtras(s.id,["channels"]).then(function(e){return e&&_.isArray(e.channels)&&e.channels||[]}).then(function(t){if(!s.is_ultra_restricted&&TS.model.user.is_admin||d&&t.indexOf(d.id)>-1){e();return}if(s.is_ultra_restricted&&t.length){TS.model.user.is_admin?TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("*{user}* is a Single-Channel Guest and can\u2019t be added to a second channel. To invite {user} to this channel, you\u2019ll need to <{team_url}admin#restricted|upgrade their membership> to a Multi-Channel Guest. \u200bNote: This will add a billable seat to your workspace.","cmd_handlers")({user:g(s),team_url:TS.boot_data.team_url}),{input_txt:i,slackbot_feels:"sad_surprise"}):TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("*{user}* is a Single-Channel Guest and can\u2019t be added to a second channel. Your Workspace Admin can upgrade their membership to a Multi-Channel Guest.","cmd_handlers")({user:g(s)}),{input_txt:i,slackbot_feels:"sad_surprise"});return false}if(!TS.model.user.is_admin){if(s.is_ultra_restricted){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("*{user}* is a Single-Channel Guest. Only your Workspace Admin can invite them to a channel.","cmd_handlers")({user:g(s)}),{input_txt:i,slackbot_feels:"sad_surprise"});return false}if(d&&!d.is_private&&!d.is_group){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("*{user}* is a Multi-Channel Guest. Only your Workspace Admin can invite them to a channel.","cmd_handlers")({user:g(s)}),{input_txt:i,slackbot_feels:"sad_surprise"});return false}}e()})})}},"/invite_people":{localized:"/"+TS.interop.i18n.t("invite_people","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Invite people to your workspace","cmd_handlers")(),args:[{name:TS.utility.exampleEmailAddress()+", ...",optional:true}],func:function e(t,r){if(TS.interop.rules.invites.canUserSeeInviteModal(TS.redux.getState())){r=r&&r.trim();r&&TS.redux.dispatch(TS.interop.actions.setUnsentInvites(r.split(/\s*,\s*|\s+/).map(function(e){return{email:e}})));TS.interop.mountInviteModal(TS.boot_data.team_id,{source:"invite_people_slash_command"})}else TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("You don\u2019t have permission to invite people.","cmd_handlers")(),{slackbot_feels:"sad_surprise"})}},"/dm":{localized:"/"+TS.interop.i18n.t("dm","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/msg",aliases:null,desc:"",func:function e(t,r,n,i,a,s){TS.cmd_handlers["/msg"].func(t,r,n,i,a,s)}},"/archive":{localized:"/"+TS.interop.i18n.t("archive","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Archive the current channel","cmd_handlers")(),func:function e(){var t=TS.shared.legacyGetActiveModelOb();if(TS.interop.rules.channels.isArchived(t)||TS.interop.rules.channels.isRequired(t))return;if(TS.interop.rules.channels.isExternallySharedChannel(t))return;if(t.is_channel&&!t.is_mpim){if(!TS.permissions.members.canArchiveChannels())return;if(TS.boot_data.page_needs_enterprise&&!_.get(TS.model.user,"enterprise_user.is_admin",false)&&TS.interop.rules.channels.isOrgDefaultChannel(t))return;TS.channels.ui.showArchiveChannelDialog(t)}else if(t.is_group&&!t.is_mpim){if(TS.model.user.is_restricted)return;TS.channels.ui.showArchiveGroupDialog(t)}}},"/leave":{localized:"/"+TS.interop.i18n.t("leave","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/close","/part"],localized_aliases:["/"+TS.interop.i18n.t("close","cmd_handlers")(),"/"+TS.interop.i18n.t("part","cmd_handlers")()],desc:TS.interop.i18n.t("Leave a channel","cmd_handlers")(),func:function e(t,r,n){if(1==n.length){var i=TS.shared.legacyGetActiveModelOb();i.is_channel?i.is_mpim?TS.redux.dispatch(TS.interop.channels.closeChannelApi({channelId:i.id})):TS.interop.rules.channels.isArchived(i)?TS.shared.legacyCloseArchivedChannel(i.id):TS.channels.leave(i.id):i.is_mpim||i.is_im?TS.redux.dispatch(TS.interop.channels.closeChannelApi({channelId:i.id})):i.is_group?TS.interop.rules.channels.isArchived(i)?TS.shared.legacyCloseArchivedChannel(i.id):TS.channels.leave(i.id):TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("A valid channel or member name is required.","cmd_handlers")(),{slackbot_feels:"sad_surprise"})}else{var a=TS.interop.texty.convertContentsStringToDisplayString(r);var s=a&&TS.redux.channels.getPublicOrPrivateChannelByName(a);var o=a&&!s?TS.interop.channels.fetchAndUpsertChannelsWithQuery({query:{query:a,count:1}}).timeout(TS.interop.connectivity.getMaximumSocketWait()).catch(_.noop):Promise.resolve();o.then(function(){s=s||a&&TS.redux.channels.getPublicOrPrivateChannelByName(a);s?TS.channels.leave(s.id):TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("A valid channel name is required.","cmd_handlers")(),{slackbot_feels:"sad_surprise"})})}}},"/close":{localized:"/"+TS.interop.i18n.t("close","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/leave",aliases:null,desc:"",func:function e(t,r,n){TS.cmd_handlers["/leave"].func(t,r,n)}},"/part":{localized:"/"+TS.interop.i18n.t("part","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/leave",aliases:null,desc:"",func:function e(t,r,n){TS.cmd_handlers["/leave"].func(t,r,n)}},"/topic":{localized:"/"+TS.interop.i18n.t("topic","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.rules.channels.isExternallySharedChannel(TS&&TS.shared&&TS.shared.legacyGetActiveModelOb())?TS.interop.i18n.t("Set the channel topic for your workspace","cmd_handlers")():TS.interop.i18n.t("Set the channel topic","cmd_handlers")(),args:[{name:TS.interop.i18n.t("new topic","cmd_handlers")(),optional:true}],func:function e(t,r,n,i){var a=TS.shared.legacyGetActiveModelOb();if(TS.model.user.is_restricted||TS.interop.rules.channels.isRequired(a)&&!TS.permissions.members.canPostInChannel(a)){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Setting the topic is a restricted action.","cmd_handlers")(),{input_txt:i,slackbot_feels:"sad_surprise"});return}if(TS.interop.channels.channelTopicExceedsLimit(r)){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Topics cannot exceed {max_characters} characters.","cmd_handlers")({max_characters:TS.model.channel_topic_max_length}),{input_txt:i,slackbot_feels:"sad_surprise"});return}var s=_.trim(i.substr(t.length));a.is_mpim||a.is_im?TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Regrettably, direct messages do not have topics","cmd_handlers")(),{slackbot_feels:"sad_surprise"}):s?TS.interop.channels.submitChannelTopic(a.id,s).then(TS.channels.legacyUpdateTopicFromAPI).catch(TS.channels.legacyAlertSetTopicError):$("#channel_topic_text").click().focus().select()}},"/search":{localized:"/"+TS.interop.i18n.t("search","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/s"],localized_aliases:["/"+TS.interop.i18n.t("s","cmd_handlers")()],desc:TS.interop.i18n.t("Perform a search","cmd_handlers")(),args:[{name:TS.interop.i18n.t("your text","cmd_handlers")(),optional:true}],func:function e(t,r){TS.interop.searchActions.openFromSlashCommand({query:r})}},"/s":{localized:"/"+TS.interop.i18n.t("s","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/search",aliases:null,desc:"",func:function e(t,r){TS.cmd_handlers["/search"].func(t,r)}},"/rename":{localized:"/"+TS.interop.i18n.t("rename","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.rules.channels.isExternallySharedChannel(TS&&TS.shared&&TS.shared.legacyGetActiveModelOb())?TS.interop.i18n.t("Rename this channel for your workspace","cmd_handlers")():TS.interop.i18n.t("Rename a channel","cmd_handlers")(),args:[{name:TS.interop.i18n.t("new name","cmd_handlers")(),optional:true}],func:function e(){if(TS.model.user.is_restricted){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("You don\u2019t have permission to rename.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}var t=TS.shared.legacyGetActiveModelOb();if(t.is_mpim||t.is_im){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Direct messages don\u2019t even have a name! Ergo, regrettably, you can\u2019t change it.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}if((t.is_channel||t.is_group)&&!TS.model.user.is_admin&&t.creator!=TS.model.user.id){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Only Workspace Admins (or the channel creator) are allowed to rename channels.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}TS.permissions.channels.canSeeRenameChannelOption(t)||TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("You don\u2019t have permission to rename.","cmd_handlers")(),{slackbot_feels:"sad_surprise"})}},"/color":{localized:"/"+TS.interop.i18n.t("color","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:["/colour"],localized_aliases:["/"+TS.interop.i18n.t("colour","cmd_handlers")()],desc:TS.interop.i18n.t("Set a custom color for another member","cmd_handlers")(),func:function e(t,r,n,i,a,s){var o=n.length>1?n[1]:"";var l=n.length>2?n[2].replace(/#/g,""):"";var u;var d=S(o);if(!d){u=TS.interop.i18n.t("A valid member name is required.","cmd_handlers")();s&&a?TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise"});return}var c;d&&(c=TS.interop.members.getPrefCompliantMemberName(d,true,true));if(l&&(6!=l.length||!("#"+l).match(TS.format.hex_rx))){u=TS.interop.i18n.t("A valid 6 character hex code is required, like `FF0000`.","cmd_handlers")();s&&a?TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i});return}TS.members.setMemberUserColor(d,l);TS.prefs.setPrefLocal("user_colors",JSON.stringify(TS.model.user_colors));TS.prefs.setPrefByAPI({name:"user_colors",value:TS.prefs.getPref("user_colors")});u=l?TS.interop.i18n.t("You\u2019ve set your custom color for {user} to {color}","cmd_handlers")({user:c,color:"#"+l}):TS.interop.i18n.t("You\u2019ve removed your custom color for {user}.","cmd_handlers")({user:c});s&&a?TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,c_id:s.id,thread_ts:a.ts}):TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i})}},"/colour":{localized:"/"+TS.interop.i18n.t("colour","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/color",aliases:null,desc:"",func:function e(t,r,n,i,a,s){TS.cmd_handlers["/color"].func(t,r,n,i,a,s)}},"/discon":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.interop.SocketManager.disconnect()}},"/sleepsleep":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.interop.SocketManager.sleep()}},"/sleepsleep2":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.interop.SocketManager.clearFastReconnectUrl();TS.interop.SocketManager.sleep()}},"/discon4":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.interop.SocketManager.clearFastReconnectUrl();TS.interop.SocketManager.disconnect()}},"/slackdebugdegrade":{localized:null,type:"client",autocomplete:function e(){return TS.boot_data.feature_tinyspeck},alias_of:null,aliases:null,desc:"",func:function e(){TS.interop.SocketManager.clearFastReconnectUrl();TS.interop.SocketManager.debugSetSocketConnectFlakiness(1);TS.interop.SocketManager.disconnect()}},"/slackdebugdegraderecover":{localized:null,type:"client",autocomplete:function e(){return TS.boot_data.feature_tinyspeck},alias_of:null,aliases:null,desc:"",func:function e(){var t=0;if(TS.qs_args.ws_flakiness){t=parseFloat(TS.qs_args.ws_flakiness);(_.isNaN(t)||t<0||t>1)&&(t=0)}TS.interop.SocketManager.debugSetSocketConnectFlakiness(t)}},"/collapse":{localized:"/"+TS.interop.i18n.t("collapse","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Collapse all files in the current channel (opposite of /expand)","cmd_handlers")(),func:function e(){var t=TS.shared.legacyGetActiveModelOb().id;var r=TS.redux.messages.getExpandablesInChannel(t);var n=_.zipObject(r,_.map(r,function(){return false}));TS.redux.dispatch(TS.interop.redux.features.expandables.bulkSetExpanded(n));TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("I\u2019ve collapsed all files in this channel for you.","cmd_handlers")(),{temporary:false})}},"/expand":{localized:"/"+TS.interop.i18n.t("expand","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Expand all files in the current channel (opposite of /collapse)","cmd_handlers")(),func:function e(){var t=TS.shared.legacyGetActiveModelOb().id;var r=TS.redux.messages.getExpandablesInChannel(t);var n=_.zipObject(r,_.map(r,function(){return true}));TS.redux.dispatch(TS.interop.redux.features.expandables.bulkSetExpanded(n));TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("I\u2019ve expanded all files in this channel for you.","cmd_handlers")(),{temporary:false})}},"/remove":{localized:"/"+TS.interop.i18n.t("remove","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/kick"],localized_aliases:["/"+TS.interop.i18n.t("kick","cmd_handlers")()],desc:TS.interop.i18n.t("Remove a person from the current channel","cmd_handlers")(),args:[{name:TS.interop.i18n.t("@user","cmd_handlers")(),optional:false}],func:function e(t,r,n,i){var a=TS.shared.legacyGetActiveModelOb();r=$.trim(r);var s=S(r);var o=_.get(s,"is_app_user",false);if((a.is_im||a.is_mpim)&&!o){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("You can\u2019t remove someone from a direct message.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}if(TS.interop.rules.channels.isPublicChannel(a)&&!o&&!TS.permissions.members.canKickFromChannels()){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Removing someone from a channel is a restricted action.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}if(TS.interop.rules.channels.isPrivateChannel(a)&&!o&&!TS.permissions.members.canKickFromGroups()){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Removing someone from a private channel is a restricted action.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}if(TS.interop.rules.channels.isArchived(a)){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("You can\u2019t remove anyone from *{channel}* while it is archived.","cmd_handlers")({channel:(TS.model.active_channel_id?"#":"")+a.name}),{slackbot_feels:"sad_surprise"});return}if(!r){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Please specify someone to remove!","cmd_handlers")(),{input_txt:i});return}if(!s){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("*{input}* is not a recognized member name.","cmd_handlers")({input:TS.interop.i18n.safeString(_.escape(TS.interop.texty.convertContentsStringToDisplayString(_.trim(i.substr(t.length))),TS.interop.prefs.getHighlightWords(),TS.interop.rules.emoji.shouldRenderEmojiAsText()))}),{input_txt:i,slackbot_feels:"sad_surprise"});return}if(TS.interop.rules.channels.isRequired(a)&&!s.is_restricted&&!s.is_bot){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("You can\u2019t remove this member from *{channel}*!","cmd_handlers")({channel:(TS.model.active_channel_id?"#":"")+a.name}));return}TS.interop.membership.ensureChannelMembershipIsKnownForUsers(a.id,[s.id]).then(function(){var e=TS.interop.membership.getCachedChannelMembershipInfoForUser(a.id,s.id);if(!e.is_member){var r;r=o?TS.interop.i18n.t("{app_user} isn\u2019t in this conversation, so you can\u2019t remove it.","apps")({app_user:TS.interop.i18n.safeString("<@"+s.id+">")}):TS.interop.i18n.t("*{user}* is not a member of this {channel}.","cmd_handlers")({user:TS.interop.i18n.safeString(_.escape(TS.interop.texty.convertContentsStringToDisplayString(_.trim(i.substr(t.length))),TS.interop.prefs.getHighlightWords(),TS.interop.rules.emoji.shouldRenderEmojiAsText())),channel:a.is_channel?TS.interop.i18n.t("channel","cmd_handlers")():TS.interop.i18n.t("private channel","cmd_handlers")()});TS.cmd_handlers.addEphemeralFeedback(r,{input_txt:i,slackbot_feels:"sad_surprise"});return}if(s.is_self)return;if(o){TS.interop.removeAppFromChannel({appUserId:s.id,channelId:a.id,onError:function e(){},referringEventId:"BUILTIN_CHAT_COMMAND_CALLED",sendEphemeralErrorMessage:true});return}if(TS.interop.members.isExternal(s)){var n=TS.interop.i18n.t("You can\u2019t remove {member_name} from this channel, because they\u2019re from another organization.","cmd_handlers")({member_name:g(s)});TS.cmd_handlers.addEphemeralFeedback(n,{input_txt:i,slackbot_feels:"sad_surprise"});return}a.is_channel?TS.channels.legacyKickMember(a.id,s.id):a.is_group&&TS.groups.kickMember(a.id,s.id)})}},"/kick":{localized:"/"+TS.interop.i18n.t("kick","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/remove",aliases:null,desc:"",func:function e(t,r,n,i){TS.cmd_handlers["/remove"].func(t,r,n,i)}},"/feedback":{localized:"/"+TS.interop.i18n.t("feedback","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Send feedback to Slack","cmd_handlers")(),args:[{name:TS.interop.i18n.t("your message","cmd_handlers")(),optional:true}],func:function e(t,r,n,i,a,s){if(!r){TS.utility.openInNewTab("/help/requests/new","_blank");return}var o=_.trim(i.substr(t.length));o=TS.interop.texty.convertContentsStringToDisplayString(o,TS.interop.prefs.getHighlightWords());TS.generic_dialog.start({title:TS.interop.i18n.t("Send feedback","cmd_handlers")(),body:'<p class="bold">'+TS.interop.i18n.t("Looks like you are trying to send us some feedback! Yes?","cmd_handlers")()+"</p>",show_cancel_button:true,show_go_button:true,go_button_text:TS.interop.i18n.t("Yes, send it","cmd_handlers")(),onGo:function e(){var r={command:t,text:o,channel:TS.model.active_cid,client_token:TS.interop.client_action_token.generateAndEnqueue()};if(s&&a){r.channel=s.id;r.thread_ts=a.ts}var n=function e(){};TS.interop.api.call("chat.command",r).then(function(e){var t=e.data,r=e.args,i=e.request_id;var a=true;n(a,t,r,i);return{data:t,args:r,request_id:i}}).catch(function(e){var t=e.data,r=e.args,i=e.request_id;var a=false;n(a,t,r,i);return{data:t,args:r,request_id:i}})},onCancel:function e(){s&&a&&TS.utility.populateThreadInputs(i,s.id,a.ts)}})}},"/shrug":{localized:"/"+TS.interop.i18n.t("shrug","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Appends \xaf\\_(\u30c4)_/\xaf to your message","cmd_handlers")(),args:[{name:TS.interop.i18n.t("your message","cmd_handlers")(),optional:true}],func:function e(){}},"/showfallbacks":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.model.show_attachment_fallback=!TS.model.show_attachment_fallback}}});var e=["/shrug","/shortcuts","/keys","/away","/search","/feedback","/slack_diagnostic_report","/msg","/dm","/s","/star","/color","/colour","/active","/mute"];var t;var r={localized:null,type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.interop.i18n.t("Start a call","cmd_handlers")(),args:[{name:TS.interop.i18n.t("help","cmd_handlers")(),optional:true}],can_be_overridden_by_server_cmd:true,func:function e(t,r){var n=TS.shared.legacyGetActiveModelOb();var i=TS.interop.members.getMemberById(n.user);if(TS.boot_data.page_needs_enterprise&&(TS.interop.rules.channels.isExternallySharedChannel(n)||TS.interop.rules.channels.isOrgDefaultChannel(n))){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("You are not allowed to use this command here.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}if("help"===r.trim()){var a;a=TS.utility.calls.isCurrentContextMultiParty()&&!TS.utility.calls.isMultiPartyEnabled()?TS.interop.i18n.t("To call someone, use `/call` in a direct message to them.","cmd_handlers")():n.is_mpim?TS.interop.i18n.t("To call {group_name}, use `/call` in this group conversation.","cmd_handlers")({group_name:TS.interop.rules.channels.getDisplayNameForChannel(n)}):n.is_im?TS.interop.i18n.t("To call {user}, use `/call` in this Direct Message conversation.","cmd_handlers")({user:TS.interop.rules.channels.getDisplayNameForChannel(n)}):TS.interop.i18n.t("To start a call in {channel}, use `/call` here.","cmd_handlers")({channel:TS.interop.rules.channels.getDisplayNameForChannel(n)});a+="\n";a+=TS.interop.i18n.t("To run a series of tests, use `/call --test` here.","cmd_handlers")();TS.cmd_handlers.addEphemeralFeedback(a);return}if(r.trim().match(/--server=/)){var s=r.trim().replace(/--server=/g,"");var o=TS.storage.fetchCallsState();o.call_server_override=s;TS.storage.storeCallsState(o)}if(r.trim().match(/--regions=/)){var l=r.trim().replace(/--regions=/g,"");var u=TS.storage.fetchCallsState();u.call_regions_override=l;TS.storage.storeCallsState(u)}if(TS.utility.calls.isCurrentContextMultiParty()&&!TS.utility.calls.isMultiPartyEnabled()){if("Slack"!==TS.prefs.getTeamPref("calling_app_name")){TS.utility.calls.startCallInModelOb(n,true);return}TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Group calls aren\u2019t available on the free plan. Try using `/call` in a Direct Message conversation!","cmd_handlers")());return}if(TS.interop.rules.channels.isSlackbot(n)){var d=[TS.interop.i18n.t("I\u2019m on the other line. Sorry!","cmd_handlers")(),TS.interop.i18n.t("Thanks for calling me! I\u2019m afraid I only accept calls from my mother, Sundays at 2pm.","cmd_handlers")(),TS.interop.i18n.t("I\u2019m washing my hair right now\u2026can\u2019t come to the phone!","cmd_handlers")(),TS.interop.i18n.t("It\u2019s awfully nice of you to try calling me. But \u2014 shh! \u2014 I\u2019m quite afraid of the phone!","cmd_handlers")()+" :grimacing:",TS.interop.i18n.t("Thank you so much for calling, but I can\u2019t talk right now, I\u2019m watching my stories.","cmd_handlers")()];var c=_.shuffle(d)[0];TS.cmd_handlers.addEphemeralFeedback(c);return}if(i&&(i.is_bot||i.id==TS.model.user.id)){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("Though you\u2019re great to talk to (obviously), we\u2019re willing to bet that calling someone else may be almost as good\u2026","cmd_handlers","e5fb5f25184a009f745a0fe29acdafd7f8708aa2")({user:TS.interop.members.getPrefCompliantMemberName(i,false,true)}),{slackbot_feels:"sad_surprise"});return}TS.utility.calls.startCallInModelOb(n,true)}};var n=[];var i=function r(){if(t||TS.interop.i18n.locale===TS.interop.i18n.DEFAULT_LOCALE)return;t=true;var n;var i;_.forOwn(TS.cmd_handlers,function(t,r){if(0!==r.indexOf("/"))return;n=TS.cmd_handlers[r].localized?TS.cmd_handlers[r].localized.toLowerCase():null;if(n&&n!==r&&!TS.cmd_handlers[n]){TS.cmd_handlers[n]=_.clone(TS.cmd_handlers[r]);TS.cmd_handlers[n].localized=null;TS.cmd_handlers[n].canonical_name=r;TS.cmd_handlers[r].autocomplete=false;i=TS.interop.i18n.deburr(n);if(n!==i){TS.cmd_handlers[n].normalized=i;TS.cmd_handlers[i]||(TS.cmd_handlers[i]=_.clone(TS.cmd_handlers[r]))}if(_.includes(e,r)){e.push(n);n!==i&&e.push(i)}}})};var a=function e(t,r){TS.model.commands_cache_ts=r;var n={data:t,cache_ts:TS.model.commands_cache_ts,locale:TS.interop.i18n.locale};TS.storage.storeCmds(n);TS.cmd_handlers.mergeInServerCmds(t);l();m(t)};var s=function e(){var t=TS.storage.fetchCmds();if(!t)return false;if(TS.model.commands_cache_ts!==t.cache_ts)return false;if(TS.interop.i18n.locale!==t.locale)return false;return true};var o=function e(){TS.cmd_handlers.setUpCmds()};var l=function e(){var t="/"+TS.interop.i18n.t("call","cmd_handlers")();var n=TS.interop.i18n.deburr(t);if(TS.utility.calls.isEnabled()){if(!TS.cmd_handlers["/call"])if("/call"===t)TS.cmd_handlers["/call"]=r;else{var i=_.clone(r);i.canonical_name="/call";TS.cmd_handlers[t]=i;var a=_.clone(r);a.autocomplete=false;a.localized=null;TS.cmd_handlers["/call"]=a;if(t!==n){TS.cmd_handlers[t].normalized=n;TS.cmd_handlers[n]||(TS.cmd_handlers[n]=a)}}}else{TS.cmd_handlers["/call"]&&"client"===TS.cmd_handlers["/call"].type&&_.unset(TS.cmd_handlers,"/call");TS.cmd_handlers[t]&&"client"===TS.cmd_handlers[t].type&&_.unset(TS.cmd_handlers,t);t!==n&&TS.cmd_handlers[n]&&"client"===TS.cmd_handlers[n].type&&_.unset(TS.cmd_handlers,t)}};var u=function e(t){var r=false;var n=TS.shared.legacyGetActiveModelOb();TS.interop.rules.channels.isOrgShared(n)&&(r=true);return{cmds:t.filter(function(e){return("core"===e.type||"client"===e.type)&&!(r&&"/call"===e.name)}),id:"core",name:"Slack"}};var d=function e(t){return{cmds:t.filter(function(e){return"custom"===e.type}),id:"custom",name:TS.interop.rules.teams.getTeamDisplayName(TS.model.team)}};var c=function e(t){var r=TS.interop.apps.getAppById(t);if(!r)return false;if(r.isUnknown||r.isNonExistent)return false;if(!r.is_xoxa_app)return false;var n=TS.interop.membership.getCachedChannelMembershipInfoForUser(TS.model.active_cid,r.app_user_id);if(true===n.is_known&&false===n.is_member)return true;return false};var m=function e(t){var r=[];_.each(t,function(e){var t=e.app;if(t){var n=TS.interop.apps.getAppById(t);var i=n&&n.app_user_id;i&&r.push(i)}});n=r};var f=function e(t){var r=t.filter(function(e){return"app"===e.type||"service"===e.type});var n=r.filter(function(e){return!!(e.service_name||e.app)});var i=r.filter(function(e){return!(e.service_name||e.app)});var a={};n.forEach(function(e){var t=TS.cmd_handlers.getAppNameForCmdName(e.name);a[t]||(a[t]=[]);a[t].push(e)});var s=Object.keys(a).slice().sort(TS.interop.i18n.sorter);var o=s.map(function(e){var t={cmds:a[e],id:"app",name:e};t.xoxa_app_not_in_channel=c(a[e][0].app);return t});o.push({cmds:i,id:"app",name:"Other"});return o};var p=function e(t,r,n){if(!_.isObject(t))throw new Error("Expected user to be an object");if(!_.isObject(r))throw new Error("Expected model_ob to be an object");if(!_.isString(n))throw new Error("Expected input_txt to be a string");return TS.interop.membership.ensureChannelMembershipIsKnownForUsers(r.id,[t.id]).then(function(){var e=TS.interop.membership.getCachedChannelMembershipInfoForUser(r.id,t.id);if(e.is_member){TS.cmd_handlers.addEphemeralFeedback(TS.interop.i18n.t("{user} is already in this channel.","cmd_handlers")({user:g(t)}),{input_txt:n});return}if(!r.is_mpim&&!TS.permissions.channels.canMemberBeInvitedToChannel(r,t)){var i;if(TS.boot_data.page_needs_enterprise){i=TS.interop.members.isExternal(t)?TS.interop.rules.channels.isExternallySharedChannel(r)||!TS.teams.getTeamNameByMember(t)?TS.interop.i18n.t("{member_name} can\u2019t be invited to this channel because they\u2019re from a workspace outside your organization.","cmd_handlers")({member_name:g(t)}):TS.interop.rules.teams.isSharedChannelsEnabled(TS.redux.getState(),TS.model.team)?TS.interop.i18n.t("{member_name} can\u2019t be invited to this channel because they\u2019re from a workspace outside your organization. If you\u2019d like, you can share this channel with {team_name}.","cmd_handlers")({member_name:g(t),team_name:TS.interop.i18n.safeString(_.escape(TS.teams.getTeamNameByMember(t)))}):TS.interop.i18n.t("{member_name} can\u2019t be invited to this channel because they\u2019re from a workspace outside your organization. If you\u2019d like, you can share this channel with {team_name}. <https://slack.com/help/articles/115004151203-A-guide-to-shared-channels|Learn about shared channels>","cmd_handlers","d7091ca6b333c5995afb7cea035a4200f90c80e2")({member_name:g(t),team_name:TS.interop.i18n.safeString(_.escape(TS.teams.getTeamNameByMember(t)))}):TS.interop.i18n.t("{user} is not a member of {team_name}.","cmd_handlers")({user:g(t),team_name:TS.interop.i18n.safeString(_.escape(TS.interop.rules.teams.getTeamDisplayName(TS.model.team)))});TS.cmd_handlers.addEphemeralFeedback(i,{input_txt:n,slackbot_feels:"sad_surprise"});return}if(TS.interop.members.isExternal(t)){i=TS.interop.rules.channels.isExternallySharedChannel(r)||!TS.teams.getTeamNameByMember(t)?TS.interop.i18n.t("{member_name} can\u2019t be invited to this channel because they\u2019re from another workspace.","cmd_handlers")({member_name:g(t)}):TS.interop.rules.teams.isSharedChannelsEnabled(TS.redux.getState(),TS.interop.teams.getCurrentTeam())?TS.interop.i18n.t("{member_name} can\u2019t be invited to this channel because they\u2019re from another workspace. If you\u2019d like, you can share this channel with {team_name}.","cmd_handlers")({member_name:g(t),team_name:TS.interop.i18n.safeString(_.escape(TS.teams.getTeamNameByMember(t)))}):TS.interop.i18n.t("{member_name} can\u2019t be invited to this channel because they\u2019re from another workspace. If you\u2019d like, you can share this channel with {team_name}. <https://slack.com/help/articles/115004151203-A-guide-to-shared-channels|Learn about shared channels>","cmd_handlers","fc4ec08c96b8476f2b02f7a58c6fe1927ab3670e")({member_name:g(t),team_name:TS.interop.i18n.safeString(_.escape(TS.teams.getTeamNameByMember(t)))});TS.cmd_handlers.addEphemeralFeedback(i,{input_txt:n,slackbot_feels:"sad_surprise"});return}}if(TS.interop.rules.channels.isMpim(r));else if(!TS.interop.rules.channels.isPrivateChannel(r))return TS.interop.api.call("conversations.invite",{channel:r.id,users:t.id})})};var h=function e(t,r,n){if(!_.isObject(t))throw new Error("Expected ug to be an object");if(!_.isObject(r))throw new Error("Expected model_ob to be an object");if(!_.isString(n))throw new Error("Expected input_txt to be a string");TS.interop.userGroups.promiseToGetUserGroupMembers(t.id).then(function(e){TS.interop.membership.ensureChannelMembershipIsKnownForUsers(r.id,e.users).then(function(){var t=e.users.filter(function(e){if(TS.boot_data.page_needs_enterprise){var t=TS.interop.members.getMemberById(e);if(!TS.permissions.channels.canMemberBeInvitedToChannel(r,t))return false}var n=TS.interop.membership.getCachedChannelMembershipInfoForUser(r.id,e);return!n.is_member});if(!t.length){var i=TS.interop.i18n.t("All of the users in that user group are already in this channel.","cmd_handlers")();TS.cmd_handlers.addEphemeralFeedback(i,{input_txt:n});return}(!r.is_private&&!r.is_group||TS.interop.rules.channels.isExternallySharedChannel(r))&&TS.interop.api.call("conversations.invite",{channel:r.id,users:t,force:true})})})};var g=function e(t){if(!_.isObject(t))throw new Error("Expected user to be an object");return TS.interop.members.getPrefCompliantMemberName(t,false,true)};var S=function e(t){return TS.interop.members.getMemberById(t)}})()},q3cq:function(e,t){(function(){TS.registerModule("redux.teams",{onStart:function e(){Object.defineProperty(TS.model,"team",{get:function e(){return TS.redux.teams.getCurrentTeam()},set:function e(){TS.error("TS.redux.teams: trying to set TS.model.team???");return false}})},upsertTeam:function e(t){if(!t||!t.id)return;return TS.interop.teams.upsertTeam({team:t})},removeTeam:function e(t){if(!t||!t.id)return;TS.interop.teams.removeTeam(t)},getTeamById:function e(t,r){if(!TS.interop.teams.getTeamById)return null;return TS.interop.teams.getTeamById(t,r)},getAllTeams:function e(){if(!TS.interop.teams.getAllTeams)return null;return TS.interop.teams.getAllTeams()},getTeamByDomain:function e(t){if(!TS.interop.teams.getTeamByDomain)return null;return TS.interop.teams.getTeamByDomain(t)},getCurrentTeam:function e(){if(!TS.interop.teams.getCurrentTeam)return null;return TS.interop.teams.getCurrentTeam()},ensureEnterpriseTeamIsKnown:function e(t,r){if(!TS.interop.teams.ensureEnterpriseTeamIsKnown)return null;return TS.interop.teams.ensureEnterpriseTeamIsKnown({teamId:t,additionalOptions:r})},getSelfEnterpriseTeam:function e(){if(!TS.interop.teams.getSelfEnterpriseTeam)return null;return TS.interop.teams.getSelfEnterpriseTeam(TS.redux.getState())},getSelfEnterpriseOrgName:function e(){if(!TS.interop.teams.getSelfEnterpriseOrgName)return null;return TS.interop.teams.getSelfEnterpriseOrgName(TS.redux.getState())},fetchAndUpsertEnterpriseOrgInfo:function e(){if(!TS.interop.teams.fetchAndUpsertEnterpriseOrgInfo)return null;return TS.redux.dispatch(TS.interop.teams.fetchAndUpsertEnterpriseOrgInfo())}})})()},"qQ+f":function(e,t){(function(){TS.registerModule("groups",{switched_sig:new signals.Signal,member_joined_sig:new signals.Signal,member_left_sig:new signals.Signal,message_received_sig:new signals.Signal,message_removed_sig:new signals.Signal,message_changed_sig:new signals.Signal,marked_sig:new signals.Signal,unread_changed_sig:new signals.Signal,unread_highlight_changed_sig:new signals.Signal,opened_sig:new signals.Signal,closed_sig:new signals.Signal,msg_not_sent_sig:new signals.Signal,legacyAddMsg:function e(t,r){var n=false;var i=TS.interop.channels.getGroupById(t,n);if(!i){TS.channels.temp_list_of_removed_channels[t]||TS.error('unknown group "'+t+'"');return}if(!TS.redux.messages.addMessage(r,true))return;if(TS.interop.messages.isReply(r)&&!TS.shared.legacyAddMsg(i,r))return;TS.groups.message_received_sig.dispatch(i,r)},legacyRemoveMsg:function e(t,r){var n=false;var i=TS.interop.channels.getGroupById(t,n);if(!i){TS.error('unknown group "'+t+'"');return}TS.redux.messages.removeMessage(r);if(TS.interop.messages.isReply(r)){i._archive_msgs&&TS.utility.msgs.spliceMsg(i._archive_msgs,r);var a=i.msgs;TS.utility.msgs.spliceMsg(a,r)}TS.groups.message_removed_sig.dispatch(i,r)},legacyOnSendMsg:function e(t,r){var n=false;var i=TS.interop.channels.getGroupById(r.SENT_MSG.channel,n);if(!i){TS.error("unknown group? "+r.SENT_MSG.channel);return}TS.shared.legacyOnSendMsg(t,r,i,TS.groups)},legacyDisplayGroup:function e(r){var n=_.defaults({},r,{from_history:false,replace_history_state:false});var i=n.id;if(!i){TS.error("no group id supplied");return}var a=n.and_send_txt;var s=n.from_history;var o=n.replace_history_state;var l=n.last_active_primary_view;TS.telemeter.mark("start_channel_change_"+i);TS.redux.dispatch(TS.interop.redux.models.channelsMeta.prqMetrics.updateChannelLastFocus({lastFocus:TS.interop.redux.models.window.getWindowLastFocusEvent(TS.redux.getState()),objId:i}));var u=false;var d=TS.interop.channels.getGroupById(i,u);if(!d){TS.error('group "'+i+'" unknown');return}TS.utility.msgs.maybeClearPrevLastRead();TS.utility.msgs.maybeClearPrevLastRead(d);TS.has_pri[t]&&TS.log(t,"legacyDisplayGroup "+d.id+" from_history:"+s+" replace_history_state:"+o);var c=l||TS.model.active_group_id;if(i===c&&!o){TS.warn('group "'+i+'" already displayed');a&&TS.shared.legacySendMsg(i,$.trim(a));return}a&&TS.shared.legacySendMsg(i,$.trim(a))},legacyMarkMostRecentReadMsg:function e(t,r){if(!t){TS.error("group unknown");return}TS.interop.channels.markMostRecentMsgRead({channelId:t.id,reason:r})},markReadMsg:function e(t,r,n){TS.redux.dispatch(TS.interop.actions.markLastRead({id:t,ts:r,reason:n}))},createChild:function t(r,n,i){var a=false;var s=TS.interop.channels.getGroupById(r,a);s||(s=TS.interop.channels.getPublicChannelById(r,a));if(!s)return;if(TS.interop.rules.channels.isExternallySharedChannel(s)){var o=TS.interop.i18n.t("Uh oh!","channel_invite")();var l=TS.interop.i18n.t("Sorry! Something went wrong.","channel_invite")();TS.ui.fs_modal.close();TS.generic_dialog.alert(l,o);return}TS.model.archives_and_recreated_groups[r]=true;var u=n?n.join(","):"";var d=function t(r,n,a){e(r,n,a);i&&i(r,n,a)};TS.interop.api.call("conversations.createChild",{channel:r,_and_invite_members_ids:u}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;d(i,t,r,n);return{data:t,args:r,request_id:n}},function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;d(i,t,r,n);return{data:t,args:r,request_id:n}})},createSuggestedName:function e(t){var r=TS.model.user.name;var n=[];var i;var a;var s=TS.model.channel_name_max_length;for(a=0;a<t.length;a+=1){i=TS.interop.members.getMemberById(t[a]);if(!i)continue;n.push(i)}n.sort(function e(t,r){var n=t._name_lc;var i=r._name_lc;if(n<i)return-1;if(n>i)return 1;return 0});for(a=0;a<n.length;a+=1){i=n[a];r+="-"+i.name.split("-")[0]}if(r.length>s){r=r.substr(0,s);"-"===r.charAt(r.length-1)&&(r=r.substr(0,s-1))}var o=r;var l=1;var u;while(TS.redux.channels.getPublicOrPrivateChannelByName(r)||TS.interop.members.memberExistsWithName(r)){u=(l+1).toString();l+=1;r=o+u;r.length>s&&(r=o.substr(0,s-u.length)+u)}return r},kickMember:function e(t,r){if(!TS.permissions.members.canKickFromGroups())return;var n=false;var i=TS.interop.channels.getGroupById(t,n);if(!i)return;return TS.shared.legacyKickMember(i,r)},test:function t(){return{_onCreate:e}}});var e=function e(t,r,n){if(!t){"name_taken"===r.error||"restricted_action"===r.error||TS.error("failed to create group");return}if(r.channel){var i=TS.interop.channels.upsertChannel(r.channel);var a=r.channel.id}if(!a){TS.error("no group_id?!!");return}if(!i){TS.error("no group?!!");return}var s=n._and_invite_members_ids?n._and_invite_members_ids.split(","):null;s&&TS.interop.api.call("conversations.invite",{channel:a,users:s.join(",")})};var t=999})()},qWi6:function(e,t){(function(){TS.registerModule("utility.search",{test:function e(){return{_fetchMembersFromFlannel:n}},makeClause:function t(r,n,i){if(e(r,n,i))return;var a={type:r.toLowerCase(),value:n};i&&(a.field_id=i);return a},makeConjunction:function e(r,n){if(t(r,n))return;return{type:r.toLowerCase(),clauses:n}},promiseToSearch:function e(t){if(!t)return Promise.reject(new Error("Cannot search without arguments."));if(t.all_of_org&&!TS.boot_data.page_needs_enterprise)return Promise.reject(new Error("cannot search an org when not an enterprise team"));if(!t.solr&&TS.interop.Flannel.useSocket()){if(!t.hasOwnProperty("raw_query"))return Promise.reject(new Error("Flannel searches require a `raw_query` to be provided"));var a=t.raw_query;var s=t.count||Infinity;var o;if(_.isEmpty(t.raw_query)&&!t.only_admins)o=Promise.resolve([]);else{var l={};t.only_admins?l.filter="admins":t.only_local_team&&(l.filter="team");o=n(t.raw_query,s,t.determine_membership_for_channel,l)}return o.then(function(e){var r=e.objects;if(!t.include_bots){var n=_.remove(r,{is_bot:true});n.length&&TS.has_pri[i]&&TS.log(i,"Flannel: removed these bots from results:",n)}if(t.exclude_slackbot&&t.include_bots){var o=_.remove(r,{is_slackbot:true});o.length&&TS.has_pri[i]&&TS.log(i,"Flannel: removed slackbot from results:",o)}if(TS.boot_data.page_needs_enterprise&&!t.all_of_org){var l=_.remove(r,function(e){var t=_.get(e,"enterprise_user.teams",[]);var r=_.includes(t,TS.model.team.id);return!r});l.length&&TS.has_pri[i]&&TS.log(i,"Flannel: removed these org members from results:",l)}if(!t.include_deleted){var u=_.remove(r,{deleted:true});u.length&&TS.has_pri[i]&&TS.log(i,"Flannel: removed these deleted members from results:",u)}r=_.intersectionBy(TS.members.getMembersForUser(),r,"id");return{ok:true,data:{items:r.slice(0,s),next_cursor_mark:null,num_found:r.length,teams:[TS.model.team]},args:{query:a}}})}if(!t.query)return Promise.reject(new Error("Cannot search without a query."));var u={query:JSON.stringify(t.query)};["sort","sort_direction","count","cursor_mark","include_bots","include_deleted","exclude_slackbot","ignore_guest_accounts"].forEach(function(e){t.hasOwnProperty(e)&&(u[e]=t[e])});var d=t.endpoint;d||(d=t.all_of_org?"search.enterprise":"search.team");return TS.interop.api.call(d,u).catch(r)}});var e=function e(t,r,n){if(!t){TS.error("cannot make a clause without a type");return}if(!r){TS.error("cannot make a clause without a value");return}"custom"!==t||n||TS.error("cannot make a custom type clause without a field id")};var t=function e(t,r){if(!t){TS.error("cannot make a conjunction without an 'and' or 'or' type");return}(!r||r.length<2)&&TS.error("cannot make a conjunction without at least two clauses")};var r=function e(t){TS.error(t.data.error+" error occured while searching");TS.generic_dialog.alert(TS.interop.i18n.t("Sorry! Something went wrong. Please try again.","utility_search")());throw t};var n=function e(t,r,n,i){i=i||{};var a={query:t,count:r};i.filter&&(a.filter=i.filter);var s=TS.members.fetchAndUpsertMembersWithQuery(a);if(!n)return s;var o=_.assign({channels:[n]},a);var l=TS.members.fetchAndUpsertMembersWithQuery(o);return Promise.join(s,l).then(function(e){var t=e[0];var r=e[1];var i=_.map(t.objects,"id");var a=_.map(r.objects,"id");var s={};a.forEach(function(e){s[e]=true});_.difference(i,a).forEach(function(e){s[e]=false});TS.redux.dispatch(TS.interop.redux.models.membership.setChannelMembershipInfoForUsers({channelId:n,membershipInfo:s}));return t})};var i=1989})()},qYTV:function(e,t,r){"use strict";r.r(t);var n=r("LzIY");var i=r.n(n);var a=r("GhXE");var s=r.n(a);var o=r("XUc0");var l=r.n(o);var u=r("J7dF");var d=r.n(u);var c=r("laYx");var _=r.n(c);var m=r("Nwtb");var f=r.n(m);var p=r("SkS5");var h=r.n(p);var g=r("ftdm");var S=r.n(g);var T=r("gYX6");var v=r.n(T);var b=r("sOV0");var y=r.n(b);var w=r("weHv");var k=r.n(w);var x=r("VACg");var C=r.n(x);var M=r("2hNN");var I=r.n(M);var E=r("EXLS");var A=r.n(E);var P=r("Ysd/");var O=r.n(P);var F=r("/xdr");var H=r.n(F);var j=r("GNek");var D=r.n(j);var $=r("/q0e");var L=r.n($);var R=r("4B0H");var N=r.n(R);var B=r("q3cq");var U=r.n(B);var q=r("6usU");var G=r.n(q);var W=r("YZHV");var z=r.n(W);var K=r("fK9Z");var V=r.n(K);var Y=r("Oszc");var J=r.n(Y);var Q=r("pW7e");var X=r.n(Q);var Z=r("qQ+f");var ee=r.n(Z);var te=r("Foai");var re=r.n(te);var ne=r("gm7A");var ie=r.n(ne);var ae=r("F/UT");var se=r.n(ae);var oe=r("W17R");var le=r.n(oe);var ue=r("zkfd");var de=r.n(ue);var ce=r("Pv2O");var _e=r.n(ce);var me=r("rRwQ");var fe=r.n(me);var pe=r("7EQy");var he=r.n(pe);var ge=r("4Cq+");var Se=r.n(ge);var Te=r("SaiC");var ve=r.n(Te);var be=r("8FFK");var ye=r.n(be);var we=r("jAhp");var ke=r.n(we);var xe=r("mGpN");var Ce=r.n(xe);var Me=r("j9dp");var Ie=r.n(Me);var Ee=r("HtJm");var Ae=r.n(Ee);var Pe=r("I1WX");var Oe=r.n(Pe);var Fe=r("4KQo");var He=r.n(Fe);var je=r("6btA");var De=r.n(je);var $e=r("mmJJ");var Le=r.n($e);var Re=r("aLMH");var Ne=r.n(Re);var Be=r("SmOH");var Ue=r.n(Be);var qe=r("Cs7e");var Ge=r.n(qe);var We=r("V+wu");var ze=r.n(We);var Ke=r("e9QI");var Ve=r.n(Ke);var Ye=r("Chwb");var Je=r.n(Ye);var Qe=r("pdVC");var Xe=r.n(Qe);var Ze=r("PhMi");var et=r.n(Ze);var tt=r("bFS3");var rt=r.n(tt);var nt=r("2h3S");var it=r.n(nt);var at=r("sVQH");var st=r.n(at);var ot=r("EcSN");var lt=r.n(ot);var ut=r("L48h");var dt=r.n(ut);var ct=r("oTOb");var _t=r.n(ct);var mt=r("UP61");var ft=r.n(mt);var pt=r("HUaD");var ht=r.n(pt);var gt=r("9mk2");var St=r.n(gt);var Tt=r("4oWp");var vt=r.n(Tt);var bt=r("Zt5a");var yt=r.n(bt);var wt=r("QqCU");var kt=r.n(wt);var xt=r("HfRC");var Ct=r.n(xt);var Mt=r("nH+9");var It=r.n(Mt);var Et=r("IZwQ");var At=r.n(Et);var Pt=r("R0Lu");var Ot=r.n(Pt);var Ft=r("3D55");var Ht=r.n(Ft);var jt=r("5+2p");var Dt=r.n(jt);var $t=r("bdn/");var Lt=r.n($t);var Rt=r("3Vm1");var Nt=r.n(Rt);var Bt=r("gj8S");var Ut=r.n(Bt);var qt=r("54vr");var Gt=r.n(qt);var Wt=r("qWi6");var zt=r.n(Wt);var Kt=r("S+GT");var Vt=r.n(Kt);var Yt=r("m7EJ");var Jt=r.n(Yt);var Qt=r("D7d6");var Xt=r.n(Qt);var Zt=r("Jzty");var er=r.n(Zt);var tr=r("GhNQ");var rr=r.n(tr);var nr=r("kyJk");var ir=r.n(nr);var ar=r("Nyv6");var sr=r.n(ar);var or=r("OHyl");var lr=r.n(or);var ur=r("PU4x");var dr=r.n(ur);var cr=r("+J8v");var _r=r.n(cr);var mr=r("VTIS");var fr=r.n(mr);var pr=r("G4VQ");var hr=r.n(pr);var gr=r("zmUN");var Sr=r.n(gr);var Tr=r("nOzb");var vr=r.n(Tr);var br=r("16zC");var yr=r.n(br);var wr=r("ae6w");var kr=r.n(wr);var xr=r("omB7");var Cr=r.n(xr);var Mr=r("b1eP");var Ir=r.n(Mr);var Er=r("RvrE");var Ar=r.n(Er);var Pr=r("T0l3");var Or=r.n(Pr);var Fr=r("g247");var Hr=r.n(Fr)},rRwQ:function(e,t,r){var n=r("cDf5");var i=r("RIqP");(function(){TS.registerModule("members",{presence_changed_sig:new signals.Signal,ds_presence_changed_sig:new signals.Signal,user_color_changed_sig:new signals.Signal,joined_team_sig:new signals.Signal,changed_current_status_sig:new signals.Signal,changed_name_sig:new signals.Signal,changed_real_name_sig:new signals.Signal,changed_deleted_sig:new signals.Signal,changed_profile_sig:new signals.Signal,changed_tz_sig:new signals.Signal,changed_account_type_sig:new signals.Signal,changed_admin_perms_sig:new signals.Signal,changed_owner_perms_sig:new signals.Signal,changed_self_sig:new signals.Signal,lazily_added_sig:new signals.Signal,batch_upserted_sig:new signals.Signal,member_was_upserted_sig:new signals.Signal,user_added_to_team_sig:new signals.Signal,user_removed_from_team_sig:new signals.Signal,changed_is_unknown_sig:new signals.Signal,legacy_is_in_bulk_upsert_mode:false,onStart:function e(){TS.channels.joined_sig.add(function(){TS.members.invalidateMembersUserCanSeeArrayCaches()});TS.channels.left_sig.add(function(){TS.members.invalidateMembersUserCanSeeArrayCaches()})},legacyUpsertAndSignal:function e(t){var r=TS.members.legacyUpsertMember(t);return x(r,t)},legacyUpsertMember:function t(r){var n=TS.redux.members.hasMemberWithId(r.id)&&TS.interop.members.getRawMemberById(r.id);var i="NOOP";var a=[];r=TS.interop.members.processMemberForUpserting(r);if(n){TS.has_pri[w]&&TS.log(w,'updating existing member "'+r.id+'"');var s=T(n,r);i=s.status;a=s.what_changed;if(_.includes(a,"deleted")){var o=TS.redux.channels.getImByMemberId(r.id);o&&(o.is_archived=r.deleted)}}else if(r.id){i="ADDED";_.includes(d,r.id)&&a.push("is_unknown");v(r);TS.has_pri[w]&&TS.log(w,'adding member "'+r.id+'" color:'+r.color+" member_color:"+r.member_color)}else TS.error("bad error, no member.id");if(r.is_self&&r.deleted){TS.reload(null,"member.is_self && member.deleted");return}if(!TS.members.legacy_is_in_bulk_upsert_mode){TS.members.invalidateMembersUserCanSeeArrayCaches();TS.members.invalidateActiveMembersArrayCaches()}TS.members.member_was_upserted_sig.dispatch();if(!TS.members.legacy_is_in_bulk_upsert_mode){if("NOOP"!==i){TS.interop.members.dangerouslyAddMember(r);TS.redux.dispatch(TS.interop.redux.features.presence.updatePresence({memberId:r.id,presence:r.presence}))}TS.interop.members.markObjectsAsFresh([r.id]);TS.interop.members.setCanMembersInteract([r])}var l={status:i,member:r,what_changed:a};TS.members.legacy_is_in_bulk_upsert_mode&&e.push(l);return l},setMemberUserColor:function e(t,r){r=_.escape(r);t.member_color=r||t.color;r&&r!=t.color?TS.model.user_colors[t.id]=r:delete TS.model.user_colors[t.id];TS.members.user_color_changed_sig.dispatch(t)},getActiveMembersWithSelfAndNotSlackbot:function e(){t.length||(t=c(t,{include_self:true,include_slackbot:false,include_bots:true}));return t},getActiveMembersExceptSelfAndSlackbot:function e(){r.length||(r=c(r,{include_self:false,include_slackbot:false,include_bots:true}));return r},getActiveMembersWithSelfAndSlackbot:function e(){s.length||(s=c(s,{include_self:true,include_slackbot:true,include_bots:true}));return s},getMembersWithOptions:function e(t){var r=TS.members.getMembersForUser();var n=_.filter(r,function(e){if(e.is_stranger)return false;if(t.only_admins)return e.is_admin&&!e.deleted;if(t.only_local_team&&!TS.interop.rules.members.isMemberOnTeam(e,TS.model.team.id))return false;if(!t.include_deleted&&e.deleted)return false;if(!t.include_slackbot&&TS.interop.rules.members.isSlackbot(e))return false;if(!t.include_self&&e.is_self)return false;if(!t.include_bots&&e.is_bot)return false;return true});return n},getMembersForUser:function e(){if(u.length)return u;u=_.filter(TS.redux.members.getAllMembers(),function(e){return true!==e.is_stranger&&!!e.name});return u},legacyGetPrefCompliantMemberNameLowerCase:function e(t,r){if(!t)return"";var n=function(){var e=TS.interop.members.getMemberRealNameLowerCase(t);!TS.interop.members.shouldDisplayRealNames()&&TS.interop.members.getMemberProfileFieldDisplayNameLowerCase(t)&&(e=TS.interop.members.getMemberProfileFieldDisplayNameLowerCase(t));return e}();return r?_.escape(n):n},invalidateMembersUserCanSeeArrayCaches:function e(){if(!TS.model.user)return;var t=u.length;if(!t)return;u.length=0;TS.members.invalidateActiveMembersArrayCaches()},invalidateActiveMembersArrayCaches:function e(){t.length=0;r.length=0;a.length=0;s.length=0;o.length=0;l.length=0},legacyMemberSorterByActiveWithBotsLast:function e(t){var r=t.filter(function(e){return e.is_bot||TS.interop.rules.members.isSlackbot(e)});var n=r.filter(function(e){return"active"===e.presence});var a=r.filter(function(e){return"away"===e.presence});var s=t.filter(function(e){return!e.is_bot&&!TS.interop.rules.members.isSlackbot(e)});var o=s.filter(function(e){return"active"===e.presence});var l=s.filter(function(e){return"away"===e.presence});var u=o.sort(function(e,t){var r=TS.interop.members.getPrefCompliantMemberName(e)||e.name;var n=TS.interop.members.getPrefCompliantMemberName(t)||t.name;return TS.interop.i18n.sorter(r,n)});var d=l.sort(function(e,t){var r=TS.interop.members.getPrefCompliantMemberName(e)||e.name;var n=TS.interop.members.getPrefCompliantMemberName(t)||t.name;return TS.interop.i18n.sorter(r,n)});var c=n.sort(TS.interop.i18n.mappedSorter("name"));var _=a.sort(TS.interop.i18n.mappedSorter("name"));var m=[];m.push.apply(m,i(u).concat(i(c),i(d),i(_)));return m},legacyEnsureMembersInDataArePresent:function e(t,r){var n=TS.interop.utility.extractAllMemberIds(t);if("T02J3DPUE"===_.get(TS,"model.team.id")&&!_.isEmpty(n)){var i=_.some(n,function(e){return"U"===e[0]});if(i){var a={message:"Fetching U users on W team from source: "+r,stack:TS.console.getStackTrace()};$.post(TS.boot_data.beacon_error_url,{description:"fetch_u_on_w_team",error_json:JSON.stringify(a),team:_.get(TS,"model.team.id","none"),user:TS.boot_data.user_id,version:TS.boot_data.version_ts})}}return TS.interop.members.ensureMembersArePresent(n)},fetchAndUpsertMembersWithQuery:function e(t){return TS.interop.members.fetchAndUpsertMembersWithQuery({query:t}).then(function(e){var t=e.members,r=e.next_marker;return{objects:t,next_marker:r}})},legacyStartBatchUpsert:function e(){if(TS.members.legacy_is_in_bulk_upsert_mode)return false;TS.members.legacy_is_in_bulk_upsert_mode=true;return true},legacyFinishBatchUpsert:function t(){if(!TS.members.legacy_is_in_bulk_upsert_mode)return false;TS.members.legacy_is_in_bulk_upsert_mode=false;TS.members.invalidateMembersUserCanSeeArrayCaches();TS.members.invalidateActiveMembersArrayCaches();var r=_.partition(e,function(e){return _.includes(e.what_changed,"is_unknown")});var n=r[0];TS.interop.members.dangerouslyBulkAddMembers(e.map(function(e){return e.member}));var i=e.reduce(function(e,t){var r=t.member;e[r.id]=e[r.presence];return e},{});TS.redux.dispatch(TS.interop.redux.features.presence.bulkUpdatePresence(i));n.length>0&&TS.members.changed_is_unknown_sig.dispatch({batch:_.map(n,"member")});TS.members.batch_upserted_sig.dispatch(e);TS.interop.members.markObjectsAsFresh(_.map(e,"member.id"));TS.interop.members.setCanMembersInteract(e.map(function(e){return e.member}));e=[];return true},legacyAllocateTeamListMembers:function e(t){var r;var n=[];var i=[];var a=[];var s=[];var o=[];var l=[];t.sort(function(e,t){var r=e._real_name_lc||e._name_lc;var n=t._real_name_lc||t._name_lc;if(r>n)return 1;if(n>r)return-1;return 0});for(var u=0;u<t.length;u+=1){r=t[u];r.deleted?r.is_bot?a.push(r):i.push(r):r.is_ultra_restricted?l.push(r):r.is_restricted?o.push(r):r.is_bot||TS.interop.rules.members.isSlackbot(r)?s.push(r):n.push(r)}return{members:n,disabled_members:i,deleted_bots:a,bots:s,restricted_members:o,ultra_restricted_members:l}},promiseToSearchMembers:function e(t){return Promise.resolve(t).then(function(e){if(!e)return Promise.reject(new Error("No search parameters provided"));e.query=e.query&&e.query.trim()||"";e.include_org=!!TS.boot_data.page_needs_enterprise&&!!e.include_org;e.org_team_ids=e.include_org&&Array.isArray(e.org_team_ids)?e.org_team_ids:[];e=f(e,TS.interop.searcher.isNewMemberSearch(e));if(e._is_new||e.num_remaining>0)return p(e);return Promise.resolve(e)})},readyMemberSearcher:function e(t,r){return f(t,r)},buildPromiseToSearchMembersArguments:function e(t){return h(t)},userAddedToTeam:function e(t){var r=_.merge({},TS.model.user);r.enterprise_user&&(r.enterprise_user.teams=_.uniq(r.enterprise_user.teams.concat(t)));TS.members.legacyUpsertMember(r);TS.members.user_added_to_team_sig.dispatch(t)},userRemovedFromTeam:function e(t){var r=_.merge({},TS.model.user);r.enterprise_user&&(r.enterprise_user.teams=r.enterprise_user.teams.filter(function(e){return e!==t}));TS.members.legacyUpsertMember(r);TS.members.user_removed_from_team_sig.dispatch(t)},legacyEnsureMemberObjectsForUserProfileFields:function e(t){var r=[];t.is_restricted&&t.profile.guest_invited_by&&r.push(t.profile.guest_invited_by);var n=TS.team.getVisibleTeamProfileFieldsForMember(t);var i=_.chain(n).filter({type:"user"}).reduce(function(e,t){return e.concat(t.value.split(/\s*,\s*/))},[]).value();r=_.chain(r).concat(i).compact().uniq().value();if(!r.length)return Promise.resolve();return TS.interop.members.ensureMembersArePresent(r)},maybeUpdateMembersUserCanSee:function e(t){if(!t)return y()},legacySetMemberUnknown:function e(t){d.push(t)},getAvatarBaseUrl:function e(){return TS.model.team&&TS.model.team.avatar_base_url},test:function e(){var e={};Object.defineProperty(e,"_accessible_user_ids_last_fetched_ts",{get:function e(){return b},set:function e(t){b=t}});Object.defineProperty(e,"_processNewMemberForUpserting",{get:function e(){return v},set:function e(t){v=t}});Object.defineProperty(e,"_processExistingMemberForUpserting",{get:function e(){return T},set:function e(t){T=t}});Object.defineProperty(e,"_fillMembersWithOptions",{get:function e(){return c},set:function e(t){c=t}});Object.defineProperty(e,"_members_for_user",{get:function e(){return u},set:function e(t){u=t}});return e}});var e=[];var t=[];var r=[];var a=[];var s=[];var o=[];var l=[];var u=[];var d=[];var c=function e(t,r){if(!_.isArray(t))throw new TypeError("members passed to _fillMembersWithOptions is not an array!");t.length=0;var n=TS.members.getMembersWithOptions(r);_.each(n,function(e){t.push(e)});return t};var m=function e(t){var r=!!t&&t.is_unknown;t&&t.is_unknown&&(t.is_unknown=false);_.pull(d,t.id);return r};var f=function e(t,r){t=t||{};t.hasOwnProperty("_searcher_p")&&r&&t._searcher_p.cancel();t.hasOwnProperty("_cursor_mark")&&!r||(t._cursor_mark="");t.hasOwnProperty("full_profile_filter")||(t.full_profile_filter=true);t.hasOwnProperty("include_bots")||(t.include_bots=true);t.hasOwnProperty("include_deleted")||(t.include_deleted=false);t.hasOwnProperty("include_self")||(t.include_self=false);t.hasOwnProperty("include_slackbot")||(t.include_slackbot=true);t.hasOwnProperty("only_local_team")||(t.only_local_team=false);t.hasOwnProperty("only_admins")||(t.only_admins=false);t.hasOwnProperty("items")&&!r||(t.items=[]);t.hasOwnProperty("not_member_of")||(t.not_member_of=[]);t.hasOwnProperty("member_of")||(t.member_of=[]);t.hasOwnProperty("num_found")&&!r||(t.num_found=0);t.hasOwnProperty("num_remaining")&&!r||(t.num_remaining=0);t.hasOwnProperty("num_new")&&!r||(t.num_new=0);t.hasOwnProperty("max_api_results")||(t.max_api_results=100);if(r){t._last_query=t.query;t._last_include_org=t.include_org;t._last_org_team_ids=t.org_team_ids}t._is_new=!!r;return t};var p=function e(t){var r=function e(){return g(t)};t._is_new?t._searcher_p=r():t._searcher_p=t._searcher_p.then(r);return t._searcher_p};var h=function e(t){var r=[TS.utility.search.makeClause("is","user")];if(t._last_query){var n=t._last_query.split(/\s*,\s*|\s+/).map(function(e){return"@"===e.charAt("0")?e.substring(1):e}).filter(function(e){return!!e}).map(function(e){if(1===e.length||!t.full_profile_filter)return TS.utility.search.makeConjunction("OR",[TS.utility.search.makeClause("real_name",e),TS.utility.search.makeClause("display_name",e)]);return TS.utility.search.makeClause("fuzzy_with_email",e)});r=r.concat(n)}if(t.not_member_of&&t.not_member_of.length){var i=t.not_member_of.map(function(e){return TS.utility.search.makeClause("not_member_of",e)});r.push(i.length>1?TS.utility.search.makeConjunction("OR",i):i[0])}if(t.member_of&&t.member_of.length){var a=t.member_of.map(function(e){return TS.utility.search.makeClause("member_of",e)});r.push(a.length>1?TS.utility.search.makeConjunction("OR",a):a[0])}if(t._last_include_org&&t._last_org_team_ids.length){var s=t._last_org_team_ids.map(function(e){return TS.utility.search.makeClause("belongs_to_team_id",e)});r.push(s.length>1?TS.utility.search.makeConjunction("OR",s):s[0])}var o=r.length>1?TS.utility.search.makeConjunction("AND",r):r[0];var l={query:o,count:t.max_api_results,include_bots:t.include_bots,include_deleted:t.include_deleted,ignore_guest_accounts:t.ignore_guest_accounts,only_local_team:t.only_local_team,only_admins:t.only_admins,raw_query:t.query};t._last_include_org&&(l.all_of_org=t._last_include_org);t._cursor_mark&&(l.cursor_mark=t._cursor_mark);t.determine_membership_for_channel&&(l.determine_membership_for_channel=t.determine_membership_for_channel);return l};var g=function e(t){var r=h(t);t.num_new=0;return TS.utility.search.promiseToSearch(r).then(function(e){if(!e.data.items.length)return Promise.resolve(t);if(!t.num_remaining){t.num_remaining=e.data.num_found;t.num_found=e.data.num_found}t.num_remaining-=e.data.items.length;t._cursor_mark=e.data.next_cursor_mark;var r=e.data.items.map(function(e){var r=TS.interop.members.getMemberById(e.id);if(!r){if(t._last_include_org&&e.team_id!==TS.model.team.id){e.is_primary_owner=false;e.is_owner=false;e.is_admin=false}r=TS.members.legacyUpsertMember(e).member}return r}).filter(function(e){if(e.is_self&&!t.include_self||TS.interop.rules.members.isSlackbot(e)&&!t.include_slackbot){t.num_found-=1;return false}if(t.limit_by_model_relevancy)return TS.utility.members.isMemberRelevantToModel(e,t.limit_by_model_relevancy);return true});t.num_new=r.length;t.items.push.apply(t.items,r);return Promise.resolve(t)})};var S=function e(t){if(!_.isObject(t))return t;return _.omitBy(t,function(e,t){return 0===t.indexOf("image_")})};var T=function e(t,r){var i="NOOP";var a=[];Object.keys(r).forEach(function(e){if("profile"===e){var s=S(t.profile);var o=S(r.profile);if(_.isObject(o)){if(s.status_text!==o.status_text||s.status_emoji!==o.status_emoji){i="CHANGED";a.push("current_status")}var l=Object.keys(s).filter(function(e){return"undefined"===typeof o[e]}).concat(["status_text","status_emoji"]);s=_.omit(s,l);o=_.omit(o,l);if(!_.isEqual(s,o)){i="CHANGED";a.push(e)}}}else if("enterprise_user"===e)if(t[e]){for(var u in r[e])if(!_.isEqual(t[e][u],r[e][u])){i="CHANGED";a.push(e)}}else{i="CHANGED";a.push(e)}else if("id"===e){var d=t.id!=r.id&&t.enterprise_user&&r.enterprise_user;if(d){var c=t.enterprise_user.id===t.id;var m=r.id!=r.enterprise_user.id;if(c&&m){i="CHANGED";a.push(e)}}}else if("teams"===e){i="CHANGED";a.push(e)}else if(t[e]!=r[e]){if("is_admin"===e&&TS.has_pri[k]){TS.warn(k,e+"is changing from `"+t[e]+"` to `"+r[e]+"`");TS.console.trace(k)}if(r[e]&&!TS.utility.isScalar(r[e])){t[e]=r[e];TS.warn(e+" is not scalar! it needs to be handled by upsertMember specifically to test if it has changed! "+n(r[e]))}else if("boolean"!==typeof r[e]||!r[e]!=!t[e]){a.push(e);i="CHANGED"}}});m(t)&&a.push("is_unknown");return{status:i,what_changed:a}};var v=function e(t){TS.members.user_color_changed_sig.dispatch(t)};var b=0;var y=function e(){TS.members.invalidateMembersUserCanSeeArrayCaches()};var w=4;var k=1975;var x=function e(t,r){if("ADDED"===t.status)TS.members.lazily_added_sig.dispatch(t.member);else if("CHANGED"===t.status){if(-1!==t.what_changed.indexOf("is_unknown")){TS.members.changed_is_unknown_sig.dispatch(t.member);return t}-1!==t.what_changed.indexOf("current_status")&&TS.members.changed_current_status_sig.dispatch(t.member);-1!==t.what_changed.indexOf("profile")&&TS.members.changed_profile_sig.dispatch(t.member);-1===t.what_changed.indexOf("is_restricted")&&-1===t.what_changed.indexOf("is_ultra_restricted")||TS.members.changed_account_type_sig.dispatch(t.member);-1!==t.what_changed.indexOf("real_name")&&TS.members.changed_real_name_sig.dispatch(t.member);-1===t.what_changed.indexOf("member_color")&&-1===t.what_changed.indexOf("color")||TS.members.user_color_changed_sig.dispatch(t.member);-1!==t.what_changed.indexOf("name")&&TS.members.changed_name_sig.dispatch(t.member);-1!==t.what_changed.indexOf("tz")&&TS.members.changed_tz_sig.dispatch(t.member);-1!==t.what_changed.indexOf("deleted")&&TS.members.changed_deleted_sig.dispatch(t.member);-1!==t.what_changed.indexOf("presence")&&TS.members.presence_changed_sig.dispatch(t.member);-1!==t.what_changed.indexOf("is_owner")&&TS.members.changed_owner_perms_sig.dispatch(t.member);-1!==t.what_changed.indexOf("is_admin")&&TS.members.changed_admin_perms_sig.dispatch(t.member);r.is_self&&TS.members.changed_self_sig.dispatch(t.member)}return t}})()},sOV0:function(e,t){(function(){TS.registerModule("redux.channels.interop",{maybeWrapEntity:function e(t){if(!t||!t.id)return t;return T(t.id)},getSetCounts:function e(){return _.chain(t).map(function(e,t){return{key:t,value:e}}).sortBy("value").reverse().value()},getReduxSetCounts:function e(){return _.chain(r).map(function(e,t){return{key:t,value:e}}).sortBy("value").reverse().value()},test:function e(){var t={};return t}});var e=TS.interop.channels.getChannelById;var t={};var r={};var n={};var i=function e(){var t=window.Proxy&&S();return t};var a=function e(t,r,n){if(!t||!r)return;var i={id:t};i[r]=n;TS.interop.channels.updateOneKeyForChannel(i)};var s=["_show_in_list_even_though_no_unreads","deleted","has_draft","is_archived","is_frozen","is_channel","is_ext_shared","is_group","is_im","is_member","is_mpim","is_open","is_org_shared","is_pending_ext_shared","is_starred","last_read","members","priority","unread_cnt","unread_highlight_cnt","internalTeamIds","pendingAndConnectedTeamIds"];var o=["_display_name","_archive_msgs","_checking_at_channel_status","_delayed_fetch_timer","_did_defer_initial_msg_history","_display_name_lc","_display_name_truncated","_i18n_ns_history","_i18n_ns","_internal_name","_jumper_previous_name_match","_latest_via_users_counts","_mark_most_recent_read_timer","_marked_reason","_members","_mention_count_display_via_users_counts","_name_lc","_prev_last_read","_score","_users_counts_info","active_members","can_thread","create_channel","created","creator","date_created","enterprise_id","fetched_history_after_scrollback_time","has_fetched_history_after_scrollback","has_pins","history_changed","history_fetch_failed","history_fetch_retries","history_is_being_fetched","id","inherit","is_default","is_general","is_global_shared","is_limited","is_moved","is_non_threadable","is_org_default","is_org_mandatory","is_private","is_read_only","is_thread_only","last_made_active","last_msg_input","latest","length","member","msgs","name_normalized","name","needs_joined_message","never_needs_joined_msg","note","num_members","old_name","oldest_msg_ts","opened_this_session","org","parent_group","pinned_items","pinned_items_count","presence","previous_names","purpose","scroll_top","shares","domain","tooltip","topic","unlinked","unread_count_display","unread_count","unread_highlight_cnt_in_client","unread_highlights","unreads","user","was_archived_this_session","isUnknown","isNonExistent","fromAnotherTeam","internalTeamIds","team_id","pendingAndConnectedTeamIds","previously_connected_team_ids","pending_connected_team_ids","conversation_host_id","shared_team_ids"];var l=["_get","_is_interop_channel_object","_set","_setWithReduxAction","attributes","children","disabled","is_broadcast_keyword","is_divider","is_emoji","is_usergroup","is_view","is_app_action","nodeType","old_name","props_to_define","selector","then","title","toObject","toJSON","window","@@toStringTag"];var u=_.reduce(s,function(e,t){e[t]=true;return e},{});var d=_.reduce(o,function(e,t){e[t]=true;return e},{});var c=_.reduce(l,function(e,t){e[t]=true;return e},{});var m={};var f=function t(r,i){if(!d[i]&&!u[i]&&!c[i]&&_.isString(i)){TS.console.logStackTrace("Accessing an unknown key "+i+" on a model object");n[i]||(n[i]=true);S()&&TS.console.error('Dev only warning: Trying to get an unknown field "'+i+'" from a model object. If this is not a typo and you are relying on this property, please try and store this data outside of the model ob, or add to the model_ob_keys_as_map whitelist in TS.redux.channels.interop.source.js. Questions? Feel free to ask in #dhtml');var a=e(r.id);return a&&a[i]}return r[i]};var p=function r(i,a,s){_.isString(a)&&(t[a]=(t[a]||0)+1);if(!d[a]&&!u[a]&&_.isString(a)){TS.console.logStackTrace("Setting an unknown key "+a+" on a model object");n[a]||(n[a]=true);if(S())throw new Error('Dev only warning: Trying to set an unknown field "'+a+'" on a model object. If this is not a typo and you are relying on this property, please try and store this data outside of the model ob, or add to the model_ob_keys_as_map whitelist in TS.redux.channels.interop.source.js. Questions? Feel free to ask in #dhtml');var o=e(i.id);o&&(o[a]=s)}i[a]=s;return true};var h=function e(t){this.id=t;Object.defineProperties(this,this.props_to_define)};var g={};_.without(o,"id").forEach(function(e){g[e]={enumerable:true,get:function t(){return this._get(e)},set:function t(r){return this._set(e,r)}};s.forEach(function(e){g[e]={enumerable:true,get:function t(){return this._get(e)},set:function t(r){return this._setWithReduxAction(e,r)}}})});h.prototype.props_to_define=g;h.prototype._is_interop_channel_object=true;h.prototype._get=function(t){var r=e(this.id);if(r)return r[t]};h.prototype._set=function(t,r){var n=e(this.id);n&&(n[t]=r);return true};h.prototype._setWithReduxAction=function(t,n){var i=e(this.id);if(i&&i[t]!==n){a(this.id,t,n);r[t]=(r[t]||0)+1}return true};var S=function e(){return TS.boot_data&&("dev"===TS.boot_data.version_ts||"local_js"===TS.boot_data.version_ts)};var T=function e(t){if(!t)throw new Error("Must pass in a valid id to _createWrappedEntityById");var r;var n=i();if(m[t])r=m[t];else{r=new h(t);n&&(r=new window.Proxy(r,{get:function e(t,r){return f(t,r)},set:function e(t,r,n){return p(t,r,n)}}));m[t]=r}return r}})()},sVQH:function(e,t,r){var n=r("lSNA");function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}));r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),true).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}(function(){TS.registerModule("msg_edit",{editing:false,editing_in_msg_pane:false,editing_in_convo_pane:false,deleting_from_editing:false,current_msg:null,current_model_ob:null,mousedown_active:false,edit_interv:0,onStart:function e(){},onCountDownInterval:function e(){if(!TS.msg_edit.current_msg)return;if(-1==TS.prefs.getTeamPref("msg_edit_window_mins")||TS.interop.rules.channels.isYou(TS.msg_edit.current_model_ob)){$("#edit_countdown").empty();return}var t=TS.interop.datetime.toDateObject(TS.msg_edit.current_msg.ts).getTime()+60*TS.prefs.getTeamPref("msg_edit_window_mins")*1e3;var r=Math.floor((t-Date.now())/1e3);r<1?$("#edit_countdown").html(TS.interop.i18n.t("(your time to edit ran out)","msg_edit")()+"&nbsp&nbsp&nbsp&nbsp"):r<61?$("#edit_countdown").html(TS.interop.i18n.t("(you have <strong>{seconds_count, number}</strong> seconds)","msg_edit")({seconds_count:r})+"&nbsp&nbsp&nbsp&nbsp"):$("#edit_countdown").empty()},cancelEditingINothingHasChanged:function e(){if(!TS.msg_edit.editing)return true;var t=TS.format.unFormatMsg(TS.msg_edit.current_msg.text);var r=TS.utility.contenteditable.value($("#message_edit_form").find("#msg_text"));if(r===t){TS.msg_edit.onCancelEdit();return true}return false},editExpiration:function e(r){if(r>0){var n=t(r);if(TS.model.user.is_admin)return'<p class="no_bottom_margin">'+TS.interop.i18n.t('In this workspace, you can\u2019t edit a message after more than <strong>{msg_edit_duration_text}</strong>. Admins can adjust this in <a href="/admin/settings#message_editing" target="_new">Workspace&nbsp;Settings</a>.',"msg_edit")({msg_edit_duration_text:n})+"</p>";return'<p class="no_bottom_margin">'+TS.interop.i18n.t("In this workspace, you can\u2019t edit a message after more than <strong>{msg_edit_duration_text}</strong>. Admins can adjust this in Workspace&nbsp;Settings.","msg_edit")({msg_edit_duration_text:n})+"</p>"}if(TS.model.user.is_admin)return'<p class="no_bottom_margin">'+TS.interop.i18n.t('In this workspace, you can\u2019t edit messages after the fact. Admins can adjust this in <a href="/admin/settings#message_editing" target="_new">Workspace&nbsp;Settings</a>.',"msg_edit")()+"</p>";return'<p class="no_bottom_margin">'+TS.interop.i18n.t("In this workspace, you can\u2019t edit messages after the fact. Admins can adjust this in Workspace&nbsp;Settings.","msg_edit")()+"</p>"},startEdit:function t(r,n,i,a){if($("#message_edit_form").length&&!TS.msg_edit.cancelEditingINothingHasChanged()){TS.msg_edit.promptEdit();return}if(!r){TS.error("no msg_ts?");return null}if(!n){TS.error("no model_ob?");return null}a||(a=TS.utility.msgs.getMsg(r,e(n)));if(!a){TS.error("no msg in msgs?");return null}if("convo"!==i){TS.redux.dispatch(TS.interop.redux.features.messageEdit.maybeStartEditingMessage({channelId:a.channel,ts:r,scroll:true}));return}var s=TS.format.unFormatMsg(a.text);var o=i&&i.force_reopen;if(!o){var l=Date.now();var u=TS.interop.datetime.toDateObject(a.ts);var d=l-u;var c=d/6e4;if(TS.prefs.getTeamPref("msg_edit_window_mins")>=0&&c>TS.prefs.getTeamPref("msg_edit_window_mins")&&!TS.interop.rules.channels.isYou(n)){TS.warn("Editing unavailable on channel "+n.id+", msg with ts = "+a.ts+". now = "+l+", elapsed (minutes) = "+c+", msg_edit_window_mins = "+TS.prefs.getTeamPref("msg_edit_window_mins"));var m=TS.prefs.getTeamPref("msg_edit_window_mins")>0?TS.interop.i18n.t("This message can\u2019t be edited","msg_edit")():TS.interop.i18n.t("Messages can\u2019t be edited","msg_edit")();TS.generic_dialog.alert(TS.msg_edit.editExpiration(TS.prefs.getTeamPref("msg_edit_window_mins")),m,TS.interop.i18n.t("Got It","msg_edit")());return}}var f;if("convo"===i){TS.msg_edit.editing_in_msg_pane=false;TS.msg_edit.editing_in_convo_pane=true;f=TS.msg_edit.getDivForMsgInConvoPane(a.ts)}else{TS.msg_edit.editing_in_msg_pane=true;TS.msg_edit.editing_in_convo_pane=false;f=TS.msg_edit.getDivForMsgInMsgPane(a.ts)}if(!f.length){TS.error("no msg div for edit");return null}TS.msg_edit.current_msg=a;TS.msg_edit.current_model_ob=n;f.addClass("hidden");var p=s;i&&i.text&&(p=i.text);var h=TS.templates.message_edit_form({msg:a,edit_text:p,permalink:TS.utility.msgs.constructMsgPermalink(n,a.ts,a.thread_ts),include_emo:false,relative_ts:TS.interop.messages.isReply(a)});f.after(h);var g=$("#message_edit_form");var S=g;var T=g.find("#msg_text");TS.utility.contenteditable.create(T,{ariaLabel:TS.interop.i18n.t("Edit message","msg_edit")(),modules:{tabcomplete:{searchOptions:{},positionMenu:function e(t){t.style.width=T.outerWidth()+"px";TS.tabcomplete.positionUIRelativeToInput(t,T)},completers:["channels","emoji","members"]}},onEnter:function e(){TS.msg_edit.checkAndSubmit(T,g);return false},onEscape:function e(){TS.model.menu_is_showing||TS.model.dialog_is_showing||setTimeout(TS.msg_edit.onCancelEdit,0)},onTextChange:function e(){TS.msg_edit.checkLengthAndUpdateMessage(T)},enableBroadcastKeywords:!("convo"===i)});TS.utility.contenteditable.enable(T);T.on("keyup",function(){var e=TS.utility.contenteditable.cursorPosition(T);e.length||S.find(".edit_controls").scrollintoview({px_offset:-50})});TS.utility.contenteditable.value(T,p);TS.msg_edit.checkLengthAndUpdateMessage(T);TS.info("message_edit_form added");TS.msg_edit.editing=true;g.bind("destroyed",function(){TS.utility.contenteditable.unload($("#message_edit_form #msg_text"));TS.info("message_edit_form removed");TS.msg_edit.editing=false;TS.msg_edit.editing_in_msg_pane=false;TS.msg_edit.editing_in_convo_pane=false;g=null;T=null;TS.msg_edit.resetEditUI()});g.bind("submit",function(e){e.preventDefault();var t=TS.utility.contenteditable.value(T);t=TS.utility.contenteditable.legacySynchronouslyReplacePotentialMentions(t,{enableBroadcastKeywords:!("convo"===i)});if(t===s){TS.msg_edit.onCancelEdit();return}if(!t){var o=TS.utility.msgs.getMsgActions(a,n);var l=f.attr("id")===TS.templates.makeMsgDomIdInConversation(r)||f.attr("id")===TS.templates.makeMsgDomIdInThreadsView(r);o.remove_broadcast&&!l?TS.msg_edit.startRemoveBroadcast(TS.msg_edit.current_msg.ts,TS.msg_edit.current_model_ob,true):o.delete_msg?TS.msg_edit.startDelete(TS.msg_edit.current_msg.ts,TS.msg_edit.current_model_ob,TS.msg_edit.onCancelEdit,true):TS.msg_edit.onConfirmEdit("~"+a.text.replace(/~/g,"")+"~");return}var u=TS.ui.needToBlockAtChannelKeyword(t,null,TS.msg_edit.current_model_ob.id);if(u){TS.generic_dialog.alert("<p>"+TS.interop.i18n.t("A Workspace Owner has restricted the use of <strong>{blocked_keyword}</strong> messages.","msg_edit")({blocked_keyword:TS.interop.i18n.safeString(_.escape(u))})+"</p>");return}if(!$.trim(t))return;TS.msg_edit.onConfirmEdit(t)});g.find("#commit_edit").bind("click",function(){TS.msg_edit.checkAndSubmit(T,g)});g.find("#cancel_edit").bind("click",function(){TS.msg_edit.onCancelEdit()});g.bind("mousedown",function(){TS.msg_edit.mousedown_active=true});g.bind("mouseup",function(){TS.msg_edit.mousedown_active=false});var v=g.find(".emo_menu");v.removeClass("hidden");v.bind("click.open_dialog",function(e){TS.ui.react_emoji_menu.start({e:e,input_to_fill:"#msg_text"})});S.find(".edit_controls").scrollintoview({duration:500,px_offset:-50,complete:function e(){TS.msg_edit.focusAndSetCursorPosition(T,i)}});TS.msg_edit.onCountDownInterval();TS.msg_edit.edit_interv=setInterval(TS.msg_edit.onCountDownInterval,1e3)},isMessageTooLong:function e(t){var r=TS.format.cleanMsg(TS.utility.contenteditable.value(t));return r.length>TS.interop.constants.MAX_MESSAGE_INPUT_LENGTH},updateTooLongWarning:function e(t,r){var n=$(t).parent().find(".edit_warning");r?n.removeClass("hidden"):$(t).parent().find(".edit_warning").addClass("hidden")},checkLengthAndUpdateMessage:function e(t){var r=TS.msg_edit.isMessageTooLong(t);TS.msg_edit.updateTooLongWarning(t,r);return!r},checkAndSubmit:function e(t,r){TS.msg_edit.checkLengthAndUpdateMessage(t)&&r.submit()},onConfirmEdit:function e(t){if(!TS.msg_edit.current_msg){TS.error("no TS.msg_edit.current_msg?");return null}if(!t){TS.error("no edited_text?");return null}TS.msg_edit.commitEditInternal(t);TS.msg_edit.resetEditUI()},onCancelEdit:function e(){if(!TS.msg_edit.current_msg){TS.error("no TS.msg_edit.current_msg?");return null}TS.msg_edit.resetEditUI()},resetEditUI:function e(){clearInterval(TS.msg_edit.edit_interv);if(!TS.msg_edit.current_msg){TS.error("no TS.msg_edit.current_msg?");return null}TS.msg_edit.getDivBeingEdited().removeClass("hidden");$("#message_edit_container").remove()},getDivBeingEdited:function e(){if(TS.msg_edit.editing_in_msg_pane)return TS.msg_edit.getDivForMsgInMsgPane(TS.msg_edit.current_msg.ts);if(TS.msg_edit.editing_in_convo_pane)return TS.msg_edit.getDivForMsgInConvoPane(TS.msg_edit.current_msg.ts);return $()},getDivForMsgInMsgPane:function e(t){var r=TS.model.unread_view_is_showing;var n=TS.model.threads_view_is_showing;if(r)return $("#"+TS.templates.makeMsgDomIdInUnreadView(t));if(n)return $("#"+TS.templates.makeMsgDomIdInThreadsView(t));return $("#"+TS.templates.makeMsgDomId(t))},getDivForMsgInConvoPane:function e(t){return $("#"+TS.templates.makeMsgDomIdInConversation(t))},getAllDivsForMsg:function e(t){var r=TS.msg_edit.getDivForMsgInMsgPane(t);return r.add(TS.msg_edit.getDivForMsgInConvoPane(t))},commitEditInternal:function e(t){TS.msg_edit.commitEdit(TS.msg_edit.current_msg,TS.msg_edit.current_model_ob,t)},commitEdit:function e(r,n,i,a,s){if(!r){TS.error("no msg?");return null}if(!n){TS.error("no model_ob?");return null}a||(a=0);s||(s=100);var o=function e(a,s,o){if(a){var l=false;TS.interop.rules.messages.isReply(r)&&r.text!==s.text&&(l=true);if(TS.web||n.is_channel&&!n.is_member||l){var u=_.extend({},r,{text:s.text,edited:{ts:TS.interop.datetime.makeTsStamp(null,{padder:"0"})}});TS.utility.msgs.replaceMsg(n,u)}}else{if(s&&s.error)if("message_not_found"===s.error){if(o._attempts<10){o._delay_ms*=1.75;setTimeout(function(){TS.msg_edit.commitEdit(r,n,i,o._attempts+1,o._delay_ms)},o._delay_ms);return}n.is_channel?TS.channels.legacyRemoveMsg(n.id,r):n.is_im?TS.ims.legacyRemoveMsg(n.id,r):n.is_mpim?TS.mpims.legacyRemoveMsg(n.id,r):n.is_group&&TS.groups.legacyRemoveMsg(n.id,r);TS.generic_dialog.alert(TS.interop.i18n.t("Sorry, something went wrong with editing your message. Try again in a moment.","msg_edit")(),TS.interop.i18n.t("Message editing failed","msg_edit")())}else if("edit_window_closed"===s.error){var d="<p>"+TS.interop.i18n.t("Sorry, but messages can only be edited for <strong>{msg_edit_duration_text}</strong> after posting.","msg_edit")({msg_edit_duration_text:t(TS.prefs.getTeamPref("msg_edit_window_mins"))})+"</p>";TS.model.user.is_admin&&(d+="<p>"+TS.interop.i18n.t('(To adjust the message editing window, visit <a href="/admin/settings#message_editing" target="_new">Workspace&nbsp;Settings</a>.)',"msg_edit")()+"</p>");TS.generic_dialog.alert(d,TS.interop.i18n.t("Message editing failed","msg_edit")())}else"msg_too_long"===s.error?TS.generic_dialog.alert(TS.interop.i18n.t("Sorry, your message is too long. Please shorten it and try again.","msg_edit")(),TS.interop.i18n.t("Message editing failed","msg_edit")()):TS.generic_dialog.alert(TS.interop.i18n.t("Sorry, something went wrong with editing your message. Try again in a moment.","msg_edit")(),TS.interop.i18n.t("Message editing failed","msg_edit")());else TS.generic_dialog.alert(TS.interop.i18n.t("Sorry, something went wrong with editing your message. Try again in a moment.","msg_edit")(),TS.interop.i18n.t("Message editing failed","msg_edit")());TS.msg_edit.startEdit(r.ts,n,{text:i,force_reopen:true})}};return TS.interop.api.call("chat.update",{channel:n.id,ts:r.ts,text:TS.format.cleanMsg(i),_attempts:a,_delay_ms:s}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;o(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;o(i,t,r,n);return{data:t,args:r,request_id:n}})},promptEdit:function e(){if("none"!==$("#message_editing_info").css("display")){$("#message_edit_container").scrollintoview({duration:300,px_offset:0});return}$("#message_editing_info").css("display","");$("#message_editing_info").css("opacity",0);$("#message_edit_container").scrollintoview({duration:300,px_offset:0,complete:function e(){$("#message_editing_info").transition({opacity:1},250)}})},startDelete:function t(r,n,i,s,o){o=o||_.noop;if(!r){TS.error("no msg_ts?");o();return null}_.isString(n)&&(n=TS.redux.channels.getEntityById(n));if(!n){TS.error("no model_ob?");o();return null}var l=TS.redux.messages.getMessageByTimestamp(n.id,r);l&&l.file&&(l=a({},l,{file:TS.redux.files.getFileById(l.file)}));l||(l=TS.utility.msgs.getMsg(r,e(n)));if(!l){TS.error("no msg in msgs?");o();return null}TS.msg_edit.deleting_from_editing=!!s;TS.msg_edit.current_msg=l;TS.msg_edit.current_model_ob=n;var u=TS.msg_edit.getAllDivsForMsg(l.ts);var d='<p class="bottom_margin">'+TS.interop.i18n.t("Are you sure you want to delete this message? This cannot be undone.","msg_edit")()+"</p>";if(l.subtype){var c;if(l.file){c="file";"snippet"===l.file.mode?c="snippet":"post"===l.file.mode&&(c="post")}var m="";"file_upload"===l.subtype?"file"===c?m=TS.interop.i18n.t("Note that deleting this message will not delete the file that was uploaded.","msg_edit")():"snippet"===c?m=TS.interop.i18n.t("Note that deleting this message will not delete the snippet that was uploaded.","msg_edit")():"post"===c&&(m=TS.interop.i18n.t("Note that deleting this message will not delete the post that was uploaded.","msg_edit")()):"file_share"===l.subtype?"file"===c?m=TS.interop.i18n.t("Note that deleting this message will not unshare the file.","msg_edit")():"snippet"===c?m=TS.interop.i18n.t("Note that deleting this message will not unshare the snippet.","msg_edit")():"post"===c&&(m=TS.interop.i18n.t("Note that deleting this message will not unshare the post.","msg_edit")()):"file_comment"===l.subtype&&(m=TS.interop.i18n.t("Note that deleting this message will not delete the comment.","msg_edit")());m&&(d+="<p>"+m+"</p>")}u.addClass("delete_mode");TS.generic_dialog.start({title:TS.interop.i18n.t("Delete message","msg_edit")(),body:d+TS.templates.builders.msgs.buildHTML({msg:l,model_ob:n,standalone:true}),go_button_text:TS.interop.i18n.t("Delete","msg_edit")(),go_button_class:"btn_danger",onGo:function e(){TS.msg_edit.deleting_from_editing&&TS.redux.dispatch(TS.interop.redux.features.messageEdit.stopEditingMessage({channelId:n.id,ts:r}));TS.msg_edit.commitDeleteInternal(i)},onCancel:function e(){TS.msg_edit.onCancelDelete()},onEnd:o});TS.generic_dialog.div.find("img.msg_inline_img.hidden").each(function(e,t){var r=$(t);r.prop("src",r.data("real-src"));r.removeClass("hidden")})},onCancelDelete:function e(){if(!TS.msg_edit.current_msg){TS.error("no TS.msg_edit.current_msg?");return null}var t=TS.msg_edit.getAllDivsForMsg(TS.msg_edit.current_msg.ts);t.removeClass("delete_mode");TS.msg_edit.deleting_from_editing&&TS.utility.contenteditable.focus($("#msg_text"))},commitDeleteInternal:function e(t){TS.msg_edit.commitDelete(TS.msg_edit.current_msg,TS.msg_edit.current_model_ob,TS.msg_edit.onCancelDelete,t)},commitDelete:function t(r,n,i,a,s,o,l){if(!r){TS.error("no msg?");return null}if(!n){TS.error("no model_ob?");return null}var u=n.id;o||(o=0);l||(l=100);if(r.is_ephemeral||TS.interop.rules.messages.isTempMsg(r))n.is_channel?TS.channels.legacyRemoveMsg(n.id,r):n.is_im?TS.ims.legacyRemoveMsg(n.id,r):n.is_mpim?TS.mpims.legacyRemoveMsg(n.id,r):n.is_group&&TS.groups.legacyRemoveMsg(n.id,r);else{if(r._jl_rollup_hash&&r._jl_rollup_hash.msg_ids){var d=r._jl_rollup_hash.msg_ids;d.forEach(function(t){if(t==r.ts)return;var d=function t(o,l,u){if(o||"message_not_found"===l.error){if("message_not_found"===l.error&&u._attempts<10){u._delay_ms*=1.75;setTimeout(function(){TS.msg_edit.commitDelete(r,n,i,a,s,u._attempts+1,u._delay_ms)},u._delay_ms);return}(TS.web||n.is_channel&&!n.is_member)&&(n.is_channel?TS.channels.legacyRemoveMsg(n.id,TS.utility.msgs.getMsg(u.ts,e(n))):n.is_im?TS.ims.legacyRemoveMsg(n.id,TS.utility.msgs.getMsg(u.ts,e(n))):n.is_mpim?TS.mpims.legacyRemoveMsg(n.id,TS.utility.msgs.getMsg(u.ts,e(n))):n.is_group&&TS.groups.legacyRemoveMsg(n.id,TS.utility.msgs.getMsg(u.ts,e(n))))}};TS.interop.api.call("chat.delete",{channel:u,ts:t,_attempts:o,_delay_ms:l}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;d(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;d(i,t,r,n);return{data:t,args:r,request_id:n}})})}var c=function e(t,o,l){if(t||"message_not_found"===o.error){if("message_not_found"===o.error&&l._attempts<10){l._delay_ms*=1.75;setTimeout(function(){TS.msg_edit.commitDelete(r,n,i,a,s,l._attempts+1,l._delay_ms)},l._delay_ms);return}(TS.web||n.is_channel&&!n.is_member)&&(n.is_channel?TS.channels.legacyRemoveMsg(n.id,r):n.is_im?TS.ims.legacyRemoveMsg(n.id,r):n.is_mpim?TS.mpims.legacyRemoveMsg(n.id,r):n.is_group&&TS.groups.legacyRemoveMsg(n.id,r));a&&a()}else{i&&i();if(!s){var u;u=o&&o.error?TS.interop.i18n.t("The message was not deleted. The error was: {error}","msg_edit")({error:o.error}):TS.interop.i18n.t("The message was not deleted. The error was: unknown","msg_edit")();TS.generic_dialog.start({title:TS.interop.i18n.t("Delete Message Failed","msg_edit")(),body:u,show_cancel_button:false,esc_for_ok:true})}}if(TS.web){var d=!TS.utility.msgs.getDisplayedMsgs(n.msgs).length;if(d){var c=$(".pager .previous a");c.attr("href")?window.location=c.attr("href"):TS.reload(false,"TS.msg_edit.commitEdit")}}};TS.interop.api.call("chat.delete",{channel:u,ts:r.ts,_attempts:o,_delay_ms:l}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;c(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;c(i,t,r,n);return{data:t,args:r,request_id:n}})}},$last_clicked_cb:null,startBatchDelete:function e(){$("#msgs_div").addClass("selecting_messages");$("#channel_actions_div").addClass("hidden");$("#batch_delete_div").removeClass("hidden");TS.msg_edit.batchDeleteSelectionChanged()},cancelBatchDelete:function e(){TS.msg_edit.selectNoneBatchDelete();$("#msgs_div").removeClass("selecting_messages");$("#channel_actions_div").removeClass("hidden");$("#batch_delete_div").addClass("hidden")},doBatchDelete:function t(){var r=$("#msgs_div").find(".msg_select_cb:checked");var n=TS.shared.legacyGetActiveModelOb();if(r.length){var i=r.length;if(1==i){TS.msg_edit.startDelete(r.eq(0).closest(".message").data("ts"),n,TS.msg_edit.cancelBatchDelete);return}var a='<p class="small_bottom_margin">'+TS.interop.i18n.t("Are you sure you want to delete {count, plural, =1 {this message} other {these messages}}? This cannot be undone! Note that deleting these messages will not delete any files or file comments.","msg_edit")({count:i})+"</p>";var s;var o;for(var l=0;l<i;l+=1){o&&!o.no_display&&(s=o);var u=r.eq(l).closest(".message").data("ts");o=TS.utility.msgs.getMsg(u,e(n));if(!o)continue;a+=TS.templates.builders.msgs.buildHTML({msg:o,prev_msg:s,model_ob:n,standalone:true})}var d=function e(t){function r(e){TS.msg_edit.commitDelete(e,n,i,i,true)}function i(){if(t.length)setTimeout(function(){r(t.pop())},100);else{TS.generic_dialog.cancel();TS.generic_dialog.start({title:"",body:TS.interop.i18n.t("Messages deleted.","msg_edit")(),show_cancel_button:false,esc_for_ok:true})}}TS.generic_dialog.start({title:"",body:"<p>"+TS.interop.i18n.t("Deleting messages...","msg_edit")()+"</p>",show_cancel_button:false,show_go_button:false});i()};TS.generic_dialog.start({title:TS.interop.i18n.t("Delete Messages","msg_edit")(),body:a,go_button_text:TS.interop.i18n.t("Yes, delete these messages","msg_edit")(),go_button_class:"btn_danger",onGo:function t(){var a=[];for(var s=0;s<i;s+=1){var o=r.eq(s).closest(".message").data("ts");if(!o){alert("no msg_ts");return}var l=TS.utility.msgs.getMsg(o,e(n));if(!l){alert("no msg");return}a.push(l)}TS.msg_edit.cancelBatchDelete();d(a)}})}},batchDeleteSelectionChanged:function e(t,r){var n=TS.msg_edit.$last_clicked_cb;if(n&&t&&r){var i=$("#msgs_div").find(".msg_select_cb:visible");var a=i.index(n);var s=i.index(t);if(a>s){s=a;a=i.index(t)}var o="checked"===n.prop("checked");for(var l=a;l<=s;l+=1)i.eq(l).prop("checked",o)}n=t;TS.msg_edit.$last_clicked_cb=n;var u=TS.interop.i18n.t("0 messages","msg_edit")();var d=$("#msgs_div").find(".msg_select_cb:checked");$("#msgs_div").find(".multi_delete_mode").removeClass("multi_delete_mode");if(d.length){u=TS.interop.i18n.t("{count, plural, =1 {# message} other {# messages}}","msg_edit")({count:d.length});$("#batch_delete_button").removeClass("disabled");d.each(function(){$(this).closest(".message").addClass("multi_delete_mode")})}else $("#batch_delete_button").addClass("disabled");$("#batch_delete_count_span").html(u)},selectAllBatchDelete:function e(){$("#msgs_div").find(".msg_select_cb:visible").prop("checked",true);TS.msg_edit.batchDeleteSelectionChanged()},selectNoneBatchDelete:function e(){$("#msgs_div").find(".msg_select_cb:visible").prop("checked",false);TS.msg_edit.batchDeleteSelectionChanged()},startRemoveBroadcast:function e(t,r,n,i){i=i||_.noop;_.isString(r)&&(r=TS.redux.channels.getEntityById(r));var a=TS.utility.msgs.findMsg(t,r.id);if(!a){TS.error("Cannot find "+t+" for startRemoveBroadcast");i();return}TS.msg_edit.deleting_from_editing=!!n;TS.msg_edit.current_msg=a;TS.msg_edit.current_model_ob=r;var s=TS.msg_edit.getDivForMsgInMsgPane(t);var o=r.is_channel||r.is_group&&!r.is_mpim;var l=TS.templates.builders.msgs.buildHTML({msg:a,model_ob:r,standalone:true});var u=TS.templates.thread_confirm_remove_broadcast({is_channel_or_group:o,msg_html:new Handlebars.SafeString(l)});s.addClass("delete_mode");var d;d=o?TS.interop.i18n.t("Remove from channel","msg_edit")():TS.interop.i18n.t("Remove from conversation","msg_edit")();TS.generic_dialog.start({title:d,body:u,go_button_text:TS.interop.i18n.t("Remove message","msg_edit")(),onGo:function e(){TS.msg_edit.deleting_from_editing&&TS.msg_edit.onCancelEdit();TS.interop.api.call("chat.delete",{channel:r.id,ts:a.ts,broadcast_delete:true}).then(function(){TS.redux.dispatch(TS.interop.redux.features.messageEdit.stopEditingMessage({channelId:r.id,ts:a.ts}));TS.web&&(r.is_channel?TS.channels.legacyRemoveMsg(r.id,a):r.is_im?TS.ims.legacyRemoveMsg(r.id,a):r.is_mpim?TS.mpims.legacyRemoveMsg(r.id,a):r.is_group&&TS.groups.legacyRemoveMsg(r.id,a))}).catch(function(e){TS.error("Failed to remove broadcast "+a.ts);TS.error(e);TS.msg_edit.current_msg===a&&TS.msg_edit.onCancelDelete()})},onCancel:function e(){TS.msg_edit.onCancelDelete()},onEnd:i})},pauseEditing:function e(){if(!TS.msg_edit.editing)return;var t=$("#msg_text");var r=TS.utility.contenteditable.value(t);var n=TS.utility.contenteditable.cursorPosition(t);var i={msg_ts:TS.msg_edit.current_msg.ts,model_ob:TS.msg_edit.current_model_ob,text:r,cursor_start:n.start,cursor_length:n.length};TS.msg_edit.resetEditUI();return i},resumeEditing:function e(t){if(TS.msg_edit.editing)return;if(!t)return;if(TS.model.active_cid!==t.model_ob.id)return;TS.msg_edit.startEdit(t.msg_ts,t.model_ob,t)},focusAndSetCursorPosition:function e(t,r){TS.utility.contenteditable.focus(t);TS.utility.rAF(function(){r&&_.isFinite(r.cursor_start)&&_.isFinite(r.cursor_length)?TS.utility.contenteditable.cursorPosition(t,r.cursor_start,r.cursor_length):TS.utility.contenteditable.cursorPosition(t,1e8,0)})}});var e=function e(t){return t.msgs};var t=function e(t){return TS.interop.datetime.toTimeDuration(t,{units:"minutes"})}})()},wTVA:function(e,t){function r(e){if(Array.isArray(e))return e}e.exports=r},weHv:function(e,t){(function(){TS.registerModule("redux.presence",{onStart:function e(){n()},getPresenceByMemberId:function t(r){return e(r)},toggleUserPresence:function e(){return TS.redux.dispatch(TS.interop.redux.features.presence.toggleUserPresence())},updatePresenceForMember:function e(t){if(!t||!t.id)return;TS.redux.dispatch(TS.interop.redux.features.presence.updatePresence({memberId:t.id,presence:t.presence}))},addToBulkUpsertPayload:function e(r){if(!r)return;var n=r.id;var i=r.presence;t[n]=i},test:function e(){var t={};return t}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.features.presence.getPresenceByMemberId");var t={};var r=function e(){if(t.length){TS.redux.dispatch(TS.interop.redux.features.presence.bulkUpdatePresence(t));t={}}};var n=function e(){TS.members.presence_changed_sig.add(TS.redux.presence.updatePresenceForMember);TS.members.batch_upserted_sig.add(r)}})()},wkBT:function(e,t){function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}e.exports=r},zkfd:function(e,t,r){var n=r("lSNA");function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}));r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),true).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}(function(){TS.registerModule("teams",{added_sig:new signals.Signal,rename_sig:new signals.Signal,changed_icon_sig:new signals.Signal,changed_is_unknown_sig:new signals.Signal,unknown_resolution_rebuild_sig:new signals.Signal,onStart:function e(){TS.teams.changed_icon_sig.add(r);TS.teams.rename_sig.add(r);TS.teams.added_sig.add(s);TS.team.team_name_changed_sig.add(s)},getTeamById:function e(t,r){if(!_.isString(t))return null;return TS.redux.teams.getTeamById(t,r)},getAllExternalTeams:function e(){var t=TS.interop.teams.getAllExternalTeams(TS.redux.getState());return t.reduce(function(e,t){return a({},e,n({},t.id,t))},{})},isPartOfMyOrg:function e(t){if(!_.isObject(t))return false;var r=m();return r&&r===t.enterprise_id},getAllEnterpriseTeams:function e(){return _.pickBy(TS.redux.teams.getAllTeams(),TS.teams.isPartOfMyOrg)},getEnterpriseTeams:function e(t){t=_.isObject(t)?t:{};var r=TS.teams.getAllEnterpriseTeams();t.only_member_of&&(r=_.pickBy(r,function(e){return TS.model.user.enterprise_user.teams.indexOf(e.id)>-1}));t.exclude_current_team&&(r=_.omitBy(r,function(e){return e.id===TS.model.team.id}));return r},getTeamByDomain:function e(t){if(!_.isString(t))return null;return TS.redux.teams.getTeamByDomain(t)},getTeamByMsg:function e(t){if(!_.isObject(t))return null;var r=t.source_team_id;if(!r)return null;var n=TS.teams.getTeamById(r);if(n)return n;return null},getTeamNameByMember:function e(t){if(!_.isObject(t)||!t.team_id)return null;var r=TS.teams.getTeamById(t.team_id);return TS.interop.rules.teams.getTeamDisplayName(r)},getTeamNameByMemberId:function e(t){if(!_.isString(t))return null;var r=TS.interop.members.getMemberById(t);if(!r)return null;var n=TS.teams.getTeamById(r.team_id);return TS.interop.rules.teams.getTeamDisplayName(n)},getTeamNameById:function e(t){var r=TS.teams.getTeamById(t);return TS.interop.rules.teams.getTeamDisplayName(r)},updateTeamName:function e(t){if(!t.name)return;var r=false;var n=TS.teams.getTeamById(t.source_team,r);if(!n)return;n=_.clone(n);n.name=t.name;TS.teams.rename_sig.dispatch(TS.redux.teams.upsertTeam(n))},updateTeamIcon:function e(t){if(!t.icon)return;var r=false;var n=TS.teams.getTeamById(t.source_team,r);if(!n)return;n=_.clone(n);n.icon=t.icon;TS.teams.changed_icon_sig.dispatch(TS.redux.teams.upsertTeam(n))},ensureTeamsArePresent:function e(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"TS.teams.ensureTeamsArePresent";if(!_.isArray(r))return Promise.reject(Error("t_ids is not an array"));var i=_.filter(r,function(e){var t=false;var r=TS.teams.getTeamById(e,t);return!r||r._other_account});if(!i.length)return Promise.resolve();return t(i,n)},ensureTeamsInDataArePresent:function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"TS.teams.ensureTeamsInDataArePresent";var n=TS.interop.utility.extractAllTeamIds(t);return TS.teams.ensureTeamsArePresent(n,r)},ensureSharedTeamsForMember:function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"TS.teams.ensureSharedTeamsForMember";if(!t)return Promise.resolve();return TS.teams.ensureTeamsArePresent(o(t),r)},getSharedTeamsForMember:function e(t){if(!t)return[];return _.map(o(t),function(e){return TS.teams.getTeamById(e)})},promiseToSearchTeams:function e(t){if(!m())return Promise.resolve(t);return Promise.resolve(t).then(function(e){if(!e)return Promise.reject(new Error("No search parameters provided"));e=l(e);if(e._is_new||e.num_remaining>0)return d(e);return Promise.resolve(e)})},test:function e(){var r={_getSharedTeamIdsForMember:o};Object.defineProperty(r,"_readyTeamSearcher",{get:function e(){return l},set:function e(t){l=t}});Object.defineProperty(r,"_promiseToSearchTeamsWorker",{get:function e(){return c},set:function e(t){c=t}});Object.defineProperty(r,"_buildPromiseToSearchTeamsArguments",{get:function e(){return u},set:function e(t){u=t}});Object.defineProperty(r,"_getTeamsByIdFromApi",{get:function e(){return t},set:function e(r){t=r}});return r}});var e=100;var t=function e(t,r){if(!_.isArray(t))return Promise.reject(Error("t_ids is not an array"));var n=250;var i=_.chunk(t,n);return Promise.map(i,function(e){return TS.interop.api.callExpedited("team.info",{teams:e,_x_reason:r}).then(function(t){var r=[];t.data.teams.forEach(function(t){t&&t.id&&"E"===t.id.charAt(0)?TS.warn("EVALUE-1721: team.info response included an Enterprise org of "+t.id+". NOT adding to model. Client requested teams="+e.join(", ")+"."):r.push(TS.redux.teams.upsertTeam(t))});return r}).catch(function(t){TS.error("_getTeamsByIdFromApi failed with "+(t.data&&t.data.error||"unknown error")+", when requesting teams="+e.join(", "))})}).then(function(e){return _.compact(_.flatten(e))})};var r=function e(t){t.id!==TS.model.team.id&&i(t);s(t)};var i=function e(t){if(!_.isObject(t))return;var r=TS.utility.teams.getMembersForTeam(t);if(!r.length)return;_.forEach(r,function(e){TS.members.changed_profile_sig.dispatch(e)})};var s=function e(t){if(!_.isObject(t))return;var r=TS.shared.legacyGetActiveModelOb();if(!r||!TS.interop.rules.channels.isExternallySharedChannel(r))return;var n=TS.redux.getState();var i=_.uniq(TS.interop.rules.channels.getConnectedTeamIds(n,r).unshift(TS.interop.selfTeamIds.getTopLevelTeamId(n)));_.indexOf(i,t.id)>-1&&TS.channels.shared_teams_updated_sig.dispatch(r)};var o=function e(t){if(!t)return[];if(_.get(t,"enterprise_user"))return _.intersection(_.get(t,"enterprise_user.teams",[]),_.get(TS.model.user,"enterprise_user.teams",[]));if(_.get(t,"team_id")===_.get(TS.model.user,"team_id"))return[t.team_id];return[]};var l=function e(t){t=t||{};t._is_new=false;t.hasOwnProperty("query")||(t.query="");t.hasOwnProperty("additional_args")||(t.additional_args={});if(t._last_query!==t.query){t.hasOwnProperty("_searcher_p")&&t._searcher_p.cancel();t._last_query=t.query;t._is_new=true;t._cursor_mark=null;t.items=[]}if(!_.isEqual(t._last_additional_args,t.additional_args)){t.hasOwnProperty("_searcher_p")&&t._searcher_p.cancel();t._last_additional_args=_.assign({},t.additional_args);t._is_new=true;t._cursor_mark=null;t.items=[]}return t};var u=function t(r){var n=[TS.utility.search.makeClause("is","team")];r.query&&n.push(TS.utility.search.makeClause("fuzzy",r.query));_.get(r,"included_ids.length")&&(1===r.included_ids.length?n.push(TS.utility.search.makeClause("id",_.head(r.included_ids))):n.push(TS.utility.search.makeConjunction("or",_.map(r.included_ids,function(e){return TS.utility.search.makeClause("id",e)}))));var i={count:r.max_api_results||e,query:n.length>1?JSON.stringify(TS.utility.search.makeConjunction("and",n)):JSON.stringify(_.head(n))};_.isEmpty(_.get(r,"additional_args"))||(i=_.merge(i,r.additional_args));r._cursor_mark&&(i.cursor_mark=r._cursor_mark);return i};var d=function e(t){var r=function e(){return c(t)};t._is_new?t._searcher_p=r():t._searcher_p=t._searcher_p.then(r);return t._searcher_p};var c=function e(t){var r=_.get(t,"endpoint","search.enterprise");var n=_.get(t,"response_key","items");return TS.interop.api.call(r,u(t)).then(function(e){if(!t._cursor_mark){t.num_remaining=e.data.num_found;t.num_found=e.data.num_found}if(!e.data[n].length)return Promise.resolve(t);t.num_remaining-=e.data[n].length;t._cursor_mark=e.data.next_cursor_mark;var r=_.keyBy(t.omitted_ids,_.identity);var i=_(e.data[n]).filter(function(e){return!r[e.id]}).map(function(e){return TS.redux.teams.upsertTeam(e)}).value();t.num_found-=e.data[n].length-i.length;t.items=_.concat(t.items,i);return Promise.resolve(t)})};var m=function e(){return _.get(TS.model,"team.enterprise_id",TS.boot_data.enterprise_id)}})()},zmUN:function(e,t){(function(){TS.registerModule("ui.enterprise_teams_dialog",{show:function e(t){a(t)},test:function e(){var t={};Object.defineProperty(t,"_showTeamsDialog",{get:function e(){return a},set:function e(t){a=t}});Object.defineProperty(t,"_getTeamsDialogChannelTitle",{get:function e(){return s},set:function e(t){s=t}});Object.defineProperty(t,"_getTeamsDialogMemberTitle",{get:function e(){return o},set:function e(t){o=t}});return t}});var e="p-enterprise_teams_dialog";var t="enterprise_team_dialog";var r=null;function n(e){$(window.document).bind("keydown",i);var r=$(".p-searchable_enterprise_team_list");var n=new TS.SearchableEnterpriseTeamList({$container:r,id:t,model_ob_id:e.id,triggered_by_user_action:true});n.showInitial();r.on("click",".p-enterprise_team_row",TS.generic_dialog.cancel)}var i=function e(t){t.which==TS.utility.keymap.esc&&""===TS.generic_dialog.div.find("input").val()&&TS.generic_dialog.cancel()};var a=function a(l){var u=_.get(l,"id");if(r===u)return;r=u;var d=TS.templates.enterprise_teams_dialog();var c=TS.interop.utility.looksLikeMemberId(_.get(l,"id"));var m;if(c&&!_.get(l,"enterprise_user.teams.length"))return;if(!c&&!l.is_global_shared&&!TS.interop.rules.channels.getInternalTeamIds(TS.redux.getState(),l))return;m=c?o(l):s(l);TS.generic_dialog.start({dialog_class:e,title:m,body:d,cancel_button_text:TS.interop.i18n.t("Close","teams")(),hide_footer:true,show_cancel_button:true,show_go_button:false,backdrop_click_to_dismiss:true,onShow:function e(){n(l)},onEnd:function e(){var n=TS.SearchableEnterpriseTeamList.get(t);n&&n.destroy();TS.generic_dialog.div.remove();TS.generic_dialog.div=void 0;$(window.document).unbind("keydown",i);r=null}})};var s=function e(t){return t.is_global_shared?TS.interop.i18n.t("All workspaces in {channel_name}","teams")({channel_name:TS.interop.rules.channels.getDisplayNameForChannel(t)}):TS.interop.i18n.t("{team_count, number} workspaces in {channel_name}","teams")({team_count:TS.interop.rules.channels.getInternalTeamIds(TS.redux.getState(),t).length,channel_name:TS.interop.rules.channels.getDisplayNameForChannel(t)})};var o=function e(t){return TS.interop.i18n.t("Your {enterprise_name} workspaces","teams")({enterprise_name:_.escape(_.get(t,"enterprise_user.enterprise_name"))})}})()}},[["qYTV","webpack.manifest"]]]);